[{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"あああっ彼女からバレンタイン2日前にチョコくれるってメール来てたのに見落としたっっっ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%82%E3%81%82%E3%81%82%E3%81%A3%E5%BD%BC%E5%A5%B3%E3%81%8B%E3%82%89%E3%83%90%E3%83%AC%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%B32%E6%97%A5%E5%89%8D%E3%81%AB%E3%83%81%E3%83%A7%E3%82%B3%E3%81%8F%E3%82%8C%E3%82%8B%E3%81%A3%E3%81%A6%E3%83%A1%E3%83%BC%E3%83%AB%E6%9D%A5%E3%81%A6%E3%81%9F%E3%81%AE%E3%81%AB%E8%A6%8B%E8%90%BD%E3%81%A8%E3%81%97%E3%81%9F%E3%81%A3%E3%81%A3%E3%81%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eあああっ！彼女からバレンタイン2日前にチョコくれるってメール来てたのに見落としたっっっ！\u003c/h1\u003e\n\n\u003cp\u003e今どき珍しく、私は彼女との連絡手段に古き良きE-Mailを利用している。つまりはGMailを使っている。\u003c/p\u003e\n\n\u003cp\u003eさて、2020年のバレンタイン(2月14日)が近づいてきてたころ、私は大学の留年やら教育実習の挨拶やらでバレンタインどころの状態ではなかった。\u003c/p\u003e\n\n\u003cp\u003eまた彼女も正月に聞いた感じかなり忙しそうであった。\u003c/p\u003e\n\n\u003cp\u003eしたがって今年はバレンタインなしかなぁと思っていた。\u003c/p\u003e\n\n\u003cp\u003eさて、2月12日。一通のメールが届いていた。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eこんばんは！\u003c/p\u003e\n\n\u003cp\u003e14日、会えますかー？\u003cbr\u003e\nチョコ、そんなに好きじゃないみたいですけど、父にも作る予定なのでいくつかお渡ししようと。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eしかしながら前述の通りの状況でメールをチェックするような余力がなかった。気がついたのは私の誕生日である2月22日、そういえば彼女からメール着てるかな？と思って確認したときだ。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eバレンタイン、とっくに終わっとるやんけ！\u003c/strong\u003e どないしょう・・・。\u003c/p\u003e\n\n\u003cp\u003e実は彼女からのメールを見落とすのはなにも今回が初めてではない。まあそもそも彼女も私もそこまで頻繁に連絡を取ることに価値を見出していないので、さほど問題になってこなかったのであるが、\u003cstrong\u003e流石にバレンタインのチョコを逃すのはあかんやろ。\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e即座に彼女に謝罪のメールを投げつけたら翌日\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eはっ…こちらこそ昨日の連絡、忘れてました…\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eなどと許してくれたが、再発防止策は講じるべきだ。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"忙しくても確実に目を通しているものはなにか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%BF%99%E3%81%97%E3%81%8F%E3%81%A6%E3%82%82%E7%A2%BA%E5%AE%9F%E3%81%AB%E7%9B%AE%E3%82%92%E9%80%9A%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%82%82%E3%81%AE%E3%81%AF%E3%81%AA%E3%81%AB%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e忙しくても確実に目を通しているものはなにか\u003c/h1\u003e\n\n\u003cp\u003eかつてはTwitterを見ない日はなかったが、最近は毎日確実に見ているわけではない。\u003c/p\u003e\n\n\u003cp\u003eでは何なら見ているか。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eslack: 家族のやり取りや、ニコニコ動画ユーザー非公式交流slackに参加していて常時タブを開いている\u003c/li\u003e\n\u003cli\u003eQiitadon(Mastodon): 常時タブを開いているし、こまめに確認している。\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eというわけでこの2つに彼女からのメールを転送すれば流石にどっちかで気がつくだろう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"gmail---slack\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gmail---slack\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGMail -\u0026gt; Slack\u003c/h1\u003e\n\n\u003cp\u003eGMailからSlackに飛ばすのは恐ろしくかんたんだ。完全にSlackのAPIを叩く気満々で先行事例を探していた私は拍子抜けしてしまった。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://internet.watch.impress.co.jp/docs/column/slack_info/1192138.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e「Slack」と「Gmail」の連携機能をチェック！ 特定のメールをiPhoneにプッシュ通知する【週刊Slack情報局】 - INTERNET Watch\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eすなわち、GMailのメール転送機能でSlackの転送先メールアドレスに転送するだけだ。\u003c/p\u003e\n\n\u003cp\u003eもともと彼女からのメールにラベル付けと迷惑メールから除外する設定のためにGMailのフィルターを組んでいた私には2分で事足りた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"gmail---google-apps-script---qiitadonmastodon\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gmail---google-apps-script---qiitadonmastodon\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGMail --(Google Apps Script)--\u0026gt; Qiitadon(Mastodon)\u003c/h1\u003e\n\n\u003cp\u003eMastodonに通知を投げるには大きく2通りの方法がある。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eActivityPubを実装したサーバーアプリケーションを作成してそれを通知を受けたいアカウントでフォローする\u003c/li\u003e\n\u003cli\u003e通知を送る用のMastodonアカウントを作成してそれを通知を受けたいアカウントでフォロー、APIを使ってTooTを作成する\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eまあどう考えても後者のほうが楽なのでMastodon APIを叩くことにした。\u003c/p\u003e\n\n\u003cp\u003e有料ならZapierを使うとか言う方法もあるらしいが、流石にそんなことにお金を掛けたくない。\u003c/p\u003e\n\n\u003cp\u003eかつてはIFTTTを使う手段もあったようだが、2019年3月31日からその手段はできなくなっている。\u003c/p\u003e\n\n\u003cp\u003eで、GMailから対象のメールを引っ張るのも、Mastodonに投稿するのもAPIを叩くということは、それをするサーバーが必要なわけですが流石にVPSで一からやりたくないので、GoogleのAPIをかんたんに叩けるGoogle Apps Scriptを使うことにした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"開発環境をどうするか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%82%92%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e開発環境をどうするか。\u003c/h2\u003e\n\n\u003cp\u003eもはや現代においてGoogle Apps Scriptを書くとなればclasp+Typescriptが基本的人権と言っていい。\u003c/p\u003e\n\n\u003cp\u003e概ね\u003cbr\u003e\n\u003ca href=\"https://qiita.com/HeRo/items/f2ce057c6b1456e896ad\" id=\"reference-9ef4b1cce81fc3033874\"\u003eclasp が Typescript をサポートした！\u003c/a\u003e\u003cbr\u003e\nに従って環境を作った。\u003c/p\u003e\n\n\u003cp\u003eclaspを使ったので当然ソースコードはgit管理できる。と言うわけで成果物が\u003cbr\u003e\n\u003ca href=\"https://github.com/yumetodo/gmail2mastodon\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/gmail2mastodon\u003c/a\u003e\u003cbr\u003e\nこれだ。\u003c/p\u003e\n\n\u003cp\u003eちなみにGASといえば、最近実行エンジンがV8に切り替わったという衝撃のニュースが業界を駆け巡ったが、残念ながらclaspはこれに対応していない。というのも、GASへのソースコードアップロードに使われる \u003ca href=\"https://developers.google.com/apps-script/api/reference/rest/v1/projects/updateContent\" rel=\"nofollow noopener\" target=\"_blank\"\u003eREST APIサーバー\u003c/a\u003e側で、何かしらのvalidateが走った結果、ナウでヤングな記法のJavaScriptファイルを受け取ると400を突き返すらしい。OSSであるclasp側ではどうにもならず、Google内部での作業が不可欠だ。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/google/clasp/issues/735\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebuild option for V8 runtime · Issue #735 · google/clasp\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/google/clasp/pull/739\" rel=\"nofollow noopener\" target=\"_blank\"\u003eV8 engine support by PopGoesTheWza · Pull Request #739 · google/clasp\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e追記: という話だったのだが、Issueに「でもうまく行ったぜ？」って書き込みがあったので私も試したらうまくいった。なんかもうすこし細かい条件があるのかも\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"投稿用のmastodonアカウント作成とmastodon-api-tokenの取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8A%95%E7%A8%BF%E7%94%A8%E3%81%AEmastodon%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E4%BD%9C%E6%88%90%E3%81%A8mastodon-api-token%E3%81%AE%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e投稿用のMastodonアカウント作成とMastodon API tokenの取得\u003c/h2\u003e\n\n\u003cp\u003e今回はなんとなく\u003cbr\u003e\n\u003ca href=\"https://mstdn.maud.io\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://mstdn.maud.io\u003c/a\u003e\u003cbr\u003e\nにアカウントを作ることにした。\u003c/p\u003e\n\n\u003cp\u003eところがアカウントを作るだけの簡単なお仕事のはずが罠があった。\u003c/p\u003e\n\n\u003cp\u003eQiitadonが採用しているMastodonのバージョンにはないが、その後追加された機能としてBOTフラグ(正式名称はしらない)がある。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F857a62d1-c2cb-b5d0-2bb1-ec12266edb3c.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8a8a6b27d906809643f2b9c78d417aa5\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F857a62d1-c2cb-b5d0-2bb1-ec12266edb3c.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8a8a6b27d906809643f2b9c78d417aa5\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/857a62d1-c2cb-b5d0-2bb1-ec12266edb3c.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F857a62d1-c2cb-b5d0-2bb1-ec12266edb3c.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=102e373833add9dab533f8d4056a870d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eこのアカウントは主に自動で動作し、人が見ていない可能性があります\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eということをアピールできる。もちろん今回やろうとしていることはまさにBOTなのでこれをチェックしていた。\u003c/p\u003e\n\n\u003cp\u003eところがその状態だとQiitadonのようなBOTフラグを実装していないバージョンのMastodonインスタンスからは、そのアカウントが見えなくなる。つまりリモートフォローできないし、メンションも投げられないし、BOTフラグが立ってる側からのリモートフォローもできない。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/paihu\" class=\"user-mention js-hovercard\" title=\"paihu\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"paihu\"\u003e@paihu\u003c/a\u003e さんのファインプレーがなかったら未だにさまよってたに違いない。\u003cbr\u003e\n\u003ca href=\"https://qiitadon.com/web/statuses/103711452923765332\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://qiitadon.com/web/statuses/103711452923765332\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eあとは普通にtokenを取ればいい。今回、権限は\u003ccode\u003eread write:statuses\u003c/code\u003eにしておいた。readいらんかった感あるけど。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"設定ファイルをどうするか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定ファイルをどうするか\u003c/h2\u003e\n\n\u003cp\u003e通知を投げるMastodonのインスタンス名であるとか、通知の送り先とか、TooTの文字数制限とか、転送対象のメールアドレスといった情報は、ソースコードに埋め込みたくないし、git repoにすら含めたくない。というか彼女のメールアドレスが流失してしまうのは困る。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/tomboyboy/items/6a15ab1a4838bd6b7f9d\" id=\"reference-5d4ee839647b0481f303\"\u003eGASで永続化する方法まとめ（設定や処理結果を保存・読み込みしたい時）\u003c/a\u003e\u003cbr\u003e\nを眺めた結果、JSONで書いてGoogle Driveに置くことにした。それを実行時にGASから読み取る。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"json-schema\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#json-schema\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJSON schema\u003c/h3\u003e\n\n\u003cp\u003e設定を書くときにJSON schemaがあると便利だということを最近痛感している。そもそも何を書けばいいのか知るためにソースコードを見に行くのは論外だし、ドキュメントを読みに行くのも面倒すぎる。以下を参考にJSON schemaを書いた。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/arumi8go/items/a9530cbd39ff545a7bbb\" id=\"reference-254da5d02c17290a72e0\"\u003eJSON Schemaと友達になる為の記事\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://json-schema.org/draft/2019-09/json-schema-core.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJSON Schema: A Media Type for Describing JSON Documents\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cswr.github.io/JsonSchema/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eJSON Schema\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"$schema\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"https://json-schema.org/draft/2019-09/schema\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"title\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"gmail2mastodon setting file\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"object\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"properties\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"maxTootLength\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"description\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"max Toot length on your instance\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"number\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"targetEMailAdresses\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"description\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"E-Mail adresses that you want to notify\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"array\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"items\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n                \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"description\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"E-Mail adress\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n                \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"string\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"mastodonInstance\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"description\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"The mastodon instance this bot use\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"string\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"pattern\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"[^/?#]*\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"mastodonReciveUserId\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"description\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Your userid that recive notification\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"type\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"string\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれを使ってjsonを書くには\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"$schema\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"https://raw.githubusercontent.com/yumetodo/gmail2mastodon/master/scheme.json\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"mastodonInstance\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"mstdn.maud.io\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"mastodonReciveUserId\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"@yumetodo@qiitadon.com\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"maxTootLength\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e500\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"targetEMailAdresses\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"w\"\u003e\n    \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"xxx@example.com\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように\u003ccode\u003e$schema\u003c/code\u003eで指定すれば良い。なおここのURLは、サーバーが返すcontent-typeなどはどうでも良いらしく、gistやgithubのrawボタンで手に入るURLでも良いようだ(VSCode上での挙動)。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"google-drive-api\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#google-drive-api\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGoogle Drive API\u003c/h3\u003e\n\n\u003cp\u003eさて、そのjsonは\u003ccode\u003egmail2mastodon_settings/setting.json\u003c/code\u003eに置くことに決めた。あとはそれをGASから読み取ればいい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eexport\u003c/span\u003e \u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eGmail2MastodonSettingFile\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/**\n   * max Toot length on your instance\n   */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003emaxTootLength\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/**\n   * E-Mail adresses that you want to notify\n   */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003etargetEMailAdresses\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/**\n   * The mastodon instance this bot use\n   */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003emastodonInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/**\n   * Your userid that recive notification\n   */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003emastodonReciveUserId\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003egetFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparentName\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efiles\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eDriveApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esearchFiles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`title = \"\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//gmail2mastodon_settings\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eparents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetParents\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eparents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eparent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eparents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparentName\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eno such file: \u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ereadJson\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparentName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egmail2mastodon_settings\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ejsonName\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003esetting.json\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003egetFile\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparentName\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ejsonName\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetBlob\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003egetDataAsString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eどうもGoogle Drive APIにはパスという概念がこれでもかってくらい抹消されているらしい。そのため、\u003ccode\u003estd::ifstream(\"gmail2mastodon_settings/setting.json\")\u003c/code\u003eくらいでC++で手元で動かすなら書けそうな\u003cbr\u003e\n内容が上記のように膨れ上がった。\u003c/p\u003e\n\n\u003cp\u003eまずファイル名で検索を掛ける。これによって検索結果をたどるイテレータが手に入る。当然目的のファイル以外も引っかかる可能性がある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efiles\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eDriveApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esearchFiles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`title = \"\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e次にこれをループで回す。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"c1\"\u003e//後略\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eループの中では、改めて検索結果で得たファイル名とほしいファイル名を比較する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまた、親ディレクトリの名前を取得・比較する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eparents\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetParents\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eparents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasNext\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eparent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eparents\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparentName\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003eparent\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetName\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあとはJSONにパースしてあげればよい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econtent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetBlob\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003egetDataAsString\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eJSON\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eGmail2MastodonSettingFile\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ereadJson\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etargetEMailAdresses\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n  \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emastodonReciveUserId\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n  \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emastodonInstance\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e\n  \u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emaxTootLength\u003c/span\u003e\n\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003einvalid setting file\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"状態やmastodonのapi-tokenをどう持つか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%8A%B6%E6%85%8B%E3%82%84mastodon%E3%81%AEapi-token%E3%82%92%E3%81%A9%E3%81%86%E6%8C%81%E3%81%A4%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e状態やMastodonのAPI tokenをどう持つか\u003c/h2\u003e\n\n\u003cp\u003eMastodonのAPI tokenもまた公開できない情報だ。さっきの設定ファイルに書いたほうがスッキリしたかもしれないが、その技術検討より前にこちらを決定したという経緯から別の方法をとった。\u003c/p\u003e\n\n\u003cp\u003eまた状態を設定ファイルでなんとかするのは汚すぎる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/tomboyboy/items/6a15ab1a4838bd6b7f9d\"\u003eGASで永続化する方法まとめ（設定や処理結果を保存・読み込みしたい時）\u003c/a\u003e\u003cbr\u003e\nを眺めた結果、Properties Serviceを利用した。\u003c/p\u003e\n\n\u003cp\u003e読み書きするのは簡単で、\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eproperties\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ePropertiesService\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetScriptProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elastDateStr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003elastDate\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003elastDateStr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003emissing lastDate\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emastodonToken\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eScriptProperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003emastodonToken\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003emastodonToken\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003emissing mastodonToken\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように取得できる。書き出しは\u003ccode\u003eproperties.setProperty\u003c/code\u003eすればいい。\u003c/p\u003e\n\n\u003cp\u003e値を手動で設定するには、スクリプトエディターで、ファイル→プロジェクトのプロパティからダイアログがでる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fc06c0e07-c2dc-b912-3588-ce2b128a5b71.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ff89376a65f8fee3f285b2b1b4c9d98e\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fc06c0e07-c2dc-b912-3588-ce2b128a5b71.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=ff89376a65f8fee3f285b2b1b4c9d98e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/c06c0e07-c2dc-b912-3588-ce2b128a5b71.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fc06c0e07-c2dc-b912-3588-ce2b128a5b71.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=45fa49b0a0719546319ee2906342d989 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F54f0a3fd-c7eb-9fc1-4885-e8d65b55562e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=75d251575f4afb5d4c3db1168dcc475a\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F54f0a3fd-c7eb-9fc1-4885-e8d65b55562e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=75d251575f4afb5d4c3db1168dcc475a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/54f0a3fd-c7eb-9fc1-4885-e8d65b55562e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F54f0a3fd-c7eb-9fc1-4885-e8d65b55562e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2481690ac14d61fc0aac847428aa257c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"gmailからのメール取得\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#gmail%E3%81%8B%E3%82%89%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E5%8F%96%E5%BE%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eGMailからのメール取得\u003c/h2\u003e\n\n\u003cp\u003eこれは先行事例がたくさんある。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://tonari-it.com/gas-gmail-get-thread/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【GAS】Gmailの特定条件で検索したスレッドの全メールを取得してスプレッドシートに書き出す\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://asatte.biz/gmail-line/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogle Apps ScriptでGmailの特定のメールを受信したらLINEと連携して通知する\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://sitest.jp/blog/?p=3869\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogle Apps Scriptを使ってGmailの新着メールをChatWorkに通知してみた ｜ SiTest (サイテスト) ブログ\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"重複取得をどう回避するか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%87%8D%E8%A4%87%E5%8F%96%E5%BE%97%E3%82%92%E3%81%A9%E3%81%86%E5%9B%9E%E9%81%BF%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e重複取得をどう回避するか\u003c/h3\u003e\n\n\u003cp\u003eところがここで一つ問題がある。\u003c/p\u003e\n\n\u003cp\u003e先程のGoogle Drive API同様、GMail APIもまた、検索クエリを投げて絞り込みをしていくことになる。では前回の実行で取得済みであるものを弾くにはどうしたらいいだろうか？\u003c/p\u003e\n\n\u003cp\u003e上記の記事ではどれも取得したらメールを既読にしてしまう方法をとっている。しかし勝手に既読にされるのは困る。\u003c/p\u003e\n\n\u003cp\u003e記事執筆中に見つけた方法は\u003cbr\u003e\n\u003ca href=\"https://blog.adachin.me/archives/10188\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogleがIFTTTサポート終了!?GASでGmailの新着メールをLINE Notifyで通知させてみた! – ADACHIN SERVER LABO\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eget_interval\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//〇分前～現在の新着メールを取得 #--トリガーをこれに合わせておく！！\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e//取得間隔\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003enow_time\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eMath\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efloor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003egetTime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//現在時刻を変換\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003etime_term\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003enow_time\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e60\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003eget_interval\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e//変換\u003c/span\u003e\n\n  \u003cspan class=\"c1\"\u003e//検索条件指定\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003estrTerms\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e(is:unread after:\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003etime_term\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e)\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように、GASのトリガーの間隔と同じだけの幅の時間を対象にする方法だ。\u003c/p\u003e\n\n\u003cp\u003eしかし、これだとトリガー間隔を変えるのにコードをいじらないといけなくなるし、トリガーが本当に正確にキックされるかに依存してしまう。\u003c/p\u003e\n\n\u003cp\u003eそこで、実行時の時間をProperties Serviceに記録して、それを次回実行時に読み出すことにした。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"javascriptのdateとの格闘\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#javascript%E3%81%AEdate%E3%81%A8%E3%81%AE%E6%A0%BC%E9%97%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eJavaScriptのDateとの格闘\u003c/h3\u003e\n\n\u003cp\u003eJavaScriptのDateはクソの塊なので本当はmomentjsかなにかを使いたかったのだが、GASで外部ライブラリを使うのはそれこそ難しい。GASの外部ライブラリ機能はclaspでの手元開発と相性が悪いし、webpackすると場合によってはファイルサイズ制限に引っかかって動かなくなる。\u003c/p\u003e\n\n\u003cp\u003e仕方なくDateとの格闘を行った。\u003c/p\u003e\n\n\u003cp\u003eまずGASがどんなロケールで実行されるかわからないので、全てUTCで扱うことにした。\u003c/p\u003e\n\n\u003cp\u003eまた、Dateのコンストラクタ、ひいては\u003ccode\u003eDate.parse\u003c/code\u003eが何をパースできるか、どのロケールでパースされるかの保障は基本的にないと思ったほうがよいので、正規表現と\u003ccode\u003eDate.UTC\u003c/code\u003eのあわせ技でパースした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kr\"\u003einterface\u003c/span\u003e \u003cspan class=\"nx\"\u003eDateLike\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the year using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCFullYear\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the month of a Date object using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCMonth\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the day-of-the-month, using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCDate\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the day of the week using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCDay\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the hours value in a Date object using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCHours\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the minutes of a Date object using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCMinutes\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the seconds of a Date object using Universal Coordinated Time (UTC). */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetUTCSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"cm\"\u003e/** Gets the time value in milliseconds. */\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003egetTime\u003c/span\u003e\u003cspan class=\"p\"\u003e():\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eDateConstructorArgumentApplyArrayType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e?,\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e?];\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eisDateConstructorArgumentApplyArrayType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enumber\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e)[]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e \u003cspan class=\"nx\"\u003eis\u003c/span\u003e \u003cspan class=\"nx\"\u003eDateConstructorArgumentApplyArrayType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enumber\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enumber\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eevery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enumber\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eundefined\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003estrToDate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esplitted\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"sr\"\u003e/^\u003c/span\u003e\u003cspan class=\"se\"\u003e(\\d{4})\\/(\\d{1,2})\\/(\\d{1,2})\u003c/span\u003e\u003cspan class=\"sr\"\u003e \u003c/span\u003e\u003cspan class=\"se\"\u003e(\\d{1,2})\u003c/span\u003e\u003cspan class=\"sr\"\u003e:\u003c/span\u003e\u003cspan class=\"se\"\u003e(\\d{1,2})\u003c/span\u003e\u003cspan class=\"sr\"\u003e:\u003c/span\u003e\u003cspan class=\"se\"\u003e(\\d{1,2})\u003c/span\u003e\u003cspan class=\"sr\"\u003e$/\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eexec\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"nx\"\u003esplitted\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"mi\"\u003e7\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"nx\"\u003esplitted\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`date format is invalid: \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esplitted\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eshift\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eparsed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esplitted\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eparseInt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eisDateConstructorArgumentApplyArrayType\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eparsed\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`date format is invalid: \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003eparsed\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUTC\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eapply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kc\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eparsed\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edateToStr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDateLike\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCFullYear\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCMonth\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCDate\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e `\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e\n  \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCHours\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCMinutes\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCSeconds\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003edateToQuery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"na\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eDateLike\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCFullYear\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCMonth\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetUTCDate\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eDateLike\u003c/code\u003eというinterfaceはなぜ必要かというと、実はGoogle APIが使う\u003ccode\u003eDate\u003c/code\u003eはJavascript標準のものとはよく似た別物だからだ。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eisDateConstructorArgumentApplyArrayType\u003c/code\u003eという関数はなぜ必要かというと、\u003ccode\u003eDate.UTC.apply\u003c/code\u003eするときに\u003ccode\u003enumber[]\u003c/code\u003eを渡そうとすると、以下のように怒られる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F002%2F255%2F279%2Foriginal%2F68066cdabe1974b6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f56ef00f52b62cd683cbbcc77b038633\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F002%2F255%2F279%2Foriginal%2F68066cdabe1974b6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f56ef00f52b62cd683cbbcc77b038633\" alt=\"error\" data-canonical-src=\"https://file.qiitadon.com/media_attachments/files/002/255/279/original/68066cdabe1974b6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F002%2F255%2F279%2Foriginal%2F68066cdabe1974b6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7ce66c80a90c69459578e499b645bb21 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/paihu\" class=\"user-mention js-hovercard\" title=\"paihu\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"paihu\"\u003e@paihu\u003c/a\u003e さんから\u003ccode\u003eas\u003c/code\u003e使っちゃえという悪魔のささやきが聞こえた気がする。\u003cbr\u003e\n\u003ca href=\"https://qiitadon.com/web/statuses/103711891508566837\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://qiitadon.com/web/statuses/103711891508566837\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eもう少しで\u003ccode\u003etsconfig.json\u003c/code\u003eで\u003ccode\u003e\"strictBindCallApply\": false\u003c/code\u003eを設定するところだったが、QiitadonのLTLで\u003ca href=\"/okumurakengo\" class=\"user-mention js-hovercard\" title=\"okumurakengo\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"okumurakengo\"\u003e@okumurakengo\u003c/a\u003e さんからいい方法を教えてもらった。つまりTypeGuard使えばいいんじゃね？というもの。\u003cbr\u003e\n\u003ca href=\"https://qiitadon.com/web/statuses/103712043231534123\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://qiitadon.com/web/statuses/103712043231534123\u003c/a\u003e\u003cbr\u003e\n言われてみればそのとおりなので、そうした。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"本題のメール取得部分\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E9%A1%8C%E3%81%AE%E3%83%A1%E3%83%BC%E3%83%AB%E5%8F%96%E5%BE%97%E9%83%A8%E5%88%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本題のメール取得部分\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003econcatEMailAdresses\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eEMailAdresses\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e[])\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003eEMailAdresses\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003e OR \u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003equery\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e`is:unread after:\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003edateToQuery\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elastDate\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003e from:(\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003econcatEMailAdresses\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003etargetEMailAdresses\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003ethreads\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eGmailApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esearch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equery\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003enextLastDate\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003enow\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003emessages\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eGmailApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetMessagesForThreads\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ethreads\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003et\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003emessages\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e \u003cspan class=\"k\"\u003eof\u003c/span\u003e \u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eisUnread\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetDate\u003c/span\u003e\u003cspan class=\"p\"\u003e().\u003c/span\u003e\u003cspan class=\"nx\"\u003egetTime\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003elastDate\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetTime\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//中略\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eproperties\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esetProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003elastDate\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003edateToStr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003enextLastDate\u003c/span\u003e\u003cspan class=\"p\"\u003e)));\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの辺は\u003cbr\u003e\n\u003ca href=\"https://tonari-it.com/gas-gmail-get-thread/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【GAS】Gmailの特定条件で検索したスレッドの全メールを取得してスプレッドシートに書き出す\u003c/a\u003e\u003cbr\u003e\nの説明がわかりやすいので丸投げする。\u003c/p\u003e\n\n\u003cp\u003e検索クエリでは日付単位までしか絞り込めないので、\u003ccode\u003em.getDate().getTime()\u003c/code\u003eで各メッセージの真の受信時刻を取得して比較している。クエリで\u003ccode\u003eis:unread\u003c/code\u003eしているのに\u003ccode\u003em.isUnread()\u003c/code\u003e見てるのは、あんま検索クエリを信用していないからだ。というかあくまでスレッドを引っ掛けるはずだからなんなら既読のメッセージも含まれるんちゃうか？知らんけど。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"mastodon-api\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mastodon-api\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMastodon API\u003c/h2\u003e\n\n\u003cp\u003eこれが結構苦戦した。\u003cbr\u003e\n\u003ca href=\"https://qiita.com/tadaken3/items/1c86dde501bb466f2d1d\" id=\"reference-466b6ac3b3dc79e050e7\"\u003eGoogle Apps ScriptからMastodonにトゥートしてみた\u003c/a\u003e\u003cbr\u003e\nをみて意外と簡単やん、とか思ってたら大きな間違いだった。\u003c/p\u003e\n\n\u003cp\u003ePOSTリクエストを投げるには\u003ccode\u003eUrlFetchApp.fetch\u003c/code\u003eを使う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s2\"\u003e`{\"status\":\"\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003epostText\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e\",\"visibility\":\"direct\"}`\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nx\"\u003eUrlFetchApp\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003efetch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`https://\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emastodonInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e/api/v1/statuses`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"na\"\u003emethod\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003epost\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003econtentType\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eapplication/json\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003epayload\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"na\"\u003eheaders\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003eAuthorization\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eBearer \u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003emastodonToken\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこれだけ見ると簡単そうに見える。しかし問題は上で言うところの\u003ccode\u003epostText\u003c/code\u003eをどう作るかであった。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"文字数制限\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%87%E5%AD%97%E6%95%B0%E5%88%B6%E9%99%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e文字数制限\u003c/h3\u003e\n\n\u003cp\u003eMastodonのTooTは当たり前だが文字数制限がある。大体は500文字だがインスタンスによって変えられる。\u003c/p\u003e\n\n\u003cp\u003eではその文字数はどう数えているのか？\u003c/p\u003e\n\n\u003cp\u003eQiitadonの採用しているmastodonのバージョンの頃は\u003cbr\u003e\n\u003ca href=\"https://github.com/sallar/stringz/blob/bb25d60f2bc2ce4eb424e73a1166fc40a2d11a17/src/string.js\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/sallar/stringz/blob/bb25d60f2bc2ce4eb424e73a1166fc40a2d11a17/src/string.js\u003c/a\u003e\u003cbr\u003e\nのように判定されていたが、それが別ライブラリに切り出され、現在ではさらにchar-regexというパッケージによる判定に置き換わっているようだ。\u003cbr\u003e\n\u003ca href=\"https://github.com/Richienb/char-regex/blob/master/index.js\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/Richienb/char-regex/blob/master/index.js\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eで、つまるところUTF-16のcode unit数でもcodepoint数でもなく、グリフ単位になっている。ただしいつの時点のUnicode規格に則っているかは不明だ(規格と照らし合わせるのは面倒すぎるのでパス)。\u003c/p\u003e\n\n\u003cp\u003eいずれにせよ、GASでそんな判定をやるのは面倒すぎるし、しかもインスタンスごとに異なるとなってはもっと簡便な方法を採用したい。つまりcodepoint単位だ。\u003c/p\u003e\n\n\u003cp\u003e当初は\u003cbr\u003e\n\u003ca href=\"https://github.com/yumetodo/es-string-algorithm\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/es-string-algorithm\u003c/a\u003e\u003cbr\u003e\nから実装をコピペしたのだが、よく考えたらこれの実装には\u003ccode\u003efor...of\u003c/code\u003e、つまりイテレータが使われている。ES3なGASにそんなものはない。したがって正規表現を使って実装し直す羽目になった。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/YusukeHirao/items/2f0fb8d5bbb981101be0#iv-ii-%E3%82%B5%E3%83%AD%E3%82%B2%E3%83%BC%E3%83%88%E3%83%9A%E3%82%A2%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%9F%E9%85%8D%E5%88%97%E5%8C%96\" id=\"reference-554e7628ce01843ec0ce\"\u003eJavaScriptでのサロゲートペア文字列のメモ#IV-II. サロゲートペアに対応した配列化\u003c/a\u003e\u003cbr\u003e\nを参考にした。\u003c/p\u003e\n\n\u003cp\u003e毎度思うがJavascriptの文字列操作系標準ライブラリは貧弱すぎる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cm\"\u003e/**\n * Create part of the `s`\n * @param s string\n * @param pos copy start position\n * @param n copy length\n * @returns part of the `s` in range of `[pos...rlast]` (`rlast` is the smaller of `pos + n` and `std.size(s)`)\n * @throws {RangeError} When `pos` or `n` is negative or `pos` \u0026gt; `std.size(s)`\n */\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003esubstr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e?:\u003c/span\u003e \u003cspan class=\"nx\"\u003enumber\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"nx\"\u003estring\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRangeError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003estd.substr: pos \u0026lt; 0\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enumber\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRangeError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003estd.substr: n \u0026lt; 0\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ematch\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"se\"\u003e[\\u\u003c/span\u003e\u003cspan class=\"sr\"\u003eD800-\u003c/span\u003e\u003cspan class=\"se\"\u003e\\u\u003c/span\u003e\u003cspan class=\"sr\"\u003eDBFF\u003c/span\u003e\u003cspan class=\"se\"\u003e][\\u\u003c/span\u003e\u003cspan class=\"sr\"\u003eDC00-\u003c/span\u003e\u003cspan class=\"se\"\u003e\\u\u003c/span\u003e\u003cspan class=\"sr\"\u003eDFFF\u003c/span\u003e\u003cspan class=\"se\"\u003e]\u003c/span\u003e\u003cspan class=\"sr\"\u003e|\u003c/span\u003e\u003cspan class=\"se\"\u003e[^\\u\u003c/span\u003e\u003cspan class=\"sr\"\u003eD800-\u003c/span\u003e\u003cspan class=\"se\"\u003e\\u\u003c/span\u003e\u003cspan class=\"sr\"\u003eDFFF\u003c/span\u003e\u003cspan class=\"se\"\u003e]\u003c/span\u003e\u003cspan class=\"sr\"\u003e/g\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e[];\u003c/span\u003e\n  \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ethrow\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRangeError\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`std.substr: pos (which is \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e) \u0026gt; std.size(s) (which is \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypeof\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enumber\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"nx\"\u003epos\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003en\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003eundefined\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"改行の処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%94%B9%E8%A1%8C%E3%81%AE%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e改行の処理\u003c/h3\u003e\n\n\u003cp\u003eMastodon APIでは、どうやら改行するには\u003ccode\u003e\\n\u003c/code\u003eという文字列を送り込まないといけないらしい。つまりTypeScript側では\u003ccode\u003e'\\\\n'\u003c/code\u003eのように書くということだ。\u003c/p\u003e\n\n\u003cp\u003eで、問題はもともと転送しようとしているメール本文(\u003ccode\u003em.getBody()\u003c/code\u003e)に改行が含まれている時どうするかだ。\u003c/p\u003e\n\n\u003cp\u003eCRは除去し、LFは\u003ccode\u003e\\n\u003c/code\u003eという文字列に置換し、メール本文末尾のLFは除去しないといけない。\u003cbr\u003e\n上記の文字数制限は、改行が1文字扱いになることを考慮するとCRを除去した直後に掛ける必要がある。\u003c/p\u003e\n\n\u003cp\u003eつまりこうなった。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"typescript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epostTextRaw\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\n  \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emastodonReciveUserId\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s1\"\u003en\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003edateToStr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetDate\u003c/span\u003e\u003cspan class=\"p\"\u003e())}\u003c/span\u003e\u003cspan class=\"s2\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetSubject\u003c/span\u003e\u003cspan class=\"p\"\u003e()}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s1\"\u003en\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egetBody\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e// limit content length by maxTootLength\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epostTextRawLimitted\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003esubstr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003epostTextRaw\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"se\"\u003e\\r\u003c/span\u003e\u003cspan class=\"sr\"\u003e/g\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esetting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emaxTootLength\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003epostText\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003epostTextRawLimitted\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esubstring\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003epostTextRawLimitted\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elastIndexOf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)).\u003c/span\u003e\u003cspan class=\"nx\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sr\"\u003e/\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"sr\"\u003e/g\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s1\"\u003en\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこの処理に丸一日悩まされた。どっかにそういう仕様だって書いとけよ、まじで。DocumentのS/N値をあげろし。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"成果物\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%90%E6%9E%9C%E7%89%A9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e成果物\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F064a8d86-c425-d5a7-75d3-2c337931e9b8.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0acb9d25398b150a88f8a43b38d056dd\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F064a8d86-c425-d5a7-75d3-2c337931e9b8.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0acb9d25398b150a88f8a43b38d056dd\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/064a8d86-c425-d5a7-75d3-2c337931e9b8.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F064a8d86-c425-d5a7-75d3-2c337931e9b8.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6604207ff71966165257e6eba7695035 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/gmail2mastodon\" rel=\"nofollow noopener\" target=\"_blank\"\u003eyumetodo/gmail2mastodon: 私は彼女のメールをもう見落としたくない。だからmastodonに転送するんだ。\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fe3daed37-2a77-5e8f-b673-d69cd34d248b.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1caba9e4c4e031d38a62f74e8bf7bad9\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fe3daed37-2a77-5e8f-b673-d69cd34d248b.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=1caba9e4c4e031d38a62f74e8bf7bad9\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/e3daed37-2a77-5e8f-b673-d69cd34d248b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fe3daed37-2a77-5e8f-b673-d69cd34d248b.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=16a9cd132b37343e68835c8bff6eeb3e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"残された課題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AE%8B%E3%81%95%E3%82%8C%E3%81%9F%E8%AA%B2%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e残された課題\u003c/h1\u003e\n\n\u003cp\u003e冒頭で紹介した彼女とのやり取り。その後を抜粋しておこう。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e私: まあ、メール見たけど後で返そうと思って忘れるケースは防げないのでアレ。\u003c/p\u003e\n\n\u003cp\u003e彼女: あるあるですね（笑）\u003c/p\u003e\n\u003c/blockquote\u003e\n","body":"# あああっ！彼女からバレンタイン2日前にチョコくれるってメール来てたのに見落としたっっっ！\n\n今どき珍しく、私は彼女との連絡手段に古き良きE-Mailを利用している。つまりはGMailを使っている。\n\nさて、2020年のバレンタイン(2月14日)が近づいてきてたころ、私は大学の留年やら教育実習の挨拶やらでバレンタインどころの状態ではなかった。\n\nまた彼女も正月に聞いた感じかなり忙しそうであった。\n\nしたがって今年はバレンタインなしかなぁと思っていた。\n\nさて、2月12日。一通のメールが届いていた。\n\n\u003e こんばんは！\n\u003e\n\u003e14日、会えますかー？\n\u003eチョコ、そんなに好きじゃないみたいですけど、父にも作る予定なのでいくつかお渡ししようと。\n\nしかしながら前述の通りの状況でメールをチェックするような余力がなかった。気がついたのは私の誕生日である2月22日、そういえば彼女からメール着てるかな？と思って確認したときだ。\n\n**バレンタイン、とっくに終わっとるやんけ！** どないしょう・・・。\n\n実は彼女からのメールを見落とすのはなにも今回が初めてではない。まあそもそも彼女も私もそこまで頻繁に連絡を取ることに価値を見出していないので、さほど問題になってこなかったのであるが、**流石にバレンタインのチョコを逃すのはあかんやろ。**\n\n即座に彼女に謝罪のメールを投げつけたら翌日\n\n\u003e はっ…こちらこそ昨日の連絡、忘れてました…\n\nなどと許してくれたが、再発防止策は講じるべきだ。\n\n# 忙しくても確実に目を通しているものはなにか\n\nかつてはTwitterを見ない日はなかったが、最近は毎日確実に見ているわけではない。\n\nでは何なら見ているか。\n\n- slack: 家族のやり取りや、ニコニコ動画ユーザー非公式交流slackに参加していて常時タブを開いている\n- Qiitadon(Mastodon): 常時タブを開いているし、こまめに確認している。\n\nというわけでこの2つに彼女からのメールを転送すれば流石にどっちかで気がつくだろう。\n\n# GMail -\u003e Slack\n\nGMailからSlackに飛ばすのは恐ろしくかんたんだ。完全にSlackのAPIを叩く気満々で先行事例を探していた私は拍子抜けしてしまった。\n\n[「Slack」と「Gmail」の連携機能をチェック！ 特定のメールをiPhoneにプッシュ通知する【週刊Slack情報局】 - INTERNET Watch](https://internet.watch.impress.co.jp/docs/column/slack_info/1192138.html)\n\nすなわち、GMailのメール転送機能でSlackの転送先メールアドレスに転送するだけだ。\n\nもともと彼女からのメールにラベル付けと迷惑メールから除外する設定のためにGMailのフィルターを組んでいた私には2分で事足りた。\n\n# GMail --(Google Apps Script)--\u003e Qiitadon(Mastodon)\n\nMastodonに通知を投げるには大きく2通りの方法がある。\n\n- ActivityPubを実装したサーバーアプリケーションを作成してそれを通知を受けたいアカウントでフォローする\n- 通知を送る用のMastodonアカウントを作成してそれを通知を受けたいアカウントでフォロー、APIを使ってTooTを作成する\n\nまあどう考えても後者のほうが楽なのでMastodon APIを叩くことにした。\n\n有料ならZapierを使うとか言う方法もあるらしいが、流石にそんなことにお金を掛けたくない。\n\nかつてはIFTTTを使う手段もあったようだが、2019年3月31日からその手段はできなくなっている。\n\nで、GMailから対象のメールを引っ張るのも、Mastodonに投稿するのもAPIを叩くということは、それをするサーバーが必要なわけですが流石にVPSで一からやりたくないので、GoogleのAPIをかんたんに叩けるGoogle Apps Scriptを使うことにした。\n\n## 開発環境をどうするか。\n\nもはや現代においてGoogle Apps Scriptを書くとなればclasp+Typescriptが基本的人権と言っていい。\n\n概ね\n[clasp が Typescript をサポートした！](https://qiita.com/HeRo/items/f2ce057c6b1456e896ad)\nに従って環境を作った。\n\nclaspを使ったので当然ソースコードはgit管理できる。と言うわけで成果物が\nhttps://github.com/yumetodo/gmail2mastodon\nこれだ。\n\nちなみにGASといえば、最近実行エンジンがV8に切り替わったという衝撃のニュースが業界を駆け巡ったが、残念ながらclaspはこれに対応していない。というのも、GASへのソースコードアップロードに使われる [REST APIサーバー](https://developers.google.com/apps-script/api/reference/rest/v1/projects/updateContent)側で、何かしらのvalidateが走った結果、ナウでヤングな記法のJavaScriptファイルを受け取ると400を突き返すらしい。OSSであるclasp側ではどうにもならず、Google内部での作業が不可欠だ。\n\n- [build option for V8 runtime · Issue #735 · google/clasp](https://github.com/google/clasp/issues/735)\n- [V8 engine support by PopGoesTheWza · Pull Request #739 · google/clasp](https://github.com/google/clasp/pull/739)\n\n追記: という話だったのだが、Issueに「でもうまく行ったぜ？」って書き込みがあったので私も試したらうまくいった。なんかもうすこし細かい条件があるのかも\n\n## 投稿用のMastodonアカウント作成とMastodon API tokenの取得\n\n今回はなんとなく\nhttps://mstdn.maud.io\nにアカウントを作ることにした。\n\nところがアカウントを作るだけの簡単なお仕事のはずが罠があった。\n\nQiitadonが採用しているMastodonのバージョンにはないが、その後追加された機能としてBOTフラグ(正式名称はしらない)がある。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/857a62d1-c2cb-b5d0-2bb1-ec12266edb3c.png)\n\n\u003e このアカウントは主に自動で動作し、人が見ていない可能性があります\n\nということをアピールできる。もちろん今回やろうとしていることはまさにBOTなのでこれをチェックしていた。\n\nところがその状態だとQiitadonのようなBOTフラグを実装していないバージョンのMastodonインスタンスからは、そのアカウントが見えなくなる。つまりリモートフォローできないし、メンションも投げられないし、BOTフラグが立ってる側からのリモートフォローもできない。\n\n@paihu さんのファインプレーがなかったら未だにさまよってたに違いない。\nhttps://qiitadon.com/web/statuses/103711452923765332\n\nあとは普通にtokenを取ればいい。今回、権限は`read write:statuses`にしておいた。readいらんかった感あるけど。\n\n## 設定ファイルをどうするか\n\n通知を投げるMastodonのインスタンス名であるとか、通知の送り先とか、TooTの文字数制限とか、転送対象のメールアドレスといった情報は、ソースコードに埋め込みたくないし、git repoにすら含めたくない。というか彼女のメールアドレスが流失してしまうのは困る。\n\n[GASで永続化する方法まとめ（設定や処理結果を保存・読み込みしたい時）](https://qiita.com/tomboyboy/items/6a15ab1a4838bd6b7f9d)\nを眺めた結果、JSONで書いてGoogle Driveに置くことにした。それを実行時にGASから読み取る。\n\n### JSON schema\n\n設定を書くときにJSON schemaがあると便利だということを最近痛感している。そもそも何を書けばいいのか知るためにソースコードを見に行くのは論外だし、ドキュメントを読みに行くのも面倒すぎる。以下を参考にJSON schemaを書いた。\n\n- [JSON Schemaと友達になる為の記事](https://qiita.com/arumi8go/items/a9530cbd39ff545a7bbb)\n- [JSON Schema: A Media Type for Describing JSON Documents](http://json-schema.org/draft/2019-09/json-schema-core.html)\n- [JSON Schema](https://cswr.github.io/JsonSchema/)\n\n\n```json\n{\n    \"$schema\": \"https://json-schema.org/draft/2019-09/schema\",\n    \"title\": \"gmail2mastodon setting file\",\n    \"type\":\"object\",\n    \"properties\": {\n        \"maxTootLength\": {\n            \"description\": \"max Toot length on your instance\",\n            \"type\": \"number\"\n        },\n        \"targetEMailAdresses\": {\n            \"description\": \"E-Mail adresses that you want to notify\",\n            \"type\": \"array\",\n            \"items\": {\n                \"description\": \"E-Mail adress\",\n                \"type\": \"string\"\n            }\n        },\n        \"mastodonInstance\": {\n            \"description\": \"The mastodon instance this bot use\",\n            \"type\": \"string\",\n            \"pattern\": \"[^/?#]*\"\n        },\n        \"mastodonReciveUserId\": {\n            \"description\": \"Your userid that recive notification\",\n            \"type\": \"string\"\n        }\n    }\n}\n```\n\nこれを使ってjsonを書くには\n\n```json\n{\n  \"$schema\": \"https://raw.githubusercontent.com/yumetodo/gmail2mastodon/master/scheme.json\",\n  \"mastodonInstance\": \"mstdn.maud.io\",\n  \"mastodonReciveUserId\": \"@yumetodo@qiitadon.com\",\n  \"maxTootLength\": 500,\n  \"targetEMailAdresses\": [\n    \"xxx@example.com\"\n  ]\n}\n```\n\nのように`$schema`で指定すれば良い。なおここのURLは、サーバーが返すcontent-typeなどはどうでも良いらしく、gistやgithubのrawボタンで手に入るURLでも良いようだ(VSCode上での挙動)。\n\n### Google Drive API\n\nさて、そのjsonは`gmail2mastodon_settings/setting.json`に置くことに決めた。あとはそれをGASから読み取ればいい。\n\n```typescript\nexport interface Gmail2MastodonSettingFile {\n  /**\n   * max Toot length on your instance\n   */\n  maxTootLength?: number;\n  /**\n   * E-Mail adresses that you want to notify\n   */\n  targetEMailAdresses?: string[];\n  /**\n   * The mastodon instance this bot use\n   */\n  mastodonInstance?: string;\n  /**\n   * Your userid that recive notification\n   */\n  mastodonReciveUserId?: string;\n}\nconst getFile = (parentName: string, name: string) =\u003e {\n  const files = DriveApp.searchFiles(`title = \"${name}\"`);\n  while (files.hasNext()) {\n    const file = files.next();\n    if (name !== file.getName()) continue;\n    //gmail2mastodon_settings\n    const parents = file.getParents();\n    if (!parents.hasNext()) continue;\n    const parent = parents.next();\n    if (parentName === parent.getName()) return file;\n  }\n  throw new Error('no such file: ');\n};\nconst readJson = (parentName = 'gmail2mastodon_settings', jsonName = 'setting.json') =\u003e {\n  const file = getFile(parentName, jsonName);\n  const content = file.getBlob().getDataAsString();\n  if (!content) return;\n  return JSON.parse(content);\n};\n```\n\nどうもGoogle Drive APIにはパスという概念がこれでもかってくらい抹消されているらしい。そのため、`std::ifstream(\"gmail2mastodon_settings/setting.json\")`くらいでC++で手元で動かすなら書けそうな\n内容が上記のように膨れ上がった。\n\nまずファイル名で検索を掛ける。これによって検索結果をたどるイテレータが手に入る。当然目的のファイル以外も引っかかる可能性がある。\n\n```typescript\nconst files = DriveApp.searchFiles(`title = \"${name}\"`);\n```\n\n次にこれをループで回す。\n\n```typescript\nwhile (files.hasNext()) {\n  const file = files.next();\n  //後略\n}\n```\n\nループの中では、改めて検索結果で得たファイル名とほしいファイル名を比較する。\n\n```typescript\nif (name !== file.getName()) continue;\n```\n\nまた、親ディレクトリの名前を取得・比較する。\n\n```typescript\nconst parents = file.getParents();\nif (!parents.hasNext()) continue;\nconst parent = parents.next();\nif (parentName === parent.getName()) return file;\n```\n\nあとはJSONにパースしてあげればよい。\n\n```typescript\nconst content = file.getBlob().getDataAsString();\nif (!content) return;\nreturn JSON.parse(content);\n```\n\n```typescript\nconst setting: Gmail2MastodonSettingFile = readJson();\nif (\n  null == setting.targetEMailAdresses ||\n  null == setting.mastodonReciveUserId ||\n  null == setting.mastodonInstance ||\n  null == setting.maxTootLength\n) {\n  console.error('invalid setting file');\n  return -1;\n}\n```\n\n## 状態やMastodonのAPI tokenをどう持つか\n\nMastodonのAPI tokenもまた公開できない情報だ。さっきの設定ファイルに書いたほうがスッキリしたかもしれないが、その技術検討より前にこちらを決定したという経緯から別の方法をとった。\n\nまた状態を設定ファイルでなんとかするのは汚すぎる。\n\n[GASで永続化する方法まとめ（設定や処理結果を保存・読み込みしたい時）](https://qiita.com/tomboyboy/items/6a15ab1a4838bd6b7f9d)\nを眺めた結果、Properties Serviceを利用した。\n\n読み書きするのは簡単で、\n\n```typescript\nconst properties = PropertiesService.getScriptProperties();\nconst lastDateStr = properties.getProperty('lastDate');\nif (null == lastDateStr) {\n  console.error('missing lastDate');\n  return -1;\n}\nconst mastodonToken = ScriptProperties.getProperty('mastodonToken');\nif (null == mastodonToken) {\n  console.error('missing mastodonToken');\n  return -1;\n}\n```\n\nのように取得できる。書き出しは`properties.setProperty`すればいい。\n\n値を手動で設定するには、スクリプトエディターで、ファイル→プロジェクトのプロパティからダイアログがでる。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/c06c0e07-c2dc-b912-3588-ce2b128a5b71.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/54f0a3fd-c7eb-9fc1-4885-e8d65b55562e.png)\n\n## GMailからのメール取得\n\nこれは先行事例がたくさんある。\n\n- [【GAS】Gmailの特定条件で検索したスレッドの全メールを取得してスプレッドシートに書き出す](https://tonari-it.com/gas-gmail-get-thread/)\n- [Google Apps ScriptでGmailの特定のメールを受信したらLINEと連携して通知する](https://asatte.biz/gmail-line/)\n- [Google Apps Scriptを使ってGmailの新着メールをChatWorkに通知してみた ｜ SiTest (サイテスト) ブログ](https://sitest.jp/blog/?p=3869)\n\n### 重複取得をどう回避するか\n\nところがここで一つ問題がある。\n\n先程のGoogle Drive API同様、GMail APIもまた、検索クエリを投げて絞り込みをしていくことになる。では前回の実行で取得済みであるものを弾くにはどうしたらいいだろうか？\n\n上記の記事ではどれも取得したらメールを既読にしてしまう方法をとっている。しかし勝手に既読にされるのは困る。\n\n記事執筆中に見つけた方法は\n[GoogleがIFTTTサポート終了!?GASでGmailの新着メールをLINE Notifyで通知させてみた! – ADACHIN SERVER LABO](https://blog.adachin.me/archives/10188)\n\n```js\nvar get_interval = 1; //〇分前～現在の新着メールを取得 #--トリガーをこれに合わせておく！！\n\n  //取得間隔\n  var now_time= Math.floor(new Date().getTime() / 1000) ;//現在時刻を変換\n  var time_term = now_time - (60 * get_interval); //変換\n \n  //検索条件指定\n  var strTerms = '(is:unread after:'+ time_term + ')';\n```\n\nのように、GASのトリガーの間隔と同じだけの幅の時間を対象にする方法だ。\n\nしかし、これだとトリガー間隔を変えるのにコードをいじらないといけなくなるし、トリガーが本当に正確にキックされるかに依存してしまう。\n\nそこで、実行時の時間をProperties Serviceに記録して、それを次回実行時に読み出すことにした。\n\n### JavaScriptのDateとの格闘\n\nJavaScriptのDateはクソの塊なので本当はmomentjsかなにかを使いたかったのだが、GASで外部ライブラリを使うのはそれこそ難しい。GASの外部ライブラリ機能はclaspでの手元開発と相性が悪いし、webpackすると場合によってはファイルサイズ制限に引っかかって動かなくなる。\n\n仕方なくDateとの格闘を行った。\n\nまずGASがどんなロケールで実行されるかわからないので、全てUTCで扱うことにした。\n\nまた、Dateのコンストラクタ、ひいては`Date.parse`が何をパースできるか、どのロケールでパースされるかの保障は基本的にないと思ったほうがよいので、正規表現と`Date.UTC`のあわせ技でパースした。\n\n```typescript\ninterface DateLike {\n  /** Gets the year using Universal Coordinated Time (UTC). */\n  getUTCFullYear(): number;\n  /** Gets the month of a Date object using Universal Coordinated Time (UTC). */\n  getUTCMonth(): number;\n  /** Gets the day-of-the-month, using Universal Coordinated Time (UTC). */\n  getUTCDate(): number;\n  /** Gets the day of the week using Universal Coordinated Time (UTC). */\n  getUTCDay(): number;\n  /** Gets the hours value in a Date object using Universal Coordinated Time (UTC). */\n  getUTCHours(): number;\n  /** Gets the minutes of a Date object using Universal Coordinated Time (UTC). */\n  getUTCMinutes(): number;\n  /** Gets the seconds of a Date object using Universal Coordinated Time (UTC). */\n  getUTCSeconds(): number;\n  /** Gets the time value in milliseconds. */\n  getTime(): number;\n}\ntype DateConstructorArgumentApplyArrayType = [number, number, number?, number?, number?, number?, number?];\nconst isDateConstructorArgumentApplyArrayType = (\n  arr: (number | undefined)[]\n): arr is DateConstructorArgumentApplyArrayType =\u003e\n  2 \u003c= arr.length \u0026\u0026\n  arr.length \u003c= 7 \u0026\u0026\n  typeof arr[0] === 'number' \u0026\u0026\n  typeof arr[1] === 'number' \u0026\u0026\n  arr.every(e =\u003e typeof e === 'number' || typeof e === 'undefined');\nconst strToDate = (s: string) =\u003e {\n  const splitted = /^(\\d{4})\\/(\\d{1,2})\\/(\\d{1,2}) (\\d{1,2}):(\\d{1,2}):(\\d{1,2})$/.exec(s);\n  if (null == splitted || 7 !== splitted.length) {\n    throw new Error(`date format is invalid: ${s}`);\n  }\n  splitted.shift();\n  const parsed = splitted.map(d =\u003e parseInt(d));\n  if (!isDateConstructorArgumentApplyArrayType(parsed)) {\n    throw new Error(`date format is invalid: ${s}`);\n  }\n  parsed[1] -= 1;\n  return new Date(Date.UTC.apply(null, parsed));\n};\nconst dateToStr = (d: DateLike) =\u003e\n  `${d.getUTCFullYear()}/${d.getUTCMonth() + 1}/${d.getUTCDate()} ` +\n  `${d.getUTCHours()}:${d.getUTCMinutes()}:${d.getUTCSeconds()}`;\nconst dateToQuery = (d: DateLike) =\u003e `${d.getUTCFullYear()}/${d.getUTCMonth() + 1}/${d.getUTCDate()}`;\n```\n\n`DateLike`というinterfaceはなぜ必要かというと、実はGoogle APIが使う`Date`はJavascript標準のものとはよく似た別物だからだ。\n\n`isDateConstructorArgumentApplyArrayType`という関数はなぜ必要かというと、`Date.UTC.apply`するときに`number[]`を渡そうとすると、以下のように怒られる。\n\n![error](https://file.qiitadon.com/media_attachments/files/002/255/279/original/68066cdabe1974b6.png)\n\n@paihu さんから`as`使っちゃえという悪魔のささやきが聞こえた気がする。\nhttps://qiitadon.com/web/statuses/103711891508566837\n\nもう少しで`tsconfig.json`で`\"strictBindCallApply\": false`を設定するところだったが、QiitadonのLTLで@okumurakengo さんからいい方法を教えてもらった。つまりTypeGuard使えばいいんじゃね？というもの。\nhttps://qiitadon.com/web/statuses/103712043231534123\n言われてみればそのとおりなので、そうした。\n\n### 本題のメール取得部分\n\n```typescript\nconst concatEMailAdresses = (EMailAdresses: string[]) =\u003e EMailAdresses.join(' OR ');\n\nconst query = `is:unread after:${dateToQuery(lastDate)} from:(${concatEMailAdresses(setting.targetEMailAdresses)})`;\nconst threads = GmailApp.search(query);\nconst nextLastDate = Date.now();\nconst messages = GmailApp.getMessagesForThreads(threads);\nfor (const t of messages) {\n  for (const m of t) {\n    if (!m.isUnread() || m.getDate().getTime() \u003c lastDate.getTime()) continue;\n    //中略\n  }\n}\nproperties.setProperty('lastDate', dateToStr(new Date(nextLastDate)));\n```\n\nこの辺は\n[【GAS】Gmailの特定条件で検索したスレッドの全メールを取得してスプレッドシートに書き出す](https://tonari-it.com/gas-gmail-get-thread/)\nの説明がわかりやすいので丸投げする。\n\n検索クエリでは日付単位までしか絞り込めないので、`m.getDate().getTime()`で各メッセージの真の受信時刻を取得して比較している。クエリで`is:unread`しているのに`m.isUnread()`見てるのは、あんま検索クエリを信用していないからだ。というかあくまでスレッドを引っ掛けるはずだからなんなら既読のメッセージも含まれるんちゃうか？知らんけど。\n\n## Mastodon API\n\nこれが結構苦戦した。\n[Google Apps ScriptからMastodonにトゥートしてみた](https://qiita.com/tadaken3/items/1c86dde501bb466f2d1d)\nをみて意外と簡単やん、とか思ってたら大きな間違いだった。\n\nPOSTリクエストを投げるには`UrlFetchApp.fetch`を使う。\n\n```typescript\nconst payload = `{\"status\":\"${postText}\",\"visibility\":\"direct\"}`;\nUrlFetchApp.fetch(`https://${setting.mastodonInstance}/api/v1/statuses`, {\n  method: 'post',\n  contentType: 'application/json',\n  payload: payload,\n  headers: { Authorization: 'Bearer ' + mastodonToken },\n});\n```\n\nこれだけ見ると簡単そうに見える。しかし問題は上で言うところの`postText`をどう作るかであった。\n\n### 文字数制限\n\nMastodonのTooTは当たり前だが文字数制限がある。大体は500文字だがインスタンスによって変えられる。\n\nではその文字数はどう数えているのか？\n\nQiitadonの採用しているmastodonのバージョンの頃は\nhttps://github.com/sallar/stringz/blob/bb25d60f2bc2ce4eb424e73a1166fc40a2d11a17/src/string.js\nのように判定されていたが、それが別ライブラリに切り出され、現在ではさらにchar-regexというパッケージによる判定に置き換わっているようだ。\nhttps://github.com/Richienb/char-regex/blob/master/index.js\n\nで、つまるところUTF-16のcode unit数でもcodepoint数でもなく、グリフ単位になっている。ただしいつの時点のUnicode規格に則っているかは不明だ(規格と照らし合わせるのは面倒すぎるのでパス)。\n\nいずれにせよ、GASでそんな判定をやるのは面倒すぎるし、しかもインスタンスごとに異なるとなってはもっと簡便な方法を採用したい。つまりcodepoint単位だ。\n\n当初は\nhttps://github.com/yumetodo/es-string-algorithm\nから実装をコピペしたのだが、よく考えたらこれの実装には`for...of`、つまりイテレータが使われている。ES3なGASにそんなものはない。したがって正規表現を使って実装し直す羽目になった。\n\n[JavaScriptでのサロゲートペア文字列のメモ#IV-II. サロゲートペアに対応した配列化](https://qiita.com/YusukeHirao/items/2f0fb8d5bbb981101be0#iv-ii-%E3%82%B5%E3%83%AD%E3%82%B2%E3%83%BC%E3%83%88%E3%83%9A%E3%82%A2%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%9F%E9%85%8D%E5%88%97%E5%8C%96)\nを参考にした。\n\n毎度思うがJavascriptの文字列操作系標準ライブラリは貧弱すぎる。\n\n```typescript\n/**\n * Create part of the `s`\n * @param s string\n * @param pos copy start position\n * @param n copy length\n * @returns part of the `s` in range of `[pos...rlast]` (`rlast` is the smaller of `pos + n` and `std.size(s)`)\n * @throws {RangeError} When `pos` or `n` is negative or `pos` \u003e `std.size(s)`\n */\nconst substr = (s: string, pos = 0, n?: number): string =\u003e {\n  if (pos \u003c 0) {\n    throw new RangeError('std.substr: pos \u003c 0');\n  }\n  if (typeof n === 'number' \u0026\u0026 n \u003c 0) {\n    throw new RangeError('std.substr: n \u003c 0');\n  }\n  const arr = s.match(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]|[^\\uD800-\\uDFFF]/g) || [];\n  if (arr.length \u003c pos) {\n    throw new RangeError(`std.substr: pos (which is ${pos}) \u003e std.size(s) (which is ${arr.length})`);\n  }\n  return arr.slice(pos, typeof n === 'number' ? pos + n : undefined).join('');\n};\n```\n\n### 改行の処理\n\nMastodon APIでは、どうやら改行するには`\\n`という文字列を送り込まないといけないらしい。つまりTypeScript側では`'\\\\n'`のように書くということだ。\n\nで、問題はもともと転送しようとしているメール本文(`m.getBody()`)に改行が含まれている時どうするかだ。\n\nCRは除去し、LFは`\\n`という文字列に置換し、メール本文末尾のLFは除去しないといけない。\n上記の文字数制限は、改行が1文字扱いになることを考慮するとCRを除去した直後に掛ける必要がある。\n\nつまりこうなった。\n\n```typescript\nconst postTextRaw =\n  setting.mastodonReciveUserId + '\\\\n' + `${dateToStr(m.getDate())} ${m.getSubject()}` + '\\\\n' + m.getBody();\n// limit content length by maxTootLength\nconst postTextRawLimitted = substr(postTextRaw.replace(/\\r/g, ''), 0, setting.maxTootLength);\nconst postText = postTextRawLimitted.substring(0, postTextRawLimitted.lastIndexOf('\\n')).replace(/\\n/g, '\\\\n');\n```\n\nこの処理に丸一日悩まされた。どっかにそういう仕様だって書いとけよ、まじで。DocumentのS/N値をあげろし。\n\n# 成果物\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/064a8d86-c425-d5a7-75d3-2c337931e9b8.png)\n\n\n[yumetodo/gmail2mastodon: 私は彼女のメールをもう見落としたくない。だからmastodonに転送するんだ。](https://github.com/yumetodo/gmail2mastodon)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/e3daed37-2a77-5e8f-b673-d69cd34d248b.png)\n\n# 残された課題\n\n冒頭で紹介した彼女とのやり取り。その後を抜粋しておこう。\n\n\u003e私: まあ、メール見たけど後で返そうと思って忘れるケースは防げないのでアレ。\n\n\u003e彼女: あるあるですね（笑）\n","coediting":false,"comments_count":0,"created_at":"2020-02-24T21:47:48+09:00","group":null,"id":"78acd1ed63b1f90fe738","likes_count":7,"private":false,"reactions_count":0,"tags":[{"name":"GoogleAppsScript","versions":[]},{"name":"gmail","versions":[]},{"name":"TypeScript","versions":[]},{"name":"Slack","versions":[]},{"name":"mastodon","versions":[]}],"title":"私はもう二度と彼女からのメールを見落としたくないのでSlackとMastodonに通知するようにする","updated_at":"2020-02-26T12:24:37+09:00","url":"https://qiita.com/yumetodo/items/78acd1ed63b1f90fe738","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eWindowsのデフォルトのconhost.exeのクソさに誰もが直面したことがあるだろう。そしてminttyやConEmuを使い始める人が出てくる。\u003c/p\u003e\n\n\u003cp\u003eもしくは最近だとVisual Studio Codeのターミナルが結構優秀なのでそれを使ったりしているかもしれない。これについては前に\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/42132a1e8435504448aa\" id=\"reference-0d35644d7cb2adf17551\"\u003eVisual Studio Code 15.1の統合シェルをMSYS2のbashにする\u003c/a\u003e\u003cbr\u003e\nという記事を書いた。\u003c/p\u003e\n\n\u003cp\u003eさて、Windows10がリリースされてもう随分たつが、ConPTY APIの導入、そしてWindows Terminalの実装開始とWindowsの端末環境に大きな変化が訪れようとしている。\u003cbr\u003e\n\u003ca href=\"https://github.com/microsoft/terminal\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/microsoft/terminal\u003c/a\u003e\u003cbr\u003e\n執筆現在まだ正式リリースはされていないが、かなり完成度が高くなってきていて、割と使い物になるレベルに達している。\u003c/p\u003e\n\n\u003cp\u003eさて、そんなWindows Terminalでmsys2のbashを使うにはどうすればいいのか。おもむろにググったがなんとまさかの日本語の文献がヒットしない。これは私が書くしかないのでは？\u003c/p\u003e\n\n\u003cp\u003eちなみに似たような事例としてgit bashを使いたいという場合もあると思うのですが、それについては\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yokra9/items/bdd0882268b308cf22ca\" id=\"reference-141a0fba287fcc43296e\"\u003eWindows Terminal で Git Bash を表示する\u003c/a\u003e\u003cbr\u003e\nという記事がありました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e準備\u003c/h1\u003e\n\n\u003cp\u003eすでにWindows Terminalはインストールされているものとする。\u003c/p\u003e\n\n\u003cp\u003ePowerShellをまず開いて\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"err\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eguid\u003c/span\u003e\u003cspan class=\"p\"\u003e]::\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewGuid\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを実行する。これでGUIDが取得できる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e設定\u003c/h1\u003e\n\n\u003cp\u003eWindows Terminalを開いて、\u003ckbd\u003eCtl\u003c/kbd\u003e+\u003ckbd\u003e,\u003c/kbd\u003eすると設定ファイルが開く。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eprofiles\u003c/code\u003eの項目に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"acrylicOpacity\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mf\"\u003e0.5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"closeOnExit\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"colorScheme\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"Campbell\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"commandline\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"cmd.exe /c \u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eset MSYSTEM=MINGW64\u0026amp;\u0026amp; set MSYS=winsymlinks:nativestrict\u0026amp;\u0026amp; C:/msys64/usr/bin/bash.exe --login\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"fontFace\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"HackGen\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"fontSize\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"guid\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"{00000000-0000-0000-0000-000000000000}\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"historySize\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"mi\"\u003e9001\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"icon\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:/msys64/msys2.ico\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"name\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"MSYS2\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"padding\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"0, 0, 0, 0\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"snapOnInput\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"startingDirectory\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:/msys64/home/yumetodo\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n            \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"useAcrylic\"\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"w\"\u003e\n        \u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように記述する。最初からPowerShellやらコマンドプロンプトの設定が記述されていると思うが、ここでの記述順がそのままメニューでの並びになる\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3e367e0d-4cf6-9032-097a-44cff295cb1e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3e7239fc98dac737a4c9992c41fe5e8c\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3e367e0d-4cf6-9032-097a-44cff295cb1e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3e7239fc98dac737a4c9992c41fe5e8c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/3e367e0d-4cf6-9032-097a-44cff295cb1e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3e367e0d-4cf6-9032-097a-44cff295cb1e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c9a5b0bebb1425620f7c01d621c54f0a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"acrylicopacity\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#acrylicopacity\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eacrylicOpacity\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e透過設定。デフォルトで0.5。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"colorscheme\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#colorscheme\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecolorScheme\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eいくつかは既定のカラースキーマがあるほか、\u003ccode\u003eschemes\u003c/code\u003eのところに自分で追加することでそれを呼び出すこともできる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/NickSeagull/windows-terminal-monokai-night\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/NickSeagull/windows-terminal-monokai-night\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこういうのとか。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"commandline\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#commandline\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003ecommandline\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e環境変数を設定するような項目はどうも見当たらないので\u003ccode\u003ecmd.exe\u003c/code\u003eの引数で頑張ることで実現する。\u003cbr\u003e\n環境変数の意味は\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/42132a1e8435504448aa\"\u003eVisual Studio Code 15.1の統合シェルをMSYS2のbashにする\u003c/a\u003e\u003cbr\u003e\nでもみてほしい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"fontface\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#fontface\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003efontFace\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e多分省略できるし\u003ccode\u003eDejaVu Sans Mono\u003c/code\u003eとかとか好きなのを使えばいい。ちなみに例示した\u003ccode\u003eHackGen\u003c/code\u003eは\u003cbr\u003e\n\u003ca href=\"https://qiita.com/tawara_/items/374f3ca0a386fab8b305\" id=\"reference-d3114bbf21413b6ea912\"\u003e【文字幅 半角3:全角5 も追加】Ricty を神フォントだと崇める僕が、フリーライセンスのプログラミングフォント「白源」を作った話\u003c/a\u003e\u003cbr\u003e\nで紹介のあるフォントだ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"guid\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#guid\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eguid\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e\u003cstrong\u003e先程取得しておいたGUID\u003c/strong\u003eをここに書く。\u003c/p\u003e\n\n\u003cp\u003eちなみに\u003ccode\u003edefaultProfile\u003c/code\u003eにここと同じGUIDを書けばそのプロファイルが規定になる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"icon\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#icon\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eicon\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eなくてもいいがアイコンがあるほうがいいよね。msys64直下にicoファイルがあるのでそれを参照する。ちなみに\u003ccode\u003ems-appdata:///roaming/msys2.ico\u003c/code\u003eとしている例も見かけたが私の環境では動かなかった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"startingdirectory\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#startingdirectory\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003estartingDirectory\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e起動したときのカレントディレクトリ。念の為指定したけどなくても動いた。よくわからん。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"useacrylic\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#useacrylic\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003euseAcrylic\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eこれを使うと透過が有効になる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"動作例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E4%BD%9C%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動作例\u003c/h1\u003e\n\n\u003cp\u003e(図は透過させてないものです)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F809b6189-4ff7-29c2-16c3-396850adb405.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=60a13f36f42566f3be217dd8ab16a3ab\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F809b6189-4ff7-29c2-16c3-396850adb405.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=60a13f36f42566f3be217dd8ab16a3ab\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/809b6189-4ff7-29c2-16c3-396850adb405.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F809b6189-4ff7-29c2-16c3-396850adb405.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=46c0b93b68ae729d92b8521f76c28bb6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考資料\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/msys2/MSYS2-packages/issues/1684\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUsing MSYS2 in Windows Terminal · Issue #1684 · msys2/MSYS2-packages\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/microsoft/terminal/issues/1669\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUsing Windows Terminal for MSYS2 · Issue #1669 · microsoft/terminal\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://news.mynavi.jp/article/win10tips-399/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWindows 10ミニTips(399) Windows Terminalにシェルを追加する | マイナビニュース\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# はじめに\n\nWindowsのデフォルトのconhost.exeのクソさに誰もが直面したことがあるだろう。そしてminttyやConEmuを使い始める人が出てくる。\n\nもしくは最近だとVisual Studio Codeのターミナルが結構優秀なのでそれを使ったりしているかもしれない。これについては前に\n[Visual Studio Code 15.1の統合シェルをMSYS2のbashにする](https://qiita.com/yumetodo/items/42132a1e8435504448aa)\nという記事を書いた。\n\nさて、Windows10がリリースされてもう随分たつが、ConPTY APIの導入、そしてWindows Terminalの実装開始とWindowsの端末環境に大きな変化が訪れようとしている。\nhttps://github.com/microsoft/terminal\n執筆現在まだ正式リリースはされていないが、かなり完成度が高くなってきていて、割と使い物になるレベルに達している。\n\nさて、そんなWindows Terminalでmsys2のbashを使うにはどうすればいいのか。おもむろにググったがなんとまさかの日本語の文献がヒットしない。これは私が書くしかないのでは？\n\nちなみに似たような事例としてgit bashを使いたいという場合もあると思うのですが、それについては\n[Windows Terminal で Git Bash を表示する](https://qiita.com/yokra9/items/bdd0882268b308cf22ca)\nという記事がありました。\n\n# 準備\n\nすでにWindows Terminalはインストールされているものとする。\n\nPowerShellをまず開いて\n\n```powershell\n\u003e [guid]::NewGuid()\n```\n\nを実行する。これでGUIDが取得できる。\n\n# 設定\n\nWindows Terminalを開いて、\u003ckbd\u003eCtl\u003c/kbd\u003e+\u003ckbd\u003e,\u003c/kbd\u003eすると設定ファイルが開く。\n\n`profiles`の項目に\n\n```json\n        {\n            \"acrylicOpacity\" : 0.5,\n            \"closeOnExit\" : true,\n            \"colorScheme\" : \"Campbell\",\n            \"commandline\" : \"cmd.exe /c \\\"set MSYSTEM=MINGW64\u0026\u0026 set MSYS=winsymlinks:nativestrict\u0026\u0026 C:/msys64/usr/bin/bash.exe --login\\\"\",\n            \"fontFace\" : \"HackGen\",\n            \"fontSize\" : 11,\n            \"guid\" : \"{00000000-0000-0000-0000-000000000000}\",\n            \"historySize\" : 9001,\n            \"icon\": \"C:/msys64/msys2.ico\",\n            \"name\" : \"MSYS2\",\n            \"padding\" : \"0, 0, 0, 0\",\n            \"snapOnInput\" : true,\n            \"startingDirectory\" : \"C:/msys64/home/yumetodo\",\n            \"useAcrylic\" : true\n        }\n```\n\nのように記述する。最初からPowerShellやらコマンドプロンプトの設定が記述されていると思うが、ここでの記述順がそのままメニューでの並びになる\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/3e367e0d-4cf6-9032-097a-44cff295cb1e.png)\n\n## `acrylicOpacity`\n\n透過設定。デフォルトで0.5。\n\n## `colorScheme`\n\nいくつかは既定のカラースキーマがあるほか、`schemes`のところに自分で追加することでそれを呼び出すこともできる。\n\nhttps://github.com/NickSeagull/windows-terminal-monokai-night\n\nこういうのとか。\n\n## `commandline`\n\n環境変数を設定するような項目はどうも見当たらないので`cmd.exe`の引数で頑張ることで実現する。\n環境変数の意味は\n[Visual Studio Code 15.1の統合シェルをMSYS2のbashにする](https://qiita.com/yumetodo/items/42132a1e8435504448aa)\nでもみてほしい。\n\n## `fontFace`\n\n多分省略できるし`DejaVu Sans Mono`とかとか好きなのを使えばいい。ちなみに例示した`HackGen`は\n[【文字幅 半角3:全角5 も追加】Ricty を神フォントだと崇める僕が、フリーライセンスのプログラミングフォント「白源」を作った話](https://qiita.com/tawara_/items/374f3ca0a386fab8b305)\nで紹介のあるフォントだ。\n\n## `guid`\n\n**先程取得しておいたGUID**をここに書く。\n\nちなみに`defaultProfile`にここと同じGUIDを書けばそのプロファイルが規定になる。\n\n## `icon`\n\nなくてもいいがアイコンがあるほうがいいよね。msys64直下にicoファイルがあるのでそれを参照する。ちなみに`ms-appdata:///roaming/msys2.ico`としている例も見かけたが私の環境では動かなかった。\n\n## `startingDirectory`\n\n起動したときのカレントディレクトリ。念の為指定したけどなくても動いた。よくわからん。\n\n## `useAcrylic`\n\nこれを使うと透過が有効になる。\n\n# 動作例\n\n(図は透過させてないものです)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/809b6189-4ff7-29c2-16c3-396850adb405.png)\n\n# 参考資料\n\n- [Using MSYS2 in Windows Terminal · Issue #1684 · msys2/MSYS2-packages](https://github.com/msys2/MSYS2-packages/issues/1684)\n- [Using Windows Terminal for MSYS2 · Issue #1669 · microsoft/terminal](https://github.com/microsoft/terminal/issues/1669)\n- [Windows 10ミニTips(399) Windows Terminalにシェルを追加する | マイナビニュース](https://news.mynavi.jp/article/win10tips-399/)\n","coediting":false,"comments_count":0,"created_at":"2020-02-20T20:26:46+09:00","group":null,"id":"4aa03d1eb3d887bca1a8","likes_count":6,"private":false,"reactions_count":0,"tags":[{"name":"msys2","versions":[]},{"name":"WindowsTerminal","versions":[]}],"title":"Windows Terminalでもmsys2を使おう","updated_at":"2020-02-20T23:02:56+09:00","url":"https://qiita.com/yumetodo/items/4aa03d1eb3d887bca1a8","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e基本情報技術者試験に申し込んだので過去問を解いてみたのだが、初見では半分しか解けなかった。ネットワークについての知識が不十分のようだ。\u003c/p\u003e\n\n\u003cp\u003eというわけで、OSI基本参照モデルをベースに知識を増やしていく。これはそのメモ書きだ。\u003c/p\u003e\n\n\u003cp\u003eニコニコ動画ユーザー非公式交流Slackで質問に答えてくれた皆様に感謝を。\u003c/p\u003e\n\n\u003cp\u003eなお、基本情報技術者試験では問われないレベルの内容も多数含んだメモ書きである。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"osi基本参照モデルの前に\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#osi%E5%9F%BA%E6%9C%AC%E5%8F%82%E7%85%A7%E3%83%A2%E3%83%87%E3%83%AB%E3%81%AE%E5%89%8D%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOSI基本参照モデルの前に\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"パケットとデータグラムと\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%91%E3%82%B1%E3%83%83%E3%83%88%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eパケットとデータグラムと\u003c/h2\u003e\n\n\u003cp\u003eパケットという概念はOSI参照モデルより古い概念である。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%91%E3%82%B1%E3%83%83%E3%83%88\" rel=\"nofollow noopener\" target=\"_blank\"\u003eパケット - Wikipedia\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eパケット単位で小分けにして通信を行うことにより、回線を連続して占有することができないため、複数の端末からの送受信データを1本の回線に集められる（多重化）、大容量のデータのうち１か所が破損・喪失した際に、ひとつのパケットを再送するだけで足りる等の利点がある。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eではデータグラムとはなにか。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eデータグラム - Wikipedia\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「データグラム」は「パケット」と同義語として扱われることが多いが、ニュアンスは若干異なる。 「データグラム」は一般に、宛先に届かない場合でもユーザに通知しない、信頼できないサービスでのパケットを意味する。 一方「パケット」は、パケットとしてフォーマットされたメッセージ一般を指す。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eところでOSI基本参照モデルにおいてパケットといえば、第三層の話である。これはどういうことか。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eデータグラム - Wikipedia\u003c/a\u003e\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eOSIレイヤー\u003c/th\u003e\n\u003cth\u003eデータグラムの名前\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eLayer 4\u003c/td\u003e\n\u003ctd\u003eデータセグメント\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eLayer 3\u003c/td\u003e\n\u003ctd\u003eデータパケット\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eLayer 2\u003c/td\u003e\n\u003ctd\u003eフレーム (IEEE 802.3)\u003cbr\u003eフレーム (IEEE 802.11)\u003cbr\u003eセル (ATM)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eLayer 1\u003c/td\u003e\n\u003ctd\u003eチップ（英語版）\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eslackで聞いてみた。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e実体としておなじものでも、それぞれのレイヤーから見ると別の名前がついている、という感じですね\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"イーサネット\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eイーサネット\u003c/h2\u003e\n\n\u003cp\u003eイーサネットはOSI参照モデルの下位2つの層である物理層とデータリンク層に関して規定している。 現代の有線LANは、OSI参照モデルの下位2層に相当するイーサネットとそれ以上の層を規定した「TCP/IPプロトコル」の組み合わせが一般的である。\u003c/p\u003e\n\n\u003cp\u003eイーサネットの規格名の大体の付け方を下に示す。\u003c/p\u003e\n\n\u003cp\u003e$$\u003cbr\u003e\n\\begin{pmatrix}\u003cbr\u003e\n10 \\\u003cbr\u003e\n100 \\\u003cbr\u003e\n1000 \\\u003cbr\u003e\n10G \\\u003cbr\u003e\n\\end{pmatrix}\u003cbr\u003e\n\\begin{pmatrix}\u003cbr\u003e\nBASE \\\u003cbr\u003e\nBROAD \\\u003cbr\u003e\n\\end{pmatrix}\u003cbr\u003e\n\\begin{pmatrix}\u003cbr\u003e\n2 \\\u003cbr\u003e\n5 \\\u003cbr\u003e\n-TX \\\u003cbr\u003e\n-FX \\\u003cbr\u003e\netc \\\u003cbr\u003e\n\\end{pmatrix}\u003cbr\u003e\n$$\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ネットワークトポロジー\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%88%E3%83%9D%E3%83%AD%E3%82%B8%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eネットワーク・トポロジー\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F9%2F96%2FNetworkTopologies.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5551dd4256680f990275ee97183b7ea0\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F9%2F96%2FNetworkTopologies.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5551dd4256680f990275ee97183b7ea0\" alt=\"NetworkTopologies.png\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/9/96/NetworkTopologies.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F9%2F96%2FNetworkTopologies.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b60fdee9f56ee3c0a48e8fbe07ff9593 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\nパブリック・ドメイン, \u003ca href=\"https://commons.wikimedia.org/w/index.php?curid=644883\" rel=\"nofollow noopener\" target=\"_blank\"\u003eリンク\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eイーサネットはバス型構成であったが、10BASE-Tからはケーブル形状の変更で物理的にはスター型トポロジーとなった\u003c/p\u003e\n\n\u003cp\u003eところでバス型がぴんとこない。slackで聞いてみた。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eバス型ってどういうことなのかイマイチぴんとこないです。航空無線みたいなものをイメージすればいいんでしょうか？(同じ帯域を聞いている人間全員に伝わる\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこんな返事が。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eそうですね、まさに航空無線のようなものです。あれも、複数人が同時に話そうとするとスキール音になって全員が通信失敗しますよね。\u003cbr\u003e\u003cbr\u003e\nだから、CSMA/CDみたいな仕組みがEthernetにはあるんですよね。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"osi基本参照モデル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#osi%E5%9F%BA%E6%9C%AC%E5%8F%82%E7%85%A7%E3%83%A2%E3%83%87%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eOSI基本参照モデル\u003c/h1\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e番号\u003c/th\u003e\n\u003cth\u003e名称\u003c/th\u003e\n\u003cth\u003e役割\u003c/th\u003e\n\u003cth\u003e具体例\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003eアプリケーション層\u003c/td\u003e\n\u003ctd\u003e個々のアプリケーション\u003c/td\u003e\n\u003ctd\u003eWWW、メール\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003eプレゼンテーション層\u003c/td\u003e\n\u003ctd\u003eデータの表現形式\u003c/td\u003e\n\u003ctd\u003eHTML\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003eセッション層\u003c/td\u003e\n\u003ctd\u003e通信手段\u003c/td\u003e\n\u003ctd\u003eHTTP\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003eトランスポート層\u003c/td\u003e\n\u003ctd\u003eEnd-End間の通信制御\u003c/td\u003e\n\u003ctd\u003eTCP、UDP\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003eネットワーク層\u003c/td\u003e\n\u003ctd\u003eデータを送る相手を決め最適な経路で送る\u003c/td\u003e\n\u003ctd\u003eIP\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003eリンク層\u003c/td\u003e\n\u003ctd\u003e隣接機器同士の通信を実現する\u003c/td\u003e\n\u003ctd\u003eEthernet\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e物理層\u003c/td\u003e\n\u003ctd\u003e物理的な接続、電気信号\u003c/td\u003e\n\u003ctd\u003e光ファイバ、電話線\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eアプリケーション層はJISの訳語では「応用層」らしい。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://professionalipv6.booth.pm/items/913273\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロフェッショナルIPv6\u003c/a\u003e p.45\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F6d0b1d19-48cd-beb0-1461-22cf560da574.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f75505f5811e3e11d6ba6f46ba612c65\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F6d0b1d19-48cd-beb0-1461-22cf560da574.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f75505f5811e3e11d6ba6f46ba612c65\" alt=\"IPv4とIPv6の両方が同時に存在する場合\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/6d0b1d19-48cd-beb0-1461-22cf560da574.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F6d0b1d19-48cd-beb0-1461-22cf560da574.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1f0a4259f16dfb1f98a8ccbbb0c2ef29 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\nCC BY-NC-SA\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e以下は\u003ca href=\"https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999\" id=\"reference-775951b90d77869fc14d\"\u003eOSI参照モデルまとめ - Qiita\u003c/a\u003eを基に、引っかかった部分などを追記していく。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"レイヤー1物理層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC1%E7%89%A9%E7%90%86%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eレイヤー1：物理層\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"l1ハブ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#l1%E3%83%8F%E3%83%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eL1ハブ\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999\"\u003eOSI参照モデルまとめ - Qiita\u003c/a\u003eの物理層のネットワーキングデバイスにハブが出てくるがどういうものだろうか。slackで聞いてみた。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eというかL1ハブは自分でも作れるレベルのものですね\u003cbr\u003e\u003cbr\u003e\nコネクタ同士を電気的に結線するだけw\u003cbr\u003e\u003cbr\u003e\nなんの制御もしないものです\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eああ、だからリピーターと同列に書いてるのか。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.geekpage.jp/technology/ip-base/osi7.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOSI 7層モデル:Geekなぺーじ\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「１．みんなに送るけど自分に関係ない通信は無視してね！なハブ」を「リピーターハブ」と言います。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"メディアコンバーター\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%87%E3%82%A3%E3%82%A2%E3%82%B3%E3%83%B3%E3%83%90%E3%83%BC%E3%82%BF%E3%83%BC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメディアコンバーター\u003c/h3\u003e\n\n\u003cp\u003e物理層において，異なる伝送媒体を接続し，信号を相互に変換する機能のことらしいです(過去問より)。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://panasonic.co.jp/ls/plsnw/product/lan/mc.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eメディアコンバータ｜スイッチングハブ(HUB)｜パナソニックLSネットワークス株式会社｜Panasonic\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eメディアコンバータ（メディコン）は、UTPケーブルから光ファイバに変換することで、UTPケーブルでは100ｍまでに限られている伝送距離を延長するための変換装置です。スイッチングハブと接続して使用します。\u003cbr\u003e\n光ファイバはノイズに強いので、工場などのノイズ発生源が多い環境下における通信障害対策に有効です。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"レイヤー2データリンク層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC2%E3%83%87%E3%83%BC%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%AF%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eレイヤー2：データリンク層\u003c/h2\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://www.geekpage.jp/technology/ip-base/osi7.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOSI 7層モデル:Geekなぺーじ\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.geekpage.jp%2Ftechnology%2Fip-base%2Flayer2-3.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a7f005a7b303a1a898d8b215d29c213b\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.geekpage.jp%2Ftechnology%2Fip-base%2Flayer2-3.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a7f005a7b303a1a898d8b215d29c213b\" alt=\"img\" data-canonical-src=\"https://www.geekpage.jp/technology/ip-base/layer2-3.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.geekpage.jp%2Ftechnology%2Fip-base%2Flayer2-3.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4f08f1f5da4047b2e4a69b13c1ee1b67 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこの図がわかりやすい。\u003c/p\u003e\n\n\u003cp\u003eネットワークデバイスにはMACアドレスが振られており、これがノードを識別するキーになる。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"フレーム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eフレーム\u003c/h3\u003e\n\n\u003cp\u003e宛先のMACアドレス、送信元のMACアドレス、データ長orタイプ、データ本体、FCS(CRCによるチェック)という構成のフレーム(byte列)が流れていく。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F7%2F7c%2F%25E3%2582%25A4%25E3%2583%25BC%25E3%2582%25B5%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2581%25AE%25E3%2583%2595%25E3%2583%25AC%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E3%2581%25A4%25E3%2581%25AA%25E3%2581%258C%25E3%2582%258A.PNG%2F1200px-%25E3%2582%25A4%25E3%2583%25BC%25E3%2582%25B5%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2581%25AE%25E3%2583%2595%25E3%2583%25AC%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E3%2581%25A4%25E3%2581%25AA%25E3%2581%258C%25E3%2582%258A.PNG?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8b857ece0e7e656e77f0b38d9f5eb139\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F7%2F7c%2F%25E3%2582%25A4%25E3%2583%25BC%25E3%2582%25B5%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2581%25AE%25E3%2583%2595%25E3%2583%25AC%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E3%2581%25A4%25E3%2581%25AA%25E3%2581%258C%25E3%2582%258A.PNG%2F1200px-%25E3%2582%25A4%25E3%2583%25BC%25E3%2582%25B5%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2581%25AE%25E3%2583%2595%25E3%2583%25AC%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E3%2581%25A4%25E3%2581%25AA%25E3%2581%258C%25E3%2582%258A.PNG?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8b857ece0e7e656e77f0b38d9f5eb139\" alt=\"イーサネットのフレームのつながり.PNG\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88%E3%81%AE%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E3%81%A4%E3%81%AA%E3%81%8C%E3%82%8A.PNG/1200px-%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88%E3%81%AE%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E3%81%A4%E3%81%AA%E3%81%8C%E3%82%8A.PNG\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F7%2F7c%2F%25E3%2582%25A4%25E3%2583%25BC%25E3%2582%25B5%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2581%25AE%25E3%2583%2595%25E3%2583%25AC%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E3%2581%25A4%25E3%2581%25AA%25E3%2581%258C%25E3%2582%258A.PNG%2F1200px-%25E3%2582%25A4%25E3%2583%25BC%25E3%2582%25B5%25E3%2583%258D%25E3%2583%2583%25E3%2583%2588%25E3%2581%25AE%25E3%2583%2595%25E3%2583%25AC%25E3%2583%25BC%25E3%2583%25A0%25E3%2581%25AE%25E3%2581%25A4%25E3%2581%25AA%25E3%2581%258C%25E3%2582%258A.PNG?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=90227aaf68d75aab97a6c4c76f0e6300 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e\n\u003ca href=\"//commons.wikimedia.org/w/index.php?title=User:Tosaka\u0026amp;amp;action=edit\u0026amp;amp;redlink=1\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTosaka\u003c/a\u003e - 投稿者自身による作品, \u003ca href=\"https://creativecommons.org/licenses/by-sa/3.0/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCC 表示-継承 3.0\u003c/a\u003e, \u003ca href=\"https://commons.wikimedia.org/w/index.php?curid=2934539\" rel=\"nofollow noopener\" target=\"_blank\"\u003eリンク\u003c/a\u003eによる\u003c/p\u003e\n\n\u003cp\u003eタイプとは上層位のプロトコル種別を表している。結局「データ長orタイプ」の構成は以下のようになる。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://blog.longest-road.com/contents/?p=827\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDIX 規格のフレームフォーマット – Tech Knowledge\u003c/a\u003e\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eタイプ (16 進数表記)\u003c/th\u003e\n\u003cth\u003e意味\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x0000 ~ 05DC\u003c/td\u003e\n\u003ctd\u003eIEEE802.3 規格のデータ長 (DIX 規格では未使用)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x05DD ~ 05FF\u003c/td\u003e\n\u003ctd\u003e未使用\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x0800\u003c/td\u003e\n\u003ctd\u003eIPv4\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x86DD\u003c/td\u003e\n\u003ctd\u003eIPv6\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x0806\u003c/td\u003e\n\u003ctd\u003eARP\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x8035\u003c/td\u003e\n\u003ctd\u003eRARP\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x8100\u003c/td\u003e\n\u003ctd\u003eIEEE802.1Q (VLAN)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x8808\u003c/td\u003e\n\u003ctd\u003eIEEE802.3x (フロー制御)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x8809\u003c/td\u003e\n\u003ctd\u003eIEEE802.3ad (リングアグリゲーション)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x8137\u003c/td\u003e\n\u003ctd\u003ePPPoE Discovery Stage\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e0x8864\u003c/td\u003e\n\u003ctd\u003ePPPoE Session Stage\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e受信側でFCSを用いてフレームの検査が行われ、誤りがある場合は単に破棄する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"衝突への対応\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A1%9D%E7%AA%81%E3%81%B8%E3%81%AE%E5%AF%BE%E5%BF%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e衝突への対応\u003c/h3\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88\" rel=\"nofollow noopener\" target=\"_blank\"\u003eイーサネット - Wikipedia\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e初期のイーサネットは論理的、物理的ともにバス型構成であり、複数の端末が1本の同軸ケーブルに接続されていた。多数の端末が繋がっている場合には、任意の端末AとBとの「1対1」の排他的な通信は不可能であり、端末Aから送出されたデータは、同じイーサネットの配線に繋がっている全端末へ届けられる「1対全」の通信方式である。「1対全」の通信であるため、既に端末AとBが通信している時に端末Cが新たに送信したい場合は、伝送路の空きを待つ必要がある。複数の端末が接続されている時に、ほぼ同時に送信が行われた場合、衝突することがあり、その場合データが損失する。これを衝突（コリジョン）と呼\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこの方式としてCSMA/CDとCSMA/CAが挙げられる。\u003c/p\u003e\n\n\u003cp\u003eまずCSMAの意味合いは次のとおりである。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e搬送波感知（Carrier Sense）\u003c/p\u003e\n\n\u003cp\u003e通信を開始する前に、一度受信を試みることで現在通信をしているホストが他にあるかどうか確認する。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e多重アクセス（Multiple Access）\u003c/p\u003e\n\n\u003cp\u003e複数のクライアントは同じ回線を共用し、他者が通信をしていなければ自分の通信を開始する。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"csmacd\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#csmacd\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCSMA/CD\u003c/h4\u003e\n\n\u003cp\u003eイーサネットにおいて用いられている。ただし、スイッチングハブで通信制御を行うことが一般的になったため(物理的にスター型になった)、必要性はなくなり、10GbEthernetなど、Ethernet規格の中でも比較的新しいものでは衝突検出をサポートしていない。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e衝突検出（Collision Detection）\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e複数の通信が同時に行われた場合はそれを検知し、ランダムな時間待ってから再び送信手順を行う。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"csmaca\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#csmaca\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCSMA/CA\u003c/h4\u003e\n\n\u003cp\u003e無線LANの通信規格であるIEEE 802.11において用いられている。これは無線通信では信頼できる衝突検出がないためである。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e衝突回避（Collision Avoidance）\u003c/p\u003e\n\n\u003cp\u003e搬送波感知の段階で通信中のホストが存在した場合、通信終了と同時に送信を試みると衝突する可能性が高い。そのため、他のホストの送信終了を検知した場合は自分が送信を開始する前にランダムな長さの待ち時間をとる。なお、永久に送信できない事態を防ぐため、この待ち時間は徐々に短くされてゆく。\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"レイヤー3ネットワーク層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC3%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eレイヤー3：ネットワーク層\u003c/h2\u003e\n\n\u003cp\u003eようやくIPアドレスの出番がやってきた。IPv4だとかIPv6とかはこのレイヤーの話になる。ネットワーク層では隣の機器だけではなく離れた機器の通信も扱う。ここでルーターが大事になってくる。\u003c/p\u003e\n\n\u003cp\u003eルータが通信経路の決定に関わる(経路選択機能)。\u003c/p\u003e\n\n\u003cp\u003eIPv4とIPv6の詳細は\u003ca href=\"https://professionalipv6.booth.pm/items/913273\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロフェッショナルIPv6\u003c/a\u003eを後でのんびり眺める。\u003c/p\u003e\n\n\u003cp\u003eなおICMPはIPv6時代ではICMPv6になったが、もはや別物と言っていい進化を遂げたらしい。つまり、もはや\u003ccode\u003eping\u003c/code\u003eや\u003ccode\u003etraceroute\u003c/code\u003eが主要な用途だった時代は終わったということらしい。知らんけど。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://professionalipv6.booth.pm/items/913273\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロフェッショナルIPv6\u003c/a\u003e p.102 表6.1 さまざまな機能のICMPv6 への統合\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e機能\u003c/th\u003e\n\u003cth\u003eIPv4 における手段\u003c/th\u003e\n\u003cth\u003eIPv6 における手段\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eエラーメッセージ、情報メッセージなど\u003c/td\u003e\n\u003ctd\u003eICMP\u003c/td\u003e\n\u003ctd\u003eICMPv6\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eIP アドレスからリンク層アドレスの解決\u003c/td\u003e\n\u003ctd\u003eARP\u003c/td\u003e\n\u003ctd\u003e近隣探索（ICMPv6）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eリンク層アドレスからIP アドレスの解決\u003c/td\u003e\n\u003ctd\u003eRARP\u003c/td\u003e\n\u003ctd\u003e近隣探索（ICMPv6）\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eマルチキャストの機能\u003c/td\u003e\n\u003ctd\u003eIGMP\u003c/td\u003e\n\u003ctd\u003eMLD（ICMPv6）\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003eCC BY-NC-SA\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"レイヤー4トランスポート層\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC4%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88%E5%B1%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eレイヤー4：トランスポート層\u003c/h2\u003e\n\n\u003cp\u003eほとんどの通信はTCPが用いられるが、そのほかにもUDPがある。また、TCPだと機能が多すぎるけどUDPだと少なすぎるという用途のためにSCTPとかQUICがある。\u003c/p\u003e\n\n\u003cp\u003eSCTPがすでにあるのにそれに似たQUICというUDP上で構築されたものが出てきたのは\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://qiita.com/urakarin/items/dd1cb2f25e2c80178e5d#comment-121be4bc7bde1f27f790\" id=\"reference-5826accbd34651d67917\"\u003eSCTPとは - Qiita\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eQUICの動機として分析があるけど、結局、TCP/UDPじゃないと通信を通してもらえるか怪しくなる、はあるんでしょうね。\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eQUICのoverUDPはオーバーヘッドと現実解としての利便では利便が勝つってことでしょうし\u003c/strong\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eというコメントを見かけた\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ハブとかスイッチがどのレイヤーかわかりにくい問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%8F%E3%83%96%E3%81%A8%E3%81%8B%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%81%8C%E3%81%A9%E3%81%AE%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E3%81%8B%E3%82%8F%E3%81%8B%E3%82%8A%E3%81%AB%E3%81%8F%E3%81%84%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eハブとかスイッチがどのレイヤーかわかりにくい問題\u003c/h1\u003e\n\n\u003cp\u003eまずハブと言う言葉はL1でもL2でも見かける。L1のハブとは単に通信線をつなげただけのものに過ぎなかった。L2ハブではスイッチング機能(=MACアドレスを見て特定の機器にのみ伝える)を持つものが一般的になっている(スイッチングハブ)。\u003c/p\u003e\n\n\u003cp\u003eL2スイッチはスイッチングハブの機能に加えて、VLANを構成できる。\u003c/p\u003e\n\n\u003cp\u003eL3スイッチはVLAN間の通信の制御ができるルーター機能を持つ。\u003c/p\u003e\n\n\u003cp\u003e・・・と思ったが早速slackでツッコミが入った。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eVLANを構成できる機能はL2、L3と関係ないです。VLAN間の通信制御ができないL3SWもあります。VLANは中級編くらいなので、今は意識しなくて良いです。VLANが構成できるルータはポートVLANとタグVLANがあって・・・と説明すると長くなります。\u003c/p\u003e\n\n\u003cp\u003eL2スイッチはあくまでもOSIのレイヤー2をみて通すということしか言ってない\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eVLANまわり理解することを諦めた。いつかきっとまた勉強しよう。\u003c/p\u003e\n\n\u003cp\u003eと言っていたら、slackでさらにコメントが付いて\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eL2SWとL3SWに関しては、それぞれ、第2層（macアドレス）・第3層（IPアドレス）を元に流す先を決める…っていう程度の理解で問題ないと思いますー\u003c/p\u003e\n\n\u003cp\u003eVLANはこの図を見てもらうのがなんとなくわかってもらえそう\u003cbr\u003e\nそしてとりあえずそのなんとなくレベルで今は良さそう\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fmilestone-of-se.nesuke.com%2Fwp-content%2Fuploads%2F2017%2F10%2Ftag-vlan-1.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c6307ff92bfe857bb6211ce577d65e4e\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fmilestone-of-se.nesuke.com%2Fwp-content%2Fuploads%2F2017%2F10%2Ftag-vlan-1.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c6307ff92bfe857bb6211ce577d65e4e\" alt=\"img\" data-canonical-src=\"https://milestone-of-se.nesuke.com/wp-content/uploads/2017/10/tag-vlan-1.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fmilestone-of-se.nesuke.com%2Fwp-content%2Fuploads%2F2017%2F10%2Ftag-vlan-1.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=30dabddfd13f780a7662801c4acb10ad 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eさらに\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【図解】初心者にも分かる VLAN 入門〜仕組み,メリットや必要性について〜│SEの道標\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan-access-trunk/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e【図解】トランクポートとアクセスポートの違い、trunk port に access port や PC を接続するとどうなるか│SEの道標\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eを見ると良いと言われた。あと実際に手を動かして勉強するためには\u003cbr\u003e\n\u003ca href=\"https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCISCOスイッチ/ルータの無料エミュレーターの紹介 | Netassist Blog\u003c/a\u003e\u003cbr\u003e\nのようなシュミレーターがあるらしい。\u003c/p\u003e\n\n\u003cp\u003eあとVLANのメリットは\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e1つのスイッチで複数のネットワークが使えて、切り替えられるのがメリットと考えてますー\u003c/p\u003e\n\n\u003cp\u003eもしこれをVLAN使わずにそれぞれ分けたネットワークで構成するなら、ネットワークの数だけスイッチが必要になるところを、VLANを使えば1つで済ませられます\u003c/p\u003e\n\n\u003cp\u003eさらに、アップリンク（上流側）はトランクポートにすることで、「VLAN=10」「VLAN=20」みたいなタグをつけて流すことができるので、複数のネットワークで同じ線を共有することができるようになりますー\u003c/p\u003e\n\n\u003cp\u003eさっきの図だと、VLAN使わなければ営業部と開発部と幹部とで上下それぞれ3つずつスイッチが必要になる上に、それぞれを結線しないといけないのでスイッチ間の線も3本になるところが、VLANのおかげでスイッチ2つの線1本で済むっていう感じです\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eとのこと。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参考資料\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E8%80%83%E8%B3%87%E6%96%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参考資料\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999\"\u003eOSI参照モデルまとめ - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.geekpage.jp/technology/ip-base/osi7.php\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOSI 7層モデル:Geekなぺーじ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://professionalipv6.booth.pm/items/913273\" rel=\"nofollow noopener\" target=\"_blank\"\u003eプロフェッショナルIPv6\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://wa3.i-3-i.info/word15164.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eダムハブ (dumb hub)とは｜「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.sophia-it.com/content/%E3%83%80%E3%83%A0%E3%83%8F%E3%83%96\" rel=\"nofollow noopener\" target=\"_blank\"\u003eダムハブとは (dumb hub)： - IT用語辞典バイナリ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://shanai-se.net/l2%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%81%A8%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0%E3%83%8F%E3%83%96%E3%81%AE%E9%81%95%E3%81%84/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eL2スイッチとスイッチングハブの違い | 社内SEの教科書\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://shanai-se.net/l2%e3%82%b9%e3%82%a4%e3%83%83%e3%83%81%e3%81%a8l3%e3%82%b9%e3%82%a4%e3%83%83%e3%83%81%e3%81%ae%e9%81%95%e3%81%84/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eL2スイッチとL3スイッチの違い | 社内SEの教科書\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.enri.go.jp/report/hapichi/pdf2006/15.pdf\" rel=\"nofollow noopener\" target=\"_blank\"\u003e5. 航空無線へのCDMA方式の適用可能性\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%BB%E3%83%88%E3%83%9D%E3%83%AD%E3%82%B8%E3%83%BC\" rel=\"nofollow noopener\" target=\"_blank\"\u003eネットワーク・トポロジー - Wikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88\" rel=\"nofollow noopener\" target=\"_blank\"\u003eイーサネット - Wikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/CSMA/CD\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCSMA/CD - Wikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/CSMA/CA\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCSMA/CA - Wikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.longest-road.com/contents/?p=827\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDIX 規格のフレームフォーマット – Tech Knowledge\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0\" rel=\"nofollow noopener\" target=\"_blank\"\u003eデータグラム - Wikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%91%E3%82%B1%E3%83%83%E3%83%88\" rel=\"nofollow noopener\" target=\"_blank\"\u003eパケット - Wikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/urakarin/items/dd1cb2f25e2c80178e5d\" id=\"reference-7ba893c5747fc9199039\"\u003eSCTPとは - Qiita\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"license\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#license\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLicense\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCC BY-NC-SA 4.0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://commons.wikimedia.org/wiki/File:Cc-by-nc-sa_icon.svg#/media/%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB:Cc-by-nc-sa_icon.svg\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F1%2F12%2FCc-by-nc-sa_icon.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=62142230bb98f73efb8f1be1e46a9125\" alt=\"Cc-by-nc-sa icon.svg\" width=\"120\" height=\"42\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/1/12/Cc-by-nc-sa_icon.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F1%2F12%2FCc-by-nc-sa_icon.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=f59cf0954aa4d6ba1f563758ad57f085 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"# はじめに\n\n基本情報技術者試験に申し込んだので過去問を解いてみたのだが、初見では半分しか解けなかった。ネットワークについての知識が不十分のようだ。\n\nというわけで、OSI基本参照モデルをベースに知識を増やしていく。これはそのメモ書きだ。\n\nニコニコ動画ユーザー非公式交流Slackで質問に答えてくれた皆様に感謝を。\n\nなお、基本情報技術者試験では問われないレベルの内容も多数含んだメモ書きである。\n\n# OSI基本参照モデルの前に\n\n## パケットとデータグラムと\n\nパケットという概念はOSI参照モデルより古い概念である。\n\n\u003e [パケット - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%91%E3%82%B1%E3%83%83%E3%83%88)\n\u003e\n\u003e パケット単位で小分けにして通信を行うことにより、回線を連続して占有することができないため、複数の端末からの送受信データを1本の回線に集められる（多重化）、大容量のデータのうち１か所が破損・喪失した際に、ひとつのパケットを再送するだけで足りる等の利点がある。\n\nではデータグラムとはなにか。\n\n\u003e [データグラム - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0)\n\u003e\n\u003e 「データグラム」は「パケット」と同義語として扱われることが多いが、ニュアンスは若干異なる。 「データグラム」は一般に、宛先に届かない場合でもユーザに通知しない、信頼できないサービスでのパケットを意味する。 一方「パケット」は、パケットとしてフォーマットされたメッセージ一般を指す。\n\nところでOSI基本参照モデルにおいてパケットといえば、第三層の話である。これはどういうことか。\n\n\u003e [データグラム - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0)\n\u003e\n\u003e | OSIレイヤー            | データグラムの名前    |\n\u003e |------------------------|-----------------------|\n\u003e | Layer 4                | データセグメント      |\n\u003e | Layer 3                | データパケット        |\n\u003e | Layer 2                | フレーム (IEEE 802.3)\u003cbr\u003eフレーム (IEEE 802.11)\u003cbr\u003eセル (ATM) |\n\u003e | Layer 1                | チップ（英語版）      |\n\nslackで聞いてみた。\n\n\u003e 実体としておなじものでも、それぞれのレイヤーから見ると別の名前がついている、という感じですね\n\n## イーサネット\n\nイーサネットはOSI参照モデルの下位2つの層である物理層とデータリンク層に関して規定している。 現代の有線LANは、OSI参照モデルの下位2層に相当するイーサネットとそれ以上の層を規定した「TCP/IPプロトコル」の組み合わせが一般的である。\n\nイーサネットの規格名の大体の付け方を下に示す。\n\n$$\n\\begin{pmatrix}\n10 \\\\\n100 \\\\\n1000 \\\\\n10G \\\\\n\\end{pmatrix}\n\\begin{pmatrix}\nBASE \\\\\nBROAD \\\\\n\\end{pmatrix}\n\\begin{pmatrix}\n2 \\\\\n5 \\\\\n-TX \\\\\n-FX \\\\\netc \\\\\n\\end{pmatrix}\n$$\n\n## ネットワーク・トポロジー\n\n![NetworkTopologies.png](https://upload.wikimedia.org/wikipedia/commons/9/96/NetworkTopologies.png)  \nパブリック・ドメイン, [リンク](https://commons.wikimedia.org/w/index.php?curid=644883)\n\nイーサネットはバス型構成であったが、10BASE-Tからはケーブル形状の変更で物理的にはスター型トポロジーとなった\n\nところでバス型がぴんとこない。slackで聞いてみた。\n\n\u003e バス型ってどういうことなのかイマイチぴんとこないです。航空無線みたいなものをイメージすればいいんでしょうか？(同じ帯域を聞いている人間全員に伝わる\n\nこんな返事が。\n\n\u003e そうですね、まさに航空無線のようなものです。あれも、複数人が同時に話そうとするとスキール音になって全員が通信失敗しますよね。  \n\u003e だから、CSMA/CDみたいな仕組みがEthernetにはあるんですよね。\n\n# OSI基本参照モデル\n\n| 番号 | 名称                 | 役割                                   | 具体例             |\n|------|----------------------|----------------------------------------|--------------------|\n| 7    | アプリケーション層   | 個々のアプリケーション                 | WWW、メール        |\n| 6    | プレゼンテーション層 | データの表現形式                       | HTML               |\n| 5    | セッション層         | 通信手段                               | HTTP               |\n| 4    | トランスポート層     | End-End間の通信制御                    | TCP、UDP           |\n| 3    | ネットワーク層       | データを送る相手を決め最適な経路で送る | IP                 |\n| 2    | リンク層             | 隣接機器同士の通信を実現する           | Ethernet           |\n| 1    | 物理層               | 物理的な接続、電気信号                 | 光ファイバ、電話線 |\n\nアプリケーション層はJISの訳語では「応用層」らしい。\n\n\u003e [プロフェッショナルIPv6](https://professionalipv6.booth.pm/items/913273) p.45\n\u003e\n\u003e ![IPv4とIPv6の両方が同時に存在する場合](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/6d0b1d19-48cd-beb0-1461-22cf560da574.png)\n\u003e CC BY-NC-SA\n\n以下は[OSI参照モデルまとめ - Qiita](https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999)を基に、引っかかった部分などを追記していく。\n\n## レイヤー1：物理層\n\n### L1ハブ\n\n[OSI参照モデルまとめ - Qiita](https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999)の物理層のネットワーキングデバイスにハブが出てくるがどういうものだろうか。slackで聞いてみた。\n\n\u003e というかL1ハブは自分でも作れるレベルのものですね  \n\u003e コネクタ同士を電気的に結線するだけw  \n\u003e なんの制御もしないものです\n\nああ、だからリピーターと同列に書いてるのか。\n\n\u003e [OSI 7層モデル:Geekなぺーじ](https://www.geekpage.jp/technology/ip-base/osi7.php)\n\u003e\n\u003e 「１．みんなに送るけど自分に関係ない通信は無視してね！なハブ」を「リピーターハブ」と言います。\n\n### メディアコンバーター\n\n物理層において，異なる伝送媒体を接続し，信号を相互に変換する機能のことらしいです(過去問より)。\n\n\u003e [メディアコンバータ｜スイッチングハブ(HUB)｜パナソニックLSネットワークス株式会社｜Panasonic](https://panasonic.co.jp/ls/plsnw/product/lan/mc.html)\n\u003e\n\u003e メディアコンバータ（メディコン）は、UTPケーブルから光ファイバに変換することで、UTPケーブルでは100ｍまでに限られている伝送距離を延長するための変換装置です。スイッチングハブと接続して使用します。\n光ファイバはノイズに強いので、工場などのノイズ発生源が多い環境下における通信障害対策に有効です。\n\n## レイヤー2：データリンク層\n\n\u003e [OSI 7層モデル:Geekなぺーじ](https://www.geekpage.jp/technology/ip-base/osi7.php)\n\u003e\n\u003e ![img](https://www.geekpage.jp/technology/ip-base/layer2-3.png)\n\nこの図がわかりやすい。\n\nネットワークデバイスにはMACアドレスが振られており、これがノードを識別するキーになる。\n\n### フレーム\n\n宛先のMACアドレス、送信元のMACアドレス、データ長orタイプ、データ本体、FCS(CRCによるチェック)という構成のフレーム(byte列)が流れていく。\n\n![イーサネットのフレームのつながり.PNG](https://upload.wikimedia.org/wikipedia/commons/thumb/7/7c/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88%E3%81%AE%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E3%81%A4%E3%81%AA%E3%81%8C%E3%82%8A.PNG/1200px-%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88%E3%81%AE%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%81%AE%E3%81%A4%E3%81%AA%E3%81%8C%E3%82%8A.PNG)  \n[Tosaka](//commons.wikimedia.org/w/index.php?title=User:Tosaka\u0026amp;action=edit\u0026amp;redlink=1) - 投稿者自身による作品, [CC 表示-継承 3.0](https://creativecommons.org/licenses/by-sa/3.0/), [リンク](https://commons.wikimedia.org/w/index.php?curid=2934539)による\n\nタイプとは上層位のプロトコル種別を表している。結局「データ長orタイプ」の構成は以下のようになる。\n\n\u003e [DIX 規格のフレームフォーマット – Tech Knowledge](https://blog.longest-road.com/contents/?p=827)\n\u003e\n\u003e | タイプ (16 進数表記) | 意味                                          |\n\u003e |----------------------|-----------------------------------------------|\n\u003e | 0x0000 ~ 05DC        | IEEE802.3 規格のデータ長 (DIX 規格では未使用) |\n\u003e | 0x05DD ~ 05FF        | 未使用                                        |\n\u003e | 0x0800               | IPv4                                          |\n\u003e | 0x86DD               | IPv6                                          |\n\u003e | 0x0806               | ARP                                           |\n\u003e | 0x8035               | RARP                                          |\n\u003e | 0x8100               | IEEE802.1Q (VLAN)                             |\n\u003e | 0x8808               | IEEE802.3x (フロー制御)                       |\n\u003e | 0x8809               | IEEE802.3ad (リングアグリゲーション)          |\n\u003e | 0x8137               | PPPoE Discovery Stage                         |\n\u003e | 0x8864               | PPPoE Session Stage                           |\n\n受信側でFCSを用いてフレームの検査が行われ、誤りがある場合は単に破棄する。\n\n### 衝突への対応\n\n\u003e [イーサネット - Wikipedia](https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88)\n\u003e\n\u003e 初期のイーサネットは論理的、物理的ともにバス型構成であり、複数の端末が1本の同軸ケーブルに接続されていた。多数の端末が繋がっている場合には、任意の端末AとBとの「1対1」の排他的な通信は不可能であり、端末Aから送出されたデータは、同じイーサネットの配線に繋がっている全端末へ届けられる「1対全」の通信方式である。「1対全」の通信であるため、既に端末AとBが通信している時に端末Cが新たに送信したい場合は、伝送路の空きを待つ必要がある。複数の端末が接続されている時に、ほぼ同時に送信が行われた場合、衝突することがあり、その場合データが損失する。これを衝突（コリジョン）と呼\n\nこの方式としてCSMA/CDとCSMA/CAが挙げられる。\n\nまずCSMAの意味合いは次のとおりである。\n\n1. 搬送波感知（Carrier Sense）\n\n    通信を開始する前に、一度受信を試みることで現在通信をしているホストが他にあるかどうか確認する。\n\n2. 多重アクセス（Multiple Access）\n\n    複数のクライアントは同じ回線を共用し、他者が通信をしていなければ自分の通信を開始する。\n\n#### CSMA/CD\n\nイーサネットにおいて用いられている。ただし、スイッチングハブで通信制御を行うことが一般的になったため(物理的にスター型になった)、必要性はなくなり、10GbEthernetなど、Ethernet規格の中でも比較的新しいものでは衝突検出をサポートしていない。\n\n- 衝突検出（Collision Detection）\n\n  複数の通信が同時に行われた場合はそれを検知し、ランダムな時間待ってから再び送信手順を行う。\n\n#### CSMA/CA\n\n無線LANの通信規格であるIEEE 802.11において用いられている。これは無線通信では信頼できる衝突検出がないためである。\n\n- 衝突回避（Collision Avoidance）\n\n    搬送波感知の段階で通信中のホストが存在した場合、通信終了と同時に送信を試みると衝突する可能性が高い。そのため、他のホストの送信終了を検知した場合は自分が送信を開始する前にランダムな長さの待ち時間をとる。なお、永久に送信できない事態を防ぐため、この待ち時間は徐々に短くされてゆく。\n\n## レイヤー3：ネットワーク層\n\nようやくIPアドレスの出番がやってきた。IPv4だとかIPv6とかはこのレイヤーの話になる。ネットワーク層では隣の機器だけではなく離れた機器の通信も扱う。ここでルーターが大事になってくる。\n\nルータが通信経路の決定に関わる(経路選択機能)。\n\nIPv4とIPv6の詳細は[プロフェッショナルIPv6](https://professionalipv6.booth.pm/items/913273)を後でのんびり眺める。\n\nなおICMPはIPv6時代ではICMPv6になったが、もはや別物と言っていい進化を遂げたらしい。つまり、もはや`ping`や`traceroute`が主要な用途だった時代は終わったということらしい。知らんけど。\n\n\u003e [プロフェッショナルIPv6](https://professionalipv6.booth.pm/items/913273) p.102 表6.1 さまざまな機能のICMPv6 への統合\n\u003e\n\u003e |機能                                 |IPv4 における手段|IPv6 における手段|\n\u003e |-------------------------------------|-----------------|------------------|\n\u003e |エラーメッセージ、情報メッセージなど |ICMP            |ICMPv6            |\n\u003e |IP アドレスからリンク層アドレスの解決|ARP             |近隣探索（ICMPv6）|\n\u003e |リンク層アドレスからIP アドレスの解決|RARP            |近隣探索（ICMPv6）|\n\u003e |マルチキャストの機能                 |IGMP            |MLD（ICMPv6）      |\n\u003e\n\u003e CC BY-NC-SA\n\n## レイヤー4：トランスポート層\n\nほとんどの通信はTCPが用いられるが、そのほかにもUDPがある。また、TCPだと機能が多すぎるけどUDPだと少なすぎるという用途のためにSCTPとかQUICがある。\n\nSCTPがすでにあるのにそれに似たQUICというUDP上で構築されたものが出てきたのは\n\n\u003e [SCTPとは - Qiita](https://qiita.com/urakarin/items/dd1cb2f25e2c80178e5d#comment-121be4bc7bde1f27f790)\n\u003e\n\u003e QUICの動機として分析があるけど、結局、TCP/UDPじゃないと通信を通してもらえるか怪しくなる、はあるんでしょうね。\n\u003e\n\u003e **QUICのoverUDPはオーバーヘッドと現実解としての利便では利便が勝つってことでしょうし**\n\nというコメントを見かけた\n\n# ハブとかスイッチがどのレイヤーかわかりにくい問題\n\nまずハブと言う言葉はL1でもL2でも見かける。L1のハブとは単に通信線をつなげただけのものに過ぎなかった。L2ハブではスイッチング機能(=MACアドレスを見て特定の機器にのみ伝える)を持つものが一般的になっている(スイッチングハブ)。\n\nL2スイッチはスイッチングハブの機能に加えて、VLANを構成できる。\n\nL3スイッチはVLAN間の通信の制御ができるルーター機能を持つ。\n\n・・・と思ったが早速slackでツッコミが入った。\n\n\u003eVLANを構成できる機能はL2、L3と関係ないです。VLAN間の通信制御ができないL3SWもあります。VLANは中級編くらいなので、今は意識しなくて良いです。VLANが構成できるルータはポートVLANとタグVLANがあって・・・と説明すると長くなります。\n\n\u003e L2スイッチはあくまでもOSIのレイヤー2をみて通すということしか言ってない\n\nVLANまわり理解することを諦めた。いつかきっとまた勉強しよう。\n\nと言っていたら、slackでさらにコメントが付いて\n\n\u003e L2SWとL3SWに関しては、それぞれ、第2層（macアドレス）・第3層（IPアドレス）を元に流す先を決める…っていう程度の理解で問題ないと思いますー\n\n\u003e VLANはこの図を見てもらうのがなんとなくわかってもらえそう\n\u003e そしてとりあえずそのなんとなくレベルで今は良さそう\n\u003e\n\u003e ![img](https://milestone-of-se.nesuke.com/wp-content/uploads/2017/10/tag-vlan-1.png)\n\nさらに\n\n- [【図解】初心者にも分かる VLAN 入門〜仕組み,メリットや必要性について〜│SEの道標](https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan/)\n- [【図解】トランクポートとアクセスポートの違い、trunk port に access port や PC を接続するとどうなるか│SEの道標](https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan-access-trunk/)\n\nを見ると良いと言われた。あと実際に手を動かして勉強するためには\n[CISCOスイッチ/ルータの無料エミュレーターの紹介 | Netassist Blog](https://milestone-of-se.nesuke.com/nw-basic/ethernet/vlan/)\nのようなシュミレーターがあるらしい。\n\nあとVLANのメリットは\n\n\u003e 1つのスイッチで複数のネットワークが使えて、切り替えられるのがメリットと考えてますー\n\u003e\n\u003e もしこれをVLAN使わずにそれぞれ分けたネットワークで構成するなら、ネットワークの数だけスイッチが必要になるところを、VLANを使えば1つで済ませられます\n\u003e\n\u003e さらに、アップリンク（上流側）はトランクポートにすることで、「VLAN=10」「VLAN=20」みたいなタグをつけて流すことができるので、複数のネットワークで同じ線を共有することができるようになりますー\n\u003e\n\u003e さっきの図だと、VLAN使わなければ営業部と開発部と幹部とで上下それぞれ3つずつスイッチが必要になる上に、それぞれを結線しないといけないのでスイッチ間の線も3本になるところが、VLANのおかげでスイッチ2つの線1本で済むっていう感じです\n\nとのこと。\n\n# 参考資料\n\n- [OSI参照モデルまとめ - Qiita](https://qiita.com/tatsuya4150/items/474b60beed0c04d5d999)\n- [OSI 7層モデル:Geekなぺーじ](https://www.geekpage.jp/technology/ip-base/osi7.php)\n- [プロフェッショナルIPv6](https://professionalipv6.booth.pm/items/913273)\n- [ダムハブ (dumb hub)とは｜「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典](https://wa3.i-3-i.info/word15164.html)\n- [ダムハブとは (dumb hub)： - IT用語辞典バイナリ](https://www.sophia-it.com/content/%E3%83%80%E3%83%A0%E3%83%8F%E3%83%96)\n- [L2スイッチとスイッチングハブの違い | 社内SEの教科書](https://shanai-se.net/l2%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%81%A8%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%83%B3%E3%82%B0%E3%83%8F%E3%83%96%E3%81%AE%E9%81%95%E3%81%84/)\n- [L2スイッチとL3スイッチの違い | 社内SEの教科書](https://shanai-se.net/l2%e3%82%b9%e3%82%a4%e3%83%83%e3%83%81%e3%81%a8l3%e3%82%b9%e3%82%a4%e3%83%83%e3%83%81%e3%81%ae%e9%81%95%e3%81%84/)\n- [5. 航空無線へのCDMA方式の適用可能性](https://www.enri.go.jp/report/hapichi/pdf2006/15.pdf)\n- [ネットワーク・トポロジー - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%BB%E3%83%88%E3%83%9D%E3%83%AD%E3%82%B8%E3%83%BC)\n- [イーサネット - Wikipedia](https://ja.wikipedia.org/wiki/%E3%82%A4%E3%83%BC%E3%82%B5%E3%83%8D%E3%83%83%E3%83%88)\n- [CSMA/CD - Wikipedia](https://ja.wikipedia.org/wiki/CSMA/CD)\n- [CSMA/CA - Wikipedia](https://ja.wikipedia.org/wiki/CSMA/CA)\n- [DIX 規格のフレームフォーマット – Tech Knowledge](https://blog.longest-road.com/contents/?p=827)\n- [データグラム - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B0%E3%83%A9%E3%83%A0)\n- [パケット - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%91%E3%82%B1%E3%83%83%E3%83%88)\n- [SCTPとは - Qiita](https://qiita.com/urakarin/items/dd1cb2f25e2c80178e5d)\n\n# License\n\n[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja)\n\n\u003ca href=\"https://commons.wikimedia.org/wiki/File:Cc-by-nc-sa_icon.svg#/media/ファイル:Cc-by-nc-sa_icon.svg\"\u003e\u003cimg src=\"https://upload.wikimedia.org/wikipedia/commons/1/12/Cc-by-nc-sa_icon.svg\" alt=\"Cc-by-nc-sa icon.svg\" width=\"120\" height=\"42\"\u003e\u003c/a\u003e\n","coediting":false,"comments_count":0,"created_at":"2020-02-18T20:30:24+09:00","group":null,"id":"c9e09a77ee07752f8ae0","likes_count":3,"private":false,"reactions_count":0,"tags":[{"name":"基本情報技術者試験","versions":[]},{"name":"OSI参照モデル","versions":[]}],"title":"OSI基本参照モデルについて勉強している","updated_at":"2020-02-19T13:23:24+09:00","url":"https://qiita.com/yumetodo/items/c9e09a77ee07752f8ae0","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eRustでコードを書いて、WASMにしてnpmのパッケージにするとなると、wasm-packを使うのが一般的らしい。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/rustwasm/wasm-pack\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/rustwasm/wasm-pack\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eところがいろいろなツールを使うために自動テスト\u0026amp;デプロイには一工夫がいる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"最初の試み結局やめた-docker--circle-ciでの自動化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%88%9D%E3%81%AE%E8%A9%A6%E3%81%BF%E7%B5%90%E5%B1%80%E3%82%84%E3%82%81%E3%81%9F-docker--circle-ci%E3%81%A7%E3%81%AE%E8%87%AA%E5%8B%95%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最初の試み(結局やめた): Docker + Circle CIでの自動化\u003c/h1\u003e\n\n\u003cp\u003e最初に自動化を試みたころ、ちょうどDockerの勉強をしていたので、Dockerが使いたかった。あとCircle CIを使い始めた頃だったのでそれを選んだ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"docker-imageの作成\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#docker-image%E3%81%AE%E4%BD%9C%E6%88%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDocker Imageの作成\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"最初の試み失敗-alpine-linuxベースで作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%80%E5%88%9D%E3%81%AE%E8%A9%A6%E3%81%BF%E5%A4%B1%E6%95%97-alpine-linux%E3%83%99%E3%83%BC%E3%82%B9%E3%81%A7%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e最初の試み(失敗): Alpine Linuxベースで作る\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"dockerfile\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"s\"\u003e    alpine:3.10\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003eapk add \u003cspan class=\"nt\"\u003e--no-cache\u003c/span\u003e zlib-dev openssl-dev git bash rust cargo nodejs npm \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e        npm update \u003cspan class=\"nt\"\u003e-g\u003c/span\u003e npm \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e        cargo \u003cspan class=\"nb\"\u003einstall \u003c/span\u003ewasm-pack \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003cspan class=\"c\"\u003e# https://rustwasm.github.io/wasm-pack/book/prerequisites/non-rustup-setups.html\u003c/span\u003e\n        wget https://static.rust-lang.org/dist/rust-std-1.34.2-wasm32-unknown-unknown.tar.gz \u0026amp;\u0026amp; \\\n        tar -xf rust-std-1.34.2-wasm32-unknown-unknown.tar.gz \u0026amp;\u0026amp; \\\n        mv rust-std-1.34.2-wasm32-unknown-unknown/rust-std-wasm32-unknown-unknown/lib/rustlib/wasm32-unknown-unknown /usr/lib/rustlib/ \u0026amp;\u0026amp; \\\n        rm -r rust-std-1.34.2-wasm32-unknown-unknown \u0026amp;\u0026amp; rm rust-std-1.34.2-wasm32-unknown-unknown.tar.gz\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command: Running build command...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking rustc version...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: rustc version is 34.\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking crate configuration...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Crate is correctly configured.\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking for wasm-target...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [INFO]: Checking for the Wasm target...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::build::wasm_target: Looking for wasm32-unknown-unknown in \"/usr/lib/rustlib\"\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::build::wasm_target: Found wasm32-unknown-unknown in \"/usr/lib/rustlib\"\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking for wasm-target was successful.\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Building wasm...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [INFO]: Compiling to Wasm...\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#  INFO 2019-09-09T16:55:21Z: wasm_pack::child: Running \"cargo\" \"build\" \"--lib\" \"--target\" \"wasm32-unknown-unknown\"\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] failed to read rustc info cache: failed to read `/markdown_img_url_editor/markdown_img_url_editor_rust/target/.rustc_info.json`\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# [2019-09-09T16:55:21Z WARN  cargo::util::rustc] failed to update rustc info cache: failed to write `/markdown_img_url_editor/markdown_img_url_editor_rust/target/.rustc_info.json`\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# error: failed to run `rustc` to learn about target-specific information\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e# Caused by:\u003c/span\u003e\n\u003cspan class=\"c\"\u003e#   process didn't exit successfully: `rustc - --crate-name ___ --print=file-names --target wasm32-unknown-unknown --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro` (exit code: 1)\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# --- stderr\u003c/span\u003e\n\u003cspan class=\"c\"\u003e# error: Could not create LLVM TargetMachine for triple: wasm32-unknown-unknown: No available targets are compatible with triple \"wasm32-unknown-unknown\"\u003c/span\u003e\n\u003cspan class=\"k\"\u003eENV\u003c/span\u003e\u003cspan class=\"s\"\u003e PATH $PATH:/root/.cargo/bin\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/BuildContainers/blob/8011ab2426779f6e5fcefa08ffdf57482b0ce2ca/rust-1.34.2-wasm-node-10/Dockerfile\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/BuildContainers/blob/8011ab2426779f6e5fcefa08ffdf57482b0ce2ca/rust-1.34.2-wasm-node-10/Dockerfile\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e上のようなDocker Fileを作ったのだが、コメントで書いたようなエラーが出てうまくいかなかった\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"次の試み-officialのrustイメージベース\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E3%81%AE%E8%A9%A6%E3%81%BF-official%E3%81%AErust%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%83%99%E3%83%BC%E3%82%B9\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次の試み: OfficialのRustイメージベース\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"dockerfile\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eFROM\u003c/span\u003e\u003cspan class=\"s\"\u003e rust\u003c/span\u003e\n\u003cspan class=\"k\"\u003eRUN \u003c/span\u003ecurl \u003cspan class=\"nt\"\u003e-sL\u003c/span\u003e https://deb.nodesource.com/setup_10.x | bash - \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e apt-get \u003cspan class=\"nb\"\u003einstall\u003c/span\u003e \u003cspan class=\"nt\"\u003e-y\u003c/span\u003e nodejs \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003erm\u003c/span\u003e \u003cspan class=\"nt\"\u003e-rf\u003c/span\u003e /var/lib/apt/lists/\u003cspan class=\"k\"\u003e*\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e        curl https://rustwasm.github.io/wasm-pack/installer/init.sh \u003cspan class=\"nt\"\u003e-sSf\u003c/span\u003e | sh\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/BuildContainers/blob/8011ab2426779f6e5fcefa08ffdf57482b0ce2ca/rust-latest-wasm-lts/Dockerfile\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/BuildContainers/blob/8011ab2426779f6e5fcefa08ffdf57482b0ce2ca/rust-latest-wasm-lts/Dockerfile\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこれは一応うまく行った。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cirlce-ciの設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cirlce-ci%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCirlce CIの設定\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2.1\u003c/span\u003e\n\u003cspan class=\"na\"\u003eexecutors\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003edefault\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003edocker\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003eimage\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eyumetodo/buildcontainers:rust-latest-wasm-lts\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eworking_directory\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/repo\u003c/span\u003e\n\u003cspan class=\"na\"\u003ecommands\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etool_install\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enpm i -g can-npm-publish\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecargo_restore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCalculate dependencies\u003c/span\u003e\n                \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecargo generate-lockfile\u003c/span\u003e\n                \u003cspan class=\"na\"\u003eworking_directory\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003emarkdown_img_url_editor_rust\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erestore_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003ekeys\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ev4-cargo-cache-{{ arch }}-{{ checksum \"Cargo.lock\" }}\u003c/span\u003e\n    \u003cspan class=\"na\"\u003ecargo_save_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003esave_cache\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003epaths\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003e/usr/local/cargo/registry\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etarget/debug/.fingerprint\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etarget/debug/build\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etarget/debug/deps\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etarget/release/.fingerprint\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etarget/release/build\u003c/span\u003e\n                  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etarget/release/deps\u003c/span\u003e\n                \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ev4-cargo-cache-{{ arch }}-{{ checksum \"Cargo.lock\" }}\u003c/span\u003e\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003etest\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ecargo_restore_cache\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecargo test\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewasm-pack build\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ecargo_save_cache\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epublish\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eexecutor\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003edefault\u003c/span\u003e\n        \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etool_install\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003echeckout\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewasm-pack build --release --target nodejs\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eecho //registry.npmjs.org/:_authToken=${NPM_TOKEN} \u0026gt; ~/.npmrc\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003ecommand\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003eif can-npm-publish --verbose pkg; then\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003ewasm-pack publish\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003eelse\u003c/span\u003e\n                        \u003cspan class=\"s\"\u003eecho \"publish skipped\"\u003c/span\u003e\n                    \u003cspan class=\"s\"\u003efi\u003c/span\u003e\n\u003cspan class=\"na\"\u003eworkflows\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eversion\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"m\"\u003e2\u003c/span\u003e\n    \u003cspan class=\"na\"\u003epublishflow\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n            \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003epublish\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                \u003cspan class=\"na\"\u003econtext\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enpm\u003c/span\u003e\n                \u003cspan class=\"na\"\u003erequires\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003etest\u003c/span\u003e\n                \u003cspan class=\"na\"\u003efilters\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                    \u003cspan class=\"na\"\u003etags\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n                        \u003cspan class=\"na\"\u003eonly\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e/^v.*/\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/markdown_img_url_editor_rust/blob/bbf656c6ed9874b77a23508dce6432da8a1bc4a7/.circleci/config.yml\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/markdown_img_url_editor_rust/blob/bbf656c6ed9874b77a23508dce6432da8a1bc4a7/.circleci/config.yml\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさっき作ったDocker Imageを指定してこんな感じに設定したらうまく動いた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"次の試み-github-actionsをつかう\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E3%81%AE%E8%A9%A6%E3%81%BF-github-actions%E3%82%92%E3%81%A4%E3%81%8B%E3%81%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次の試み: Github Actionsをつかう\u003c/h1\u003e\n\n\u003cp\u003eしかしよく考えてほしい。node.jsは頻繁に新しいバージョンがでるし、rustもそれなりにバージョンアップが来る。wasm-packだって更新が来る。そのたびにImage作って更新していくと考えるとかなりだるい。\u003c/p\u003e\n\n\u003cp\u003eそもそもDockerを使うべきじゃなかった気がしてくる。\u003c/p\u003e\n\n\u003cp\u003eそこで目をつけたのがGithub Actionsだ。これはUbuntuの上で走る(いや他のも選べるし、更にその上でDocker動かすとかもできるけど)。\u003c/p\u003e\n\n\u003cp\u003eちょっとまえにcpprefjp（C++のリファレンスサイト)にかんたんなチェックをするCIをGithub Actionsで組んだばかりだったので、勝手がわかってるのも大きい。\u003cbr\u003e\n\u003ca href=\"https://github.com/cpprefjp/site/pull/737\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/cpprefjp/site/pull/737\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eTest and Release\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003eon\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e[\u003c/span\u003e\u003cspan class=\"nv\"\u003epush\u003c/span\u003e\u003cspan class=\"pi\"\u003e]\u003c/span\u003e\n\n\u003cspan class=\"na\"\u003ejobs\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n  \u003cspan class=\"na\"\u003ebuild\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n\n    \u003cspan class=\"na\"\u003eruns-on\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eubuntu-latest\u003c/span\u003e\n\n    \u003cspan class=\"na\"\u003esteps\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/checkout@v2\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCache cargo registry\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/cache@v1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/.cargo/registry\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCache cargo index\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/cache@v1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e~/.cargo/git\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ runner.os }}-cargo-index-${{ hashFiles('**/Cargo.lock') }}\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eCache cargo build\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/cache@v1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003epath\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003etarget\u003c/span\u003e\n        \u003cspan class=\"na\"\u003ekey\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ runner.os }}-cargo-build-target-${{ hashFiles('**/Cargo.lock') }}\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eRun tests\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecargo test --verbose\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eUse Node.js ${{ matrix.node-version }}\u003c/span\u003e\n      \u003cspan class=\"na\"\u003euses\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003eactions/setup-node@v1\u003c/span\u003e\n      \u003cspan class=\"na\"\u003ewith\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003enode-version\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e12.x\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eregistry-url\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e'\u003c/span\u003e\u003cspan class=\"s\"\u003ehttps://registry.npmjs.org'\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003einstall wasm-pack\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ecurl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewasm-pack build --release --target nodejs\u003c/span\u003e\n    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003ename\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003ewasm-pack publish when possible\u003c/span\u003e\n      \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"pi\"\u003e|\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eif npx can-npm-publish --verbose pkg; then\u003c/span\u003e\n            \u003cspan class=\"s\"\u003ewasm-pack publish\u003c/span\u003e\n        \u003cspan class=\"s\"\u003eelse\u003c/span\u003e\n            \u003cspan class=\"s\"\u003eecho \"publish skipped\"\u003c/span\u003e\n        \u003cspan class=\"s\"\u003efi\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eNODE_AUTH_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.NPM_TOKEN }}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/markdown_img_url_editor_rust/blob/aeb43c0d46439c24c665848183cece9599c71695/.github/workflows/release.yml\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/markdown_img_url_editor_rust/blob/aeb43c0d46439c24c665848183cece9599c71695/.github/workflows/release.yml\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCargoのキャッシュ設定は\u003cbr\u003e\n\u003ca href=\"https://github.com/actions/cache/blob/master/examples.md#rust---cargo\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/actions/cache/blob/master/examples.md#rust---cargo\u003c/a\u003e\u003cbr\u003e\nのものを拝借した。\u003c/p\u003e\n\n\u003cp\u003eGithub ActionsのRustの設定例\u003cbr\u003e\n\u003ca href=\"https://github.com/actions/starter-workflows/blob/e5a3a0e11268f84ad0ff6569a47e197cc8e1f758/ci/rust.yml\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/actions/starter-workflows/blob/e5a3a0e11268f84ad0ff6569a47e197cc8e1f758/ci/rust.yml\u003c/a\u003e\u003cbr\u003e\nを見てみたところ、どうも何もしなくてもcargoは使えるらしい。どのバージョンとかは面倒くさいので調べてないが、まあ動いているのでいい。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003enpm publish\u003c/code\u003eする時\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"na\"\u003erun\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003enpm publish\u003c/span\u003e\n      \u003cspan class=\"na\"\u003eenv\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eNODE_AUTH_TOKEN\u003c/span\u003e\u003cspan class=\"pi\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e${{ secrets.NPM_TOKEN }}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのようにするのだが、\u003ccode\u003ewasm-pack publish\u003c/code\u003eする先行事例が見つからなくて不安だった。結果動いたのでよい。\u003c/p\u003e\n\n\u003cp\u003eあと、PRからのビルドのときはpublish周りはいらないので\u003cbr\u003e\n\u003ca href=\"https://github.com/yumetodo/markdown_img_url_editor_rust/blob/aeb43c0d46439c24c665848183cece9599c71695/.github/workflows/test.yml#L1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/markdown_img_url_editor_rust/blob/aeb43c0d46439c24c665848183cece9599c71695/.github/workflows/test.yml#L1\u003c/a\u003e\u003cbr\u003e\n省略版を作った。\u003c/p\u003e\n\n\u003cp\u003eところで\u003ccode\u003esecrets.NPM_TOKEN\u003c/code\u003eってPRから見えたりはしないですよね？確認してないけど。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"成果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%88%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e成果\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.npmjs.com/package/markdown_img_url_editor_rust\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.npmjs.com/package/markdown_img_url_editor_rust\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eに上がっている。\u003c/p\u003e\n\n\u003cp\u003eちなみにこのパッケージは何かというと\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/yumetodo/vscode-google-photos-uploader\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/vscode-google-photos-uploader\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"https://github.com/yumetodo/markdown_img_url_editor\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/markdown_img_url_editor\u003c/a\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/yumetodo/markdown_img_url_editor_rust\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/markdown_img_url_editor_rust\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eというような依存関係になっている。\u003c/p\u003e\n","body":"# はじめに\n\nRustでコードを書いて、WASMにしてnpmのパッケージにするとなると、wasm-packを使うのが一般的らしい。\n\nhttps://github.com/rustwasm/wasm-pack\n\nところがいろいろなツールを使うために自動テスト\u0026デプロイには一工夫がいる。\n\n# 最初の試み(結局やめた): Docker + Circle CIでの自動化\n\n最初に自動化を試みたころ、ちょうどDockerの勉強をしていたので、Dockerが使いたかった。あとCircle CIを使い始めた頃だったのでそれを選んだ。\n\n## Docker Imageの作成\n\n### 最初の試み(失敗): Alpine Linuxベースで作る\n\n```dockerfile\nFROM    alpine:3.10\nRUN apk add --no-cache zlib-dev openssl-dev git bash rust cargo nodejs npm \u0026\u0026 \\\n        npm update -g npm \u0026\u0026 \\\n        cargo install wasm-pack \u0026\u0026 \\\n# https://rustwasm.github.io/wasm-pack/book/prerequisites/non-rustup-setups.html\n        wget https://static.rust-lang.org/dist/rust-std-1.34.2-wasm32-unknown-unknown.tar.gz \u0026\u0026 \\\n        tar -xf rust-std-1.34.2-wasm32-unknown-unknown.tar.gz \u0026\u0026 \\\n        mv rust-std-1.34.2-wasm32-unknown-unknown/rust-std-wasm32-unknown-unknown/lib/rustlib/wasm32-unknown-unknown /usr/lib/rustlib/ \u0026\u0026 \\\n        rm -r rust-std-1.34.2-wasm32-unknown-unknown \u0026\u0026 rm rust-std-1.34.2-wasm32-unknown-unknown.tar.gz\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command: Running build command...\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking rustc version...\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: rustc version is 34.\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking crate configuration...\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Crate is correctly configured.\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking for wasm-target...\n# [INFO]: Checking for the Wasm target...\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::build::wasm_target: Looking for wasm32-unknown-unknown in \"/usr/lib/rustlib\"\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::build::wasm_target: Found wasm32-unknown-unknown in \"/usr/lib/rustlib\"\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Checking for wasm-target was successful.\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::command::build: Building wasm...\n# [INFO]: Compiling to Wasm...\n#  INFO 2019-09-09T16:55:21Z: wasm_pack::child: Running \"cargo\" \"build\" \"--lib\" \"--target\" \"wasm32-unknown-unknown\"\n# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] failed to read rustc info cache: failed to read `/markdown_img_url_editor/markdown_img_url_editor_rust/target/.rustc_info.json`\n# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\n# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\n# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\n# [2019-09-09T16:55:21Z INFO  cargo::util::rustc] rustc info cache miss\n# [2019-09-09T16:55:21Z WARN  cargo::util::rustc] failed to update rustc info cache: failed to write `/markdown_img_url_editor/markdown_img_url_editor_rust/target/.rustc_info.json`\n# error: failed to run `rustc` to learn about target-specific information\n\n# Caused by:\n#   process didn't exit successfully: `rustc - --crate-name ___ --print=file-names --target wasm32-unknown-unknown --crate-type bin --crate-type rlib --crate-type dylib --crate-type cdylib --crate-type staticlib --crate-type proc-macro` (exit code: 1)\n# --- stderr\n# error: Could not create LLVM TargetMachine for triple: wasm32-unknown-unknown: No available targets are compatible with triple \"wasm32-unknown-unknown\"\nENV PATH $PATH:/root/.cargo/bin\n```\n\nhttps://github.com/yumetodo/BuildContainers/blob/8011ab2426779f6e5fcefa08ffdf57482b0ce2ca/rust-1.34.2-wasm-node-10/Dockerfile\n\n上のようなDocker Fileを作ったのだが、コメントで書いたようなエラーが出てうまくいかなかった\n\n### 次の試み: OfficialのRustイメージベース\n\n```dockerfile\nFROM rust\nRUN curl -sL https://deb.nodesource.com/setup_10.x | bash - \u0026\u0026 apt-get install -y nodejs \u0026\u0026 rm -rf /var/lib/apt/lists/* \u0026\u0026 \\\n        curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh\n```\n\nhttps://github.com/yumetodo/BuildContainers/blob/8011ab2426779f6e5fcefa08ffdf57482b0ce2ca/rust-latest-wasm-lts/Dockerfile\n\nこれは一応うまく行った。\n\n## Cirlce CIの設定\n\n```yml\nversion: 2.1\nexecutors:\n    default:\n        docker:\n            - image: yumetodo/buildcontainers:rust-latest-wasm-lts\n        working_directory: ~/repo\ncommands:\n    tool_install:\n        steps:\n            - run: npm i -g can-npm-publish\n    cargo_restore_cache:\n        steps:\n            - run:\n                name: Calculate dependencies\n                command: cargo generate-lockfile\n                working_directory: markdown_img_url_editor_rust\n            - restore_cache:\n                keys:\n                  - v4-cargo-cache-{{ arch }}-{{ checksum \"Cargo.lock\" }}\n    cargo_save_cache:\n        steps:\n            - save_cache:\n                paths:\n                  - /usr/local/cargo/registry\n                  - target/debug/.fingerprint\n                  - target/debug/build\n                  - target/debug/deps\n                  - target/release/.fingerprint\n                  - target/release/build\n                  - target/release/deps\n                key: v4-cargo-cache-{{ arch }}-{{ checksum \"Cargo.lock\" }}\njobs:\n    test:\n        executor: default\n        steps:\n            - checkout\n            - cargo_restore_cache\n            - run: cargo test\n            - run: wasm-pack build\n            - cargo_save_cache\n    publish:\n        executor: default\n        steps:\n            - tool_install\n            - checkout\n            - run: wasm-pack build --release --target nodejs\n            - run: echo //registry.npmjs.org/:_authToken=${NPM_TOKEN} \u003e ~/.npmrc\n            - run:\n                command: |\n                    if can-npm-publish --verbose pkg; then\n                        wasm-pack publish\n                    else\n                        echo \"publish skipped\"\n                    fi\nworkflows:\n    version: 2\n    publishflow:\n        jobs:\n            - test\n            - publish:\n                context: npm\n                requires:\n                    - test\n                filters:\n                    tags:\n                        only: /^v.*/\n```\n\nhttps://github.com/yumetodo/markdown_img_url_editor_rust/blob/bbf656c6ed9874b77a23508dce6432da8a1bc4a7/.circleci/config.yml\n\nさっき作ったDocker Imageを指定してこんな感じに設定したらうまく動いた。\n\n# 次の試み: Github Actionsをつかう\n\nしかしよく考えてほしい。node.jsは頻繁に新しいバージョンがでるし、rustもそれなりにバージョンアップが来る。wasm-packだって更新が来る。そのたびにImage作って更新していくと考えるとかなりだるい。\n\nそもそもDockerを使うべきじゃなかった気がしてくる。\n\nそこで目をつけたのがGithub Actionsだ。これはUbuntuの上で走る(いや他のも選べるし、更にその上でDocker動かすとかもできるけど)。\n\nちょっとまえにcpprefjp（C++のリファレンスサイト)にかんたんなチェックをするCIをGithub Actionsで組んだばかりだったので、勝手がわかってるのも大きい。\nhttps://github.com/cpprefjp/site/pull/737\n\n```yml\nname: Test and Release\n\non:\n  [push]\n\njobs:\n  build:\n\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/checkout@v2\n    - name: Cache cargo registry\n      uses: actions/cache@v1\n      with:\n        path: ~/.cargo/registry\n        key: ${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}\n    - name: Cache cargo index\n      uses: actions/cache@v1\n      with:\n        path: ~/.cargo/git\n        key: ${{ runner.os }}-cargo-index-${{ hashFiles('**/Cargo.lock') }}\n    - name: Cache cargo build\n      uses: actions/cache@v1\n      with:\n        path: target\n        key: ${{ runner.os }}-cargo-build-target-${{ hashFiles('**/Cargo.lock') }}\n    - name: Run tests\n      run: cargo test --verbose\n    - name: Use Node.js ${{ matrix.node-version }}\n      uses: actions/setup-node@v1\n      with:\n        node-version: 12.x\n        registry-url: 'https://registry.npmjs.org'\n    - name: install wasm-pack\n      run: curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh\n    - run: wasm-pack build --release --target nodejs\n    - name: wasm-pack publish when possible\n      run: |\n        if npx can-npm-publish --verbose pkg; then\n            wasm-pack publish\n        else\n            echo \"publish skipped\"\n        fi\n      env:\n        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}\n```\n\nhttps://github.com/yumetodo/markdown_img_url_editor_rust/blob/aeb43c0d46439c24c665848183cece9599c71695/.github/workflows/release.yml\n\nCargoのキャッシュ設定は\nhttps://github.com/actions/cache/blob/master/examples.md#rust---cargo\nのものを拝借した。\n\nGithub ActionsのRustの設定例\nhttps://github.com/actions/starter-workflows/blob/e5a3a0e11268f84ad0ff6569a47e197cc8e1f758/ci/rust.yml\nを見てみたところ、どうも何もしなくてもcargoは使えるらしい。どのバージョンとかは面倒くさいので調べてないが、まあ動いているのでいい。\n\n`npm publish`する時\n\n```yml\n    - run: npm publish\n      env:\n        NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}\n```\n\nのようにするのだが、`wasm-pack publish`する先行事例が見つからなくて不安だった。結果動いたのでよい。\n\nあと、PRからのビルドのときはpublish周りはいらないので\nhttps://github.com/yumetodo/markdown_img_url_editor_rust/blob/aeb43c0d46439c24c665848183cece9599c71695/.github/workflows/test.yml#L1\n省略版を作った。\n\nところで`secrets.NPM_TOKEN`ってPRから見えたりはしないですよね？確認してないけど。\n\n# 成果\n\nhttps://www.npmjs.com/package/markdown_img_url_editor_rust\n\nに上がっている。\n\nちなみにこのパッケージは何かというと\n\n- https://github.com/yumetodo/vscode-google-photos-uploader\n    - https://github.com/yumetodo/markdown_img_url_editor\n        - https://github.com/yumetodo/markdown_img_url_editor_rust\n\nというような依存関係になっている。\n","coediting":false,"comments_count":0,"created_at":"2020-02-12T11:55:46+09:00","group":null,"id":"7fda6d38bd5182388e48","likes_count":6,"private":false,"reactions_count":0,"tags":[{"name":"Rust","versions":[]},{"name":"npm","versions":[]},{"name":"wasm","versions":[]},{"name":"wasm-pack","versions":[]},{"name":"GitHubActions","versions":[]}],"title":"rust+npm+wasm-packなrepoをGithub Actionsで自動テスト＆デプロイできるようにしてみた","updated_at":"2020-02-12T11:55:46+09:00","url":"https://qiita.com/yumetodo/items/7fda6d38bd5182388e48","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"http://p774.blog.fc2.com/blog-entry-73.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eObject.prototype.hasOwnProperty()は変数に入れた方が速い？ - JavaScript\u003c/a\u003e\u003cbr\u003e\nというブログ記事が私のMastodonのTLに出ていました。\u003c/p\u003e\n\n\u003cp\u003e趣旨としては\u003ccode\u003ehasOwnProperty\u003c/code\u003eをどう呼び出すかで4通りの検証が以下のコードでなされていたようです。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"js\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003emyObj\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"na\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e111\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// テスト1: ユーザー定義の対象オブジェクトから呼び出す。\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003etest1\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003emyObj\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eprop\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ems\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// テスト2: ネイティブオブジェクトメソッドからcallを使って呼び出す(Object.prototype.hasOwnProperty.call())。\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003etest2\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprototype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eprop\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ems\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// テスト3: objProtoHasOwnというローカル変数に代入してキャッシュ化。\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003etest3\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eobjProtoHasOwn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eobjProtoHasOwn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprototype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003eobjProtoHasOwn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eprop\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ems\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"c1\"\u003e// テスト4: ローカル変数でキャッシュ化した上で、hasOwnという関数にして使用。\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e \u003cspan class=\"nx\"\u003etest4\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eobjProtoHasOwn\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ehasOwn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003eobjProtoHasOwn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprototype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003ehasOwn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eobjProtoHasOwn\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eobj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eprop\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10000000\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"nx\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003ehasOwn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emyObj\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eprop\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n        \u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nb\"\u003eDate\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003estopTime\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nx\"\u003estartTime\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ems\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"nx\"\u003etest1\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etest2\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etest3\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003etest4\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})();\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"元の記事の検証結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%83%E3%81%AE%E8%A8%98%E4%BA%8B%E3%81%AE%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e元の記事の検証結果\u003c/h1\u003e\n\n\u003cp\u003eテスト環境:\u003cbr\u003e\nChrome 60.0.3112.113(64bit)\u003cbr\u003e\nFirefox 55.0.3(64bit)\u003cbr\u003e\nIE 11.413.15063.0(32bit)\u003cbr\u003e\nJScript Panel 1.2.3.2\u003c/p\u003e\n\n\u003cp\u003ePCは2600K, Memory8G, Windows10(64bit)\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eテスト種類\u003c/th\u003e\n\u003cth\u003eChorome\u003c/th\u003e\n\u003cth\u003eFirefox\u003c/th\u003e\n\u003cth\u003eIE\u003c/th\u003e\n\u003cth\u003eMicrosoft Edge\u003c/th\u003e\n\u003cth\u003eJScript Panel\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト1 (myObj.hasOwnProperty)\u003c/td\u003e\n\u003ctd\u003e105\u003c/td\u003e\n\u003ctd\u003e26\u003c/td\u003e\n\u003ctd\u003e2986\u003c/td\u003e\n\u003ctd\u003e3306\u003c/td\u003e\n\u003ctd\u003e781\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト2 (Object.prototype.hasOwnProperty.call)\u003c/td\u003e\n\u003ctd\u003e100\u003c/td\u003e\n\u003ctd\u003e1298\u003c/td\u003e\n\u003ctd\u003e6534\u003c/td\u003e\n\u003ctd\u003e7758\u003c/td\u003e\n\u003ctd\u003e907\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト3 (Object.prototype.hasOwnPropertyを変数に)\u003c/td\u003e\n\u003ctd\u003e122\u003c/td\u003e\n\u003ctd\u003e21\u003c/td\u003e\n\u003ctd\u003e4437\u003c/td\u003e\n\u003ctd\u003e5097\u003c/td\u003e\n\u003ctd\u003e893\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト4 (Object.prototype.hasOwnPropertyを変数→関数)\u003c/td\u003e\n\u003ctd\u003e125\u003c/td\u003e\n\u003ctd\u003e47\u003c/td\u003e\n\u003ctd\u003e4907\u003c/td\u003e\n\u003ctd\u003e6332\u003c/td\u003e\n\u003ctd\u003e923\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"今回の再検証結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%AE%E5%86%8D%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回の再検証結果\u003c/h1\u003e\n\n\u003cp\u003eChrome 79.0.3945.130(64bit)\u003cbr\u003e\nFirefox 72.0.2(64bit)\u003cbr\u003e\nIE 11.592.18362.0(32bit)\u003cbr\u003e\nMicrosoft Edge 44.18362.449.0(64bit)\u003c/p\u003e\n\n\u003cp\u003ePCはIntel Core i7-7500U, Memory16G, Windows10(64bit)\u003c/p\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003eテスト種類\u003c/th\u003e\n\u003cth\u003eChrome\u003c/th\u003e\n\u003cth\u003eFirefox\u003c/th\u003e\n\u003cth\u003eInternet Explorer\u003c/th\u003e\n\u003cth\u003eEdge\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト1 (myObj.hasOwnProperty)\u003c/td\u003e\n\u003ctd\u003e99(87.4～110.6)\u003c/td\u003e\n\u003ctd\u003e58.25(55.4～61.1)\u003c/td\u003e\n\u003ctd\u003e3083.65(3025.5～3141.8)\u003c/td\u003e\n\u003ctd\u003e3172.95(3125.4～3220.5)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト2 (Object.prototype.hasOwnProperty.call)\u003c/td\u003e\n\u003ctd\u003e85(80.6～89.4)\u003c/td\u003e\n\u003ctd\u003e55.9(51.7～60.1)\u003c/td\u003e\n\u003ctd\u003e4567.1(4512.7～4621.5)\u003c/td\u003e\n\u003ctd\u003e5660.65(5610.7～5710.6)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト3 (Object.prototype.hasOwnPropertyを変数に)\u003c/td\u003e\n\u003ctd\u003e103.2(98.0～108.4)\u003c/td\u003e\n\u003ctd\u003e49.45(45.2～53.7)\u003c/td\u003e\n\u003ctd\u003e3612.75(3555.3～3670.2)\u003c/td\u003e\n\u003ctd\u003e4316.85(4255.6～4378.1)\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003eテスト4 (Object.prototype.hasOwnPropertyを変数→関数)\u003c/td\u003e\n\u003ctd\u003e117.9(110.5～125.3)\u003c/td\u003e\n\u003ctd\u003e46.25(45.5～47.0)\u003c/td\u003e\n\u003ctd\u003e3752.75(3688.9～3816.6)\u003c/td\u003e\n\u003ctd\u003e4836.55(4751.9～4921.2)\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003cp\u003e元記事とは違って20回計測で、95%信頼区間を括弧中に表示しています。TBのことを考え、測定の間には30秒~1分程度の間隔があります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"考察\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%80%83%E5%AF%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e考察\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"今回と元記事の差\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BB%8A%E5%9B%9E%E3%81%A8%E5%85%83%E8%A8%98%E4%BA%8B%E3%81%AE%E5%B7%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e今回と元記事の差\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e元記事のようにFirefoxのテスト2だけ猛烈に遅いということは確認されなかった。\u003c/li\u003e\n\u003cli\u003e全般にPCスペックなどの要因から速度が速いが、なぜかFirefoxのテスト2以外だけ遅い\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"いずれの検証にも言えること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%84%E3%81%9A%E3%82%8C%E3%81%AE%E6%A4%9C%E8%A8%BC%E3%81%AB%E3%82%82%E8%A8%80%E3%81%88%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eいずれの検証にも言えること\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e全般にFirefoxとChromeが速いのはなんか最適化がかかって処理が飛んでいるのではないか？(検証方法がわからず断念\u003c/li\u003e\n\u003cli\u003eIRよりEdgeのほうが遅い。いっちょんわからん\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h1\u003e\n\n\u003cp\u003eまあIEとかもう誰も使ってないし(ぇ)、Edgeは中身Chromeになるので、ぶっちゃけどれ使ってもいいんじゃないですかね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"データ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%87%E3%83%BC%E3%82%BF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eデータ\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"chrome\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#chrome\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eChrome\u003c/h2\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e測定回数\u003c/th\u003e\n\u003cth\u003e1\u003c/th\u003e\n\u003cth\u003e2\u003c/th\u003e\n\u003cth\u003e3\u003c/th\u003e\n\u003cth\u003e4\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e202\u003c/td\u003e\n\u003ctd\u003e106\u003c/td\u003e\n\u003ctd\u003e122\u003c/td\u003e\n\u003ctd\u003e118\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e98\u003c/td\u003e\n\u003ctd\u003e95\u003c/td\u003e\n\u003ctd\u003e102\u003c/td\u003e\n\u003ctd\u003e178\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e85\u003c/td\u003e\n\u003ctd\u003e96\u003c/td\u003e\n\u003ctd\u003e101\u003c/td\u003e\n\u003ctd\u003e120\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e91\u003c/td\u003e\n\u003ctd\u003e89\u003c/td\u003e\n\u003ctd\u003e102\u003c/td\u003e\n\u003ctd\u003e118\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e137\u003c/td\u003e\n\u003ctd\u003e98\u003c/td\u003e\n\u003ctd\u003e131\u003c/td\u003e\n\u003ctd\u003e118\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003e101\u003c/td\u003e\n\u003ctd\u003e77\u003c/td\u003e\n\u003ctd\u003e96\u003c/td\u003e\n\u003ctd\u003e106\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e94\u003c/td\u003e\n\u003ctd\u003e79\u003c/td\u003e\n\u003ctd\u003e89\u003c/td\u003e\n\u003ctd\u003e110\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003e90\u003c/td\u003e\n\u003ctd\u003e96\u003c/td\u003e\n\u003ctd\u003e96\u003c/td\u003e\n\u003ctd\u003e120\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003e100\u003c/td\u003e\n\u003ctd\u003e80\u003c/td\u003e\n\u003ctd\u003e103\u003c/td\u003e\n\u003ctd\u003e119\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e10\u003c/td\u003e\n\u003ctd\u003e95\u003c/td\u003e\n\u003ctd\u003e85\u003c/td\u003e\n\u003ctd\u003e129\u003c/td\u003e\n\u003ctd\u003e114\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e11\u003c/td\u003e\n\u003ctd\u003e80\u003c/td\u003e\n\u003ctd\u003e70\u003c/td\u003e\n\u003ctd\u003e96\u003c/td\u003e\n\u003ctd\u003e113\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e12\u003c/td\u003e\n\u003ctd\u003e102\u003c/td\u003e\n\u003ctd\u003e79\u003c/td\u003e\n\u003ctd\u003e90\u003c/td\u003e\n\u003ctd\u003e102\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e13\u003c/td\u003e\n\u003ctd\u003e94\u003c/td\u003e\n\u003ctd\u003e77\u003c/td\u003e\n\u003ctd\u003e89\u003c/td\u003e\n\u003ctd\u003e102\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e14\u003c/td\u003e\n\u003ctd\u003e82\u003c/td\u003e\n\u003ctd\u003e87\u003c/td\u003e\n\u003ctd\u003e98\u003c/td\u003e\n\u003ctd\u003e96\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e15\u003c/td\u003e\n\u003ctd\u003e76\u003c/td\u003e\n\u003ctd\u003e77\u003c/td\u003e\n\u003ctd\u003e101\u003c/td\u003e\n\u003ctd\u003e118\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e16\u003c/td\u003e\n\u003ctd\u003e88\u003c/td\u003e\n\u003ctd\u003e99\u003c/td\u003e\n\u003ctd\u003e111\u003c/td\u003e\n\u003ctd\u003e112\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e17\u003c/td\u003e\n\u003ctd\u003e87\u003c/td\u003e\n\u003ctd\u003e82\u003c/td\u003e\n\u003ctd\u003e108\u003c/td\u003e\n\u003ctd\u003e111\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e18\u003c/td\u003e\n\u003ctd\u003e91\u003c/td\u003e\n\u003ctd\u003e71\u003c/td\u003e\n\u003ctd\u003e99\u003c/td\u003e\n\u003ctd\u003e144\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e19\u003c/td\u003e\n\u003ctd\u003e95\u003c/td\u003e\n\u003ctd\u003e81\u003c/td\u003e\n\u003ctd\u003e91\u003c/td\u003e\n\u003ctd\u003e114\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e20\u003c/td\u003e\n\u003ctd\u003e92\u003c/td\u003e\n\u003ctd\u003e76\u003c/td\u003e\n\u003ctd\u003e110\u003c/td\u003e\n\u003ctd\u003e125\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e平均\u003c/td\u003e\n\u003ctd\u003e99\u003c/td\u003e\n\u003ctd\u003e85\u003c/td\u003e\n\u003ctd\u003e103.2\u003c/td\u003e\n\u003ctd\u003e117.9\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準偏差\u003c/td\u003e\n\u003ctd\u003e26.50283004\u003c/td\u003e\n\u003ctd\u003e9.959919678\u003c/td\u003e\n\u003ctd\u003e11.96076921\u003c/td\u003e\n\u003ctd\u003e16.85200285\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準誤差\u003c/td\u003e\n\u003ctd\u003e5.926212956\u003c/td\u003e\n\u003ctd\u003e2.227105745\u003c/td\u003e\n\u003ctd\u003e2.674509301\u003c/td\u003e\n\u003ctd\u003e3.768222393\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間\u003c/td\u003e\n\u003ctd\u003e11.61516405\u003c/td\u003e\n\u003ctd\u003e4.365047085\u003c/td\u003e\n\u003ctd\u003e5.241941947\u003c/td\u003e\n\u003ctd\u003e7.385580233\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最大\u003c/td\u003e\n\u003ctd\u003e110.6151641\u003c/td\u003e\n\u003ctd\u003e89.36504708\u003c/td\u003e\n\u003ctd\u003e108.4419419\u003c/td\u003e\n\u003ctd\u003e125.2855802\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最小\u003c/td\u003e\n\u003ctd\u003e87.38483595\u003c/td\u003e\n\u003ctd\u003e80.63495292\u003c/td\u003e\n\u003ctd\u003e97.95805805\u003c/td\u003e\n\u003ctd\u003e110.5144198\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"firefox\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#firefox\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eFirefox\u003c/h2\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e測定回数\u003c/th\u003e\n\u003cth\u003e1\u003c/th\u003e\n\u003cth\u003e2\u003c/th\u003e\n\u003cth\u003e3\u003c/th\u003e\n\u003cth\u003e4\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003ctd\u003e41\u003c/td\u003e\n\u003ctd\u003e41\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e59\u003c/td\u003e\n\u003ctd\u003e42\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003ctd\u003e47\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e61\u003c/td\u003e\n\u003ctd\u003e40\u003c/td\u003e\n\u003ctd\u003e42\u003c/td\u003e\n\u003ctd\u003e49\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e56\u003c/td\u003e\n\u003ctd\u003e55\u003c/td\u003e\n\u003ctd\u003e48\u003c/td\u003e\n\u003ctd\u003e48\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e65\u003c/td\u003e\n\u003ctd\u003e58\u003c/td\u003e\n\u003ctd\u003e54\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003e65\u003c/td\u003e\n\u003ctd\u003e58\u003c/td\u003e\n\u003ctd\u003e54\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e55\u003c/td\u003e\n\u003ctd\u003e56\u003c/td\u003e\n\u003ctd\u003e63\u003c/td\u003e\n\u003ctd\u003e47\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003e60\u003c/td\u003e\n\u003ctd\u003e60\u003c/td\u003e\n\u003ctd\u003e43\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003e59\u003c/td\u003e\n\u003ctd\u003e67\u003c/td\u003e\n\u003ctd\u003e71\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e10\u003c/td\u003e\n\u003ctd\u003e66\u003c/td\u003e\n\u003ctd\u003e57\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e11\u003c/td\u003e\n\u003ctd\u003e58\u003c/td\u003e\n\u003ctd\u003e57\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e12\u003c/td\u003e\n\u003ctd\u003e51\u003c/td\u003e\n\u003ctd\u003e64\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003ctd\u003e47\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e13\u003c/td\u003e\n\u003ctd\u003e53\u003c/td\u003e\n\u003ctd\u003e49\u003c/td\u003e\n\u003ctd\u003e42\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e14\u003c/td\u003e\n\u003ctd\u003e65\u003c/td\u003e\n\u003ctd\u003e55\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e15\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003ctd\u003e49\u003c/td\u003e\n\u003ctd\u003e62\u003c/td\u003e\n\u003ctd\u003e51\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e16\u003c/td\u003e\n\u003ctd\u003e68\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e17\u003c/td\u003e\n\u003ctd\u003e65\u003c/td\u003e\n\u003ctd\u003e72\u003c/td\u003e\n\u003ctd\u003e43\u003c/td\u003e\n\u003ctd\u003e47\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e18\u003c/td\u003e\n\u003ctd\u003e60\u003c/td\u003e\n\u003ctd\u003e55\u003c/td\u003e\n\u003ctd\u003e42\u003c/td\u003e\n\u003ctd\u003e44\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e19\u003c/td\u003e\n\u003ctd\u003e59\u003c/td\u003e\n\u003ctd\u003e60\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003ctd\u003e45\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e20\u003c/td\u003e\n\u003ctd\u003e50\u003c/td\u003e\n\u003ctd\u003e78\u003c/td\u003e\n\u003ctd\u003e73\u003c/td\u003e\n\u003ctd\u003e46\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e平均\u003c/td\u003e\n\u003ctd\u003e58.25\u003c/td\u003e\n\u003ctd\u003e55.9\u003c/td\u003e\n\u003ctd\u003e49.45\u003c/td\u003e\n\u003ctd\u003e46.25\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準偏差\u003c/td\u003e\n\u003ctd\u003e6.594505288\u003c/td\u003e\n\u003ctd\u003e9.658674857\u003c/td\u003e\n\u003ctd\u003e9.754358\u003c/td\u003e\n\u003ctd\u003e1.669580786\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準誤差\u003c/td\u003e\n\u003ctd\u003e1.47457621\u003c/td\u003e\n\u003ctd\u003e2.159745355\u003c/td\u003e\n\u003ctd\u003e2.181140757\u003c/td\u003e\n\u003ctd\u003e0.373329613\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間\u003c/td\u003e\n\u003ctd\u003e2.890116287\u003c/td\u003e\n\u003ctd\u003e4.233023146\u003c/td\u003e\n\u003ctd\u003e4.274957362\u003c/td\u003e\n\u003ctd\u003e0.731712602\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最大\u003c/td\u003e\n\u003ctd\u003e61.14011629\u003c/td\u003e\n\u003ctd\u003e60.13302315\u003c/td\u003e\n\u003ctd\u003e53.72495736\u003c/td\u003e\n\u003ctd\u003e46.9817126\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最小\u003c/td\u003e\n\u003ctd\u003e55.35988371\u003c/td\u003e\n\u003ctd\u003e51.66697685\u003c/td\u003e\n\u003ctd\u003e45.17504264\u003c/td\u003e\n\u003ctd\u003e45.5182874\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ie\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ie\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eIE\u003c/h2\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e測定回数\u003c/th\u003e\n\u003cth\u003e1\u003c/th\u003e\n\u003cth\u003e2\u003c/th\u003e\n\u003cth\u003e3\u003c/th\u003e\n\u003cth\u003e4\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e3464\u003c/td\u003e\n\u003ctd\u003e5035\u003c/td\u003e\n\u003ctd\u003e4125\u003c/td\u003e\n\u003ctd\u003e4225\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e2928\u003c/td\u003e\n\u003ctd\u003e4499\u003c/td\u003e\n\u003ctd\u003e3556\u003c/td\u003e\n\u003ctd\u003e3667\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e3059\u003c/td\u003e\n\u003ctd\u003e4371\u003c/td\u003e\n\u003ctd\u003e3567\u003c/td\u003e\n\u003ctd\u003e4052\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e3091\u003c/td\u003e\n\u003ctd\u003e4469\u003c/td\u003e\n\u003ctd\u003e3680\u003c/td\u003e\n\u003ctd\u003e3804\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e3107\u003c/td\u003e\n\u003ctd\u003e4548\u003c/td\u003e\n\u003ctd\u003e3616\u003c/td\u003e\n\u003ctd\u003e3756\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003e3019\u003c/td\u003e\n\u003ctd\u003e4510\u003c/td\u003e\n\u003ctd\u003e3565\u003c/td\u003e\n\u003ctd\u003e3692\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e3266\u003c/td\u003e\n\u003ctd\u003e4627\u003c/td\u003e\n\u003ctd\u003e3652\u003c/td\u003e\n\u003ctd\u003e3704\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003e2804\u003c/td\u003e\n\u003ctd\u003e4511\u003c/td\u003e\n\u003ctd\u003e3518\u003c/td\u003e\n\u003ctd\u003e3574\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003e3079\u003c/td\u003e\n\u003ctd\u003e4544\u003c/td\u003e\n\u003ctd\u003e3562\u003c/td\u003e\n\u003ctd\u003e3652\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e10\u003c/td\u003e\n\u003ctd\u003e2942\u003c/td\u003e\n\u003ctd\u003e4646\u003c/td\u003e\n\u003ctd\u003e3458\u003c/td\u003e\n\u003ctd\u003e3625\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e11\u003c/td\u003e\n\u003ctd\u003e3031\u003c/td\u003e\n\u003ctd\u003e4522\u003c/td\u003e\n\u003ctd\u003e3532\u003c/td\u003e\n\u003ctd\u003e3679\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e12\u003c/td\u003e\n\u003ctd\u003e3019\u003c/td\u003e\n\u003ctd\u003e4610\u003c/td\u003e\n\u003ctd\u003e3540\u003c/td\u003e\n\u003ctd\u003e3728\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e13\u003c/td\u003e\n\u003ctd\u003e3108\u003c/td\u003e\n\u003ctd\u003e4497\u003c/td\u003e\n\u003ctd\u003e3576\u003c/td\u003e\n\u003ctd\u003e3677\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e14\u003c/td\u003e\n\u003ctd\u003e3122\u003c/td\u003e\n\u003ctd\u003e4585\u003c/td\u003e\n\u003ctd\u003e3603\u003c/td\u003e\n\u003ctd\u003e3789\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e15\u003c/td\u003e\n\u003ctd\u003e3192\u003c/td\u003e\n\u003ctd\u003e4576\u003c/td\u003e\n\u003ctd\u003e3551\u003c/td\u003e\n\u003ctd\u003e3709\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e16\u003c/td\u003e\n\u003ctd\u003e3217\u003c/td\u003e\n\u003ctd\u003e4632\u003c/td\u003e\n\u003ctd\u003e3691\u003c/td\u003e\n\u003ctd\u003e3852\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e17\u003c/td\u003e\n\u003ctd\u003e3041\u003c/td\u003e\n\u003ctd\u003e4539\u003c/td\u003e\n\u003ctd\u003e3596\u003c/td\u003e\n\u003ctd\u003e3670\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e18\u003c/td\u003e\n\u003ctd\u003e3091\u003c/td\u003e\n\u003ctd\u003e4540\u003c/td\u003e\n\u003ctd\u003e3681\u003c/td\u003e\n\u003ctd\u003e3785\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e19\u003c/td\u003e\n\u003ctd\u003e3088\u003c/td\u003e\n\u003ctd\u003e4577\u003c/td\u003e\n\u003ctd\u003e3635\u003c/td\u003e\n\u003ctd\u003e3707\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e20\u003c/td\u003e\n\u003ctd\u003e3005\u003c/td\u003e\n\u003ctd\u003e4504\u003c/td\u003e\n\u003ctd\u003e3551\u003c/td\u003e\n\u003ctd\u003e3708\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e平均\u003c/td\u003e\n\u003ctd\u003e3083.65\u003c/td\u003e\n\u003ctd\u003e4567.1\u003c/td\u003e\n\u003ctd\u003e3612.75\u003c/td\u003e\n\u003ctd\u003e3752.75\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準偏差\u003c/td\u003e\n\u003ctd\u003e132.7472316\u003c/td\u003e\n\u003ctd\u003e124.0503527\u003c/td\u003e\n\u003ctd\u003e131.150629\u003c/td\u003e\n\u003ctd\u003e145.5853272\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準誤差\u003c/td\u003e\n\u003ctd\u003e29.68318337\u003c/td\u003e\n\u003ctd\u003e27.73850212\u003c/td\u003e\n\u003ctd\u003e29.32617218\u003c/td\u003e\n\u003ctd\u003e32.55386882\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間\u003c/td\u003e\n\u003ctd\u003e58.17797081\u003c/td\u003e\n\u003ctd\u003e54.36646557\u003c/td\u003e\n\u003ctd\u003e57.47824174\u003c/td\u003e\n\u003ctd\u003e63.80441094\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最大\u003c/td\u003e\n\u003ctd\u003e3141.827971\u003c/td\u003e\n\u003ctd\u003e4621.466466\u003c/td\u003e\n\u003ctd\u003e3670.228242\u003c/td\u003e\n\u003ctd\u003e3816.554411\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最小\u003c/td\u003e\n\u003ctd\u003e3025.472029\u003c/td\u003e\n\u003ctd\u003e4512.733534\u003c/td\u003e\n\u003ctd\u003e3555.271758\u003c/td\u003e\n\u003ctd\u003e3688.945589\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"edge\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#edge\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eEdge\u003c/h2\u003e\n\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth\u003e測定回数\u003c/th\u003e\n\u003cth\u003e1\u003c/th\u003e\n\u003cth\u003e2\u003c/th\u003e\n\u003cth\u003e3\u003c/th\u003e\n\u003cth\u003e4\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd\u003e1\u003c/td\u003e\n\u003ctd\u003e3116\u003c/td\u003e\n\u003ctd\u003e5658\u003c/td\u003e\n\u003ctd\u003e4239\u003c/td\u003e\n\u003ctd\u003e4682\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e2\u003c/td\u003e\n\u003ctd\u003e3116\u003c/td\u003e\n\u003ctd\u003e5658\u003c/td\u003e\n\u003ctd\u003e4239\u003c/td\u003e\n\u003ctd\u003e4682\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e3\u003c/td\u003e\n\u003ctd\u003e3118\u003c/td\u003e\n\u003ctd\u003e5641\u003c/td\u003e\n\u003ctd\u003e4390\u003c/td\u003e\n\u003ctd\u003e4910\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e4\u003c/td\u003e\n\u003ctd\u003e3071\u003c/td\u003e\n\u003ctd\u003e5583\u003c/td\u003e\n\u003ctd\u003e4205\u003c/td\u003e\n\u003ctd\u003e4662\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e5\u003c/td\u003e\n\u003ctd\u003e3170\u003c/td\u003e\n\u003ctd\u003e5816\u003c/td\u003e\n\u003ctd\u003e4466\u003c/td\u003e\n\u003ctd\u003e5031\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e6\u003c/td\u003e\n\u003ctd\u003e3352\u003c/td\u003e\n\u003ctd\u003e5714\u003c/td\u003e\n\u003ctd\u003e4523\u003c/td\u003e\n\u003ctd\u003e4899\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e7\u003c/td\u003e\n\u003ctd\u003e3352\u003c/td\u003e\n\u003ctd\u003e5714\u003c/td\u003e\n\u003ctd\u003e4523\u003c/td\u003e\n\u003ctd\u003e4899\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e8\u003c/td\u003e\n\u003ctd\u003e3053\u003c/td\u003e\n\u003ctd\u003e5521\u003c/td\u003e\n\u003ctd\u003e4175\u003c/td\u003e\n\u003ctd\u003e4569\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e9\u003c/td\u003e\n\u003ctd\u003e3059\u003c/td\u003e\n\u003ctd\u003e5462\u003c/td\u003e\n\u003ctd\u003e4043\u003c/td\u003e\n\u003ctd\u003e4514\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e10\u003c/td\u003e\n\u003ctd\u003e3093\u003c/td\u003e\n\u003ctd\u003e5606\u003c/td\u003e\n\u003ctd\u003e4225\u003c/td\u003e\n\u003ctd\u003e4965\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e11\u003c/td\u003e\n\u003ctd\u003e3323\u003c/td\u003e\n\u003ctd\u003e5674\u003c/td\u003e\n\u003ctd\u003e4490\u003c/td\u003e\n\u003ctd\u003e4967\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e12\u003c/td\u003e\n\u003ctd\u003e2978\u003c/td\u003e\n\u003ctd\u003e5443\u003c/td\u003e\n\u003ctd\u003e4190\u003c/td\u003e\n\u003ctd\u003e4623\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e13\u003c/td\u003e\n\u003ctd\u003e3167\u003c/td\u003e\n\u003ctd\u003e5532\u003c/td\u003e\n\u003ctd\u003e4264\u003c/td\u003e\n\u003ctd\u003e4876\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e14\u003c/td\u003e\n\u003ctd\u003e3191\u003c/td\u003e\n\u003ctd\u003e5684\u003c/td\u003e\n\u003ctd\u003e4379\u003c/td\u003e\n\u003ctd\u003e4746\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e15\u003c/td\u003e\n\u003ctd\u003e3174\u003c/td\u003e\n\u003ctd\u003e5779\u003c/td\u003e\n\u003ctd\u003e4306\u003c/td\u003e\n\u003ctd\u003e4799\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e16\u003c/td\u003e\n\u003ctd\u003e3300\u003c/td\u003e\n\u003ctd\u003e5762\u003c/td\u003e\n\u003ctd\u003e4238\u003c/td\u003e\n\u003ctd\u003e5262\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e17\u003c/td\u003e\n\u003ctd\u003e3244\u003c/td\u003e\n\u003ctd\u003e5754\u003c/td\u003e\n\u003ctd\u003e4439\u003c/td\u003e\n\u003ctd\u003e4876\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e18\u003c/td\u003e\n\u003ctd\u003e3058\u003c/td\u003e\n\u003ctd\u003e5569\u003c/td\u003e\n\u003ctd\u003e4113\u003c/td\u003e\n\u003ctd\u003e4618\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e19\u003c/td\u003e\n\u003ctd\u003e3205\u003c/td\u003e\n\u003ctd\u003e5776\u003c/td\u003e\n\u003ctd\u003e4420\u003c/td\u003e\n\u003ctd\u003e5021\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e20\u003c/td\u003e\n\u003ctd\u003e3319\u003c/td\u003e\n\u003ctd\u003e5867\u003c/td\u003e\n\u003ctd\u003e4470\u003c/td\u003e\n\u003ctd\u003e5130\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e平均\u003c/td\u003e\n\u003ctd\u003e3172.95\u003c/td\u003e\n\u003ctd\u003e5660.65\u003c/td\u003e\n\u003ctd\u003e4316.85\u003c/td\u003e\n\u003ctd\u003e4836.55\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準偏差\u003c/td\u003e\n\u003ctd\u003e108.4976843\u003c/td\u003e\n\u003ctd\u003e114.0461639\u003c/td\u003e\n\u003ctd\u003e139.7155235\u003c/td\u003e\n\u003ctd\u003e193.0822299\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e標準誤差\u003c/td\u003e\n\u003ctd\u003e24.26081975\u003c/td\u003e\n\u003ctd\u003e25.50149751\u003c/td\u003e\n\u003ctd\u003e31.2413408\u003c/td\u003e\n\u003ctd\u003e43.17449913\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間\u003c/td\u003e\n\u003ctd\u003e47.55033332\u003c/td\u003e\n\u003ctd\u003e49.98201706\u003c/td\u003e\n\u003ctd\u003e61.23190328\u003c/td\u003e\n\u003ctd\u003e84.62046401\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最大\u003c/td\u003e\n\u003ctd\u003e3220.500333\u003c/td\u003e\n\u003ctd\u003e5710.632017\u003c/td\u003e\n\u003ctd\u003e4378.081903\u003c/td\u003e\n\u003ctd\u003e4921.170464\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd\u003e95%信頼区間最小\u003c/td\u003e\n\u003ctd\u003e3125.399667\u003c/td\u003e\n\u003ctd\u003e5610.667983\u003c/td\u003e\n\u003ctd\u003e4255.618097\u003c/td\u003e\n\u003ctd\u003e4751.929536\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n","body":"# はじめに\n\n[Object.prototype.hasOwnProperty()は変数に入れた方が速い？ - JavaScript](http://p774.blog.fc2.com/blog-entry-73.html)\nというブログ記事が私のMastodonのTLに出ていました。\n\n趣旨としては`hasOwnProperty`をどう呼び出すかで4通りの検証が以下のコードでなされていたようです。\n\n```js\n(function() {\n    var myObj = {\n        prop: 111\n    };\n \n    // テスト1: ユーザー定義の対象オブジェクトから呼び出す。\n    function test1() {\n        var i, startTime, stopTime;\n \n        startTime = new Date();\n \n        for (i = 0; i \u003c 10000000; i++) {\n            myObj.hasOwnProperty('prop');\n        }\n \n        stopTime = new Date();\n        console.log(stopTime - startTime + 'ms');\n    }\n \n    // テスト2: ネイティブオブジェクトメソッドからcallを使って呼び出す(Object.prototype.hasOwnProperty.call())。\n    function test2() {\n        var i, startTime, stopTime;\n \n        startTime = new Date();\n \n        for (i = 0; i \u003c 10000000; i++) {\n            Object.prototype.hasOwnProperty.call(myObj, 'prop');\n        }\n \n        stopTime = new Date();\n        console.log(stopTime - startTime + 'ms');\n    }\n \n    // テスト3: objProtoHasOwnというローカル変数に代入してキャッシュ化。\n    function test3() {\n        var i, startTime, stopTime, objProtoHasOwn;\n \n        startTime = new Date();\n        objProtoHasOwn = Object.prototype.hasOwnProperty;\n \n        for (i = 0; i \u003c 10000000; i++) {\n            objProtoHasOwn.call(myObj, 'prop');\n        }\n \n        stopTime = new Date();\n        console.log(stopTime - startTime + 'ms');\n    }\n \n    // テスト4: ローカル変数でキャッシュ化した上で、hasOwnという関数にして使用。\n    function test4() {\n        var i, startTime, stopTime, objProtoHasOwn, hasOwn;\n \n        startTime = new Date();\n        objProtoHasOwn = Object.prototype.hasOwnProperty;\n \n        hasOwn = function(obj, prop) {\n            return objProtoHasOwn.call(obj, prop);\n        };\n \n        for (i = 0; i \u003c 10000000; i++) {\n            hasOwn(myObj, 'prop');\n        }\n \n        stopTime = new Date();\n        console.log(stopTime - startTime + 'ms');\n    }\n \n    test1();\n    test2();\n    test3();\n    test4();\n})();\n```\n\n# 元の記事の検証結果\n\nテスト環境:\nChrome 60.0.3112.113(64bit)\nFirefox 55.0.3(64bit)\nIE 11.413.15063.0(32bit)\nJScript Panel 1.2.3.2\n\nPCは2600K, Memory8G, Windows10(64bit)\n\n| テスト種類                                           | Chorome | Firefox | IE   | Microsoft Edge | JScript Panel |\n|------------------------------------------------------|---------|---------|------|----------------|---------------|\n| テスト1 (myObj.hasOwnProperty)                       | 105     | 26      | 2986 | 3306           | 781           |\n| テスト2 (Object.prototype.hasOwnProperty.call)       | 100     | 1298    | 6534 | 7758           | 907           |\n| テスト3 (Object.prototype.hasOwnPropertyを変数に)    | 122     | 21      | 4437 | 5097           | 893           |\n| テスト4 (Object.prototype.hasOwnPropertyを変数→関数) | 125     | 47      | 4907 | 6332           | 923           |\n\n# 今回の再検証結果\n\nChrome 79.0.3945.130(64bit)\nFirefox 72.0.2(64bit)\nIE 11.592.18362.0(32bit)\nMicrosoft Edge 44.18362.449.0(64bit)\n\nPCはIntel Core i7-7500U, Memory16G, Windows10(64bit)\n\n| テスト種類                                           | Chrome              | Firefox           | Internet Explorer       | Edge                    |\n|------------------------------------------------------|---------------------|-------------------|-------------------------|-------------------------|\n| テスト1 (myObj.hasOwnProperty)                       | 99(87.4～110.6)     | 58.25(55.4～61.1) | 3083.65(3025.5～3141.8) | 3172.95(3125.4～3220.5) |\n| テスト2 (Object.prototype.hasOwnProperty.call)       | 85(80.6～89.4)      | 55.9(51.7～60.1)  | 4567.1(4512.7～4621.5)  | 5660.65(5610.7～5710.6) |\n| テスト3 (Object.prototype.hasOwnPropertyを変数に)    | 103.2(98.0～108.4)  | 49.45(45.2～53.7) | 3612.75(3555.3～3670.2) | 4316.85(4255.6～4378.1) |\n| テスト4 (Object.prototype.hasOwnPropertyを変数→関数) | 117.9(110.5～125.3) | 46.25(45.5～47.0) | 3752.75(3688.9～3816.6) | 4836.55(4751.9～4921.2) |\n\n元記事とは違って20回計測で、95%信頼区間を括弧中に表示しています。TBのことを考え、測定の間には30秒~1分程度の間隔があります。\n\n# 考察\n\n## 今回と元記事の差\n\n- 元記事のようにFirefoxのテスト2だけ猛烈に遅いということは確認されなかった。\n- 全般にPCスペックなどの要因から速度が速いが、なぜかFirefoxのテスト2以外だけ遅い\n\n## いずれの検証にも言えること\n\n- 全般にFirefoxとChromeが速いのはなんか最適化がかかって処理が飛んでいるのではないか？(検証方法がわからず断念\n- IRよりEdgeのほうが遅い。いっちょんわからん\n\n# 結論\n\nまあIEとかもう誰も使ってないし(ぇ)、Edgeは中身Chromeになるので、ぶっちゃけどれ使ってもいいんじゃないですかね。\n\n# データ\n\n## Chrome\n\n| 測定回数        | 1           | 2           | 3           | 4           |\n|-----------------|-------------|-------------|-------------|-------------|\n| 1               | 202         | 106         | 122         | 118         |\n| 2               | 98          | 95          | 102         | 178         |\n| 3               | 85          | 96          | 101         | 120         |\n| 4               | 91          | 89          | 102         | 118         |\n| 5               | 137         | 98          | 131         | 118         |\n| 6               | 101         | 77          | 96          | 106         |\n| 7               | 94          | 79          | 89          | 110         |\n| 8               | 90          | 96          | 96          | 120         |\n| 9               | 100         | 80          | 103         | 119         |\n| 10              | 95          | 85          | 129         | 114         |\n| 11              | 80          | 70          | 96          | 113         |\n| 12              | 102         | 79          | 90          | 102         |\n| 13              | 94          | 77          | 89          | 102         |\n| 14              | 82          | 87          | 98          | 96          |\n| 15              | 76          | 77          | 101         | 118         |\n| 16              | 88          | 99          | 111         | 112         |\n| 17              | 87          | 82          | 108         | 111         |\n| 18              | 91          | 71          | 99          | 144         |\n| 19              | 95          | 81          | 91          | 114         |\n| 20              | 92          | 76          | 110         | 125         |\n| 平均            | 99          | 85          | 103.2       | 117.9       |\n| 標準偏差        | 26.50283004 | 9.959919678 | 11.96076921 | 16.85200285 |\n| 標準誤差        | 5.926212956 | 2.227105745 | 2.674509301 | 3.768222393 |\n| 95%信頼区間     | 11.61516405 | 4.365047085 | 5.241941947 | 7.385580233 |\n| 95%信頼区間最大 | 110.6151641 | 89.36504708 | 108.4419419 | 125.2855802 |\n| 95%信頼区間最小 | 87.38483595 | 80.63495292 | 97.95805805 | 110.5144198 |\n\n## Firefox\n\n| 測定回数        | 1           | 2           | 3           | 4           |\n|-----------------|-------------|-------------|-------------|-------------|\n| 1               | 44          | 41          | 41          | 44          |\n| 2               | 59          | 42          | 44          | 47          |\n| 3               | 61          | 40          | 42          | 49          |\n| 4               | 56          | 55          | 48          | 48          |\n| 5               | 65          | 58          | 54          | 46          |\n| 6               | 65          | 58          | 54          | 46          |\n| 7               | 55          | 56          | 63          | 47          |\n| 8               | 60          | 60          | 43          | 46          |\n| 9               | 59          | 67          | 71          | 44          |\n| 10              | 66          | 57          | 45          | 46          |\n| 11              | 58          | 57          | 44          | 46          |\n| 12              | 51          | 64          | 44          | 47          |\n| 13              | 53          | 49          | 42          | 45          |\n| 14              | 65          | 55          | 44          | 46          |\n| 15              | 46          | 49          | 62          | 51          |\n| 16              | 68          | 45          | 45          | 45          |\n| 17              | 65          | 72          | 43          | 47          |\n| 18              | 60          | 55          | 42          | 44          |\n| 19              | 59          | 60          | 45          | 45          |\n| 20              | 50          | 78          | 73          | 46          |\n| 平均            | 58.25       | 55.9        | 49.45       | 46.25       |\n| 標準偏差        | 6.594505288 | 9.658674857 | 9.754358    | 1.669580786 |\n| 標準誤差        | 1.47457621  | 2.159745355 | 2.181140757 | 0.373329613 |\n| 95%信頼区間     | 2.890116287 | 4.233023146 | 4.274957362 | 0.731712602 |\n| 95%信頼区間最大 | 61.14011629 | 60.13302315 | 53.72495736 | 46.9817126  |\n| 95%信頼区間最小 | 55.35988371 | 51.66697685 | 45.17504264 | 45.5182874  |\n\n## IE\n\n| 測定回数        | 1           | 2           | 3           | 4           |\n|-----------------|-------------|-------------|-------------|-------------|\n| 1               | 3464        | 5035        | 4125        | 4225        |\n| 2               | 2928        | 4499        | 3556        | 3667        |\n| 3               | 3059        | 4371        | 3567        | 4052        |\n| 4               | 3091        | 4469        | 3680        | 3804        |\n| 5               | 3107        | 4548        | 3616        | 3756        |\n| 6               | 3019        | 4510        | 3565        | 3692        |\n| 7               | 3266        | 4627        | 3652        | 3704        |\n| 8               | 2804        | 4511        | 3518        | 3574        |\n| 9               | 3079        | 4544        | 3562        | 3652        |\n| 10              | 2942        | 4646        | 3458        | 3625        |\n| 11              | 3031        | 4522        | 3532        | 3679        |\n| 12              | 3019        | 4610        | 3540        | 3728        |\n| 13              | 3108        | 4497        | 3576        | 3677        |\n| 14              | 3122        | 4585        | 3603        | 3789        |\n| 15              | 3192        | 4576        | 3551        | 3709        |\n| 16              | 3217        | 4632        | 3691        | 3852        |\n| 17              | 3041        | 4539        | 3596        | 3670        |\n| 18              | 3091        | 4540        | 3681        | 3785        |\n| 19              | 3088        | 4577        | 3635        | 3707        |\n| 20              | 3005        | 4504        | 3551        | 3708        |\n| 平均            | 3083.65     | 4567.1      | 3612.75     | 3752.75     |\n| 標準偏差        | 132.7472316 | 124.0503527 | 131.150629  | 145.5853272 |\n| 標準誤差        | 29.68318337 | 27.73850212 | 29.32617218 | 32.55386882 |\n| 95%信頼区間     | 58.17797081 | 54.36646557 | 57.47824174 | 63.80441094 |\n| 95%信頼区間最大 | 3141.827971 | 4621.466466 | 3670.228242 | 3816.554411 |\n| 95%信頼区間最小 | 3025.472029 | 4512.733534 | 3555.271758 | 3688.945589 |\n\n## Edge\n\n| 測定回数        | 1           | 2           | 3           | 4           |\n|-----------------|-------------|-------------|-------------|-------------|\n| 1               | 3116        | 5658        | 4239        | 4682        |\n| 2               | 3116        | 5658        | 4239        | 4682        |\n| 3               | 3118        | 5641        | 4390        | 4910        |\n| 4               | 3071        | 5583        | 4205        | 4662        |\n| 5               | 3170        | 5816        | 4466        | 5031        |\n| 6               | 3352        | 5714        | 4523        | 4899        |\n| 7               | 3352        | 5714        | 4523        | 4899        |\n| 8               | 3053        | 5521        | 4175        | 4569        |\n| 9               | 3059        | 5462        | 4043        | 4514        |\n| 10              | 3093        | 5606        | 4225        | 4965        |\n| 11              | 3323        | 5674        | 4490        | 4967        |\n| 12              | 2978        | 5443        | 4190        | 4623        |\n| 13              | 3167        | 5532        | 4264        | 4876        |\n| 14              | 3191        | 5684        | 4379        | 4746        |\n| 15              | 3174        | 5779        | 4306        | 4799        |\n| 16              | 3300        | 5762        | 4238        | 5262        |\n| 17              | 3244        | 5754        | 4439        | 4876        |\n| 18              | 3058        | 5569        | 4113        | 4618        |\n| 19              | 3205        | 5776        | 4420        | 5021        |\n| 20              | 3319        | 5867        | 4470        | 5130        |\n| 平均            | 3172.95     | 5660.65     | 4316.85     | 4836.55     |\n| 標準偏差        | 108.4976843 | 114.0461639 | 139.7155235 | 193.0822299 |\n| 標準誤差        | 24.26081975 | 25.50149751 | 31.2413408  | 43.17449913 |\n| 95%信頼区間     | 47.55033332 | 49.98201706 | 61.23190328 | 84.62046401 |\n| 95%信頼区間最大 | 3220.500333 | 5710.632017 | 4378.081903 | 4921.170464 |\n| 95%信頼区間最小 | 3125.399667 | 5610.667983 | 4255.618097 | 4751.929536 |\n","coediting":false,"comments_count":0,"created_at":"2020-02-05T02:49:51+09:00","group":null,"id":"e95dfdd5fd277ec8d636","likes_count":2,"private":false,"reactions_count":0,"tags":[{"name":"JavaScript","versions":[]},{"name":"dom","versions":[]}],"title":"【202002追試】Object.prototype.hasOwnProperty()は変数に入れた方が速い？ ","updated_at":"2020-02-05T02:49:51+09:00","url":"https://qiita.com/yumetodo/items/e95dfdd5fd277ec8d636","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cerの皆様へ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cer%E3%81%AE%E7%9A%86%E6%A7%98%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++erの皆様へ\u003c/h2\u003e\n\n\u003cp\u003e本当は三項演算子(条件演算子)について、規格書を丹念に読み進めていく記事にするはずでした。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eC++の三項演算子の仕様は要するに「2つの式から共通の型を導出するのをなるべく頑張る」で、それはstd::common_(type|reference)の仕様にダイレクトにつながって、そこからさらに複数のrangeを1つのrangeに見せるアダプタ等にも綺麗につながる発展性のある話になる予定（私的に）なので誰か頑張れ。\u003c/p\u003e— Akso de la Malbono (@Cryolite) \u003ca href=\"https://twitter.com/Cryolite/status/1192078808133668870?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNovember 6, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eそれ、必要なのはstd::common_typeの解説であって三項演算子関係ないやん\u003cbr\u003e\u003cbr\u003eそしてそれには規格書でも丸々一章くらい割いてる型変換周りの仕様を全部解説しないといけない。 \u003ca href=\"https://t.co/KB2Mq5EiLK\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/KB2Mq5EiLK\u003c/a\u003e\u003c/p\u003e— yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1192285561609805824?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNovember 7, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\" data-conversation=\"none\"\u003e\n\u003cp\u003estd::common_type の解説に三項演算子関係無いですか？\u003c/p\u003e— Akso de la Malbono (@Cryolite) \u003ca href=\"https://twitter.com/Cryolite/status/1192286547510382592?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNovember 7, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003estd::common_type の仕様は記述の大幅な簡略化のために decltype(false ? declval\u0026lt;X(\u0026amp;)()\u0026gt;()() : declval\u0026lt;Y(\u0026amp;)()\u0026gt;()()) や decay_t\u0026lt;decltype(false ? declval\u0026lt;D1\u0026gt;() : declval\u0026lt;D2\u0026gt;())\u0026gt; を refer すると言う離れ業をしているわけで，ここがポイントになりませんか？\u003c/p\u003e— Akso de la Malbono (@Cryolite) \u003ca href=\"https://twitter.com/Cryolite/status/1192289318779310082?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eNovember 7, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこれらがきっかけです。\u003c/p\u003e\n\n\u003cp\u003eしかしながら、執筆現在(2019/12/24)全く調べておらず、また規格書を一章まるごと翻訳するに近い作業が発生することから、今年のAdvent Carenderの記事にするのは断念しました。\u003c/p\u003e\n\n\u003cp\u003eそこでatgt(後述)というイベントでC++のコードを書いたのでそれの解説でもしながらお茶を濁します。\u003c/p\u003e\n\n\u003cp\u003e例年真面目な記事?を書いてきたのに期待されていた方(いないって)、ごめんなさい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"atgtから来た方へ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#atgt%E3%81%8B%E3%82%89%E6%9D%A5%E3%81%9F%E6%96%B9%E3%81%B8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eatgtから来た方へ\u003c/h2\u003e\n\n\u003cp\u003eどうも、4匁で勇者として藤野に凸してきたのは私です。\u003c/p\u003e\n\n\u003cp\u003eその記録をまだお読みでない方は\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://yumetodo.hateblo.jp/entry/2019/12/23/024751\" rel=\"nofollow noopener\" target=\"_blank\"\u003eatgt2019 4匁勇者記録 - yumetodoの旅とプログラミングとかの記録\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eをお読みください。あとついでに\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://youtu.be/UuXrFN4X1T4\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019 10匁　青信号はそのまま通過ルール検証\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eもよかったら見てやってください。マイクラ検証班で録画担当してました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"atgtとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#atgt%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eatgtとは\u003c/h1\u003e\n\n\u003cp\u003e「あめちゃん」が考案し、平成17年2月に2ちゃんねるVIP板にて開催された\u003ca href=\"http://vipper.gozaru.jp/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e「VIPPERのあんたがたに挑戦します」\u003c/a\u003e。\u003c/p\u003e\n\n\u003cp\u003eGMが提示したパスワードから出題される謎を解き、その答えが指し示す場所に突撃すると、そこには次のパスワードが。\u003c/p\u003e\n\n\u003cp\u003e全国に散らばった謎を辿り、顔も知らない仲間達と協力する、世界で最もｗｋｔｋな遊びです。\u003c/p\u003e\n\n\u003cp\u003eそして、その遊びはTwitterの世界にも持ち込まれました。それが「Twitterのあんたがたに挑戦します」です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ルール\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AB%E3%83%BC%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eルール\u003c/h2\u003e\n\n\u003col\u003e\n\u003cli\u003e8桁のパスワードをメモし、財布を持ってセブンイレブンへ。\u003c/li\u003e\n\u003cli\u003eコピー機で「ネットプリント」を選択し、パスワードを入力して問題を印刷。\u003c/li\u003e\n\u003cli\u003e印刷された問題を解いて現地を突き止める。\u003c/li\u003e\n\u003cli\u003e現地でパスワードが書かれたガムテープを探す。\u003c/li\u003e\n\u003cli\u003e1～4を繰り返し、ゴールを目指す。\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"atgtでの慣習とか用語記事を読むに当たり必要そうなもの抜粋\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#atgt%E3%81%A7%E3%81%AE%E6%85%A3%E7%BF%92%E3%81%A8%E3%81%8B%E7%94%A8%E8%AA%9E%E8%A8%98%E4%BA%8B%E3%82%92%E8%AA%AD%E3%82%80%E3%81%AB%E5%BD%93%E3%81%9F%E3%82%8A%E5%BF%85%E8%A6%81%E3%81%9D%E3%81%86%E3%81%AA%E3%82%82%E3%81%AE%E6%8A%9C%E7%B2%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eatgtでの慣習とか用語(記事を読むに当たり必要そうなもの抜粋)\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003e問題がリレーして出てくるわけですが、順番に普通なら1問目、2問目・・・と書くところを、atgtでは「匁」を使って表す傾向にあります。 ex.) 14問目→14匁\u003c/li\u003e\n\u003cli\u003e天才→甜菜\u003c/li\u003e\n\u003cli\u003e問題を回答する道筋が立たずに行き詰まっているときに、pspsと表現する\u003c/li\u003e\n\u003cli\u003eガムテープがある現地に行く人を勇者と呼ぶ\u003c/li\u003e\n\u003cli\u003e勇者が見つけたガムテープに書かれたネットプリントのパスワードを使ってセブンイレブンに印刷しに行って上げる人を「せばん」と呼ぶ(ただし「あ」は1以上の任意個数、セバアアアンなど)\u003c/li\u003e\n\u003cli\u003eGoogle Spread sheetで共同作業して模索することが近年しばしば行われる。これにかじりつく担当をスプシ担当と呼ぶ(嵐防止のためにリンクはしません、全貌が一発でわかるので検索して見てきてください)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"14匁\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#14%E5%8C%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e14匁\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題\u003c/h2\u003e\n\n\u003cp\u003eどうやってここまでたどり着いたかはTwitterで各自\u003ccode\u003e#atgt2019\u003c/code\u003eを検索してほしいが、とにかく13匁を解いて現地(つくばセンタービル　緑色の自動販売機)に行ったところ、セブンイレブンのネットプリントのパスワード(\u003ccode\u003e89159986\u003c/code\u003e、ネットプリントの有効期限には注意)を入手した\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eつくばです！！！せばんさんおねがいしまあああああす \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/9XSzM2N8VW\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/9XSzM2N8VW\u003c/a\u003e\u003c/p\u003e— ーちっぃ@謎@ぃっちー (@_icchicchi0903_) \u003ca href=\"https://twitter.com/_icchicchi0903_/status/1209089210646269952?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eセブンイレブンのネットプリントを使ったことがある人ならご存知と思うが、ネットプリントするときにファイル名を見ることができる。ファイル名も問題を解く手がかりとなる。ファイル名は「白か黒か」だった。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e白か黒か \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/tF6LBK7J2f\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/tF6LBK7J2f\u003c/a\u003e\u003c/p\u003e— りー🦁🦁 (@leafed_riaf) \u003ca href=\"https://twitter.com/leafed_riaf/status/1209089621520351232?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこの記事を書くためだけに、自分もさっき近くのセブンイレブンに行って印刷してきたのがこちらだ。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5661f682-b24a-01f6-45de-5c1fd07fead2.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9aaa8cc7104e47f0072e93327c0da9bc\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5661f682-b24a-01f6-45de-5c1fd07fead2.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9aaa8cc7104e47f0072e93327c0da9bc\" alt=\"イメージ (3).png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5661f682-b24a-01f6-45de-5c1fd07fead2.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5661f682-b24a-01f6-45de-5c1fd07fead2.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e1b19aa42309cbf4921b537dcd857b38 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eここからガムテープがある場所と現地でガムテープを探すときのヒントを特定する。\u003c/p\u003e\n\n\u003cp\u003eガムテープは大抵は日本国内のどこかにある。たまにシカゴとか釜山とかベトナム(←NEW)とかいう海外にあったりするが。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"試行錯誤\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%A6%E8%A1%8C%E9%8C%AF%E8%AA%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e試行錯誤\u003c/h2\u003e\n\n\u003cp\u003e一筋縄では行かない問題で様々な模索が行われた。オセロとか、問題文下が途切れてることからループ説が出てオルゴールとか、音ゲーの譜面じゃないかとか、幅が16ますなので文字コード表のどこかじゃないかとか、数字をアルファベットに置き換えてみたり、数字を順番に線で結んでなんか図形が見えないか調べたりなどなど・・・。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"一つの道筋\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%80%E3%81%A4%E3%81%AE%E9%81%93%E7%AD%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e一つの道筋\u003c/h2\u003e\n\n\u003cp\u003eそんななか、私が目にしたツイートがこれだ。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e\u003cbr\u003eExcelみたいに\u003cbr\u003e1から2まで範囲指定して白黒反転\u003cbr\u003e2から3まで範囲指定して白黒反転\u003cbr\u003e繰り返したら何か浮かび上がるとか？\u003c/p\u003e— こーた (@escape1008) \u003ca href=\"https://twitter.com/escape1008/status/1209101312765251584?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e面白いので検証しようとしたが、これを人力でやるには面倒すぎる。2から3までやった時点であきた。\u003c/p\u003e\n\n\u003cp\u003eそういうわけでプログラムの出番やろ！\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"検証するプログラムを書く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A4%9C%E8%A8%BC%E3%81%99%E3%82%8B%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e検証するプログラムを書く\u003c/h1\u003e\n\n\u003cp\u003eというわけで私の得意言語、C++の出番だ。\u003c/p\u003e\n\n\u003cp\u003eせっかくなので\u003ca href=\"https://github.com/bolero-MURAKAMI/Sprout\" rel=\"nofollow noopener\" target=\"_blank\"\u003esprout\u003c/a\u003eのちからを借りてコンパイル時に結果を求めよう。(というのも\u003ccode\u003estd::bitset\u003c/code\u003eはconstexprに操作できない)\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;    \n#include \u0026lt;string\u0026gt;\n#include \u0026lt;sprout/bitset.hpp\u0026gt;\n#include \u0026lt;array\u0026gt;\n#include \u0026lt;algorithm\u0026gt;\n\u003c/span\u003e\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ebit_set\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebit_set\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"c1\"\u003e//y:20 x:16\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003etable\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eheight\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e20\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eline_t\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003enumber_table_t\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint8_t\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003epos_t\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003epair\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint8_t\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint8_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor_table_t\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eline_t\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eheight\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nl\"\u003eprivate:\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003et_base\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0001100000011000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b1000000001011111\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0001101000011010\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b1001001001011111\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0000100000000000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0000001000001111\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100000100000001\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0010001000001111\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0000100011011101\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100111111111000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100100011010101\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100111111111000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100110000011000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0101000000011000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0010100000001000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100000000001000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0000000000011101\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0000010000011101\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0100010000001000\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b0001000000000000\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ecolor_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003et_base\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003earray\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003epos_t\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e36\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e{{\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 0-startで数字のxy座標 */\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 1*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e10u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 2*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 3*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e10u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e16u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 4*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e18u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 5*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e12u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e6u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 6*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e7u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 7*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e8u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e6u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 8*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e13u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/* 9*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e15u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e15u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*10*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e10u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e6u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*11*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e8u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e13u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*12*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e6u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e15u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*13*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*14*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e9u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*15*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e9u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e19u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*16*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e13u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e18u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*17*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e9u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*18*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e16u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*19*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e14u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e11u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*20*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e6u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e18u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*21*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e9u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*22*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e12u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*23*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e9u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e17u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*24*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e13u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*25*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e15u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*26*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e15u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e0u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*27*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*28*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e2u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*29*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e3u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*30*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e4u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*31*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e5u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*32*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e6u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*33*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e7u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*34*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e  \u003cspan class=\"mi\"\u003e8u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"cm\"\u003e/*35*/\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e10u\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}};\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003efill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos_t\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epos_t\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ex1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eminmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eminmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eline_t\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e^=\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003enumber_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003ecreate_base_table\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enumber_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003edefault\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003efill_all\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003enumber_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003ebase_table\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecreate_base_table\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"nf\"\u003ecalc\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003etable\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efill_all\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ecalc\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"sc\"\u003e','\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ebase_table\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003efirst\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"sc\"\u003e','\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解説\u003c/h2\u003e\n\n\u003cp\u003e色の反転ということは黒と白の2値しかないのだから、これは\u003ccode\u003ebool\u003c/code\u003eの出番だ。\u003c/p\u003e\n\n\u003cp\u003eここでは黒をtrue(=1),白をfalse(=0)とする。\u003c/p\u003e\n\n\u003cp\u003eまた、数値が含まれている範囲だけが対象だから\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7c3d1a8e-7b92-3986-bdf2-b04481cd4b3d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=08cf9868ab1f7dfd924bf35c899f5b36\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7c3d1a8e-7b92-3986-bdf2-b04481cd4b3d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=08cf9868ab1f7dfd924bf35c899f5b36\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/7c3d1a8e-7b92-3986-bdf2-b04481cd4b3d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7c3d1a8e-7b92-3986-bdf2-b04481cd4b3d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bfdeab418d7283a9d7e5acaf43a564de 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eのように座標を取ることにした。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"stdbitset\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stdbitset\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003estd::bitset\u003c/code\u003e\n\u003c/h3\u003e\n\n\u003cp\u003eC++には２進数数値リテラルがあるので表の一列は\u003ccode\u003estd::bitset\u003c/code\u003eを使って\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;    \n#include \u0026lt;string\u0026gt;\n#include \u0026lt;bitset\u0026gt;\n\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b1000100001011111\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"sc\"\u003e','\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように書ける・・・ということはない。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"plain\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e出力例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,1,\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/efUA3q69VclN9mTs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/efUA3q69VclN9mTs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eバイトオーダーとかに依存して意図したようにならない。\u003c/p\u003e\n\n\u003cp\u003eさしあたってどうせコンパイル時に実行するので単純にforを回してひっくり返す関数をStackOverflowで探してきた\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://stackoverflow.com/questions/48556547/how-to-reverse-bits-in-a-bitset\" rel=\"nofollow noopener\" target=\"_blank\"\u003ec++ - How to reverse bits in a bitset? - Stack Overflow\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;    \n#include \u0026lt;string\u0026gt;\n#include \u0026lt;sprout/bitset.hpp\u0026gt;\n\u003c/span\u003e\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ebit_set\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003esprout\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebitset\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eN\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ebit_set\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ereversed\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ereverse\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mb\"\u003e0b1000100001011111\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"sc\"\u003e','\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"plain\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実行例\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e1,0,0,0,1,0,0,0,0,1,0,1,1,1,1,1,\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/f5FSFRqZgcMHR2Oh\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/f5FSFRqZgcMHR2Oh\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"数値の表を作る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%95%B0%E5%80%A4%E3%81%AE%E8%A1%A8%E3%82%92%E4%BD%9C%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e数値の表を作る\u003c/h2\u003e\n\n\u003cp\u003e1～36までの数値はその(x,y)座標を\u003ccode\u003estd::pair\u003c/code\u003eで管理した。これは後述の色の反転処理には便利だが、最終的には表の形でほしいので作る。数値が入らないところは0にする。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003enumber_table_t\u003c/span\u003e \u003cspan class=\"nf\"\u003ecreate_base_table\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003enumber_table_t\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"n\"\u003ex\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"色の反転\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%89%B2%E3%81%AE%E5%8F%8D%E8%BB%A2\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e色の反転\u003c/h2\u003e\n\n\u003cp\u003eまず2点の座標が\u003ccode\u003ep1, p2\u003c/code\u003eで与えられる。\u003ccode\u003estd::minmax\u003c/code\u003eを使って左上と右下の座標に変換する。\u003c/p\u003e\n\n\u003cp\u003eまず\u003ccode\u003e[x1, x2]\u003c/code\u003e(閉区間)のbitを立てたmaskを作る。\u003c/p\u003e\n\n\u003cp\u003eそして\u003ccode\u003e[y1, y2]\u003c/code\u003eの範囲の行に対してさっきのmaskとxorを取ればいい。xorで済むというのはとってもシンプルでいい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003efill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos_t\u003c/span\u003e \u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epos_t\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ex1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eminmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efirst\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ey1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eminmax\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ep1\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ep2\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esecond\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eline_t\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e^=\u003c/span\u003e \u003cspan class=\"n\"\u003emask\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあとはこれを全部の数字について実行すればいい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor_table_t\u003c/span\u003e \u003cspan class=\"nf\"\u003efill_all\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efill\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1u\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e0,1,1,0,0,1,1,1,1,0,1,1,1,0,1,0\n1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1\n0,0,0,1,1,0,0,1,1,1,0,1,1,1,0,0\n1,0,0,1,0,0,1,0,0,1,1,1,1,1,1,1\n0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0\n1,0,1,1,1,1,0,0,0,0,1,0,1,1,1,1\n0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0\n0,1,1,0,1,1,0,0,1,1,1,1,0,0,0,0\n0,1,0,0,0,1,1,0,0,1,0,1,1,0,1,0\n1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1\n0,0,1,1,1,0,0,1,1,0,0,1,0,0,1,0\n1,1,0,0,1,1,1,0,1,0,1,1,1,1,1,1\n0,0,1,1,0,0,1,0,1,0,0,1,1,1,1,1\n1,1,0,1,1,1,0,1,0,0,1,0,0,0,0,0\n1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0\n1,1,0,0,0,0,1,0,0,1,0,1,0,0,0,0\n0,0,0,0,1,1,1,1,1,1,1,0,0,1,0,1\n0,0,0,0,0,1,0,0,0,0,1,1,1,0,1,1\n1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0\n1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0\n\n36,0,0,0,0,0,0,0,0,17,0,0,0,0,0,26\n0,27,28,29,30,31,32,33,34,0,35,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,21,0,0,0,24,0,25\n0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,7,0,10,0,5,0,0,0\n6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0\n22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,8,0,0,0,11,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,9\n18,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,23,0,0,0,0,0,0\n4,0,0,0,0,0,20,0,0,0,0,0,0,16,0,0\n0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"結果の処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C%E3%81%AE%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果の処理\u003c/h2\u003e\n\n\u003cp\u003eExcelを使う。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F080bd0f7-b283-b0ff-f1fa-e3c907f29d10.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d23a0829c3b0911498d19a52f5853bb\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F080bd0f7-b283-b0ff-f1fa-e3c907f29d10.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0d23a0829c3b0911498d19a52f5853bb\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/080bd0f7-b283-b0ff-f1fa-e3c907f29d10.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F080bd0f7-b283-b0ff-f1fa-e3c907f29d10.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=645e28e249d83b1c0e60f736570ede16 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eまずExcelに貼り付けて、区切り位置指定する\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fadde4a9b-f5c5-3939-6aa8-9326e3a17310.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3586a8e6d322fef028bd895b90da4f28\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fadde4a9b-f5c5-3939-6aa8-9326e3a17310.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3586a8e6d322fef028bd895b90da4f28\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/adde4a9b-f5c5-3939-6aa8-9326e3a17310.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fadde4a9b-f5c5-3939-6aa8-9326e3a17310.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a6e6e6894ba0868b5e223b2e1277b9ea 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Feaa9cb19-9506-db7d-a09c-72d51535edff.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=81f7a1705a7e51fbaf6e2215b5fe1166\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Feaa9cb19-9506-db7d-a09c-72d51535edff.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=81f7a1705a7e51fbaf6e2215b5fe1166\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/eaa9cb19-9506-db7d-a09c-72d51535edff.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Feaa9cb19-9506-db7d-a09c-72d51535edff.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fe1a740e179a03162a9031ebbc77eb6b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F89c770cb-55c0-0975-4f65-9c85381ce4af.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a889b44240235052688bd8876077f364\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F89c770cb-55c0-0975-4f65-9c85381ce4af.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=a889b44240235052688bd8876077f364\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/89c770cb-55c0-0975-4f65-9c85381ce4af.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F89c770cb-55c0-0975-4f65-9c85381ce4af.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c3f3cffe033b59a6714d32a7c92783e1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e適当に列の幅を調整した後、下の表を選択して条件付き書式の設定をしていく。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F25a7883f-d1d7-cca1-8b4f-cb0a3faf5b97.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4fec029a37e1716a52e205983965aafe\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F25a7883f-d1d7-cca1-8b4f-cb0a3faf5b97.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4fec029a37e1716a52e205983965aafe\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/25a7883f-d1d7-cca1-8b4f-cb0a3faf5b97.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F25a7883f-d1d7-cca1-8b4f-cb0a3faf5b97.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=50b179ec55a9b121a68b337288113311 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F97443e91-b844-c5d2-554c-885d31cf922e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=37c7d97ba8e2b5dd8782cf4dae1fb68e\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F97443e91-b844-c5d2-554c-885d31cf922e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=37c7d97ba8e2b5dd8782cf4dae1fb68e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/97443e91-b844-c5d2-554c-885d31cf922e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F97443e91-b844-c5d2-554c-885d31cf922e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=347b719c888e9eb6349f27549aa90e86 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e条件付き書式は選択開始位置からの相対参照ができる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.excelspeedup.com/ifakaji/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eif関数で色分け。文字・背景色を変更して「赤字」で表示させる方法\u003c/a\u003e\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e上の表の対応する座標が1\n\n\u003cul\u003e\n\u003cli\u003e下の表が0 → 背景も文字も黒\u003cbr\u003e\n\u003ccode\u003e=and(A1=1, A22=0)\u003c/code\u003e\n\u003c/li\u003e\n\u003cli\u003e下の表が0以外 → 背景は黒、文字は白\u003cbr\u003e\n\u003ccode\u003e=and(A1=1, A22\u0026lt;\u0026gt;0)\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e上の表の対応する座標が0\n\n\u003cul\u003e\n\u003cli\u003e下の表が0 → 背景も文字も白\u003cbr\u003e\n\u003ccode\u003e=and(A1=0, A22=0)\u003c/code\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fcc046111-df92-0fda-70b6-6f9bff73bc22.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=090b918f7c937f2939fc02d16c03fa7a\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fcc046111-df92-0fda-70b6-6f9bff73bc22.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=090b918f7c937f2939fc02d16c03fa7a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/cc046111-df92-0fda-70b6-6f9bff73bc22.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fcc046111-df92-0fda-70b6-6f9bff73bc22.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a1f2222bd5f3e687deaae86da6ab9ab9 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこんな感じ\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5d176e9f-01f4-8b17-c6a0-f1956dbb5c10.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=99cbc4a60dc24a0a06b43ecdd204838e\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5d176e9f-01f4-8b17-c6a0-f1956dbb5c10.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=99cbc4a60dc24a0a06b43ecdd204838e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5d176e9f-01f4-8b17-c6a0-f1956dbb5c10.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5d176e9f-01f4-8b17-c6a0-f1956dbb5c10.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c04ae2e4d1263bcaa15eed2a22145268 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eというわけでこんな結果を得る。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"先を越された\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%88%E3%82%92%E8%B6%8A%E3%81%95%E3%82%8C%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e先を越された\u003c/h1\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e1〜2　2〜3 ...　って反転させたけど。 \u003ca href=\"https://t.co/uCvWP37vlS\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/uCvWP37vlS\u003c/a\u003e\u003c/p\u003e— たあ (@chakabou) \u003ca href=\"https://twitter.com/chakabou/status/1209109987005321216?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"vb\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003eSub\u003c/span\u003e \u003cspan class=\"nf\"\u003ehanten\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e'選択範囲の座標取得\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ex1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eRow\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ey1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eColumn\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ex2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eRow\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ey2\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSelection\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eCount\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eColumn\u003c/span\u003e\n\n\n    \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ex1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003ex2\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eFor\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ey1\u003c/span\u003e \u003cspan class=\"k\"\u003eTo\u003c/span\u003e \u003cspan class=\"n\"\u003ey2\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eIf\u003c/span\u003e \u003cspan class=\"n\"\u003eCells\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eInterior\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"k\"\u003eThen\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCells\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eInterior\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e16777215\u003c/span\u003e \u003cspan class=\"c1\"\u003e'白く塗る\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eElse\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eCells\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ej\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eInterior\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eColor\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e             \u003cspan class=\"c1\"\u003e'黒く塗る\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eIf\u003c/span\u003e\n\n        \u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eNext\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003eEnd\u003c/span\u003e \u003cspan class=\"k\"\u003eSub\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eそうとうスモールな半自動化による結果が先に飛び出てしまった。\u003c/p\u003e\n\n\u003cp\u003e(あれっ、でも私のと結果合わなくね？)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"甜菜はそんなものをふっとばして答えにたどり着く\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%94%9C%E8%8F%9C%E3%81%AF%E3%81%9D%E3%82%93%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E3%81%B5%E3%81%A3%E3%81%A8%E3%81%B0%E3%81%97%E3%81%A6%E7%AD%94%E3%81%88%E3%81%AB%E3%81%9F%E3%81%A9%E3%82%8A%E7%9D%80%E3%81%8F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e甜菜はそんなものをふっとばして答えにたどり着く\u003c/h1\u003e\n\n\u003cp\u003e難航するかに見えたこの問題は、結論から言うと一人の甜菜によってすべてを吹き飛ばして答えにたどり着いた。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e完全に理解した\u003cbr\u003e\u003cbr\u003eこれサイバーサンダーサイダーのPVだ\u003c/p\u003e— 雪浜皐 (@yukihama_kou) \u003ca href=\"https://twitter.com/yukihama_kou/status/1209110831343947776?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e本日のは？件だ。どっからそれが飛び出てきた。\u003c/p\u003e\n\n\u003cp\u003eというかそもそも私はサイバーサンダーサイダーなんて知らない。何だそれは\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e【VY1】サイバーサンダーサイダー【オリジナル曲】 \u003ca href=\"https://t.co/Yr55VajU8x\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/Yr55VajU8x\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/sm15440067?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#sm15440067\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/%E3%83%8B%E3%82%B3%E3%83%8B%E3%82%B3%E5%8B%95%E7%94%BB?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#ニコニコ動画\u003c/a\u003e \u003ca href=\"https://t.co/zbggwnKoLw\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/zbggwnKoLw\u003c/a\u003e\u003c/p\u003e— yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1209181352903340039?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.nicovideo.jp/watch/sm15440067\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.nicovideo.jp/watch/sm15440067\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eボカロ殿堂入り楽曲らしい。すまんな、ボカロはわからん。\u003c/p\u003e\n\n\u003cp\u003eとにかくこの空白のパターンが合致する、かつ、問題用紙下側黒い16×4くらいのくろい部分の真ん中にある白い部分の説明がつくというのでスプシ班が一斉に動き始め怒涛の勢いで埋めた\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eスプシ班入力し始めたｗｗｗｗ \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/xdDwp7AbzC\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/xdDwp7AbzC\u003c/a\u003e\u003c/p\u003e— リョウ（凌）@C97①ロビン？ (@fctokyo1016) \u003ca href=\"https://twitter.com/fctokyo1016/status/1209112120815570944?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/d42TFBRNdZ\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/d42TFBRNdZ\u003c/a\u003e\u003c/p\u003e— MAGNET (@Magnet_Compass) \u003ca href=\"https://twitter.com/Magnet_Compass/status/1209112838913937409?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eまもなくスプシで答え出そうです \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/50E8UKleL7\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/50E8UKleL7\u003c/a\u003e\u003c/p\u003e— リョウ（凌）@C97①ロビン？ (@fctokyo1016) \u003ca href=\"https://twitter.com/fctokyo1016/status/1209112887047798784?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e \n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e\u003cbr\u003e\u003cbr\u003eな ん か お る \u003ca href=\"https://t.co/uDz2oMoxGG\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/uDz2oMoxGG\u003c/a\u003e\u003c/p\u003e— Masateo(スリープモード) (@masateo0414_v2) \u003ca href=\"https://twitter.com/masateo0414_v2/status/1209121977190846465?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fc97e4f50-7cb9-7822-ad55-7e65f4931d1e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2b5cf9fda5cc21ea253e74b55dd6cdad\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fc97e4f50-7cb9-7822-ad55-7e65f4931d1e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2b5cf9fda5cc21ea253e74b55dd6cdad\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/c97e4f50-7cb9-7822-ad55-7e65f4931d1e.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fc97e4f50-7cb9-7822-ad55-7e65f4931d1e.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6f44ee7615570f7d348e69b24862b488 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eさっきのイベントの地図だけど記載ないけど閃光が近くにあるんかな\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/8O9YjQcKF8\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/8O9YjQcKF8\u003c/a\u003e\u003c/p\u003e— つる (@crane628496) \u003ca href=\"https://twitter.com/crane628496/status/1209118509894000640?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e怪しいベンチ発見\u003ca href=\"https://twitter.com/TOS?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@tos\u003c/a\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/44CE0O858D\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/44CE0O858D\u003c/a\u003e\u003c/p\u003e— たか (@takafee) \u003ca href=\"https://twitter.com/takafee/status/1209118638461964289?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eあったーーーーー！！ \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/L8P5IKnElT\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/L8P5IKnElT\u003c/a\u003e\u003c/p\u003e— 古井戸 (@deepandoldwell) \u003ca href=\"https://twitter.com/deepandoldwell/status/1209122867159322627?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 23, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n","body":"# はじめに\n\n## C++erの皆様へ\n\n本当は三項演算子(条件演算子)について、規格書を丹念に読み進めていく記事にするはずでした。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eC++の三項演算子の仕様は要するに「2つの式から共通の型を導出するのをなるべく頑張る」で、それはstd::common_(type|reference)の仕様にダイレクトにつながって、そこからさらに複数のrangeを1つのrangeに見せるアダプタ等にも綺麗につながる発展性のある話になる予定（私的に）なので誰か頑張れ。\u003c/p\u003e\u0026mdash; Akso de la Malbono (@Cryolite) \u003ca href=\"https://twitter.com/Cryolite/status/1192078808133668870?ref_src=twsrc%5Etfw\"\u003eNovember 6, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eそれ、必要なのはstd::common_typeの解説であって三項演算子関係ないやん\u003cbr\u003e\u003cbr\u003eそしてそれには規格書でも丸々一章くらい割いてる型変換周りの仕様を全部解説しないといけない。 \u003ca href=\"https://t.co/KB2Mq5EiLK\"\u003ehttps://t.co/KB2Mq5EiLK\u003c/a\u003e\u003c/p\u003e\u0026mdash; yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1192285561609805824?ref_src=twsrc%5Etfw\"\u003eNovember 7, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\" data-conversation=\"none\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003estd::common_type の解説に三項演算子関係無いですか？\u003c/p\u003e\u0026mdash; Akso de la Malbono (@Cryolite) \u003ca href=\"https://twitter.com/Cryolite/status/1192286547510382592?ref_src=twsrc%5Etfw\"\u003eNovember 7, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003estd::common_type の仕様は記述の大幅な簡略化のために decltype(false ? declval\u0026lt;X(\u0026amp;)()\u0026gt;()() : declval\u0026lt;Y(\u0026amp;)()\u0026gt;()()) や decay_t\u0026lt;decltype(false ? declval\u0026lt;D1\u0026gt;() : declval\u0026lt;D2\u0026gt;())\u0026gt; を refer すると言う離れ業をしているわけで，ここがポイントになりませんか？\u003c/p\u003e\u0026mdash; Akso de la Malbono (@Cryolite) \u003ca href=\"https://twitter.com/Cryolite/status/1192289318779310082?ref_src=twsrc%5Etfw\"\u003eNovember 7, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\nこれらがきっかけです。\n\nしかしながら、執筆現在(2019/12/24)全く調べておらず、また規格書を一章まるごと翻訳するに近い作業が発生することから、今年のAdvent Carenderの記事にするのは断念しました。\n\nそこでatgt(後述)というイベントでC++のコードを書いたのでそれの解説でもしながらお茶を濁します。\n\n例年真面目な記事?を書いてきたのに期待されていた方(いないって)、ごめんなさい。\n\n## atgtから来た方へ\n\nどうも、4匁で勇者として藤野に凸してきたのは私です。\n\nその記録をまだお読みでない方は\n\n[atgt2019 4匁勇者記録 - yumetodoの旅とプログラミングとかの記録](https://yumetodo.hateblo.jp/entry/2019/12/23/024751)\n\nをお読みください。あとついでに\n\n[#atgt2019 10匁　青信号はそのまま通過ルール検証](https://youtu.be/UuXrFN4X1T4)\n\nもよかったら見てやってください。マイクラ検証班で録画担当してました。\n\n# atgtとは\n\n「あめちゃん」が考案し、平成17年2月に2ちゃんねるVIP板にて開催された[「VIPPERのあんたがたに挑戦します」](http://vipper.gozaru.jp/)。\n\nGMが提示したパスワードから出題される謎を解き、その答えが指し示す場所に突撃すると、そこには次のパスワードが。\n\n全国に散らばった謎を辿り、顔も知らない仲間達と協力する、世界で最もｗｋｔｋな遊びです。\n\nそして、その遊びはTwitterの世界にも持ち込まれました。それが「Twitterのあんたがたに挑戦します」です。\n\n## ルール\n\n1. 8桁のパスワードをメモし、財布を持ってセブンイレブンへ。\n1. コピー機で「ネットプリント」を選択し、パスワードを入力して問題を印刷。\n1. 印刷された問題を解いて現地を突き止める。\n1. 現地でパスワードが書かれたガムテープを探す。\n1. 1～4を繰り返し、ゴールを目指す。\n\n## atgtでの慣習とか用語(記事を読むに当たり必要そうなもの抜粋)\n\n- 問題がリレーして出てくるわけですが、順番に普通なら1問目、2問目・・・と書くところを、atgtでは「匁」を使って表す傾向にあります。 ex.) 14問目→14匁\n- 天才→甜菜\n- 問題を回答する道筋が立たずに行き詰まっているときに、pspsと表現する\n- ガムテープがある現地に行く人を勇者と呼ぶ\n- 勇者が見つけたガムテープに書かれたネットプリントのパスワードを使ってセブンイレブンに印刷しに行って上げる人を「せばん」と呼ぶ(ただし「あ」は1以上の任意個数、セバアアアンなど)\n- Google Spread sheetで共同作業して模索することが近年しばしば行われる。これにかじりつく担当をスプシ担当と呼ぶ(嵐防止のためにリンクはしません、全貌が一発でわかるので検索して見てきてください)\n\n# 14匁\n\n## 問題\n\nどうやってここまでたどり着いたかはTwitterで各自`#atgt2019`を検索してほしいが、とにかく13匁を解いて現地(つくばセンタービル　緑色の自動販売機)に行ったところ、セブンイレブンのネットプリントのパスワード(`89159986`、ネットプリントの有効期限には注意)を入手した\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eつくばです！！！せばんさんおねがいしまあああああす \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/9XSzM2N8VW\"\u003epic.twitter.com/9XSzM2N8VW\u003c/a\u003e\u003c/p\u003e\u0026mdash; ーちっぃ@謎@ぃっちー (@_icchicchi0903_) \u003ca href=\"https://twitter.com/_icchicchi0903_/status/1209089210646269952?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\nセブンイレブンのネットプリントを使ったことがある人ならご存知と思うが、ネットプリントするときにファイル名を見ることができる。ファイル名も問題を解く手がかりとなる。ファイル名は「白か黒か」だった。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e白か黒か \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/tF6LBK7J2f\"\u003epic.twitter.com/tF6LBK7J2f\u003c/a\u003e\u003c/p\u003e\u0026mdash; りー🦁🦁 (@leafed_riaf) \u003ca href=\"https://twitter.com/leafed_riaf/status/1209089621520351232?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\nこの記事を書くためだけに、自分もさっき近くのセブンイレブンに行って印刷してきたのがこちらだ。\n\n![イメージ (3).png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5661f682-b24a-01f6-45de-5c1fd07fead2.png)\n\nここからガムテープがある場所と現地でガムテープを探すときのヒントを特定する。\n\nガムテープは大抵は日本国内のどこかにある。たまにシカゴとか釜山とかベトナム(←NEW)とかいう海外にあったりするが。\n\n## 試行錯誤\n\n一筋縄では行かない問題で様々な模索が行われた。オセロとか、問題文下が途切れてることからループ説が出てオルゴールとか、音ゲーの譜面じゃないかとか、幅が16ますなので文字コード表のどこかじゃないかとか、数字をアルファベットに置き換えてみたり、数字を順番に線で結んでなんか図形が見えないか調べたりなどなど・・・。\n\n## 一つの道筋\n\nそんななか、私が目にしたツイートがこれだ。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e\u003cbr\u003eExcelみたいに\u003cbr\u003e1から2まで範囲指定して白黒反転\u003cbr\u003e2から3まで範囲指定して白黒反転\u003cbr\u003e繰り返したら何か浮かび上がるとか？\u003c/p\u003e\u0026mdash; こーた (@escape1008) \u003ca href=\"https://twitter.com/escape1008/status/1209101312765251584?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n面白いので検証しようとしたが、これを人力でやるには面倒すぎる。2から3までやった時点であきた。\n\nそういうわけでプログラムの出番やろ！\n\n# 検証するプログラムを書く\n\nというわけで私の得意言語、C++の出番だ。\n\nせっかくなので[sprout](https://github.com/bolero-MURAKAMI/Sprout)のちからを借りてコンパイル時に結果を求めよう。(というのも`std::bitset`はconstexprに操作できない)\n\n## コード\n\n```cpp\n#include \u003ciostream\u003e    \n#include \u003cstring\u003e\n#include \u003csprout/bitset.hpp\u003e\n#include \u003carray\u003e\n#include \u003calgorithm\u003e\ntemplate\u003cstd::size_t N\u003e\nconstexpr sprout::bitset\u003cN\u003e reverse(const sprout::bitset\u003cN\u003e \u0026bit_set) {\n    sprout::bitset\u003cN\u003e reversed;\n    for (std::size_t i = 0, j = N - 1; i \u003c N; i++, j--) {\n        reversed[j] = bit_set[i];\n    }\n    return reversed;\n}\n//y:20 x:16\nclass table {\npublic:\n    inline static constexpr std::size_t width = 16;\n    inline static constexpr std::size_t height = 20;\n    using line_t = sprout::bitset\u003cwidth\u003e;\n    using number_table_t = std::array\u003cstd::array\u003cstd::uint8_t, width\u003e, height\u003e;\n    using pos_t = std::pair\u003cstd::uint8_t, std::uint8_t\u003e;\n    using color_table_t = std::array\u003cline_t, height\u003e;\nprivate:\n    inline static constexpr color_table_t t_base = {\n        reverse\u003cwidth\u003e(0b0001100000011000),\n        reverse\u003cwidth\u003e(0b1000000001011111),\n        reverse\u003cwidth\u003e(0b0001101000011010),\n        reverse\u003cwidth\u003e(0b1001001001011111),\n        reverse\u003cwidth\u003e(0b0000100000000000),\n        reverse\u003cwidth\u003e(0b0000001000001111),\n        reverse\u003cwidth\u003e(0b0100000100000001),\n        reverse\u003cwidth\u003e(0b0010001000001111),\n        reverse\u003cwidth\u003e(0b0000100011011101),\n        reverse\u003cwidth\u003e(0b0100111111111000),\n        reverse\u003cwidth\u003e(0b0100100011010101),\n        reverse\u003cwidth\u003e(0b0100111111111000),\n        reverse\u003cwidth\u003e(0b0100110000011000),\n        reverse\u003cwidth\u003e(0b0101000000011000),\n        reverse\u003cwidth\u003e(0b0010100000001000),\n        reverse\u003cwidth\u003e(0b0100000000001000),\n        reverse\u003cwidth\u003e(0b0000000000011101),\n        reverse\u003cwidth\u003e(0b0000010000011101),\n        reverse\u003cwidth\u003e(0b0100010000001000),\n        reverse\u003cwidth\u003e(0b0001000000000000)\n    };\n    color_table_t t = t_base;\n    inline static constexpr std::array\u003cpos_t, 36\u003e pos{{\n        /* 0-startで数字のxy座標 */\n        /* 1*/{  5u, 10u },\n        /* 2*/{  4u,  3u },\n        /* 3*/{ 10u, 16u },\n        /* 4*/{  0u, 18u },\n        /* 5*/{ 12u,  6u },\n        /* 6*/{  0u,  7u },\n        /* 7*/{  8u,  6u },\n        /* 8*/{  4u, 13u },\n        /* 9*/{ 15u, 15u },\n        /*10*/{ 10u,  6u },\n        /*11*/{  8u, 13u },\n        /*12*/{  6u, 15u },\n        /*13*/{  1u,  5u },\n        /*14*/{  0u,  9u },\n        /*15*/{  9u, 19u },\n        /*16*/{ 13u, 18u },\n        /*17*/{  9u,  0u },\n        /*18*/{  0u, 16u },\n        /*19*/{ 14u, 11u },\n        /*20*/{  6u, 18u },\n        /*21*/{  9u,  2u },\n        /*22*/{  0u, 12u },\n        /*23*/{  9u, 17u },\n        /*24*/{ 13u,  2u },\n        /*25*/{ 15u,  2u },\n        /*26*/{ 15u,  0u },\n        /*27*/{  1u,  1u },\n        /*28*/{  2u,  1u },\n        /*29*/{  3u,  1u },\n        /*30*/{  4u,  1u },\n        /*31*/{  5u,  1u },\n        /*32*/{  6u,  1u },\n        /*33*/{  7u,  1u },\n        /*34*/{  8u,  1u },\n        /*35*/{ 10u,  1u }\n    }};\n    inline constexpr void fill(pos_t p1, pos_t p2)\n    {\n        const auto [x1, x2] = std::minmax(p1.first, p2.first);\n        const auto [y1, y2] = std::minmax(p1.second, p2.second);\n        line_t mask{};\n        for(auto i = x1; i \u003c= x2; ++i) mask.set(i);\n        for(auto i = y1; i \u003c= y2; ++i) this-\u003et[i] ^= mask;\n    }\npublic:\n    inline static constexpr number_table_t create_base_table()\n    {\n        number_table_t re{};\n        for(std::size_t i{}; i \u003c pos.size(); ++i) {\n            const auto [x, y] = pos[i];\n            re[y][x] = i + 1u;\n        }\n        return re;\n    }\n    table() = default;\n    inline constexpr color_table_t fill_all()\n    {\n        for(std::size_t i = 1u; i \u003c pos.size(); ++i) {\n            this-\u003efill(pos[i - 1u], pos[i]);\n        }\n        return this-\u003et;\n    }\n};\nconstexpr table::number_table_t base_table = table::create_base_table();\ninline constexpr auto calc()\n{\n    table t{};\n    return t.fill_all();\n}\nint main()\n{\n    constexpr auto re = calc();\n    for(auto l : re) {\n        for(std::size_t i{}; i \u003c l.size(); ++i) {\n            if (i) std::cout \u003c\u003c ',';\n            std::cout \u003c\u003c l[i];\n        }\n        std::cout \u003c\u003c std::endl;\n    }\n    std::cout \u003c\u003c std::endl;\n    for(auto\u0026\u0026 l : base_table) {\n        bool first = true;\n        for(auto\u0026\u0026 e : l) {\n            if (!std::exchange(first, false)) std::cout \u003c\u003c ',';\n            std::cout \u003c\u003c int(e);\n        }\n        std::cout \u003c\u003c std::endl;\n    }\n}\n```\n\n## 解説\n\n色の反転ということは黒と白の2値しかないのだから、これは`bool`の出番だ。\n\nここでは黒をtrue(=1),白をfalse(=0)とする。\n\nまた、数値が含まれている範囲だけが対象だから\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/7c3d1a8e-7b92-3986-bdf2-b04481cd4b3d.png)\n\nのように座標を取ることにした。\n\n### `std::bitset`\n\nC++には２進数数値リテラルがあるので表の一列は`std::bitset`を使って\n\n```cpp\n#include \u003ciostream\u003e    \n#include \u003cstring\u003e\n#include \u003cbitset\u003e\nint main()\n{\n    std::bitset\u003c16\u003e b{0b1000100001011111};\n    for(std::size_t i{}; i \u003c b.size(); ++i) {\n        std::cout \u003c\u003c b[i] \u003c\u003c ',';\n    }\n}\n```\n\nのように書ける・・・ということはない。\n\n```plain:出力例\n1,1,1,1,1,0,1,0,0,0,0,1,0,0,0,1,\n```\n\nhttps://wandbox.org/permlink/efUA3q69VclN9mTs\n\nバイトオーダーとかに依存して意図したようにならない。\n\nさしあたってどうせコンパイル時に実行するので単純にforを回してひっくり返す関数をStackOverflowで探してきた\n\n[c++ - How to reverse bits in a bitset? - Stack Overflow](https://stackoverflow.com/questions/48556547/how-to-reverse-bits-in-a-bitset)\n\n```cpp\n#include \u003ciostream\u003e    \n#include \u003cstring\u003e\n#include \u003csprout/bitset.hpp\u003e\ntemplate\u003cstd::size_t N\u003e\nconstexpr sprout::bitset\u003cN\u003e reverse(const sprout::bitset\u003cN\u003e \u0026bit_set) {\n    sprout::bitset\u003cN\u003e reversed;\n    for (std::size_t i = 0, j = N - 1; i \u003c N; i++, j--) {\n        reversed[j] = bit_set[i];\n    }\n    return reversed;\n}\nint main()\n{\n    constexpr auto b = reverse\u003c16\u003e(0b1000100001011111);\n    for(std::size_t i{}; i \u003c b.size(); ++i) {\n        std::cout \u003c\u003c b[i] \u003c\u003c ',';\n    }\n}\n```\n\n```plain:実行例\n1,0,0,0,1,0,0,0,0,1,0,1,1,1,1,1,\n```\n\nhttps://wandbox.org/permlink/f5FSFRqZgcMHR2Oh\n\n## 数値の表を作る\n\n1～36までの数値はその(x,y)座標を`std::pair`で管理した。これは後述の色の反転処理には便利だが、最終的には表の形でほしいので作る。数値が入らないところは0にする。\n\n```cpp\n    inline static constexpr number_table_t create_base_table()\n    {\n        number_table_t re{};\n        for(std::size_t i{}; i \u003c pos.size(); ++i) {\n            const auto [x, y] = pos[i];\n            re[y][x] = i + 1u;\n        }\n        return re;\n    }\n```\n\n## 色の反転\n\nまず2点の座標が`p1, p2`で与えられる。`std::minmax`を使って左上と右下の座標に変換する。\n\nまず`[x1, x2]`(閉区間)のbitを立てたmaskを作る。\n\nそして`[y1, y2]`の範囲の行に対してさっきのmaskとxorを取ればいい。xorで済むというのはとってもシンプルでいい。\n\n```cpp\n    inline constexpr void fill(pos_t p1, pos_t p2)\n    {\n        const auto [x1, x2] = std::minmax(p1.first, p2.first);\n        const auto [y1, y2] = std::minmax(p1.second, p2.second);\n        line_t mask{};\n        for(auto i = x1; i \u003c= x2; ++i) mask.set(i);\n        for(auto i = y1; i \u003c= y2; ++i) this-\u003et[i] ^= mask;\n    }\n```\n\nあとはこれを全部の数字について実行すればいい。\n\n```cpp\n    inline constexpr color_table_t fill_all()\n    {\n        for(std::size_t i = 1u; i \u003c pos.size(); ++i) {\n            this-\u003efill(pos[i - 1u], pos[i]);\n        }\n        return this-\u003et;\n    }\n```\n\n## 結果\n\n```\n0,1,1,0,0,1,1,1,1,0,1,1,1,0,1,0\n1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1\n0,0,0,1,1,0,0,1,1,1,0,1,1,1,0,0\n1,0,0,1,0,0,1,0,0,1,1,1,1,1,1,1\n0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0\n1,0,1,1,1,1,0,0,0,0,1,0,1,1,1,1\n0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0\n0,1,1,0,1,1,0,0,1,1,1,1,0,0,0,0\n0,1,0,0,0,1,1,0,0,1,0,1,1,0,1,0\n1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1\n0,0,1,1,1,0,0,1,1,0,0,1,0,0,1,0\n1,1,0,0,1,1,1,0,1,0,1,1,1,1,1,1\n0,0,1,1,0,0,1,0,1,0,0,1,1,1,1,1\n1,1,0,1,1,1,0,1,0,0,1,0,0,0,0,0\n1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0\n1,1,0,0,0,0,1,0,0,1,0,1,0,0,0,0\n0,0,0,0,1,1,1,1,1,1,1,0,0,1,0,1\n0,0,0,0,0,1,0,0,0,0,1,1,1,0,1,1\n1,0,1,1,1,0,1,1,1,1,1,0,1,1,1,0\n1,1,1,0,1,1,1,1,1,0,1,1,1,1,0,0\n\n36,0,0,0,0,0,0,0,0,17,0,0,0,0,0,26\n0,27,28,29,30,31,32,33,34,0,35,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,21,0,0,0,24,0,25\n0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,13,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,7,0,10,0,5,0,0,0\n6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,19,0\n22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,8,0,0,0,11,0,0,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0\n0,0,0,0,0,0,12,0,0,0,0,0,0,0,0,9\n18,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0\n0,0,0,0,0,0,0,0,0,23,0,0,0,0,0,0\n4,0,0,0,0,0,20,0,0,0,0,0,0,16,0,0\n0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0\n```\n\n## 結果の処理\n\nExcelを使う。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/080bd0f7-b283-b0ff-f1fa-e3c907f29d10.png)\n\nまずExcelに貼り付けて、区切り位置指定する\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/adde4a9b-f5c5-3939-6aa8-9326e3a17310.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/eaa9cb19-9506-db7d-a09c-72d51535edff.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/89c770cb-55c0-0975-4f65-9c85381ce4af.png)\n\n適当に列の幅を調整した後、下の表を選択して条件付き書式の設定をしていく。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/25a7883f-d1d7-cca1-8b4f-cb0a3faf5b97.png)\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/97443e91-b844-c5d2-554c-885d31cf922e.png)\n\n条件付き書式は選択開始位置からの相対参照ができる。\n\n[if関数で色分け。文字・背景色を変更して「赤字」で表示させる方法](https://www.excelspeedup.com/ifakaji/)\n\n- 上の表の対応する座標が1\n    - 下の表が0 → 背景も文字も黒  \n      `=and(A1=1, A22=0)`\n    - 下の表が0以外 → 背景は黒、文字は白  \n      `=and(A1=1, A22\u003c\u003e0)`\n- 上の表の対応する座標が0\n    - 下の表が0 → 背景も文字も白  \n      `=and(A1=0, A22=0)`\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/cc046111-df92-0fda-70b6-6f9bff73bc22.png)\n\nこんな感じ\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5d176e9f-01f4-8b17-c6a0-f1956dbb5c10.png)\n\nというわけでこんな結果を得る。\n\n# 先を越された\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e1〜2　2〜3 ...　って反転させたけど。 \u003ca href=\"https://t.co/uCvWP37vlS\"\u003epic.twitter.com/uCvWP37vlS\u003c/a\u003e\u003c/p\u003e\u0026mdash; たあ (@chakabou) \u003ca href=\"https://twitter.com/chakabou/status/1209109987005321216?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n```vb\nSub hanten()\n    '選択範囲の座標取得\n    x1 = Selection(1).Row\n    y1 = Selection(1).Column\n    x2 = Selection(Selection.Count).Row\n    y2 = Selection(Selection.Count).Column\n\n\n    For i = x1 To x2\n        For j = y1 To y2\n        If Cells(i, j).Interior.Color = 0 Then\n            Cells(i, j).Interior.Color = 16777215 '白く塗る\n        Else\n            Cells(i, j).Interior.Color = 0             '黒く塗る\n        End If\n\n        Next\n    Next\n\nEnd Sub\n```\n\nそうとうスモールな半自動化による結果が先に飛び出てしまった。\n\n(あれっ、でも私のと結果合わなくね？)\n\n# 甜菜はそんなものをふっとばして答えにたどり着く\n\n難航するかに見えたこの問題は、結論から言うと一人の甜菜によってすべてを吹き飛ばして答えにたどり着いた。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e\u003cbr\u003e\u003cbr\u003e完全に理解した\u003cbr\u003e\u003cbr\u003eこれサイバーサンダーサイダーのPVだ\u003c/p\u003e\u0026mdash; 雪浜皐 (@yukihama_kou) \u003ca href=\"https://twitter.com/yukihama_kou/status/1209110831343947776?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n本日のは？件だ。どっからそれが飛び出てきた。\n\nというかそもそも私はサイバーサンダーサイダーなんて知らない。何だそれは\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e【VY1】サイバーサンダーサイダー【オリジナル曲】 \u003ca href=\"https://t.co/Yr55VajU8x\"\u003ehttps://t.co/Yr55VajU8x\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/sm15440067?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#sm15440067\u003c/a\u003e \u003ca href=\"https://twitter.com/hashtag/%E3%83%8B%E3%82%B3%E3%83%8B%E3%82%B3%E5%8B%95%E7%94%BB?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#ニコニコ動画\u003c/a\u003e \u003ca href=\"https://t.co/zbggwnKoLw\"\u003epic.twitter.com/zbggwnKoLw\u003c/a\u003e\u003c/p\u003e\u0026mdash; yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1209181352903340039?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\nhttps://www.nicovideo.jp/watch/sm15440067\n\nボカロ殿堂入り楽曲らしい。すまんな、ボカロはわからん。\n\nとにかくこの空白のパターンが合致する、かつ、問題用紙下側黒い16×4くらいのくろい部分の真ん中にある白い部分の説明がつくというのでスプシ班が一斉に動き始め怒涛の勢いで埋めた\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eスプシ班入力し始めたｗｗｗｗ \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/xdDwp7AbzC\"\u003epic.twitter.com/xdDwp7AbzC\u003c/a\u003e\u003c/p\u003e\u0026mdash; リョウ（凌）@C97①ロビン？ (@fctokyo1016) \u003ca href=\"https://twitter.com/fctokyo1016/status/1209112120815570944?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"und\" dir=\"ltr\"\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/d42TFBRNdZ\"\u003epic.twitter.com/d42TFBRNdZ\u003c/a\u003e\u003c/p\u003e\u0026mdash; MAGNET (@Magnet_Compass) \u003ca href=\"https://twitter.com/Magnet_Compass/status/1209112838913937409?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eまもなくスプシで答え出そうです \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/50E8UKleL7\"\u003epic.twitter.com/50E8UKleL7\u003c/a\u003e\u003c/p\u003e\u0026mdash; リョウ（凌）@C97①ロビン？ (@fctokyo1016) \u003ca href=\"https://twitter.com/fctokyo1016/status/1209112887047798784?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e \n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e\u003cbr\u003e\u003cbr\u003eな ん か お る \u003ca href=\"https://t.co/uDz2oMoxGG\"\u003epic.twitter.com/uDz2oMoxGG\u003c/a\u003e\u003c/p\u003e\u0026mdash; Masateo(スリープモード) (@masateo0414_v2) \u003ca href=\"https://twitter.com/masateo0414_v2/status/1209121977190846465?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/c97e4f50-7cb9-7822-ad55-7e65f4931d1e.png)\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eさっきのイベントの地図だけど記載ないけど閃光が近くにあるんかな\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/8O9YjQcKF8\"\u003epic.twitter.com/8O9YjQcKF8\u003c/a\u003e\u003c/p\u003e\u0026mdash; つる (@crane628496) \u003ca href=\"https://twitter.com/crane628496/status/1209118509894000640?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e怪しいベンチ発見\u003ca href=\"https://twitter.com/TOS?ref_src=twsrc%5Etfw\"\u003e@tos\u003c/a\u003e\u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/44CE0O858D\"\u003epic.twitter.com/44CE0O858D\u003c/a\u003e\u003c/p\u003e\u0026mdash; たか (@takafee) \u003ca href=\"https://twitter.com/takafee/status/1209118638461964289?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eあったーーーーー！！ \u003ca href=\"https://twitter.com/hashtag/atgt2019?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#atgt2019\u003c/a\u003e \u003ca href=\"https://t.co/L8P5IKnElT\"\u003epic.twitter.com/L8P5IKnElT\u003c/a\u003e\u003c/p\u003e\u0026mdash; 古井戸 (@deepandoldwell) \u003ca href=\"https://twitter.com/deepandoldwell/status/1209122867159322627?ref_src=twsrc%5Etfw\"\u003eDecember 23, 2019\u003c/a\u003e\u003c/blockquote\u003e\n","coediting":false,"comments_count":0,"created_at":"2019-12-24T15:43:44+09:00","group":null,"id":"4533d474e1f2ca7a00e7","likes_count":6,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"Excel","versions":[]},{"name":"atgt","versions":[]}],"title":"#atgt2019 14匁にC++の力で挑んだが甜菜はそんなものをふっとばして答えにたどり着く","updated_at":"2020-01-08T00:00:59+09:00","url":"https://qiita.com/yumetodo/items/4533d474e1f2ca7a00e7","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e最近\u003ca href=\"https://www.konami.com/games/tokimeki-idol/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eときめきアイドル\u003c/a\u003eスコアランキングサイトを作りなおそうとしている \u003ca href=\"/AinoMegumi\" class=\"user-mention js-hovercard\" title=\"AinoMegumi\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"AinoMegumi\"\u003e@AinoMegumi\u003c/a\u003e から依頼を受けてASP.NET CoreでのWebページ制作に協力している。\u003c/p\u003e\n\n\u003cp\u003eその中でランキングページをどう実装するかという話になった。\u003c/p\u003e\n\n\u003cp\u003eまずランキングの種類が\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e総合\u003c/li\u003e\n\u003cli\u003e月間(今月)\u003c/li\u003e\n\u003cli\u003e月間(先月)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとあり、またときめきアイドルというゲームには\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eEasy\u003c/li\u003e\n\u003cli\u003eNormal\u003c/li\u003e\n\u003cli\u003eHard\u003c/li\u003e\n\u003cli\u003eExtreme\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eという難易度があるらしく、最大で3×4通りのページが各曲ごとに必要になることがわかった。\u003c/p\u003e\n\n\u003cp\u003e同じ曲の複数のランキングを切り替えてみたいというユーザーの行動が予想されたが、ASP.NET Coreで実装するとアクセス回数が増えてしまう。ここはクライアントサイドで切り替えを実装するべきだ。\u003c/p\u003e\n\n\u003cp\u003e一方で単に\u003ccode\u003edisplay: none;\u003c/code\u003eを切り替えるような実装では3×4通りのページが一意なURLにならないのでURLを共有することで見ているものを伝えられなくなる。\u003c/p\u003e\n\n\u003cp\u003eつまりルーティングが必要になってきた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"ライブラリ選定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E9%81%B8%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eライブラリ選定\u003c/h1\u003e\n\n\u003cp\u003eこういうSPAを作るライブラリはvue.jsとかReactとかとか山程あるらしいのだが、自分はmithril.jsしか使ったことがない。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://mithril.js.org/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://mithril.js.org/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003emithril.jsはJSXみたいなIntelliSenseに優しくない謎な拡張には頼らず、pureなJavaScriptで記述できるライブラリで、ライブラリが小さく、描画も高速である。\u003c/p\u003e\n\n\u003cp class=\"codepen\" data-height=\"265\" data-default-tab=\"js,result\" data-slug-hash=\"rmBOQV\"\u003e\n  See the Pen \u003ca href=\"https://codepen.io/tivac/pen/rmBOQV\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\n  Mithril Component Example\u003c/a\u003e by Pat Cavit (\u003ca href=\"https://codepen.io/tivac\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@tivac\u003c/a\u003e)\n  on \u003ca href=\"https://codepen.io\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodePen\u003c/a\u003e.\n\u003c/p\u003e\n\n\u003cscript async src=\"https://static.codepen.io/assets/embed/ei.js\"\u003e\u003c/script\u003e\n\n\u003cp\u003eちなみについ先日、公式Twitterができた(これまでは開発者個人のTwitterで宣伝とかしていた)\u003cbr\u003e\n\u003ca href=\"https://twitter.com/mithrildotjs\" rel=\"nofollow noopener\" target=\"_blank\"\u003e@mithrildotjs\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"mithril-jsでのルーティング\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mithril-js%E3%81%A7%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003emithril jsでのルーティング\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://mithril.js.org/route.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eroute(root, defaultRoute, routes) - Mithril.js\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003em.route\u003c/code\u003eを使うことでできるらしい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003eEdit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"na\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kd\"\u003efunction\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eMenu\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eh1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003eEditing \u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003edocument\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/edit/1\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/edit/:id\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eEdit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今回のように複数パラメータがあるルーティングももちろんできる。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eIt's possible to have multiple arguments in a route, for example \u003ccode\u003e/edit/:projectID/:userID\u003c/code\u003e would yield the properties \u003ccode\u003eprojectID\u003c/code\u003e and \u003ccode\u003euserID\u003c/code\u003e on the component's vnode attributes object.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eルーティングへのリンクを貼るには\u003ccode\u003em.route.Link\u003c/code\u003eを使う。ちなみに\u003ccode\u003em.route.LINK\u003c/code\u003eと書いて動かないとわめいて公式チャットに質問投げて秒殺されたのは内緒だ。\u003c/p\u003e\n\n\u003cp\u003e通常aタグを使うリンクを\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ea\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003ehref\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/test\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように書くところを置き換えて次のようになる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eLink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"na\"\u003ehref\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"s2\"\u003e/test\u003c/span\u003e\u003cspan class=\"dl\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"dataの欠損に対応したデザイン\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#data%E3%81%AE%E6%AC%A0%E6%90%8D%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%97%E3%81%9F%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003edataの欠損に対応したデザイン\u003c/h1\u003e\n\n\u003cp\u003e最初に\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e最大で3×4通りのページ\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eと書いたのは、ランキングへデータが投稿されていないことがあるからだ。例えば\u003ccode\u003eExtreme\u003c/code\u003e難易度のデータ投稿が3ヶ月前が最後だったら総合ランキングにしか\u003ccode\u003eExtreme\u003c/code\u003e難易度の情報がない。\u003c/p\u003e\n\n\u003cp\u003eつまり以下のようにボタンを並べられず、\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F53cc59c0-eebe-f750-e8c1-75b6938543bf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0e737257ddbc3e2fb5675bd6bcff470a\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F53cc59c0-eebe-f750-e8c1-75b6938543bf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=0e737257ddbc3e2fb5675bd6bcff470a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/53cc59c0-eebe-f750-e8c1-75b6938543bf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F53cc59c0-eebe-f750-e8c1-75b6938543bf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e57ae7c2e581a0f450a2977345704789 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこのようにデータがあるボタンだけ出したい。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff43ed56f-f984-c620-6709-0e7bb2494959.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f56170a0687aff3f35a74858940c8526\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff43ed56f-f984-c620-6709-0e7bb2494959.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f56170a0687aff3f35a74858940c8526\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f43ed56f-f984-c620-6709-0e7bb2494959.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff43ed56f-f984-c620-6709-0e7bb2494959.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=76c5d335d15b49fe906f08246f1a511d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"hrefをどう作るか問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#href%E3%82%92%E3%81%A9%E3%81%86%E4%BD%9C%E3%82%8B%E3%81%8B%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ehrefをどう作るか問題\u003c/h1\u003e\n\n\u003cp\u003eランキングの種類ボタンと難易度ボタンは別のクラスにして分離することにした。ただし実装が似かよるので継承を使った。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eRankingType\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eNavBase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/**\n     * @param {string} rankingType\n     */\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003erankingTypeList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003edecideDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingTypeList\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003etotal\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n        \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eranking-type\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingTypeDescriptionMap\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)}\u003c/span\u003e\u003cspan class=\"s2\"\u003eランキング`\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eGameMode\u003c/span\u003e \u003cspan class=\"kd\"\u003eextends\u003c/span\u003e \u003cspan class=\"nx\"\u003eNavBase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"cm\"\u003e/**\n     * @param {string} rankingType\n     * @param {string} gameMode\n     */\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003elist\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateGameModeList\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n      \u003cspan class=\"kd\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eselected\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003edecideDefault\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003eextreme\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003esuper\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eselected\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egame-mode\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003echarAt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e).\u003c/span\u003e\u003cspan class=\"nx\"\u003etoUpperCase\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eslice\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e#constructor(): selected=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eselected\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprefix_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e今選択されているボタンは\u003ccode\u003eNavBase\u003c/code\u003eクラスに\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"cm\"\u003e/**\n     * @returns {string}\n     */\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eget\u003c/span\u003e \u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003eset\u003c/span\u003e \u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eselected\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e#set current(\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"nx\"\u003eselected\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e)`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eselected\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんなのがあるのでとってこれる。\u003c/p\u003e\n\n\u003cp\u003eルーティングはまずこれらを持つ\u003ccode\u003eMain\u003c/code\u003eクラスを作る。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  \u003cspan class=\"kd\"\u003eclass\u003c/span\u003e \u003cspan class=\"nx\"\u003eMain\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eRankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eGameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e???\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprototype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erankingType\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003eObject\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eprototype\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehasOwnProperty\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecall\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egameMode\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erankingType\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nx\"\u003eGameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erankingType\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e \u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egameMode\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n          \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003erankingType\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e???\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egameMode\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e!==\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n          \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003evnode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eattrs\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003egameMode\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"nx\"\u003ecreateRanking\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003erankingType\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003egameMode\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e)];\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eでは肝心の\u003ccode\u003eview()\u003c/code\u003eメソッドはどういう実装になるのか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"nx\"\u003eview\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"nx\"\u003econsole\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e#view() this.current=\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003enav\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecssClassPrefix_\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n        \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n          \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ediv\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecssClassPrefix_\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e-container`\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n          \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elist_\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e\n            \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n              \u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"s1\"\u003ebutton\u003c/span\u003e\u003cspan class=\"dl\"\u003e'\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"na\"\u003eclass\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n                  \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent_\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"nx\"\u003ev\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e?\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecssClassPrefix_\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e-container__item is-current`\u003c/span\u003e\n                    \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e`\u003c/span\u003e\u003cspan class=\"p\"\u003e${\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecssClassPrefix_\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"s2\"\u003e-container__item`\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n              \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eLink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003ehref\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e???,\u003c/span\u003e\n                  \u003cspan class=\"nx\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalueConverter_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n          \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n      \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eさて、ボタンのリンク先である\u003ccode\u003ehref\u003c/code\u003eはどのように書けばいいだろうか。\u003c/p\u003e\n\n\u003cp\u003eルーティング後のURLは例えば\u003ccode\u003e#!/cmonth/easy\u003c/code\u003eのようになる。\u003ccode\u003e#!\u003c/code\u003eの部分は勝手に\u003ccode\u003em.route.Link\u003c/code\u003eがやってくれるからいいが、問題は\u003ccode\u003e/cmonth/easy\u003c/code\u003eの部分だ。\u003c/p\u003e\n\n\u003cp\u003eランキングの種類選択ボタンはデータのあるゲーム難易度を知ってさらにどの難易度を表示するかをボタンがクリックされる\u003cstrong\u003e前に\u003c/strong\u003e知る必要がある。ところがランキングの種類とゲーム難易度はクラスを分けてしまったから、ランキングの種類を管理するクラスはゲームの難易度のことは知らない。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結局コールバックしかないのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E5%B1%80%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF%E3%81%97%E3%81%8B%E3%81%AA%E3%81%84%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結局コールバックしかないのか？\u003c/h1\u003e\n\n\u003cp\u003eこれに対してEventを使ってメッセージングみたいなことを実装しようとしたがコードが膨れ上がりすぎた。\u003c/p\u003e\n\n\u003cp\u003eMainクラスはすべての情報を知っているのだからここから教えてあげればいい。\u003c/p\u003e\n\n\u003cp\u003eつまりhrefを生成する関数を注入すればいい。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"cm\"\u003e/**\n     * @param {(s: string) =\u0026gt; string} hrefCreater\n     */\u003c/span\u003e\n    \u003cspan class=\"nx\"\u003einjectHrefCreater\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ehrefCreater\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehrefCreater_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ehrefCreater\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003eview()\u003c/code\u003eでは\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e              \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n                \u003cspan class=\"nx\"\u003em\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eroute\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eLink\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003ehref\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehrefCreater_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n                  \u003cspan class=\"na\"\u003eoptions\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"na\"\u003ereplace\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n                \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalueConverter_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ev\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n              \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように呼び出す。\u003c/p\u003e\n\n\u003cp\u003eあとはMainクラスで\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"diff\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  class Main {\n    constructor() {\n      this.rankingType = new RankingType();\n      this.gameMode = new GameMode(this.rankingType.current);\n\u003cspan class=\"gi\"\u003e+     this.rankingType.injectHrefCreater(rankTypeSelected =\u0026gt; {\n+       const gameMode = decideDefault(createGameModeList(input[rankTypeSelected]), this.gameMode.current, 'extreme');\n+       console.log(`this.rankingType.injectHrefCreater:: /${rankTypeSelected}/${gameMode}`);\n+       return `/${rankTypeSelected}/${gameMode}`;\n+     });\n+     this.gameMode.injectHrefCreater(gameModeSelected =\u0026gt; `/${this.rankingType.current}/${gameModeSelected}`);\n\u003c/span\u003e    }\n    view(vnode) {\n      if (\n        Object.prototype.hasOwnProperty.call(vnode.attrs, 'rankingType') \u0026amp;\u0026amp;\n        Object.prototype.hasOwnProperty.call(vnode.attrs, 'gameMode')\n      ) {\n        if (vnode.attrs['rankingType'] !== this.rankingType.current) {\n          this.gameMode = new GameMode(vnode.attrs['rankingType'], vnode.attrs['gameMode']);\n          this.rankingType.current = vnode.attrs['rankingType'];\n\u003cspan class=\"gi\"\u003e+         this.gameMode.injectHrefCreater(gameModeSelected =\u0026gt; `/${this.rankingType.current}/${gameModeSelected}`);\n\u003c/span\u003e        }\n        if (vnode.attrs['gameMode'] !== this.gameMode.current) {\n          this.gameMode.current = vnode.attrs['gameMode'];\n        }\n      }\n      return [m(this.rankingType), m(this.gameMode), createRanking(this.rankingType.current, this.gameMode.current)];\n    }\n  }\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように書き換えればいい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"もっといい方法はなかったのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%82%E3%81%A3%E3%81%A8%E3%81%84%E3%81%84%E6%96%B9%E6%B3%95%E3%81%AF%E3%81%AA%E3%81%8B%E3%81%A3%E3%81%9F%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eもっといい方法はなかったのか\u003c/h1\u003e\n\n\u003cp\u003eそもそもランキングの種類とゲーム難易度のクラスが持っている状態は何だったか。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"javascript\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"cm\"\u003e/**\n     * @param {readonly string[]} list target list\n     * @param {string} selectedValue\n     * @param {string} cssClassPrefix\n     * @param {(v: string) =\u0026gt; string} valueConverter\n     */\u003c/span\u003e\n    \u003cspan class=\"kd\"\u003econstructor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eselectedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecssClassPrefix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003evalueConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003elist_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003elist\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecurrent_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eselectedValue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecssClassPrefix_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003ecssClassPrefix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ehrefCreater_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"dl\"\u003e''\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003evalueConverter_\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003evalueConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eごちゃごちゃあるが、本質的には今どの種類か(\u003ccode\u003ethis.current_\u003c/code\u003e)という一つの情報しかない。\u003c/p\u003e\n\n\u003cp\u003eいっそのことクラスじゃなくて関数にして毎回状態を渡して生成するみたいなダイナミックさを受け入れたらもっとシンプルになった気がしないでもない。\u003c/p\u003e\n\n\u003cp\u003eまあ今からはやらないけど。\u003c/p\u003e\n\n\u003cp\u003eもしくはステート管理ライブラリを導入するとなんかいい感じに解決できるのかもしれない(あんま良く知らない)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"できたもの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A7%E3%81%8D%E3%81%9F%E3%82%82%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eできたもの\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://yumetodo.github.io/kamioda20191018task/index2.html#!/total/extreme\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://yumetodo.github.io/kamioda20191018task/index2.html#!/total/extreme\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5f8cc7cb-9e14-33f2-4126-03f81ccec326.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=67bd779e319dfa68045a0daa42ec8ac6\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5f8cc7cb-9e14-33f2-4126-03f81ccec326.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=67bd779e319dfa68045a0daa42ec8ac6\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5f8cc7cb-9e14-33f2-4126-03f81ccec326.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F5f8cc7cb-9e14-33f2-4126-03f81ccec326.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a757b94d9f52c7cde09e9b5846287fbf 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"アンケート\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%A2%E3%83%B3%E3%82%B1%E3%83%BC%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eアンケート\u003c/h1\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e\u003ca href=\"https://twitter.com/hashtag/%E3%82%A2%E3%83%B3%E3%82%B1%E3%83%BC%E3%83%88?src=hash\u0026amp;ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e#アンケート\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e難易度ボタン、どっちのデザインがいい？\u003cbr\u003e投票は下にあります \u003ca href=\"https://t.co/Au3gk20dBM\" rel=\"nofollow noopener\" target=\"_blank\"\u003epic.twitter.com/Au3gk20dBM\u003c/a\u003e\u003c/p\u003e— ときドルスコアランキング管理者「神御田」からのお知らせ (@tokidolrank) \u003ca href=\"https://twitter.com/tokidolrank/status/1185890787025801216?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOctober 20, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e投票はこちら\u003c/p\u003e— ときドルスコアランキング管理者「神御田」からのお知らせ (@tokidolrank) \u003ca href=\"https://twitter.com/tokidolrank/status/1185890790158942209?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eOctober 20, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n","body":"# はじめに\n\n最近[ときめきアイドル](https://www.konami.com/games/tokimeki-idol/)スコアランキングサイトを作りなおそうとしている @AinoMegumi から依頼を受けてASP.NET CoreでのWebページ制作に協力している。\n\nその中でランキングページをどう実装するかという話になった。\n\nまずランキングの種類が\n\n- 総合\n- 月間(今月)\n- 月間(先月)\n\nとあり、またときめきアイドルというゲームには\n\n- Easy\n- Normal\n- Hard\n- Extreme\n\nという難易度があるらしく、最大で3×4通りのページが各曲ごとに必要になることがわかった。\n\n同じ曲の複数のランキングを切り替えてみたいというユーザーの行動が予想されたが、ASP.NET Coreで実装するとアクセス回数が増えてしまう。ここはクライアントサイドで切り替えを実装するべきだ。\n\n一方で単に`display: none;`を切り替えるような実装では3×4通りのページが一意なURLにならないのでURLを共有することで見ているものを伝えられなくなる。\n\nつまりルーティングが必要になってきた。\n\n# ライブラリ選定\n\nこういうSPAを作るライブラリはvue.jsとかReactとかとか山程あるらしいのだが、自分はmithril.jsしか使ったことがない。\n\nhttps://mithril.js.org/\n\nmithril.jsはJSXみたいなIntelliSenseに優しくない謎な拡張には頼らず、pureなJavaScriptで記述できるライブラリで、ライブラリが小さく、描画も高速である。\n\n\u003cp class=\"codepen\" data-height=\"265\" data-theme-id=\"0\" data-default-tab=\"js,result\" data-user=\"tivac\" data-slug-hash=\"rmBOQV\" style=\"height: 265px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;\" data-pen-title=\"Mithril Component Example\"\u003e\n  \u003cspan\u003eSee the Pen \u003ca href=\"https://codepen.io/tivac/pen/rmBOQV\"\u003e\n  Mithril Component Example\u003c/a\u003e by Pat Cavit (\u003ca href=\"https://codepen.io/tivac\"\u003e@tivac\u003c/a\u003e)\n  on \u003ca href=\"https://codepen.io\"\u003eCodePen\u003c/a\u003e.\u003c/span\u003e\n\u003c/p\u003e\n\u003cscript async src=\"https://static.codepen.io/assets/embed/ei.js\"\u003e\u003c/script\u003e\n\nちなみについ先日、公式Twitterができた(これまでは開発者個人のTwitterで宣伝とかしていた)\n[@mithrildotjs](https://twitter.com/mithrildotjs)\n\n# mithril jsでのルーティング\n\n[route(root, defaultRoute, routes) - Mithril.js](https://mithril.js.org/route.html)\n\n`m.route`を使うことでできるらしい。\n\n```javascript\nvar Edit = {\n    view: function(vnode) {\n        return [\n            m(Menu),\n            m(\"h1\", \"Editing \" + vnode.attrs.id)\n        ]\n    }\n}\nm.route(document.body, \"/edit/1\", {\n    \"/edit/:id\": Edit,\n})\n```\n\n今回のように複数パラメータがあるルーティングももちろんできる。\n\n\u003e It's possible to have multiple arguments in a route, for example `/edit/:projectID/:userID` would yield the properties `projectID` and `userID` on the component's vnode attributes object.\n\nルーティングへのリンクを貼るには`m.route.Link`を使う。ちなみに`m.route.LINK`と書いて動かないとわめいて公式チャットに質問投げて秒殺されたのは内緒だ。\n\n通常aタグを使うリンクを\n\n```javascript\nm('a', {href: \"/test\"})\n```\n\nのように書くところを置き換えて次のようになる。\n\n```javascript\nm(m.route.Link, {href: \"/test\"})\n```\n\n# dataの欠損に対応したデザイン\n\n最初に\n\n\u003e 最大で3×4通りのページ\n\nと書いたのは、ランキングへデータが投稿されていないことがあるからだ。例えば`Extreme`難易度のデータ投稿が3ヶ月前が最後だったら総合ランキングにしか`Extreme`難易度の情報がない。\n\nつまり以下のようにボタンを並べられず、\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/53cc59c0-eebe-f750-e8c1-75b6938543bf.png)\n\nこのようにデータがあるボタンだけ出したい。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f43ed56f-f984-c620-6709-0e7bb2494959.png)\n\n# hrefをどう作るか問題\n\nランキングの種類ボタンと難易度ボタンは別のクラスにして分離することにした。ただし実装が似かよるので継承を使った。\n\n```javascript\n  class RankingType extends NavBase {\n    /**\n     * @param {string} rankingType\n     */\n    constructor(rankingType) {\n      super(\n        rankingTypeList,\n        decideDefault(rankingTypeList, rankingType, 'total'),\n        'ranking-type',\n        v =\u003e `${rankingTypeDescriptionMap.get(v)}ランキング`\n      );\n    }\n  }\n  class GameMode extends NavBase {\n    /**\n     * @param {string} rankingType\n     * @param {string} gameMode\n     */\n    constructor(rankingType, gameMode) {\n      const list = createGameModeList(input[rankingType]);\n      const selected = decideDefault(list, gameMode, 'extreme');\n      super(list, selected, 'game-mode', v =\u003e v.charAt(0).toUpperCase() + v.slice(1));\n      console.log(`${this.constructor.name}#constructor(): selected=${selected}`, list);\n      this.prefix_ = rankingType;\n    }\n  }\n```\n\n今選択されているボタンは`NavBase`クラスに\n\n```javascript\n    /**\n     * @returns {string}\n     */\n    get current() {\n      return this.current_;\n    }\n    set current(selected) {\n      console.log(`${this.constructor.name}#set current(${selected})`);\n      this.current_ = selected;\n    }\n```\n\nこんなのがあるのでとってこれる。\n\nルーティングはまずこれらを持つ`Main`クラスを作る。\n\n```javascript\n  class Main {\n    constructor() {\n      this.rankingType = new RankingType();\n      this.gameMode = new GameMode(this.rankingType.current);\n      ???\n    }\n    view(vnode) {\n      if (\n        Object.prototype.hasOwnProperty.call(vnode.attrs, 'rankingType') \u0026\u0026\n        Object.prototype.hasOwnProperty.call(vnode.attrs, 'gameMode')\n      ) {\n        if (vnode.attrs['rankingType'] !== this.rankingType.current) {\n          this.gameMode = new GameMode(vnode.attrs['rankingType'], vnode.attrs['gameMode']);\n          this.rankingType.current = vnode.attrs['rankingType'];\n          ???\n        }\n        if (vnode.attrs['gameMode'] !== this.gameMode.current) {\n          this.gameMode.current = vnode.attrs['gameMode'];\n        }\n      }\n      return [m(this.rankingType), m(this.gameMode), createRanking(this.rankingType.current, this.gameMode.current)];\n    }\n  }\n```\n\nでは肝心の`view()`メソッドはどういう実装になるのか。\n\n```javascript\n    view() {\n      console.log(`${this.constructor.name}#view() this.current=${this.current}`);\n      return m(\n        'nav',\n        { class: this.cssClassPrefix_ },\n        m(\n          'div',\n          { class: `${this.cssClassPrefix_}-container` },\n          this.list_.map(v =\u003e\n            m(\n              'button',\n              {\n                class:\n                  this.current_ === v\n                    ? `${this.cssClassPrefix_}-container__item is-current`\n                    : `${this.cssClassPrefix_}-container__item`,\n              },\n              m(\n                m.route.Link,\n                {\n                  href: ???,\n                  options: { replace: true },\n                },\n                this.valueConverter_(v)\n              )\n            )\n          )\n        )\n      );\n    }\n```\n\nさて、ボタンのリンク先である`href`はどのように書けばいいだろうか。\n\nルーティング後のURLは例えば`#!/cmonth/easy`のようになる。`#!`の部分は勝手に`m.route.Link`がやってくれるからいいが、問題は`/cmonth/easy`の部分だ。\n\nランキングの種類選択ボタンはデータのあるゲーム難易度を知ってさらにどの難易度を表示するかをボタンがクリックされる**前に**知る必要がある。ところがランキングの種類とゲーム難易度はクラスを分けてしまったから、ランキングの種類を管理するクラスはゲームの難易度のことは知らない。\n\n# 結局コールバックしかないのか？\n\nこれに対してEventを使ってメッセージングみたいなことを実装しようとしたがコードが膨れ上がりすぎた。\n\nMainクラスはすべての情報を知っているのだからここから教えてあげればいい。\n\nつまりhrefを生成する関数を注入すればいい。\n\n```javascript\n    /**\n     * @param {(s: string) =\u003e string} hrefCreater\n     */\n    injectHrefCreater(hrefCreater) {\n      this.hrefCreater_ = hrefCreater;\n    }\n```\n\n`view()`では\n\n```javascript\n              m(\n                m.route.Link,\n                {\n                  href: this.hrefCreater_(v),\n                  options: { replace: true },\n                },\n                this.valueConverter_(v)\n              )\n```\n\nのように呼び出す。\n\nあとはMainクラスで\n\n```diff\n  class Main {\n    constructor() {\n      this.rankingType = new RankingType();\n      this.gameMode = new GameMode(this.rankingType.current);\n+     this.rankingType.injectHrefCreater(rankTypeSelected =\u003e {\n+       const gameMode = decideDefault(createGameModeList(input[rankTypeSelected]), this.gameMode.current, 'extreme');\n+       console.log(`this.rankingType.injectHrefCreater:: /${rankTypeSelected}/${gameMode}`);\n+       return `/${rankTypeSelected}/${gameMode}`;\n+     });\n+     this.gameMode.injectHrefCreater(gameModeSelected =\u003e `/${this.rankingType.current}/${gameModeSelected}`);\n    }\n    view(vnode) {\n      if (\n        Object.prototype.hasOwnProperty.call(vnode.attrs, 'rankingType') \u0026\u0026\n        Object.prototype.hasOwnProperty.call(vnode.attrs, 'gameMode')\n      ) {\n        if (vnode.attrs['rankingType'] !== this.rankingType.current) {\n          this.gameMode = new GameMode(vnode.attrs['rankingType'], vnode.attrs['gameMode']);\n          this.rankingType.current = vnode.attrs['rankingType'];\n+         this.gameMode.injectHrefCreater(gameModeSelected =\u003e `/${this.rankingType.current}/${gameModeSelected}`);\n        }\n        if (vnode.attrs['gameMode'] !== this.gameMode.current) {\n          this.gameMode.current = vnode.attrs['gameMode'];\n        }\n      }\n      return [m(this.rankingType), m(this.gameMode), createRanking(this.rankingType.current, this.gameMode.current)];\n    }\n  }\n```\n\nのように書き換えればいい。\n\n# もっといい方法はなかったのか\n\nそもそもランキングの種類とゲーム難易度のクラスが持っている状態は何だったか。\n\n```javascript\n    /**\n     * @param {readonly string[]} list target list\n     * @param {string} selectedValue\n     * @param {string} cssClassPrefix\n     * @param {(v: string) =\u003e string} valueConverter\n     */\n    constructor(list, selectedValue, cssClassPrefix, valueConverter) {\n      this.list_ = list;\n      this.current_ = selectedValue;\n      this.cssClassPrefix_ = cssClassPrefix;\n      this.hrefCreater_ = () =\u003e '';\n      this.valueConverter_ = valueConverter;\n    }\n```\n\nごちゃごちゃあるが、本質的には今どの種類か(`this.current_`)という一つの情報しかない。\n\nいっそのことクラスじゃなくて関数にして毎回状態を渡して生成するみたいなダイナミックさを受け入れたらもっとシンプルになった気がしないでもない。\n\nまあ今からはやらないけど。\n\nもしくはステート管理ライブラリを導入するとなんかいい感じに解決できるのかもしれない(あんま良く知らない)\n\n# できたもの\n\nhttps://yumetodo.github.io/kamioda20191018task/index2.html#!/total/extreme\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/5f8cc7cb-9e14-33f2-4126-03f81ccec326.png)\n\n# アンケート\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e\u003ca href=\"https://twitter.com/hashtag/%E3%82%A2%E3%83%B3%E3%82%B1%E3%83%BC%E3%83%88?src=hash\u0026amp;ref_src=twsrc%5Etfw\"\u003e#アンケート\u003c/a\u003e \u003cbr\u003e\u003cbr\u003e難易度ボタン、どっちのデザインがいい？\u003cbr\u003e投票は下にあります \u003ca href=\"https://t.co/Au3gk20dBM\"\u003epic.twitter.com/Au3gk20dBM\u003c/a\u003e\u003c/p\u003e\u0026mdash; ときドルスコアランキング管理者「神御田」からのお知らせ (@tokidolrank) \u003ca href=\"https://twitter.com/tokidolrank/status/1185890787025801216?ref_src=twsrc%5Etfw\"\u003eOctober 20, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e投票はこちら\u003c/p\u003e\u0026mdash; ときドルスコアランキング管理者「神御田」からのお知らせ (@tokidolrank) \u003ca href=\"https://twitter.com/tokidolrank/status/1185890790158942209?ref_src=twsrc%5Etfw\"\u003eOctober 20, 2019\u003c/a\u003e\u003c/blockquote\u003e\n","coediting":false,"comments_count":0,"created_at":"2019-10-23T19:52:25+09:00","group":null,"id":"8c4aacbc9db04633b668","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"JavaScript","versions":[]},{"name":"Mithril.js","versions":[]},{"name":"Mithril","versions":[]}],"title":"mithril.jsのrouteでSPAを作るときにhrefにつまずいた件","updated_at":"2019-10-23T19:52:25+09:00","url":"https://qiita.com/yumetodo/items/8c4aacbc9db04633b668","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじまりポエム\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%81%BE%E3%82%8A%E3%83%9D%E3%82%A8%E3%83%A0\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじまり(ポエム)\u003c/h1\u003e\n\n\u003cp\u003e私はRustのプログラムを愛用しているVisual Studio Codeで書いていた。\u003c/p\u003e\n\n\u003cp\u003eデバッグするかーとどうやってデバッグするか調べた。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/kat_out/items/cf89a8dffb4e0629948a\" id=\"reference-924eac5cbe923719948c\"\u003eVisual Studio CodeでRustのコード補完・タスク・Debug実行\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなるほど、\u003ca href=\"https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodeLLDB\u003c/a\u003eというのがあるらしい。\u003c/p\u003e\n\n\u003cp\u003e私はCodeLLDBをポチッと導入し、設定を書き起動しようとした。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eCodeLLDB requires Python 3.6(64bit), but looks like it is not installed on this machine\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ePython必要なの！？あれ、でもPython入れてなかったっけ・・・\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003epython -V\nPython 3.2.2\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e古すぎ！\u003c/p\u003e\n\n\u003cp\u003eはいはい、chocolateyで入れましょうね～\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003echoco install python3 -y\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003epython -V\nPython 3.7.4\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eあれ、なんか3.7が降ってきた。まあ3.6って言ってたけど動くでしょ！\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eCodeLLDB requires Python 3.6(64bit), but looks like it is not installed on this machine\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e希望は打ち砕かれた。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/vadimcn/vscode-lldb/issues/157\" rel=\"nofollow noopener\" target=\"_blank\"\u003egot error : CodeLLDB requires Python 3.6(64bit), but looks like it is not installed on this machine · Issue #157 · vadimcn/vscode-lldb\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI got the same error,\u003cbr\u003e\n\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F46454174%2F50803179-b1352c80-130f-11e9-957a-f832b4708b2f.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d87b920c26b46e33914e95d52a372854\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F46454174%2F50803179-b1352c80-130f-11e9-957a-f832b4708b2f.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d87b920c26b46e33914e95d52a372854\" alt=\"image\" data-canonical-src=\"https://user-images.githubusercontent.com/46454174/50803179-b1352c80-130f-11e9-957a-f832b4708b2f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fuser-images.githubusercontent.com%2F46454174%2F50803179-b1352c80-130f-11e9-957a-f832b4708b2f.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2869494225670cd9e21f550808bd6e0d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eI have found a difference in registry. Python is registered under \"HKEY_CURRENT_USER\" but not under \"HKEY_LOCAL_MACHINE\" .\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eなるほど、レジストリ見てんのか。偽装してみるか。\u003c/p\u003e\n\n\u003cp\u003eところが\u003ccode\u003epython36.dll\u003c/code\u003eが見つからないとのたまってきた。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F001%2F425%2F186%2Foriginal%2Fa21f8b89d26eabad.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d593162d792a542d296a349687612e02\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F001%2F425%2F186%2Foriginal%2Fa21f8b89d26eabad.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d593162d792a542d296a349687612e02\" alt=\"dll\" data-canonical-src=\"https://file.qiitadon.com/media_attachments/files/001/425/186/original/a21f8b89d26eabad.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F001%2F425%2F186%2Foriginal%2Fa21f8b89d26eabad.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=89777a08f661017c76f01a044046e1da 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなんでDLLの場所設定でいじれないの？\u003cbr\u003e\n私はIssueを投げた。\u003cbr\u003e\n\u003ca href=\"https://github.com/vadimcn/vscode-lldb/issues/205\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWhy does the python version is locked as 3.6 only for Windows? · Issue #205 · vadimcn/vscode-lldb\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eしかしそうはいっても始まらぬ。なんとかしてPython3.6を手に入れねばならぬ。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.python.org/downloads/windows/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePython Releases for Windows | Python.org\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e3.6系統の最新リリースは・・・3.6.9か。リンクを踏んだ私に待ち受けていたのは・・・\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.python.org/downloads/release/python-369/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePython Release Python 3.6.9 | Python.org\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cstrong\u003eソースコードしか配布されていないという現実だった\u003c/strong\u003e\u003c/p\u003e\n\n\u003cp\u003e・・・\u003cstrong\u003eこれはビルドするしかない！\u003c/strong\u003e 一つ前の3.6.8を使うという発想が何故かなかった私はビルドする道へ進んだ。最近はC++書いてなくてTypeScriptばっか書いてるけどVisual Studioくらい入ってるし余裕でしょ、そう思っていた。\u003c/p\u003e\n\n\u003cp\u003e開発者コマンドプロンプトで配布されているソースコードを展開したディレクトリの中の\u003ccode\u003ePCbuild\u003c/code\u003eに移動して\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003ebuild.bat -p x64 -c Release\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとし、ビルドした。\u003ca href=\"https://qiitadon.com/web/statuses/102683814399014503\" rel=\"nofollow noopener\" target=\"_blank\"\u003eなんかエラーが出たり型変換周りの(\u003ccode\u003eint\u003c/code\u003eを\u003ccode\u003evoid*\u003c/code\u003eにキャストして配列に格納しまた\u003ccode\u003eint\u003c/code\u003eにキャストして使うとかいうコードが原因、これ書いたやつ正気か？これだからC言語使い共は・・・)警告がどっさり出た\u003c/a\u003eが、とにかく終わった。\u003c/p\u003e\n\n\u003cp\u003eレジストリを偽装し、VSCodeの設定で\"lldb.launch.env\"の\u003ccode\u003ePATH\u003c/code\u003eを書いて動かした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eFatal Python error: Py_Initialize: unable to load the file system codec\nImport Error: No module named 'encodings' \n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cstrong\u003eこれなにか足りてないやつだ\u003c/strong\u003e、そう悟った私はとりあえず眠り、リフレッシュした脳みそで本気で取り組むことにした。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"本気でビルドする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%9C%AC%E6%B0%97%E3%81%A7%E3%83%93%E3%83%AB%E3%83%89%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e本気でビルドする\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ビルドの準備\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E6%BA%96%E5%82%99\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビルドの準備\u003c/h2\u003e\n\n\u003cp\u003e改めてビルドの準備をしていく。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"net-35\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#net-35\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e.NET 3.5\u003c/h3\u003e\n\n\u003cp\u003eWindows10では.NET 3.5がデフォルトで無効になっている。\u003cbr\u003e\n\u003ca href=\"https://blogs.technet.microsoft.com/askcorejp/2018/10/05/enable_net35_win10/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e.NET Framework 3.5 を有効化する手順について ( Windows 10 ) | Ask CORE\u003c/a\u003e\u003cbr\u003e\nに従って有効化する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"visual-studio\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#visual-studio\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eVisual Studio\u003c/h3\u003e\n\n\u003cp\u003e2015以上であればよい。私はVisual Studio 2019を選んだ。C#とC++のコンパイルが普通にできれば十分だとは思うが、なんせ私の環境にはいろいろ入れているので最小構成がよくわからない。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eMSVC v140 - VS2015 C++ ビルドツール\u003c/code\u003eとかも必要である可能性はある。\u003c/p\u003e\n\n\u003cp\u003eまあなんなら下にVS installerの構成ファイル置いておくので適宜いじって読み込ませてほしい。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://gist.github.com/yumetodo/c48152a7512356db33bb2c0994610359\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://gist.github.com/yumetodo/c48152a7512356db33bb2c0994610359\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"choclatey\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#choclatey\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003echoclatey\u003c/h3\u003e\n\n\u003cp\u003e必須というわけではないが、ないと説明が面倒くさいので。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://chocolatey.org/install\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://chocolatey.org/install\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eにあるとおりに入れてほしい。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"mercurial\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#mercurial\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMercurial\u003c/h3\u003e\n\n\u003cp\u003e管理者権限のあるPowershellないしコマンドプロンプトで\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003echoco install hg -y\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"python\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#python\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ePython\u003c/h3\u003e\n\n\u003cp\u003ePythonをビルドするにはPythonが必要である。おおっと、鶏と卵の問題というかブートストラップ問題だ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003echoco install python3 -y\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"sphinx\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sphinx\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003esphinx\u003c/h4\u003e\n\n\u003cp\u003eさっそくPythonについてくるpipの出番だ。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003epip install Sphinx\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"tcl\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#tcl\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eTcl\u003c/h3\u003e\n\n\u003cp\u003eこれがなんなのかわかっていないがとにかく必要らしい。なんとなくIDLEのためじゃないかという気がするが・・・。\u003c/p\u003e\n\n\u003cp\u003e\u003ca\u003eftp://ftp.tcl.tk/pub/tcl/tcl8_6/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eから\u003ccode\u003etcl-core8.6.6-src.tar.gz\u003c/code\u003eをダウンロードする。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"html-help-workshop\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#html-help-workshop\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eHTML Help Workshop\u003c/h3\u003e\n\n\u003cp\u003eVisual Studio 2017以降のインストーラーでは入れられないので自分で持ってくる必要がある。\u003cbr\u003e\n\u003ca href=\"https://docs.microsoft.com/ja-jp/previous-versions/windows/desktop/htmlhelp/microsoft-html-help-downloads\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMicrosoft HTML Help Downloads | Microsoft Docs\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003eDownload Htmlhelp.exe\u003c/code\u003eをクリック。ダウンロードしたら実行してどんどん次に進んでいけば終わる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"build\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#build\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eBuild\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"download--展開\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#download--%E5%B1%95%E9%96%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eDownload \u0026amp; 展開\u003c/h3\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.python.org/downloads/release/python-369/\" rel=\"nofollow noopener\" target=\"_blank\"\u003ePython Release Python 3.6.9 | Python.org\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eXZ compressed source tarballを落として展開する。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"追加のファイル配置\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E5%8A%A0%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E9%85%8D%E7%BD%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e追加のファイル配置\u003c/h3\u003e\n\n\u003cp\u003eその中に\u003ccode\u003eexternals\u003c/code\u003eというディレクトリを作る。そこに\u003ccode\u003etcl-core8.6.6-src.tar.gz\u003c/code\u003eを展開する。フォルダー名は\u003ccode\u003etcl-core-8.6.6.0\u003c/code\u003eに。これをやらないと、下のようなエラーに見舞われる。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F001%2F425%2F010%2Foriginal%2F7dff6df9d53fe486.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7bec9ca6f7fca82085d4cfb4f5b9cab3\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F001%2F425%2F010%2Foriginal%2F7dff6df9d53fe486.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7bec9ca6f7fca82085d4cfb4f5b9cab3\" alt=\"error\" data-canonical-src=\"https://file.qiitadon.com/media_attachments/files/001/425/010/original/7dff6df9d53fe486.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ffile.qiitadon.com%2Fmedia_attachments%2Ffiles%2F001%2F425%2F010%2Foriginal%2F7dff6df9d53fe486.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=643b19efe900a3249f0ecccfbe86730a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"環境変数の設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e環境変数の設定\u003c/h3\u003e\n\n\u003cp\u003eVSの開発者コマンドプロンプトを立ち上げる。以下の環境変数を設定する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nf\"\u003eset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ePYTHON\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\\Python37\\python.exe\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003epython2.7もしくは3.4以降の\u003ccode\u003epython.exe\u003c/code\u003eのフルパス。\u003cbr\u003e\n今回はchocolateyで入れているから\u003ccode\u003e\"C:\\Python37\\python.exe\"\u003c/code\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nf\"\u003eset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eSPHINXBUILD\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\\Python37\\Scripts\\sphinx-build.exe\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ewhere sphinx-build\u003c/code\u003eすれば教えてくれるだろう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nf\"\u003eset\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\\Program Files\\Mercurial\\hg.exe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\\Program Files (x86)\\HTML Help Workshop\\hhc.exe\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"nf\"\u003ePATH\u003c/span\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e１つ目はhg.exeの場所。\u003ccode\u003ewhere hg\u003c/code\u003eすれば教えてくれるだろう\u003cbr\u003e\nもう一つはhhc.exeの場所。デフォルトでは\u003ccode\u003e\"C:\\Program Files (x86)\\HTML Help Workshop\\hhc.exe\"\u003c/code\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ビルド\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%93%E3%83%AB%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eビルド\u003c/h3\u003e\n\n\u003cp\u003eビルドにはとても時間がかかる。PCを放置して別の作業をしたいが、PGOビルドをするときにネットワーク接続をしようとしてWindowsのファイアウォールから許諾画面が出てくる。ただまあビルドの最終盤で気がついて許可したけど多分間に合ってなかったろうし、やっぱり放置してもいい気がする。\u003c/p\u003e\n\n\u003cp\u003eビルドコマンドは極めてシンプルだ。\u003ccode\u003e-o\u003c/code\u003eにはビルド成果物を置く場所を指定する。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nf\"\u003ecd\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eTools\\msi\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nf\"\u003ebuildrelease.bat\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-x64\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-o\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\\tmp\\python\"\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e最終的に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e               Total    Copied   Skipped  Mismatch    FAILED    Extras\n    Dirs :         1         0         1         0         0         0\n   Files :        71        28        43         0         0         0\n   Bytes :   96.69 m   49.61 m   47.08 m         0         0         0\n   Times :   0:00:00   0:00:00                       0:00:00   0:00:00\n\n\n   Speed :           481735111 Bytes/sec.\n   Speed :           27565.104 MegaBytes/min.\n   Ended : 2019年8月27日 17:26:31\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのようなログが出て終わった。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"install\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#install\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003einstall\u003c/h2\u003e\n\n\u003cp\u003e先程\u003ccode\u003e-o\u003c/code\u003eで指定したディレクトリに\u003ccode\u003eamd64\u003c/code\u003eというディレクトリが作られているはずだ。\u003ccode\u003epython-3.6.9-amd64.exe\u003c/code\u003eがよくお見かけするpythonのインストーラーだ。\u003c/p\u003e\n\n\u003cp\u003eこれを実行する。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"codelldbよ動け\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#codelldb%E3%82%88%E5%8B%95%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCodeLLDBよ、動け\u003c/h1\u003e\n\n\u003cp\u003eVSCodeの設定を\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"json\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nl\"\u003e\"lldb.launch.env\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"PATH\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003ePython36\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n  \u003c/span\u003e\u003cspan class=\"nl\"\u003e\"PYTHONPATH\"\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"s2\"\u003e\"C:\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003ePython36\u003c/span\u003e\u003cspan class=\"se\"\u003e\\\\\u003c/span\u003e\u003cspan class=\"s2\"\u003eLib\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e見直してリベンジだ。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fbceba0e6-1103-261c-7932-a88bc462ef39.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9d49ca235aa07f43995c1aab3e3699e2\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fbceba0e6-1103-261c-7932-a88bc462ef39.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9d49ca235aa07f43995c1aab3e3699e2\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/bceba0e6-1103-261c-7932-a88bc462ef39.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fbceba0e6-1103-261c-7932-a88bc462ef39.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e2e378e1fa2d51e449e0b30db27607a7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e動いた。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"余談\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談\u003c/h1\u003e\n\n\u003cp\u003e大体同じ話が\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://yumetodo.hateblo.jp/entry/2019/08/27/003655\" rel=\"nofollow noopener\" target=\"_blank\"\u003epython 3.6.9をWindowsでx64 Release buildした - yumetodoの旅とプログラミングとかの記録\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://yumetodo.hateblo.jp/entry/2019/08/27/183346\" rel=\"nofollow noopener\" target=\"_blank\"\u003epython 3.6.9をもっとガチでWindows10でx64 Release buildした - yumetodoの旅とプログラミングとかの記録\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eに書いてあるのですが、せっかくなのでQiitaにもあげようとこの記事を書いたわけです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"追記\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E8%A8%98\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e追記\u003c/h1\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/vadimcn/vscode-lldb/issues/205#issuecomment-557977394\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/vadimcn/vscode-lldb/issues/205#issuecomment-557977394\u003c/a\u003e\u003cbr\u003e\nvadimcn commented on 25 Nov 2019\u003c/p\u003e\n\n\u003cp\u003eAs of v1.4.0, codelldb will use whatever Python 3 (\u0026gt;=3.3) you've got.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003ePython3系なら動くってことになったぽい。やったぜ。\u003c/p\u003e\n","body":"# はじまり(ポエム)\n\n私はRustのプログラムを愛用しているVisual Studio Codeで書いていた。\n\n\nデバッグするかーとどうやってデバッグするか調べた。\n\n[Visual Studio CodeでRustのコード補完・タスク・Debug実行](https://qiita.com/kat_out/items/cf89a8dffb4e0629948a)\n\nなるほど、[CodeLLDB](https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb)というのがあるらしい。\n\n私はCodeLLDBをポチッと導入し、設定を書き起動しようとした。\n\n\u003e CodeLLDB requires Python 3.6(64bit), but looks like it is not installed on this machine\n\nPython必要なの！？あれ、でもPython入れてなかったっけ・・・\n\n```\npython -V\nPython 3.2.2\n```\n\n古すぎ！\n\nはいはい、chocolateyで入れましょうね～\n\n```\nchoco install python3 -y\n```\n\n```\npython -V\nPython 3.7.4\n```\n\nあれ、なんか3.7が降ってきた。まあ3.6って言ってたけど動くでしょ！\n\n\u003e CodeLLDB requires Python 3.6(64bit), but looks like it is not installed on this machine\n\n希望は打ち砕かれた。\n\n\u003e [got error : CodeLLDB requires Python 3.6(64bit), but looks like it is not installed on this machine · Issue #157 · vadimcn/vscode-lldb](https://github.com/vadimcn/vscode-lldb/issues/157)\n\u003e\n\u003eI got the same error,\n\u003e![image](https://user-images.githubusercontent.com/46454174/50803179-b1352c80-130f-11e9-957a-f832b4708b2f.png)\n\u003e\n\u003eI have found a difference in registry. Python is registered under \"HKEY_CURRENT_USER\" but not under \"HKEY_LOCAL_MACHINE\" .\n\nなるほど、レジストリ見てんのか。偽装してみるか。\n\nところが`python36.dll`が見つからないとのたまってきた。\n\n![dll](https://file.qiitadon.com/media_attachments/files/001/425/186/original/a21f8b89d26eabad.png)\n\nなんでDLLの場所設定でいじれないの？\n私はIssueを投げた。\n[Why does the python version is locked as 3.6 only for Windows? · Issue #205 · vadimcn/vscode-lldb](https://github.com/vadimcn/vscode-lldb/issues/205)\n\nしかしそうはいっても始まらぬ。なんとかしてPython3.6を手に入れねばならぬ。\n\n[Python Releases for Windows | Python.org](https://www.python.org/downloads/windows/)\n\n3.6系統の最新リリースは・・・3.6.9か。リンクを踏んだ私に待ち受けていたのは・・・\n\n[Python Release Python 3.6.9 | Python.org](https://www.python.org/downloads/release/python-369/)\n\n**ソースコードしか配布されていないという現実だった**\n\n・・・**これはビルドするしかない！** 一つ前の3.6.8を使うという発想が何故かなかった私はビルドする道へ進んだ。最近はC++書いてなくてTypeScriptばっか書いてるけどVisual Studioくらい入ってるし余裕でしょ、そう思っていた。\n\n開発者コマンドプロンプトで配布されているソースコードを展開したディレクトリの中の`PCbuild`に移動して\n\n```\nbuild.bat -p x64 -c Release\n```\n\nとし、ビルドした。[なんかエラーが出たり型変換周りの(`int`を`void*`にキャストして配列に格納しまた`int`にキャストして使うとかいうコードが原因、これ書いたやつ正気か？これだからC言語使い共は・・・)警告がどっさり出た](https://qiitadon.com/web/statuses/102683814399014503)が、とにかく終わった。\n\nレジストリを偽装し、VSCodeの設定で\"lldb.launch.env\"の`PATH`を書いて動かした。\n\n```\nFatal Python error: Py_Initialize: unable to load the file system codec\nImport Error: No module named 'encodings' \n```\n\n**これなにか足りてないやつだ**、そう悟った私はとりあえず眠り、リフレッシュした脳みそで本気で取り組むことにした。\n\n# 本気でビルドする\n\n## ビルドの準備\n\n改めてビルドの準備をしていく。\n\n### .NET 3.5\n\nWindows10では.NET 3.5がデフォルトで無効になっている。\n[.NET Framework 3.5 を有効化する手順について ( Windows 10 ) | Ask CORE](https://blogs.technet.microsoft.com/askcorejp/2018/10/05/enable_net35_win10/)\nに従って有効化する。\n\n### Visual Studio\n\n2015以上であればよい。私はVisual Studio 2019を選んだ。C#とC++のコンパイルが普通にできれば十分だとは思うが、なんせ私の環境にはいろいろ入れているので最小構成がよくわからない。\n\n`MSVC v140 - VS2015 C++ ビルドツール`とかも必要である可能性はある。\n\nまあなんなら下にVS installerの構成ファイル置いておくので適宜いじって読み込ませてほしい。\n\n[https://gist.github.com/yumetodo/c48152a7512356db33bb2c0994610359](https://gist.github.com/yumetodo/c48152a7512356db33bb2c0994610359)\n\n### choclatey\n\n必須というわけではないが、ないと説明が面倒くさいので。\n\n[https://chocolatey.org/install](https://chocolatey.org/install)\n\nにあるとおりに入れてほしい。\n\n### Mercurial\n\n管理者権限のあるPowershellないしコマンドプロンプトで\n\n```\nchoco install hg -y\n```\n\n### Python\n\nPythonをビルドするにはPythonが必要である。おおっと、鶏と卵の問題というかブートストラップ問題だ。\n\n```\nchoco install python3 -y\n```\n\n#### sphinx\n\nさっそくPythonについてくるpipの出番だ。\n\n```\npip install Sphinx\n```\n\n### Tcl\n\nこれがなんなのかわかっていないがとにかく必要らしい。なんとなくIDLEのためじゃないかという気がするが・・・。\n\n[ftp://ftp.tcl.tk/pub/tcl/tcl8_6/](ftp://ftp.tcl.tk/pub/tcl/tcl8_6/)\n\nから`tcl-core8.6.6-src.tar.gz`をダウンロードする。\n\n### HTML Help Workshop\n\nVisual Studio 2017以降のインストーラーでは入れられないので自分で持ってくる必要がある。\n[Microsoft HTML Help Downloads | Microsoft Docs](https://docs.microsoft.com/ja-jp/previous-versions/windows/desktop/htmlhelp/microsoft-html-help-downloads)\n`Download Htmlhelp.exe`をクリック。ダウンロードしたら実行してどんどん次に進んでいけば終わる。\n\n## Build\n\n### Download \u0026 展開\n\n[Python Release Python 3.6.9 | Python.org](https://www.python.org/downloads/release/python-369/)\n\nXZ compressed source tarballを落として展開する。\n\n### 追加のファイル配置\n\nその中に`externals`というディレクトリを作る。そこに`tcl-core8.6.6-src.tar.gz`を展開する。フォルダー名は`tcl-core-8.6.6.0`に。これをやらないと、下のようなエラーに見舞われる。\n\n![error](https://file.qiitadon.com/media_attachments/files/001/425/010/original/7dff6df9d53fe486.png)\n\n### 環境変数の設定\n\nVSの開発者コマンドプロンプトを立ち上げる。以下の環境変数を設定する。\n\n```powershell\nset PYTHON=\"C:\\Python37\\python.exe\"\n```\n\npython2.7もしくは3.4以降の`python.exe`のフルパス。\n今回はchocolateyで入れているから`\"C:\\Python37\\python.exe\"`\n\n```powershell\nset SPHINXBUILD=\"C:\\Python37\\Scripts\\sphinx-build.exe\"\n```\n\n`where sphinx-build`すれば教えてくれるだろう。\n\n```powershell\nset PATH=\"C:\\Program Files\\Mercurial\\hg.exe\";\"C:\\Program Files (x86)\\HTML Help Workshop\\hhc.exe\";%PATH%\n```\n\n１つ目はhg.exeの場所。`where hg`すれば教えてくれるだろう\nもう一つはhhc.exeの場所。デフォルトでは`\"C:\\Program Files (x86)\\HTML Help Workshop\\hhc.exe\"`\n\n### ビルド\n\nビルドにはとても時間がかかる。PCを放置して別の作業をしたいが、PGOビルドをするときにネットワーク接続をしようとしてWindowsのファイアウォールから許諾画面が出てくる。ただまあビルドの最終盤で気がついて許可したけど多分間に合ってなかったろうし、やっぱり放置してもいい気がする。\n\nビルドコマンドは極めてシンプルだ。`-o`にはビルド成果物を置く場所を指定する。\n\n```powershell\ncd Tools\\msi\nbuildrelease.bat -x64 -o \"C:\\tmp\\python\"\n```\n\n最終的に\n\n```\n               Total    Copied   Skipped  Mismatch    FAILED    Extras\n    Dirs :         1         0         1         0         0         0\n   Files :        71        28        43         0         0         0\n   Bytes :   96.69 m   49.61 m   47.08 m         0         0         0\n   Times :   0:00:00   0:00:00                       0:00:00   0:00:00\n\n\n   Speed :           481735111 Bytes/sec.\n   Speed :           27565.104 MegaBytes/min.\n   Ended : 2019年8月27日 17:26:31\n```\n\nのようなログが出て終わった。\n\n## install\n\n先程`-o`で指定したディレクトリに`amd64`というディレクトリが作られているはずだ。`python-3.6.9-amd64.exe`がよくお見かけするpythonのインストーラーだ。\n\nこれを実行する。\n\n# CodeLLDBよ、動け\n\nVSCodeの設定を\n\n```json\n\"lldb.launch.env\": {\n  \"PATH\": \"C:\\\\Python36\",\n  \"PYTHONPATH\": \"C:\\\\Python36\\\\Lib\",\n}\n```\n\n見直してリベンジだ。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/bceba0e6-1103-261c-7932-a88bc462ef39.png)\n\n動いた。\n\n# 余談\n\n大体同じ話が\n\n- [python 3.6.9をWindowsでx64 Release buildした - yumetodoの旅とプログラミングとかの記録](https://yumetodo.hateblo.jp/entry/2019/08/27/003655)\n- [python 3.6.9をもっとガチでWindows10でx64 Release buildした - yumetodoの旅とプログラミングとかの記録](https://yumetodo.hateblo.jp/entry/2019/08/27/183346)\n\nに書いてあるのですが、せっかくなのでQiitaにもあげようとこの記事を書いたわけです。\n\n# 追記\n\n\u003e https://github.com/vadimcn/vscode-lldb/issues/205#issuecomment-557977394\n\u003e vadimcn commented on 25 Nov 2019\n\u003e\n\u003e As of v1.4.0, codelldb will use whatever Python 3 (\u003e=3.3) you've got.\n\nPython3系なら動くってことになったぽい。やったぜ。\n","coediting":false,"comments_count":0,"created_at":"2019-08-27T20:51:39+09:00","group":null,"id":"4b0a095abb60c77d0ab8","likes_count":9,"private":false,"reactions_count":0,"tags":[{"name":"Python","versions":[]},{"name":"Rust","versions":[]},{"name":"Python3","versions":[]},{"name":"VSCode","versions":[]}],"title":"俺はRustのDebugをしようとしていた。そうしたらpython 3.6.9をWindows10でx64 Release buildしていた","updated_at":"2020-02-18T22:50:26+09:00","url":"https://qiita.com/yumetodo/items/4b0a095abb60c77d0ab8","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\u003cp\u003eなんか毎回探し回ってる気がするのでメモしておく。\u003c/p\u003e\n\n\u003cp\u003emsys2のuser homeではなくてwindowsのuser home dir(\u003ccode\u003eC:\\Users\\yumetodo\u003c/code\u003eとか)に\u003ccode\u003e.npmrc\u003c/code\u003eがあるのでその中にある。\u003c/p\u003e\n\n\u003cp\u003eほかは多数解説のある通り\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/KamataRyo/items/6e795c6734f9a775f5a6\" id=\"reference-09eead613c799b12adea\"\u003eTravis CIを使ってnpmを継続的に公開・メンテナンスするよ\u003c/a\u003e\u003c/p\u003e\n","body":"なんか毎回探し回ってる気がするのでメモしておく。\n\nmsys2のuser homeではなくてwindowsのuser home dir(`C:\\Users\\yumetodo`とか)に`.npmrc`があるのでその中にある。\n\nほかは多数解説のある通り\n\n[Travis CIを使ってnpmを継続的に公開・メンテナンスするよ](https://qiita.com/KamataRyo/items/6e795c6734f9a775f5a6)\n","coediting":false,"comments_count":0,"created_at":"2019-08-10T14:09:23+09:00","group":null,"id":"a9b61c7893fff941909c","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"npm","versions":[]},{"name":"msys2","versions":[]},{"name":"nvm-windows","versions":[]}],"title":"msys2環境でnvm-windowsでnpmを管理している人のための_authTokenの探し方","updated_at":"2019-08-10T14:09:23+09:00","url":"https://qiita.com/yumetodo/items/a9b61c7893fff941909c","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003eVSCodeには\u003ca href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRemote Development\u003c/a\u003eという拡張があります。まだPreview版ですが、出てからそこそこ経ったので試してみました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h1\u003e\n\n\u003cp\u003eおそらくssh-agentのからみから、msys2のsshを使うのはうまく行かず、Windows10標準搭載のsshを使うことになります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"前提\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%89%8D%E6%8F%90\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e前提\u003c/h1\u003e\n\n\u003cp\u003emsys2から普通に目的のサーバーにコマンドラインでsshできる状態。もちろんパスワード認証なんかじゃなくて公開鍵認証で。\u003ccode\u003e~/.ssh/config\u003c/code\u003eには\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"apache\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e~/.ssh/config\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eHost irregular-at-tus.work\n    IdentityFile ~/key_webarena/key_webarena\n    \u003cspan class=\"nc\"\u003ePort\u003c/span\u003e 110\n    \u003cspan class=\"nc\"\u003eUser\u003c/span\u003e yumetodo\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003cp\u003eのようにある。つまり\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e├─.ssh\n│  ├─config\n│  └─known_hosts\n├─key_webarena\n│  ├─key_webarena\n│  └─key_webarena.pub\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのようなdirectory構成。\u003c/p\u003e\n\n\u003cp\u003eこの記事でのSSH先はWebARENAのVPSで動いているUbuntu 18.04 Server。\u003c/p\u003e\n\n\u003cp\u003eWindowsでsshするのにmsys2ないしgit-bash使ってないとか有りえんので、この段階に至ってない場合は多分この拡張にお世話になることはないはず。\u003c/p\u003e\n\n\u003cp\u003eremoteは今の所\u003ccode\u003eglibc\u003c/code\u003eベースで動いているx86_64なLinux環境のみ対応。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"windows10標準搭載のsshとmsys2のpacmanで落とせるsshで設定を共有しつつsshできるように\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#windows10%E6%A8%99%E6%BA%96%E6%90%AD%E8%BC%89%E3%81%AEssh%E3%81%A8msys2%E3%81%AEpacman%E3%81%A7%E8%90%BD%E3%81%A8%E3%81%9B%E3%82%8Bssh%E3%81%A7%E8%A8%AD%E5%AE%9A%E3%82%92%E5%85%B1%E6%9C%89%E3%81%97%E3%81%A4%E3%81%A4ssh%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWindows10標準搭載のsshとmsys2のpacmanで落とせるsshで設定を共有しつつsshできるように\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"シンボリックリンクを貼る\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AA%E3%83%83%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%92%E8%B2%BC%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eシンボリックリンクを貼る\u003c/h2\u003e\n\n\u003cp\u003eまずは\u003ccode\u003e~/.ssh/config\u003c/code\u003eおよび設定で参照している認証鍵にシンボリックリンクを貼ります。\u003c/p\u003e\n\n\u003cp\u003eコマンドプロンプトを立ち上げ以下のように。ユーザー名は適宜読み替えてください。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bat\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\Users\\yumetodo\u0026gt;mklink \u003cspan class=\"na\"\u003e/D \u003c/span\u003e.ssh \u003cspan class=\"s2\"\u003e\"C:\\msys64\\home\\yumetodo\\.ssh\"\u003c/span\u003e\n.ssh \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;===\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\.ssh のシンボリック リンクが作成されました\n\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\Users\\yumetodo\u0026gt;mklink \u003cspan class=\"na\"\u003e/D \u003c/span\u003e\u003cspan class=\"kd\"\u003ekey_webarena\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"C:\\msys64\\home\\yumetodo\\key_webarena\"\u003c/span\u003e\n\u003cspan class=\"kd\"\u003ekey_webarena\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;===\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\key_webarena のシンボリック リンクが作成されました\n\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\Users\\yumetodo\u0026gt;dir \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"nb\"\u003efindstr\u003c/span\u003e \u003cspan class=\"kd\"\u003eSY\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2017\u003c/span\u003e/11/17  \u003cspan class=\"m\"\u003e13\u003c/span\u003e:03    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kd\"\u003eSYMLINKD\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e     .gnupg \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\.gnupg\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2019\u003c/span\u003e/08/05  \u003cspan class=\"m\"\u003e20\u003c/span\u003e:46    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kd\"\u003eSYMLINKD\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e     .ssh \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\.ssh\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003cspan class=\"m\"\u003e2019\u003c/span\u003e/08/01  \u003cspan class=\"m\"\u003e01\u003c/span\u003e:01    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kd\"\u003eSYMLINKD\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e     \u003cspan class=\"kd\"\u003ekey_webarena\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\key_webarena\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003e.gnupg\u003c/code\u003eは別件なので気になさらずに・・・。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"鍵のあるdirectoryの権限設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%8D%B5%E3%81%AE%E3%81%82%E3%82%8Bdirectory%E3%81%AE%E6%A8%A9%E9%99%90%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e鍵のあるdirectoryの権限設定\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003e~/.ssh/config\u003c/code\u003eの\u003ccode\u003eIdentityFile\u003c/code\u003eで指定した鍵ファイルがあるdirectoryをWindowsのエクスプローラーからたどり、プロパティ→セキュリティで以下の画面が開きます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F4ac4e048-e51e-b99b-e854-2d2db4d96a12.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6b5b3510565f042d3c3d30df862a4375\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F4ac4e048-e51e-b99b-e854-2d2db4d96a12.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6b5b3510565f042d3c3d30df862a4375\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/4ac4e048-e51e-b99b-e854-2d2db4d96a12.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F4ac4e048-e51e-b99b-e854-2d2db4d96a12.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=0b2579456ab1dcfb6e3cd109e3cc020a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eさらに詳細設定を押すと以下の画面が開きます。\u003c/p\u003e\n\n\u003cp\u003eここで継承の無効化を押します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F1f30677c-ef0d-ac83-13a3-e99c90cd746d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=21fd10bb098735bc563c8d3d75237d19\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F1f30677c-ef0d-ac83-13a3-e99c90cd746d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=21fd10bb098735bc563c8d3d75237d19\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/1f30677c-ef0d-ac83-13a3-e99c90cd746d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F1f30677c-ef0d-ac83-13a3-e99c90cd746d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=45879469e7573c7e7ba29c841f4a51fb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e確認画面がでるので変換します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fbc0a5c60-37c0-9aab-578e-690e82a5fdce.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c6951fcaab7fc77cbc7dca26ac28af76\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fbc0a5c60-37c0-9aab-578e-690e82a5fdce.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=c6951fcaab7fc77cbc7dca26ac28af76\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/bc0a5c60-37c0-9aab-578e-690e82a5fdce.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fbc0a5c60-37c0-9aab-578e-690e82a5fdce.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1fcf9043277937827ac7006907bde03b 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eすると編集ができるようになるので、「Users」と「Authenticated Users」を削除します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F09789002-b245-4a36-8fa8-774b62436465.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5b1b3ba0526ba49879dcaaa93e6cfad0\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F09789002-b245-4a36-8fa8-774b62436465.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5b1b3ba0526ba49879dcaaa93e6cfad0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/09789002-b245-4a36-8fa8-774b62436465.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F09789002-b245-4a36-8fa8-774b62436465.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2e71efb270d009a1036ed1477684cb49 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e追加を押します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F10e68e9a-c6d6-3f15-ef59-eed4702f9adf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4d3791ec517a6bfae356b4a0bfa28d46\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F10e68e9a-c6d6-3f15-ef59-eed4702f9adf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4d3791ec517a6bfae356b4a0bfa28d46\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/10e68e9a-c6d6-3f15-ef59-eed4702f9adf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F10e68e9a-c6d6-3f15-ef59-eed4702f9adf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=be90edf5a96fb82cfe35452223e3036a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eプリンシパルの選択を押します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F8b85326c-07fb-0e03-2197-1db804174d5b.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fa6951350ac22c4b216a849864c06214\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F8b85326c-07fb-0e03-2197-1db804174d5b.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fa6951350ac22c4b216a849864c06214\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/8b85326c-07fb-0e03-2197-1db804174d5b.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F8b85326c-07fb-0e03-2197-1db804174d5b.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6fa33b2c2e9edf4607707b9ad5a701cf 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e自分のWindowsログインユーザー名を入れて、「名前の確認」を押します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff69a841f-05d8-12ce-ff2c-b846a21cdb51.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=642329296c5cd1d57bb7c0e47266864d\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff69a841f-05d8-12ce-ff2c-b846a21cdb51.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=642329296c5cd1d57bb7c0e47266864d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f69a841f-05d8-12ce-ff2c-b846a21cdb51.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff69a841f-05d8-12ce-ff2c-b846a21cdb51.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=fc32ebfa66b14964915b85be3322fece 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eサジェストされるのでOKで閉じます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fca0696ec-4d96-7cca-5617-cedf02a13008.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3cacda55424b871f12e7001606f1e51b\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fca0696ec-4d96-7cca-5617-cedf02a13008.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3cacda55424b871f12e7001606f1e51b\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/ca0696ec-4d96-7cca-5617-cedf02a13008.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fca0696ec-4d96-7cca-5617-cedf02a13008.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=57c3ee922d09bebdf9d69b52450e3aa5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e「フルコントロール」にチェックを付けてOKします。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F68d308b0-ece8-b640-8b8b-db21eaa32dbf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8eff607bac487aa326a789f226446156\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F68d308b0-ece8-b640-8b8b-db21eaa32dbf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8eff607bac487aa326a789f226446156\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/68d308b0-ece8-b640-8b8b-db21eaa32dbf.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F68d308b0-ece8-b640-8b8b-db21eaa32dbf.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=2837f8938651270cac35d6b6e368de83 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e最終的にこんな感じになっているはず・・・。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fb9a65204-1d83-ef0b-88ba-bf5a347d3028.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=78b13bcfaccae28c5691793f1288dad5\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fb9a65204-1d83-ef0b-88ba-bf5a347d3028.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=78b13bcfaccae28c5691793f1288dad5\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/b9a65204-1d83-ef0b-88ba-bf5a347d3028.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fb9a65204-1d83-ef0b-88ba-bf5a347d3028.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=892840a016b6510390af1b44b10940b8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eOKで閉じます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sshconfigの権限設定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sshconfig%E3%81%AE%E6%A8%A9%E9%99%90%E8%A8%AD%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e~/.ssh/config\u003c/code\u003eの権限設定\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003e~/.ssh/config\u003c/code\u003eをWindowsのExplorerからたどってプロパティを開いて先ほどと同様に設定してきます。ただし以下の画面で「フルコントロール」ではなく「変更」に。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff756752a-9c73-abb0-0ff9-8f17cacedace.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b0bde73f87ced5c4ea011967bc4ef461\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff756752a-9c73-abb0-0ff9-8f17cacedace.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b0bde73f87ced5c4ea011967bc4ef461\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f756752a-9c73-abb0-0ff9-8f17cacedace.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff756752a-9c73-abb0-0ff9-8f17cacedace.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c8a8914f38a964d1d46029d09edb917f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ssh-agentの有効化\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ssh-agent%E3%81%AE%E6%9C%89%E5%8A%B9%E5%8C%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003essh-agent\u003c/code\u003eの有効化\u003c/h2\u003e\n\n\u003cp\u003e他にもやり方はあるのですがコマンドラインからやるなら、管理者権限のPowerShellを立ち上げて\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"powershell\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nf\"\u003eSet-Service\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003essh-agent\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nt\"\u003e-StartupType\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003eAutomatic\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nf\"\u003eStart-Service\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003essh-agent\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003cspan class=\"nf\"\u003eGet-Service\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nx\"\u003essh-agent\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとすればいいです。GUIからやるなら\u003ccode\u003eService\u003c/code\u003eで検索して\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F85d5d64c-1bdc-0969-b5b0-ef7a3833b2ce.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9475d1d4f7db1bb801eb77deb028569e\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F85d5d64c-1bdc-0969-b5b0-ef7a3833b2ce.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9475d1d4f7db1bb801eb77deb028569e\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/85d5d64c-1bdc-0969-b5b0-ef7a3833b2ce.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F85d5d64c-1bdc-0969-b5b0-ef7a3833b2ce.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4330405afae5bc450cdf881fe0113198 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eOpenSSH Authentication Agent\u003c/code\u003eを探して\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F130ef055-927d-3347-2733-6da9ef83d3f4.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bc0b22425c54574672f3abe99371f9bd\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F130ef055-927d-3347-2733-6da9ef83d3f4.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bc0b22425c54574672f3abe99371f9bd\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/130ef055-927d-3347-2733-6da9ef83d3f4.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F130ef055-927d-3347-2733-6da9ef83d3f4.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=94f5b98768efa2b2317001246b82ddad 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eスタートアップの種類を「自動」もしくは「自動（遅延起動）」にすればいいです。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F6dc471bb-6556-87aa-2513-cb1d91574ba6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f64c5a6ce4ea8e54f0bf048a7ed42622\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F6dc471bb-6556-87aa-2513-cb1d91574ba6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f64c5a6ce4ea8e54f0bf048a7ed42622\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/6dc471bb-6556-87aa-2513-cb1d91574ba6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F6dc471bb-6556-87aa-2513-cb1d91574ba6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a55362720595c9ea31ff23e34a7cf48d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ssh-add\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ssh-add\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003essh-add\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"bat\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\Users\\yumetodo\u0026gt;ssh\u003cspan class=\"na\"\u003e-add \u003c/span\u003e\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\key_webarena\\key_webarena\n\u003cspan class=\"kd\"\u003eEnter\u003c/span\u003e \u003cspan class=\"kd\"\u003epassphrase\u003c/span\u003e \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\key_webarena\\key_webarena:\n\u003cspan class=\"kd\"\u003eIdentity\u003c/span\u003e \u003cspan class=\"kd\"\u003eadded\u003c/span\u003e: \u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\msys64\\home\\yumetodo\\key_webarena\\key_webarena \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003eyume\u003c/span\u003e\u003cspan class=\"na\"\u003e-wikijp\u003c/span\u003e@live.jp\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003cspan class=\"kd\"\u003eC\u003c/span\u003e:\\Users\\yumetodo\u0026gt;ssh\u003cspan class=\"na\"\u003e-add -l\n\u003c/span\u003e\u003cspan class=\"m\"\u003e4096\u003c/span\u003e \u003cspan class=\"kd\"\u003eSHA256\u003c/span\u003e\u003cspan class=\"nl\"\u003e:P\u003c/span\u003e\u003cspan class=\"m\"\u003e81\u003c/span\u003e\u003cspan class=\"kd\"\u003eNFT\u003c/span\u003e\u003cspan class=\"na\"\u003e/HJeeQk\u003c/span\u003e\u003cspan class=\"m\"\u003e1\u003c/span\u003e\u003cspan class=\"kd\"\u003ejXGzZeZ4cQ\u003c/span\u003e\u003cspan class=\"na\"\u003e/XGLDKnDbgxHmFMhDgU \u003c/span\u003e\u003cspan class=\"kd\"\u003eyume\u003c/span\u003e\u003cspan class=\"na\"\u003e-wikijp\u003c/span\u003e@live.jp \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003eRSA\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ssh\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ssh\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003essh\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"text\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003eC:\\Users\\yumetodo\u0026gt;ssh irregular-at-tus.work\nwarning: agent returned different signature type ssh-rsa (expected rsa-sha2-512)\nWelcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-55-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\nWelcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-55-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Mon Aug  5 20:50:22 JST 2019\n\n  System load:  0.0                Processes:           130\n  Usage of /:   46.4% of 19.56GB   Users logged in:     0\n  Memory usage: 36%                IP address for ens3: 140.227.235.169\n  Swap usage:   6%\n\n * MicroK8s 1.15 is out! Thanks to all 40 contributors, you get the latest\n   greatest upstream Kubernetes in a single package.\n\n     https://github.com/ubuntu/microk8s\n\n * Canonical Livepatch is available for installation.\n   - Reduce system reboots and improve kernel security. Activate at:\n     https://ubuntu.com/livepatch\n\n5 packages can be updated.\n2 updates are security updates.\n\n\nLast login: Mon Aug  5 20:32:52 2019 from 119.173.37.16\nAgent pid 26403\n\nyumetodo@btgf1b8n ~\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"vscodeでsshできるまで\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#vscode%E3%81%A7ssh%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%BE%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003evscodeでSSHできるまで\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"拡張の導入\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8B%A1%E5%BC%B5%E3%81%AE%E5%B0%8E%E5%85%A5\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e拡張の導入\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRemote Development\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eを入れます。\u003c/p\u003e\n\n\u003cp\u003e設定は特に弄ることはないです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"接続\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%8E%A5%E7%B6%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e接続\u003c/h2\u003e\n\n\u003cp\u003e\u003ckbd\u003eCtrl\u003c/kbd\u003e+\u003ckbd\u003eShift\u003c/kbd\u003e+ \u003ckbd\u003eP\u003c/kbd\u003eでコマンドパレットを開いて、\u003ccode\u003eRemote-SSH: Connect to Host\u003c/code\u003eを選びます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9241c16f-c64b-9a32-08c5-73d7a528f392.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=31b9e3f1abf2f98ebf7e36dff3483267\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9241c16f-c64b-9a32-08c5-73d7a528f392.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=31b9e3f1abf2f98ebf7e36dff3483267\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/9241c16f-c64b-9a32-08c5-73d7a528f392.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F9241c16f-c64b-9a32-08c5-73d7a528f392.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=95943fdeb43202d2b523352a56cdf7a7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e~/.ssh/config\u003c/code\u003eに書いたHostが列挙されます。接続したい先を選びます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F4374a01e-f093-6ed9-a7fa-11203e544ccd.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f35db0131a2fbc8981e8f03777709d1d\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F4374a01e-f093-6ed9-a7fa-11203e544ccd.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f35db0131a2fbc8981e8f03777709d1d\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/4374a01e-f093-6ed9-a7fa-11203e544ccd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F4374a01e-f093-6ed9-a7fa-11203e544ccd.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=217d143bbfb1b261c8794350d4ea6598 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e接続中・・・\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3b55f2ad-a3e3-7b74-f416-3a8cc1f5b8bc.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=88f8e3b9a9e577399c3792c98f561029\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3b55f2ad-a3e3-7b74-f416-3a8cc1f5b8bc.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=88f8e3b9a9e577399c3792c98f561029\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/3b55f2ad-a3e3-7b74-f416-3a8cc1f5b8bc.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3b55f2ad-a3e3-7b74-f416-3a8cc1f5b8bc.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7eb565ff373c946a63f415ec09d3d5f1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eうまくいけば\u003ccode\u003eActivating Extensions...\u003c/code\u003eと下に出てきます。それが終われば使えます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fb2505e51-223c-3eae-32f3-ab1590d98e07.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6541778e6bc5a52f9a392fe42073cd59\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fb2505e51-223c-3eae-32f3-ab1590d98e07.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=6541778e6bc5a52f9a392fe42073cd59\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/b2505e51-223c-3eae-32f3-ab1590d98e07.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fb2505e51-223c-3eae-32f3-ab1590d98e07.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8011d0db9eb205db2a510b5608fdd1c8 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"試しに適当なdirectoryを開いてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A9%A6%E3%81%97%E3%81%AB%E9%81%A9%E5%BD%93%E3%81%AAdirectory%E3%82%92%E9%96%8B%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e試しに適当なDirectoryを開いてみる\u003c/h2\u003e\n\n\u003cp\u003eファイラータブを開くと\u003ccode\u003eOpen Folder\u003c/code\u003eというボタンが見えます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff5f345d7-d4ab-81ae-33d6-bcb988f922df.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=54450c3aa48235356b09d0037a30b7a7\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff5f345d7-d4ab-81ae-33d6-bcb988f922df.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=54450c3aa48235356b09d0037a30b7a7\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f5f345d7-d4ab-81ae-33d6-bcb988f922df.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Ff5f345d7-d4ab-81ae-33d6-bcb988f922df.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4ae2362ec5b55ad462d5bd54ce3a27fb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e押すと現在(\u003ccode\u003eHOME\u003c/code\u003e directory)のリストが出てきます。試しに \u003ca href=\"/Gaccho\" class=\"user-mention js-hovercard\" title=\"Gaccho\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"Gaccho\"\u003e@Gaccho\u003c/a\u003e さんの \u003ca href=\"https://github.com/Kasugaccho/DungeonTemplateLibrary\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDungeonTemplateLibrary\u003c/a\u003eをたまたまCloneしてあったのでこれを開いてみます(謎の宣伝)。\u003c/p\u003e\n\n\u003cp\u003eカーソルを合わしてOKを\u003cstrong\u003e2回\u003c/strong\u003e押します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fa127996d-dafc-7beb-3b67-f8e60c831f1a.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=57ad2a3c053bd4e1b41df900a2e472b3\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fa127996d-dafc-7beb-3b67-f8e60c831f1a.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=57ad2a3c053bd4e1b41df900a2e472b3\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/a127996d-dafc-7beb-3b67-f8e60c831f1a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fa127996d-dafc-7beb-3b67-f8e60c831f1a.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=e14956902f655e8cf3453a3ace326608 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e開けました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F83bc6e7d-a428-0c85-39d5-15dc3307b4c6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=943a5e24715f32ea1591675b041d9d6c\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F83bc6e7d-a428-0c85-39d5-15dc3307b4c6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=943a5e24715f32ea1591675b041d9d6c\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/83bc6e7d-a428-0c85-39d5-15dc3307b4c6.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F83bc6e7d-a428-0c85-39d5-15dc3307b4c6.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=94252378463a09df91403d06bc585a6a 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"端末を開いてみる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%AB%AF%E6%9C%AB%E3%82%92%E9%96%8B%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e端末を開いてみる\u003c/h2\u003e\n\n\u003cp\u003e\u003ckbd\u003eCtrl\u003c/kbd\u003e+\u003ckbd\u003eShift\u003c/kbd\u003e+ \u003ckbd\u003e@\u003c/kbd\u003eでとくに何も苦戦せずに端末が立ち上がって普通に使える。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3c8cbafd-4a4a-46dd-ba17-befbeb62095f.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8928f2c9aea155204256f0590ebc8d0a\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3c8cbafd-4a4a-46dd-ba17-befbeb62095f.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8928f2c9aea155204256f0590ebc8d0a\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/3c8cbafd-4a4a-46dd-ba17-befbeb62095f.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F3c8cbafd-4a4a-46dd-ba17-befbeb62095f.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=34573bab2e7959c2306559d1a774f0dd 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"次のステップ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AC%A1%E3%81%AE%E3%82%B9%E3%83%86%E3%83%83%E3%83%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e次のステップ\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://code.visualstudio.com/docs/remote/troubleshooting\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio Code Remote Development Troubleshooting Tips and Tricks\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcode.visualstudio.com%2Fassets%2Fdocs%2Fremote%2Fssh%2Farchitecture-ssh.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cd533ebc88a3cc164dea371dcfdf523d\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcode.visualstudio.com%2Fassets%2Fdocs%2Fremote%2Fssh%2Farchitecture-ssh.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=cd533ebc88a3cc164dea371dcfdf523d\" alt=\"SSH Architecture\" data-canonical-src=\"https://code.visualstudio.com/assets/docs/remote/ssh/architecture-ssh.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcode.visualstudio.com%2Fassets%2Fdocs%2Fremote%2Fssh%2Farchitecture-ssh.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=4df3681a2e1abadb7c5f23d4a4d3ddfc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eにも載っているように、サーバー側に入れないと動かない拡張もある。多分CMakeもそうだと思われる。そのへんを調整する必要がありそう。\u003c/p\u003e\n\n\u003cp\u003e全部のremoteに対して入れたい拡張を指定するには\u003ccode\u003e\"remote.SSH.defaultExtensions\"\u003c/code\u003eがあるらしい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"参照\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8F%82%E7%85%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e参照\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://code.visualstudio.com/docs/remote/troubleshooting#_setting-up-the-ssh-agent\" rel=\"nofollow noopener\" target=\"_blank\"\u003eVisual Studio Code Remote Development Troubleshooting Tips and Tricks#Setting up the SSH Agent\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.server-memo.net/server-setting/ssh/ssh-agent.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003essh-agentを使って公開鍵認証方式のsshパスワード入力を省略する方法 | server-memo.net\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/49926386/openssh-windows-bad-owner-or-permissions\" rel=\"nofollow noopener\" target=\"_blank\"\u003eopenssh windows bad owner or permissions - Stack Overflow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/suthio/items/2760e4cff0e185fe2db9\" id=\"reference-8811c221f867408c35bb\"\u003eWindows 10のssh-agentをコマンド プロンプト、WSL、Git Bashで使ってみた\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","body":"# はじめに\n\nVSCodeには[Remote Development](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack)という拡張があります。まだPreview版ですが、出てからそこそこ経ったので試してみました。\n\n# 結論\n\nおそらくssh-agentのからみから、msys2のsshを使うのはうまく行かず、Windows10標準搭載のsshを使うことになります。\n\n# 前提\n\nmsys2から普通に目的のサーバーにコマンドラインでsshできる状態。もちろんパスワード認証なんかじゃなくて公開鍵認証で。`~/.ssh/config`には\n\n```apache:~/.ssh/config\nHost irregular-at-tus.work\n    IdentityFile ~/key_webarena/key_webarena\n    Port 110\n    User yumetodo\n```\n\nのようにある。つまり\n\n```\n├─.ssh\n│  ├─config\n│  └─known_hosts\n├─key_webarena\n│  ├─key_webarena\n│  └─key_webarena.pub\n```\n\nのようなdirectory構成。\n\nこの記事でのSSH先はWebARENAのVPSで動いているUbuntu 18.04 Server。\n\nWindowsでsshするのにmsys2ないしgit-bash使ってないとか有りえんので、この段階に至ってない場合は多分この拡張にお世話になることはないはず。\n\nremoteは今の所`glibc`ベースで動いているx86_64なLinux環境のみ対応。\n\n# Windows10標準搭載のsshとmsys2のpacmanで落とせるsshで設定を共有しつつsshできるように\n\n## シンボリックリンクを貼る\n\nまずは`~/.ssh/config`および設定で参照している認証鍵にシンボリックリンクを貼ります。\n\nコマンドプロンプトを立ち上げ以下のように。ユーザー名は適宜読み替えてください。\n\n```bat\nC:\\Users\\yumetodo\u003emklink /D .ssh \"C:\\msys64\\home\\yumetodo\\.ssh\"\n.ssh \u003c\u003c===\u003e\u003e C:\\msys64\\home\\yumetodo\\.ssh のシンボリック リンクが作成されました\nC:\\Users\\yumetodo\u003emklink /D key_webarena \"C:\\msys64\\home\\yumetodo\\key_webarena\"\nkey_webarena \u003c\u003c===\u003e\u003e C:\\msys64\\home\\yumetodo\\key_webarena のシンボリック リンクが作成されました\nC:\\Users\\yumetodo\u003edir | findstr SY\n2017/11/17  13:03    \u003cSYMLINKD\u003e     .gnupg [C:\\msys64\\home\\yumetodo\\.gnupg]\n2019/08/05  20:46    \u003cSYMLINKD\u003e     .ssh [C:\\msys64\\home\\yumetodo\\.ssh]\n2019/08/01  01:01    \u003cSYMLINKD\u003e     key_webarena [C:\\msys64\\home\\yumetodo\\key_webarena]\n```\n\n`.gnupg`は別件なので気になさらずに・・・。\n\n## 鍵のあるdirectoryの権限設定\n\n`~/.ssh/config`の`IdentityFile`で指定した鍵ファイルがあるdirectoryをWindowsのエクスプローラーからたどり、プロパティ→セキュリティで以下の画面が開きます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/4ac4e048-e51e-b99b-e854-2d2db4d96a12.png)\n\nさらに詳細設定を押すと以下の画面が開きます。\n\nここで継承の無効化を押します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/1f30677c-ef0d-ac83-13a3-e99c90cd746d.png)\n\n確認画面がでるので変換します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/bc0a5c60-37c0-9aab-578e-690e82a5fdce.png)\n\nすると編集ができるようになるので、「Users」と「Authenticated Users」を削除します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/09789002-b245-4a36-8fa8-774b62436465.png)\n\n追加を押します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/10e68e9a-c6d6-3f15-ef59-eed4702f9adf.png)\n\nプリンシパルの選択を押します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/8b85326c-07fb-0e03-2197-1db804174d5b.png)\n\n自分のWindowsログインユーザー名を入れて、「名前の確認」を押します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f69a841f-05d8-12ce-ff2c-b846a21cdb51.png)\n\nサジェストされるのでOKで閉じます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/ca0696ec-4d96-7cca-5617-cedf02a13008.png)\n\n「フルコントロール」にチェックを付けてOKします。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/68d308b0-ece8-b640-8b8b-db21eaa32dbf.png)\n\n最終的にこんな感じになっているはず・・・。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/b9a65204-1d83-ef0b-88ba-bf5a347d3028.png)\n\nOKで閉じます。\n\n## `~/.ssh/config`の権限設定\n\n`~/.ssh/config`をWindowsのExplorerからたどってプロパティを開いて先ほどと同様に設定してきます。ただし以下の画面で「フルコントロール」ではなく「変更」に。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f756752a-9c73-abb0-0ff9-8f17cacedace.png)\n\n## `ssh-agent`の有効化\n\n他にもやり方はあるのですがコマンドラインからやるなら、管理者権限のPowerShellを立ち上げて\n\n```powershell\nSet-Service ssh-agent -StartupType Automatic\nStart-Service ssh-agent\nGet-Service ssh-agent\n```\n\nとすればいいです。GUIからやるなら`Service`で検索して\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/85d5d64c-1bdc-0969-b5b0-ef7a3833b2ce.png)\n\n`OpenSSH Authentication Agent`を探して\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/130ef055-927d-3347-2733-6da9ef83d3f4.png)\n\nスタートアップの種類を「自動」もしくは「自動（遅延起動）」にすればいいです。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/6dc471bb-6556-87aa-2513-cb1d91574ba6.png)\n\n## `ssh-add`\n\n```bat\nC:\\Users\\yumetodo\u003essh-add C:\\msys64\\home\\yumetodo\\key_webarena\\key_webarena\nEnter passphrase for C:\\msys64\\home\\yumetodo\\key_webarena\\key_webarena:\nIdentity added: C:\\msys64\\home\\yumetodo\\key_webarena\\key_webarena (yume-wikijp@live.jp)\nC:\\Users\\yumetodo\u003essh-add -l\n4096 SHA256:P81NFT/HJeeQk1jXGzZeZ4cQ/XGLDKnDbgxHmFMhDgU yume-wikijp@live.jp (RSA)\n```\n\n## `ssh`\n\n```\nC:\\Users\\yumetodo\u003essh irregular-at-tus.work\nwarning: agent returned different signature type ssh-rsa (expected rsa-sha2-512)\nWelcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-55-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\nWelcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-55-generic x86_64)\n\n * Documentation:  https://help.ubuntu.com\n * Management:     https://landscape.canonical.com\n * Support:        https://ubuntu.com/advantage\n\n  System information as of Mon Aug  5 20:50:22 JST 2019\n\n  System load:  0.0                Processes:           130\n  Usage of /:   46.4% of 19.56GB   Users logged in:     0\n  Memory usage: 36%                IP address for ens3: 140.227.235.169\n  Swap usage:   6%\n\n * MicroK8s 1.15 is out! Thanks to all 40 contributors, you get the latest\n   greatest upstream Kubernetes in a single package.\n\n     https://github.com/ubuntu/microk8s\n\n * Canonical Livepatch is available for installation.\n   - Reduce system reboots and improve kernel security. Activate at:\n     https://ubuntu.com/livepatch\n\n5 packages can be updated.\n2 updates are security updates.\n\n\nLast login: Mon Aug  5 20:32:52 2019 from 119.173.37.16\nAgent pid 26403\n\nyumetodo@btgf1b8n ~\n```\n\n# vscodeでSSHできるまで\n\n## 拡張の導入\n\n[Remote Development](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack)\n\nを入れます。\n\n設定は特に弄ることはないです。\n\n## 接続\n\n\u003ckbd\u003eCtrl\u003c/kbd\u003e+\u003ckbd\u003eShift\u003c/kbd\u003e+ \u003ckbd\u003eP\u003c/kbd\u003eでコマンドパレットを開いて、`Remote-SSH: Connect to Host`を選びます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/9241c16f-c64b-9a32-08c5-73d7a528f392.png)\n\n`~/.ssh/config`に書いたHostが列挙されます。接続したい先を選びます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/4374a01e-f093-6ed9-a7fa-11203e544ccd.png)\n\n接続中・・・\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/3b55f2ad-a3e3-7b74-f416-3a8cc1f5b8bc.png)\n\nうまくいけば`Activating Extensions...`と下に出てきます。それが終われば使えます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/b2505e51-223c-3eae-32f3-ab1590d98e07.png)\n\n## 試しに適当なDirectoryを開いてみる\n\nファイラータブを開くと`Open Folder`というボタンが見えます。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/f5f345d7-d4ab-81ae-33d6-bcb988f922df.png)\n\n押すと現在(`HOME` directory)のリストが出てきます。試しに @Gaccho さんの [DungeonTemplateLibrary](https://github.com/Kasugaccho/DungeonTemplateLibrary)をたまたまCloneしてあったのでこれを開いてみます(謎の宣伝)。\n\nカーソルを合わしてOKを**2回**押します。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/a127996d-dafc-7beb-3b67-f8e60c831f1a.png)\n\n開けました。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/83bc6e7d-a428-0c85-39d5-15dc3307b4c6.png)\n\n## 端末を開いてみる\n\n\u003ckbd\u003eCtrl\u003c/kbd\u003e+\u003ckbd\u003eShift\u003c/kbd\u003e+ \u003ckbd\u003e@\u003c/kbd\u003eでとくに何も苦戦せずに端末が立ち上がって普通に使える。\n\n![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/3c8cbafd-4a4a-46dd-ba17-befbeb62095f.png)\n\n\n# 次のステップ\n\n[Visual Studio Code Remote Development Troubleshooting Tips and Tricks](https://code.visualstudio.com/docs/remote/troubleshooting)\n\n![SSH Architecture](https://code.visualstudio.com/assets/docs/remote/ssh/architecture-ssh.png)\n\nにも載っているように、サーバー側に入れないと動かない拡張もある。多分CMakeもそうだと思われる。そのへんを調整する必要がありそう。\n\n全部のremoteに対して入れたい拡張を指定するには`\"remote.SSH.defaultExtensions\"`があるらしい。\n\n# 参照\n\n- [Visual Studio Code Remote Development Troubleshooting Tips and Tricks#Setting up the SSH Agent](https://code.visualstudio.com/docs/remote/troubleshooting#_setting-up-the-ssh-agent)\n- [ssh-agentを使って公開鍵認証方式のsshパスワード入力を省略する方法 | server-memo.net](https://www.server-memo.net/server-setting/ssh/ssh-agent.html)\n- [openssh windows bad owner or permissions - Stack Overflow](https://stackoverflow.com/questions/49926386/openssh-windows-bad-owner-or-permissions)\n- [Windows 10のssh-agentをコマンド プロンプト、WSL、Git Bashで使ってみた](https://qiita.com/suthio/items/2760e4cff0e185fe2db9)\n","coediting":false,"comments_count":0,"created_at":"2019-08-05T23:00:26+09:00","group":null,"id":"123cd1d91f913bf0e748","likes_count":6,"private":false,"reactions_count":0,"tags":[{"name":"SSH","versions":[]},{"name":"Windows10","versions":[]},{"name":"VSCode","versions":[]}],"title":"Windows10でvscodeからSSHできるようになるまで","updated_at":"2019-08-05T23:14:36+09:00","url":"https://qiita.com/yumetodo/items/123cd1d91f913bf0e748","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"注意事項\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A0%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注意事項\u003c/h1\u003e\n\n\u003cp\u003eこの記事には以下の要素が含まれます。苦手な方はご注意くださいね。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003ePythonへの熱いdisり\u003c/li\u003e\n\u003cli\u003eC言語なんてなかった\u003c/li\u003e\n\u003cli\u003eJDK問題について深く知らないので怖がっている\u003c/li\u003e\n\u003cli\u003eいわゆる関数型言語に言及しないスタイル(\u003ccode\u003eF#\u003c/code\u003eとか\u003ccode\u003eScala\u003c/code\u003eとか?)\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/ClubNaggi/items/ffaa53928f67ed4a1df8\" id=\"reference-9cced41641e28c67b78e\"\u003eJavaとC++は学ぶな！！初心者が学ぶべき言語【厳選】\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eという記事が出ているのですが、C++erとしては遺憾の意を示さざるを得ません。そのうえでこれからプログラミングを始める人におすすめする言語を紹介します。え、C++？初心者にはおすすめできません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"初心者におすすめする言語が満たすべき要件\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%9D%E5%BF%83%E8%80%85%E3%81%AB%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%99%E3%82%8B%E8%A8%80%E8%AA%9E%E3%81%8C%E6%BA%80%E3%81%9F%E3%81%99%E3%81%B9%E3%81%8D%E8%A6%81%E4%BB%B6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e初心者におすすめする言語が満たすべき要件\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e人口がそこそこいる\u003c/li\u003e\n\u003cli\u003eWindowsでも容易に開発環境が構築できる\u003c/li\u003e\n\u003cli\u003e動作結果が目で見てわかる\u003c/li\u003e\n\u003cli\u003eコンパイルしなくていい\u003c/li\u003e\n\u003cli\u003e言語規格が少なくとも5年以内に更新されている\u003c/li\u003e\n\u003cli\u003e言語規格が後方互換性を備えていること\u003c/li\u003e\n\u003cli\u003e日本語資料が豊富にあること\u003c/li\u003e\n\u003cli\u003e非力なPCでも開発できる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"人口がそこそこいる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BA%BA%E5%8F%A3%E3%81%8C%E3%81%9D%E3%81%93%E3%81%9D%E3%81%93%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e人口がそこそこいる\u003c/h2\u003e\n\n\u003cp\u003eプログラミング言語を作っている人もたくさんいるので無限にプログラミング言語は存在し得るわけですが、さすがにある程度ユーザー数がいない言語を薦めるわけにはいきません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"windowsでも容易に開発環境が構築できる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#windows%E3%81%A7%E3%82%82%E5%AE%B9%E6%98%93%E3%81%AB%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E3%81%8C%E6%A7%8B%E7%AF%89%E3%81%A7%E3%81%8D%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eWindowsでも容易に開発環境が構築できる\u003c/h2\u003e\n\n\u003cp\u003e例えばPythonはなぜかWindowsだと動かないという事態によく遭遇します(私だけ・・・？)。初心者にエラー文を読んで原因を切り分けさせるのは無理です。\u003c/p\u003e\n\n\u003cp\u003e他の言語でもWindowsで完璧に動くぜ！って言うのは以外と少ないです。Rubyはだいぶ頑張っていると思いますがそれでも特に音声やグラフィックが絡むと\u003ccode\u003ecannot load such file\u003c/code\u003eと言われがちです(なぜかmsys2 mingw64 rubyでruby2dが使えない、\u003ca href=\"https://gitter.im/ruby2d/ruby2d\" rel=\"nofollow noopener\" target=\"_blank\"\u003eチャット\u003c/a\u003eで問い合わせ中)。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"動作結果が目で見てわかる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8B%95%E4%BD%9C%E7%B5%90%E6%9E%9C%E3%81%8C%E7%9B%AE%E3%81%A7%E8%A6%8B%E3%81%A6%E3%82%8F%E3%81%8B%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e動作結果が目で見てわかる\u003c/h2\u003e\n\n\u003cp\u003e初心者はコンソールなんてまともに扱えませんし、\"Hello world!\"っていう文字を見せられても感動できません。\u003c/p\u003e\n\n\u003cp\u003eなんか図形が動くとかそういう視覚に容易に訴えられるのが望ましいです。\u003c/p\u003e\n\n\u003cp\u003eC++はGUIを作るのが極めて難しいのでこういうのは無理です(2D graphics標準化は頓挫したしな)。\u003c/p\u003e\n\n\u003cp\u003e言語標準ライブラリに2D描画ライブラリがあるか、十分メンテされてユーザーが居る2Dライブラリがあることが望ましいですね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"コンパイルしなくていい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%97%E3%81%AA%E3%81%8F%E3%81%A6%E3%81%84%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコンパイルしなくていい\u003c/h2\u003e\n\n\u003cp\u003eコンパイルはなれている人でもやっぱり面倒だと思います。もちろんいろいろ自動化することは出来ますが、自動化を組むのが今度は面倒です。\u003c/p\u003e\n\n\u003cp\u003eちなみに面倒くさがれない人は多分プログラミングにあまり向いていません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"言語規格が少なくとも5年以内に更新されている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%80%E8%AA%9E%E8%A6%8F%E6%A0%BC%E3%81%8C%E5%B0%91%E3%81%AA%E3%81%8F%E3%81%A8%E3%82%825%E5%B9%B4%E4%BB%A5%E5%86%85%E3%81%AB%E6%9B%B4%E6%96%B0%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e言語規格が少なくとも5年以内に更新されている\u003c/h2\u003e\n\n\u003cp\u003eプログラミング言語も切磋琢磨し日々様々な改善がなされているべきです。ある程度保守的なC++ですら3年おきに更新しているんですから5年経っても更新されない言語は死んでます。え？C言語？2017年末にC11と全く同じ内容をリネームして出してたけどあれはないでしょ。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"言語規格が後方互換性を備えていること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A8%80%E8%AA%9E%E8%A6%8F%E6%A0%BC%E3%81%8C%E5%BE%8C%E6%96%B9%E4%BA%92%E6%8F%9B%E6%80%A7%E3%82%92%E5%82%99%E3%81%88%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e言語規格が後方互換性を備えていること\u003c/h2\u003e\n\n\u003cp\u003e初心者が頑張ってググって出てきた情報どおりに書いて動かそうとしたら動かないとなるとモチベーションが吹き飛びます。初心者じゃなくても心が折れます。セキュリティ上の懸念などからdeprecatedになる機能が出るのは仕方ないとしても、Pythonみたいに巨大なbreaking changeを噛ましてくる言語はおすすめできません。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"日本語資料が豊富にあること\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%B3%87%E6%96%99%E3%81%8C%E8%B1%8A%E5%AF%8C%E3%81%AB%E3%81%82%E3%82%8B%E3%81%93%E3%81%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e日本語資料が豊富にあること\u003c/h2\u003e\n\n\u003cp\u003eただでさえわからないプログラミング言語を学ぶのに、自分の母国語じゃない資料で勉強するとか脳みそがパンクしてしまいます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"非力なpcでも開発できる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9D%9E%E5%8A%9B%E3%81%AApc%E3%81%A7%E3%82%82%E9%96%8B%E7%99%BA%E3%81%A7%E3%81%8D%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e非力なPCでも開発できる\u003c/h2\u003e\n\n\u003cp\u003eプログラミングするのに15万超えるようなPC買えと言われても多くの人は困ってしまいます。Unityとかは結構メモリー持っていくのでつらそうです。一般に出回っているPCはメモリーが4GBのものが多いです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おすすめしたい言語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%97%E3%81%9F%E3%81%84%E8%A8%80%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおすすめしたい言語\u003c/h1\u003e\n\n\u003cp\u003eこれらを満たす言語を残念ながら私の狭い知識では一つしか上げることが出来ませんでした。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"javascript\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#javascript\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eJavaScript\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eブラウザ上で動くのがやっぱり大きいです。Canvas APIを叩くことで図形が描画できます。実行環境をブラウザにすることで、ChromeかFirefoxを入れてもらえば(運が良ければすでに入っている)ほぼセットアップが終わります。\u003cbr\u003e\n\u003ca href=\"https://developer.mozilla.org/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript\" rel=\"nofollow noopener\" target=\"_blank\"\u003eそのままのJavaScriptを使ったブロックくずしゲーム - ゲーム開発 | MDN\u003c/a\u003e\u003cbr\u003e\nというStep-by-StepでCanvas APIを使う資料がなんとMDNにありますし実に良いです。\u003c/p\u003e\n\n\u003cp\u003e言語の人口も計算不能なレベルで大きく、開発も盛んです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おすすめしたかった言語\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%97%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F%E8%A8%80%E8%AA%9E\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおすすめしたかった言語\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ruby\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ruby\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eRuby\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eRuby自体はかなりいい言語で、日本語資料も開発者が日本人ですからたくさんあります。グラフィックではRuby2dが結構良さそうなライブラリなんですよね、動けば。うごけー。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"おすすめできない言語の例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8A%E3%81%99%E3%81%99%E3%82%81%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E8%A8%80%E8%AA%9E%E3%81%AE%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eおすすめできない言語の例\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"c\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eC++\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eC++erが言うんだから間違いない(確信)。Visual Studioはコンソールアプリケーションを作る分には手順を簡単にしてくれますが、外部ライブラリを使うには不向きです。外部ライブラリをまともに使うにはCMakeという別の言語の助けが必要になります。ものすごく難しいってわけではないですが、他の言語より難しいのは確かです。\u003c/p\u003e\n\n\u003cp\u003eC++自体もC++17以降を使う分には極端に難しいということはないと思うのですが(C++er基準)、何分古い情報が多いのとまともな入門書がないのが辛い気がします。\u003c/p\u003e\n\n\u003cp\u003eグラフィックライブラリ自体はopennframeworksとかDXライブラリとかがあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"c-1\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c-1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eC#\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eUnityはゲーム業界でもっとも使われているライブラリです。これはC#で書くことが出来ますが、Unityで使えるC#のバージョンがものすごく古いという問題がありました。ようやく新しいC#への追従の動きが一昨年くらいからあるわけですが果たしてC#の進化に追いつけるのか・・・？\u003c/p\u003e\n\n\u003cp\u003eC#自体はC#7.0とかC#8.0で書く分には悪くないと思いますが古い情報に出くわしやすい印象です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"java\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#java\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eJava\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e広く使われている言語で進化を続けています。が！Oracle JDK vs OpenJDK問題を経て(Oracle) JDK8で止まる勢とOpenJDKに移る勢で分裂している気がします。おなじくJVMで動く言語\u003ccode\u003eScala\u003c/code\u003eのドキュメントにはJDK8をいれろって書いてあります。C++erとしては言語そのものよりJVMレベルのゴタゴタが気になってしまいます。\u003c/p\u003e\n\n\u003cp\u003eちなみにOpenJDKは自分でPATH通さないといけない問題はchocolatey使えやって思ってます。\u003c/p\u003e\n\n\u003cp\u003e2Dグラフィックは言語標準ライブラリにある気がします。\u003c/p\u003e\n","body":"# 注意事項\n\nこの記事には以下の要素が含まれます。苦手な方はご注意くださいね。\n\n- Pythonへの熱いdisり\n- C言語なんてなかった\n- JDK問題について深く知らないので怖がっている\n- いわゆる関数型言語に言及しないスタイル(`F#`とか`Scala`とか?)\n\n# はじめに\n\n[JavaとC++は学ぶな！！初心者が学ぶべき言語【厳選】](https://qiita.com/ClubNaggi/items/ffaa53928f67ed4a1df8)\n\nという記事が出ているのですが、C++erとしては遺憾の意を示さざるを得ません。そのうえでこれからプログラミングを始める人におすすめする言語を紹介します。え、C++？初心者にはおすすめできません。\n\n# 初心者におすすめする言語が満たすべき要件\n\n- 人口がそこそこいる\n- Windowsでも容易に開発環境が構築できる\n- 動作結果が目で見てわかる\n- コンパイルしなくていい\n- 言語規格が少なくとも5年以内に更新されている\n- 言語規格が後方互換性を備えていること\n- 日本語資料が豊富にあること\n- 非力なPCでも開発できる\n\n## 人口がそこそこいる\n\nプログラミング言語を作っている人もたくさんいるので無限にプログラミング言語は存在し得るわけですが、さすがにある程度ユーザー数がいない言語を薦めるわけにはいきません。\n\n## Windowsでも容易に開発環境が構築できる\n\n例えばPythonはなぜかWindowsだと動かないという事態によく遭遇します(私だけ・・・？)。初心者にエラー文を読んで原因を切り分けさせるのは無理です。\n\n他の言語でもWindowsで完璧に動くぜ！って言うのは以外と少ないです。Rubyはだいぶ頑張っていると思いますがそれでも特に音声やグラフィックが絡むと`cannot load such file`と言われがちです(なぜかmsys2 mingw64 rubyでruby2dが使えない、[チャット](https://gitter.im/ruby2d/ruby2d)で問い合わせ中)。\n\n## 動作結果が目で見てわかる\n\n初心者はコンソールなんてまともに扱えませんし、\"Hello world!\"っていう文字を見せられても感動できません。\n\nなんか図形が動くとかそういう視覚に容易に訴えられるのが望ましいです。\n\nC++はGUIを作るのが極めて難しいのでこういうのは無理です(2D graphics標準化は頓挫したしな)。\n\n言語標準ライブラリに2D描画ライブラリがあるか、十分メンテされてユーザーが居る2Dライブラリがあることが望ましいですね。\n\n## コンパイルしなくていい\n\nコンパイルはなれている人でもやっぱり面倒だと思います。もちろんいろいろ自動化することは出来ますが、自動化を組むのが今度は面倒です。\n\nちなみに面倒くさがれない人は多分プログラミングにあまり向いていません。\n\n## 言語規格が少なくとも5年以内に更新されている\n\nプログラミング言語も切磋琢磨し日々様々な改善がなされているべきです。ある程度保守的なC++ですら3年おきに更新しているんですから5年経っても更新されない言語は死んでます。え？C言語？2017年末にC11と全く同じ内容をリネームして出してたけどあれはないでしょ。\n\n## 言語規格が後方互換性を備えていること\n\n初心者が頑張ってググって出てきた情報どおりに書いて動かそうとしたら動かないとなるとモチベーションが吹き飛びます。初心者じゃなくても心が折れます。セキュリティ上の懸念などからdeprecatedになる機能が出るのは仕方ないとしても、Pythonみたいに巨大なbreaking changeを噛ましてくる言語はおすすめできません。\n\n## 日本語資料が豊富にあること\n\nただでさえわからないプログラミング言語を学ぶのに、自分の母国語じゃない資料で勉強するとか脳みそがパンクしてしまいます。\n\n## 非力なPCでも開発できる\n\nプログラミングするのに15万超えるようなPC買えと言われても多くの人は困ってしまいます。Unityとかは結構メモリー持っていくのでつらそうです。一般に出回っているPCはメモリーが4GBのものが多いです。\n\n# おすすめしたい言語\n\nこれらを満たす言語を残念ながら私の狭い知識では一つしか上げることが出来ませんでした。\n\n## `JavaScript`\n\nブラウザ上で動くのがやっぱり大きいです。Canvas APIを叩くことで図形が描画できます。実行環境をブラウザにすることで、ChromeかFirefoxを入れてもらえば(運が良ければすでに入っている)ほぼセットアップが終わります。\n[そのままのJavaScriptを使ったブロックくずしゲーム - ゲーム開発 | MDN](https://developer.mozilla.org/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript)\nというStep-by-StepでCanvas APIを使う資料がなんとMDNにありますし実に良いです。\n\n言語の人口も計算不能なレベルで大きく、開発も盛んです。\n\n# おすすめしたかった言語\n\n## `Ruby`\n\nRuby自体はかなりいい言語で、日本語資料も開発者が日本人ですからたくさんあります。グラフィックではRuby2dが結構良さそうなライブラリなんですよね、動けば。うごけー。\n\n# おすすめできない言語の例\n\n## `C++`\n\nC++erが言うんだから間違いない(確信)。Visual Studioはコンソールアプリケーションを作る分には手順を簡単にしてくれますが、外部ライブラリを使うには不向きです。外部ライブラリをまともに使うにはCMakeという別の言語の助けが必要になります。ものすごく難しいってわけではないですが、他の言語より難しいのは確かです。\n\nC++自体もC++17以降を使う分には極端に難しいということはないと思うのですが(C++er基準)、何分古い情報が多いのとまともな入門書がないのが辛い気がします。\n\nグラフィックライブラリ自体はopennframeworksとかDXライブラリとかがあります。\n\n## `C#`\n\nUnityはゲーム業界でもっとも使われているライブラリです。これはC#で書くことが出来ますが、Unityで使えるC#のバージョンがものすごく古いという問題がありました。ようやく新しいC#への追従の動きが一昨年くらいからあるわけですが果たしてC#の進化に追いつけるのか・・・？\n\nC#自体はC#7.0とかC#8.0で書く分には悪くないと思いますが古い情報に出くわしやすい印象です。\n\n## `Java`\n\n広く使われている言語で進化を続けています。が！Oracle JDK vs OpenJDK問題を経て(Oracle) JDK8で止まる勢とOpenJDKに移る勢で分裂している気がします。おなじくJVMで動く言語`Scala`のドキュメントにはJDK8をいれろって書いてあります。C++erとしては言語そのものよりJVMレベルのゴタゴタが気になってしまいます。\n\nちなみにOpenJDKは自分でPATH通さないといけない問題はchocolatey使えやって思ってます。\n\n2Dグラフィックは言語標準ライブラリにある気がします。\n","coediting":false,"comments_count":47,"created_at":"2019-07-27T12:24:09+09:00","group":null,"id":"e37e11bccdf1d91ada2d","likes_count":74,"private":false,"reactions_count":0,"tags":[{"name":"Java","versions":[]},{"name":"Ruby","versions":[]},{"name":"Python","versions":[]},{"name":"C++","versions":[]},{"name":"JavaScript","versions":[]}],"title":"JavaとC++は学ぶな！！初心者が学ぶべき言語【さらに厳選】","updated_at":"2019-07-27T12:24:09+09:00","url":"https://qiita.com/yumetodo/items/e37e11bccdf1d91ada2d","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"対象者\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AF%BE%E8%B1%A1%E8%80%85\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e対象者\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/yumetodo/items/a843bd542106215bbc84\" id=\"reference-5323ca0fcb485f3d13b7\"\u003eC++erを簡易的にレベル分けすることで初心者詐欺を減らそうという試み\u003c/a\u003e\u003cbr\u003e\nでいうC++初心者以上であることが前提です。\u003c/p\u003e\n\n\u003cp\u003eまた日本の義務教育ないしそれに相当するものを終了していることも条件とします。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eCl、まだチュートリアル以前で\u003cbr\u003eなんのために存在しているのか未だにわかっていません……。\u003c/p\u003e— std::gaccho( ¨̮ ); (@wanotaitei) \u003ca href=\"https://twitter.com/wanotaitei/status/1122112931766816768?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eApril 27, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e単体テストって１つのソースファイルのみを入れて実行するやつですかね？\u003cbr\u003e\u003cbr\u003e(名称をよくわかっていない)\u003c/p\u003e— std::gaccho( ¨̮ ); (@wanotaitei) \u003ca href=\"https://twitter.com/wanotaitei/status/1122114127487365121?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eApril 27, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e「砂糖ってしょっぱいですよね？」級の発言をしているあなたでも大丈夫！1から、・・・いいえ、0から始めましょう！( \u003ca href=\"/Gaccho\" class=\"user-mention js-hovercard\" title=\"Gaccho\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"Gaccho\"\u003e@Gaccho\u003c/a\u003e 氏へのdisがひどい)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"これまであなたはどうやってプログラムを書いてきましたか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%82%8C%E3%81%BE%E3%81%A7%E3%81%82%E3%81%AA%E3%81%9F%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%8D%E3%81%BE%E3%81%97%E3%81%9F%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこれまであなたはどうやってプログラムを書いてきましたか？\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eちょっとずつプログラムを大きくして\u003c/li\u003e\n\u003cli\u003eこまめにコメントアウトしながらmain関数を書き換えながら・・・\u003c/li\u003e\n\u003cli\u003eノリと勢いで\u003c/li\u003e\n\u003cli\u003e目についた不具合があったら都度直して\u003c/li\u003e\n\u003cli\u003eなんとなく検索で引っかかるコードをコピペで継ぎ接ぎして\u003c/li\u003e\n\u003cli\u003e気分で関数わけ\u003c/li\u003e\n\u003cli\u003eよくわかんないけど、うまくいくようになった\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなんてかんじでしょうか？\u003c/p\u003e\n\n\u003cp\u003eこういうのを「もぐらたたき開発」なんて言ったりすることがあります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"もぐらたたき開発の限界\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%82%E3%81%90%E3%82%89%E3%81%9F%E3%81%9F%E3%81%8D%E9%96%8B%E7%99%BA%E3%81%AE%E9%99%90%E7%95%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eもぐらたたき開発の限界\u003c/h1\u003e\n\n\u003cp\u003eもぐらたたき開発でもプロジェクトがごくごく小規模であれば成立してしまったりします。また個人開発しているとなおさらその傾向が強くなります\u003c/p\u003e\n\n\u003cp\u003eしかし規模が大きくなるにつれて\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eソフトウェアの世代が変わったときに、一度は枯れたバグが復活している\u003c/li\u003e\n\u003cli\u003e実装の仕様がふらふらしている\u003c/li\u003e\n\u003cli\u003e発生するかもしれない要因に対して予め準備するのではなく、発生してから考える。\u003c/li\u003e\n\u003cli\u003eある作業を実施できる人、対応できる人を1人のままにしている\u003c/li\u003e\n\u003cli\u003eバグの調査が難しくなる\u003c/li\u003e\n\u003cli\u003eコードが把握しきれなくなる\u003c/li\u003e\n\u003cli\u003e手を出せない魔の領域ができる\u003c/li\u003e\n\u003cli\u003e成果物としてメンテナンスされ続けるドキュメントが明確になっていない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなどの問題ができてきて、次第に改修困難になり最終的には破棄処分せざるを得なくなります。\u003c/p\u003e\n\n\u003cp\u003eそれでも金の力で人月を浪費して無理やり押し切る、なんてケースも有るようですが、とくに趣味開発では自分のモチベが絶対なので、こんなことが起きたらモチベが続かなくなります。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"もぐらたたき開発をやめるための武器\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%82%E3%81%90%E3%82%89%E3%81%9F%E3%81%9F%E3%81%8D%E9%96%8B%E7%99%BA%E3%82%92%E3%82%84%E3%82%81%E3%82%8B%E3%81%9F%E3%82%81%E3%81%AE%E6%AD%A6%E5%99%A8\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eもぐらたたき開発をやめるための武器\u003c/h1\u003e\n\n\u003cp\u003eもちろんDRY原則を始めとするコーディング上のベストプラクティスの導入なんかも重要なのですが、そういったベストプラクティス導入を\u003cstrong\u003e動機づける\u003c/strong\u003e武器があります。\u003c/p\u003e\n\n\u003cp\u003eそれが単体テストとCIです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"単体テスト\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単体テスト\u003c/h1\u003e\n\n\u003cp\u003eまずはみんな大好きWikipediaの日本語版を見てみましょう。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eコンピュータプログラミングにおいて単体テスト（たんたいテスト）あるいはユニットテスト（英語: Unit test）とは、ソースコードの個々のユニット、すなわち、1つ以上のコンピュータプログラムモジュールが使用に適しているかどうかを決定するために、関連する制御データ、使用手順、操作手順とともにテストする手法である[1]。ユニットとはアプリケーションのテスト可能な最小の部品単位である、と直観的にとらえることができる。手続き型プログラミングでは、ユニットは、モジュール全体のこともあるが、より一般的には、個々の関数や手続きである。オブジェクト指向プログラミングでは、ユニットは、クラスなどのインタフェース全体だが、個々のメソッドであることもある[2]。単体テストは開発プロセス中にプログラマー、時にはホワイトボックステスターによって作成される。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eいきなりこれ読んで分かるならもうこの記事読まなくて大丈夫です。よい旅路を。\u003c/p\u003e\n\n\u003cp\u003e表面的にはユニットに対してなんらかの検査を行うのが単体テストです。\u003c/p\u003e\n\n\u003cp\u003eユニットが何たるかというとC++においては、概ね関数ないしクラスが該当します。つまり関数単位での検査が主になると思います。でもそもそも関数ってなんでしたっけ？\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"関数とは義務教育に立ち返って\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E6%95%B0%E3%81%A8%E3%81%AF%E7%BE%A9%E5%8B%99%E6%95%99%E8%82%B2%E3%81%AB%E7%AB%8B%E3%81%A1%E8%BF%94%E3%81%A3%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関数とは(義務教育に立ち返って)\u003c/h2\u003e\n\n\u003cp\u003e日本人が「関数」という単語を初めに習うのは中学2年の数学の時間で1次関数を習うときだと思われます\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" rel=\"footnote\" title=\"中学校学校では数学1で文字を用いた方程式などと負の数に拡張された比例関係を学び、数学2で１次関数という流れ\"\u003e1\u003c/a\u003e\u003c/sup\u003e。手元にあった学校図書から出ている平成17年に教科書検定を通った中学校数学2\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" rel=\"footnote\" title=\"一松信他 中学校数学２ 学校図書 2009 ISBN: 978-4-7625-5098-1\"\u003e2\u003c/a\u003e\u003c/sup\u003eの教科書では\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e(前略)ともなって変わる2つの変数x, yがあって、xの値を決めるとそれに対応するyがただ一つ決まるとき、\u003cstrong\u003eyはxの関数である\u003c/strong\u003eといいます。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eと書かれていました。懐かしいですね！\u003c/p\u003e\n\n\u003cp\u003e様々問題はあるものの教科書検定を通り抜けてきた教科書をなめてはいけません。優秀な皆さんはまさか中学校の教科書を捨てる、などという蛮行にはでていないはずなので探せば中学校数学の教科書は見つかるはずですからぜひ自分でも調べてみてください。えっ、捨てちゃった？しょうがないなぁ～、\u003cstrong\u003e買え\u003c/strong\u003e。\u003c/p\u003e\n\n\u003cp\u003eちなみに学校で使われる教科書は普通の書店では手に入らず教科書配給会社から買う必要があります。東京都内ならJR中央・総武各駅停車の大久保駅でてすぐ(または新宿駅から徒歩15～20分)の第一教科書で買えます(土日祝休み)。近くの小滝橋通りはラーメン激戦区なのでついでにラーメンも食べていきましょう。\u003cdel\u003e\u003ca href=\"https://tabelog.com/tokyo/A1304/A130401/13041385/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e古武士\u003c/a\u003eはええぞ。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003eさてその教科書に興味深いことが書かれています。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e「関数」ということばは、英語の「function」の訳です。「function」には\"機能\"とか\"働き\"という意味があります\u003c/p\u003e\n\n\u003cp\u003e「function」の「fun」は中国語の「\u003cruby\u003e函\u003crt\u003eファン\u003c/rt\u003e\u003c/ruby\u003e」の発音と似ているため、「function」は中国では「函数」という用語を使い、「ファンスウ」と発音しています。\u003c/p\u003e\n\n\u003cp\u003e日本でも以前は「\u003cruby\u003e函数\u003crt\u003eかんすう\u003c/rt\u003e\u003c/ruby\u003e」と書いていましたが、使用漢字の制限により「関数」と改められました。\u003c/p\u003e\n\n\u003cp\u003e「関」には\"かかわる\"という意味があり、「関数」は数量の関係を表していることばと考えることができます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fac7d2f45-9564-fcb7-0f3a-91686142290d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b2aee7b3a2da6c886a2f214306d723be\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fac7d2f45-9564-fcb7-0f3a-91686142290d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b2aee7b3a2da6c886a2f214306d723be\" alt=\"関数.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/ac7d2f45-9564-fcb7-0f3a-91686142290d.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2Fac7d2f45-9564-fcb7-0f3a-91686142290d.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=619cc17b3452b1fa9f6e86758ee8ad4c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e特にこの図に注目してください。\u003cstrong\u003e入力に対して何らかの変換をし、出力するという機能が関数である\u003c/strong\u003e、ということがよく分かる図です。この図を書いた人は神か!?まじで教科書検定を通り抜けてきた教科書なめたらあかんで！\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"関数とはcにおいて\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E6%95%B0%E3%81%A8%E3%81%AFc%E3%81%AB%E3%81%8A%E3%81%84%E3%81%A6\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関数とは(C++において)\u003c/h2\u003e\n\n\u003cp\u003eC++における関数とはなんぞやについては\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/cdfb41781d32d98be1b4\" id=\"reference-18504cbdb8fd5ea235e5\"\u003e関数の創世から深淵まで駆け抜ける関数とはなんぞや講座\u003c/a\u003e\u003cbr\u003e\nで解説済みです。\u003c/p\u003e\n\n\u003cp\u003eしかし、関数の本質は上で述べた\u003cstrong\u003e入力に対して何らかの変換をし、出力するという機能\u003c/strong\u003eであるということはなんら揺らぐものであありません。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"明示的な入力と明示的な出力\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AA%E5%85%A5%E5%8A%9B%E3%81%A8%E6%98%8E%E7%A4%BA%E7%9A%84%E3%81%AA%E5%87%BA%E5%8A%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e明示的な入力と明示的な出力\u003c/h3\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eという関数を考えてみることにします。\u003c/p\u003e\n\n\u003cp\u003eまず入力は何でしょうか？もちろん引数\u003ccode\u003en\u003c/code\u003eですよね。\u003c/p\u003e\n\n\u003cp\u003eでは出力は何でしょうか？もちろん戻り値が出力ですね。\u003c/p\u003e\n\n\u003cp\u003eC++では引数経由で値を返すなんてこともとくにC++11より前の時代では盛んに行われていましたし、現代でも\u003ccode\u003estd::error_code\u003c/code\u003eへのlvalue referenceを引数に取ってエラー返却する例もありますね。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.slideshare.net/chihayatakatuki/boost-asio\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7a6872dd-93db-31ef-be59-76847dfd549a.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=79a0caf781b3d4617ec0b21032596ee0\" alt=\"image.png\" data-canonical-src=\"https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/7a6872dd-93db-31ef-be59-76847dfd549a.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F94177%2F7a6872dd-93db-31ef-be59-76847dfd549a.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9064a85d7b28562fa60411962c61c0eb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003cbr\u003e\n( \u003ca href=\"/YukiMiyatake\" class=\"user-mention js-hovercard\" title=\"YukiMiyatake\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"YukiMiyatake\"\u003e@YukiMiyatake\u003c/a\u003e 氏の「BoostAsioで可読性を求めるのは間違っているだろうか 」より)\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.boost.org/doc/libs/1_70_0/doc/html/boost_asio/reference/basic_yield_context/operator_lb__rb_.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.boost.org/doc/libs/1_70_0/doc/html/boost_asio/reference/basic_yield_context/operator_lb__rb_.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003ebasic_yield_context\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"p\"\u003e[](\u003c/span\u003e\u003cspan class=\"n\"\u003eboost\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003esystem\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eerror_code\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまたそもそもC++には例外があるのでこれもまた出力ですよね。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"隠れた入力がある例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9A%A0%E3%82%8C%E3%81%9F%E5%85%A5%E5%8A%9B%E3%81%8C%E3%81%82%E3%82%8B%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e隠れた入力がある例\u003c/h3\u003e\n\n\u003cp\u003eC++においては関数に値を渡すのはなにも引数だけとは限りません。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003estatic storageの変数\u003c/li\u003e\n\u003cli\u003ethread loacal storageの変数\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eも入力となりえます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003eg\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e引数として渡すわけでもないのに関数を呼び出す前に何らかの操作が必要になるような例が隠れた入力であることが多いです。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"隠れた出力がある例\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%9A%A0%E3%82%8C%E3%81%9F%E5%87%BA%E5%8A%9B%E3%81%8C%E3%81%82%E3%82%8B%E4%BE%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e隠れた出力がある例\u003c/h3\u003e\n\n\u003cp\u003e隠れた入力と同様にして、隠れた出力が存在します。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"http://okapies.hateblo.jp/entry/2016/12/15/021550\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://okapies.hateblo.jp/entry/2016/12/15/021550\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eprocessNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eMessage\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eInboxQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003epopMessage\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"p\"\u003e!=\u003c/span\u003e \u003cspan class=\"k\"\u003enull\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eprocess\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eこの関数は、構文を見るかぎりは何も入力を取らず何も出力を返さないように見えるが、何かに対して明らかに依存しているし、明らかに何かをしている。実は、この関数には入力と出力の組が隠れている。その隠れた入力とは\u003ccode\u003epopMessage()\u003c/code\u003eを呼び出す前の\u003ccode\u003eInboxQueue\u003c/code\u003eの状態だ。そして、隠れた出力とは\u003ccode\u003eprocess\u003c/code\u003eが引き起こしたあらゆる結果と、それに加えて、処理が終わった後の\u003ccode\u003eInboxQueue\u003c/code\u003eの状態だ。\u003c/p\u003e\n\n\u003cp\u003e間違いなく\u003ccode\u003eInboxQueue\u003c/code\u003eの状態はこの関数の本物の入力だ。その値を知らなければ\u003ccode\u003eprocessNext\u003c/code\u003eの挙動も分からない。そして、出力の方も本物だ。\u003ccode\u003eprocessNext\u003c/code\u003eを呼び出した結果は、\u003ccode\u003eInboxQueue\u003c/code\u003eの新たな状態を考慮しないと完全に理解することはできない。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"関数単位で単体テストを行うとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%96%A2%E6%95%B0%E5%8D%98%E4%BD%8D%E3%81%A7%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E8%A1%8C%E3%81%86%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e関数単位で単体テストを行うとは\u003c/h2\u003e\n\n\u003cp\u003eようやく本題。関数とは入力に対して何らかの変換をし、出力するという機能であると前に述べましたが、\u003cstrong\u003e関数単位で単体テストを行うとは、関数に対して何かしらの入力を与え、出力が想定通りか検査するプログラムを記述すること\u003c/strong\u003eです。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"追記-テストしやすい関数とは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%BF%BD%E8%A8%98-%E3%83%86%E3%82%B9%E3%83%88%E3%81%97%E3%82%84%E3%81%99%E3%81%84%E9%96%A2%E6%95%B0%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e追記: テストしやすい関数とは\u003c/h2\u003e\n\n\u003cp\u003eずーっとこの図を探していて見つけられなかったのですが、ふとしたきっかけで見つけたので紹介しておきます。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/hirokidaichi/items/591ad96ab12938878fe1\" id=\"reference-b87e2127f9c3521555ed\"\u003e新人プログラマに知っておいてもらいたい人類がオブジェクト指向を手に入れるまでの軌跡\u003c/a\u003e\u003cbr\u003e\nにちょうどいい画像があるのでお借りしよう。\u003cbr\u003e\n\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F35671%2F04cb4681-c28e-5f35-5fba-6f6fb45c0b61.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=53c1083dab70de67d6c28f95008ff284\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F35671%2F04cb4681-c28e-5f35-5fba-6f6fb45c0b61.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=53c1083dab70de67d6c28f95008ff284\" alt=\"スクリーンショット 2014-05-12 21.51.26.png\" title=\"スクリーンショット 2014-05-12 21.51.26.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/35671/04cb4681-c28e-5f35-5fba-6f6fb45c0b61.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F35671%2F04cb4681-c28e-5f35-5fba-6f6fb45c0b61.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=05261cfeed7104a8df1734caec367dae 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e隠れた入力や出力がない関数のほうがテストしやすいし、またそういう関数をつくるべきです。\u003c/p\u003e\n\n\u003cp\u003e隠れた入力や出力をしたくなったときはそれを明示的な入力や出力に変換するラッパー関数を書いてそれを使うようにすると排除できるように思います。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"どのように単体テストを記述するか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%AB%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどのように単体テストを記述するか\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"単体テストフレームワークの選出\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E9%81%B8%E5%87%BA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単体テストフレームワークの選出\u003c/h2\u003e\n\n\u003cp\u003eRustみたいに言語そのものでテストの方法が提供されていれば素晴らしいのですが、残念ながらそのようなことはC++ではないので、誰かが作ったテストフレームワークをまず選ぶところから始めます。\u003c/p\u003e\n\n\u003cp\u003eテストフレームワークに求められる必須要件はクロスプラットフォームな\u003ca href=\"https://ja.wikipedia.org/wiki/XUnit\" rel=\"nofollow noopener\" target=\"_blank\"\u003exUnit\u003c/a\u003eであることです。そうでないものは使い物にならないので使わないでください。\u003c/p\u003e\n\n\u003cp\u003e有名なのは\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eGoogleTest\u003c/li\u003e\n\u003cli\u003eBoost.Test\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eでしょうか。今回はGoogleTestによく似ていて私が愛用している \u003ca href=\"/srz_zumix\" class=\"user-mention js-hovercard\" title=\"srz_zumix\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"srz_zumix\"\u003e@srz_zumix\u003c/a\u003e 氏作のiutestを利用します。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/srz-zumix/iutest\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/srz-zumix/iutest\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eiutestはヘッダーオンリーなのでincludeするだけで使えます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"単体テストフレームワークの使い方を覚える\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%83%95%E3%83%AC%E3%83%BC%E3%83%A0%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9%E3%82%92%E8%A6%9A%E3%81%88%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単体テストフレームワークの使い方を覚える\u003c/h2\u003e\n\n\u003cp\u003eC++の単体テストフレームワークは概ねどれもC++言語にリフレクションがないことも相まって、マクロの塊です。\u003c/p\u003e\n\n\u003cp\u003eしたがってちょっと癖のある書き方になります。\u003c/p\u003e\n\n\u003cp\u003eまず通常と同じくmain関数を・・・と言いたいところですが\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#define IUTEST_USE_MAIN 1\n#include \u0026lt;iutest.hpp\u0026gt;\n\u003c/span\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eしておくことでiutestのヘッダーをincludeしたときにmain関数も定義してくれます。言い換えるとどこか一つの翻訳単位でのみ定義してください(さもないと翻訳単位ごとにmain関数が作られて衝突する)。\u003c/p\u003e\n\n\u003cp\u003eではテストを書いていきます。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのような関数に対して\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003eIUTEST\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eMyTest\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIUTEST_ASSERT_EQ\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eIUTEST_ASSERT_EQ\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ef\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように書きます。詳しく見ていきましょう。\u003c/p\u003e\n\n\u003cp\u003eまず\u003ccode\u003eIUTEST(MyTest, f)\u003c/code\u003eではテストケース名とテスト名を書きます。テスト名は迷ったら対象の関数名にしとけばいいです。テストケース名はとりあえずはテストを束ねたものと思ってもらって構いません。\u003cstrong\u003eただしCamelCaseで書きましょう。より正確には\u003ccode\u003e_\u003c/code\u003eを使ってはいけません。\u003c/strong\u003eこれはC++特有の事情によるものです。詳細は\u003cbr\u003e\n\u003ca href=\"http://opencv.jp/googletestdocs/FAQ.html#faq-why-should-not-test-case-names-and-test-names-contain-underscore\" rel=\"nofollow noopener\" target=\"_blank\"\u003eよくある質問 — Google Test ドキュメント日本語訳\u003c/a\u003e\u003cbr\u003e\nに譲りますが、C++では\u003ccode\u003e__\u003c/code\u003e(アンダースコアの連続)を含む識別名(関数名とか)が予約されているため使ってはいけないことに起因します。\u003cbr\u003e\nref: \u003ca href=\"https://qiita.com/hashitaku/items/814fa7641fdec8694d5f\" id=\"reference-e738b76023ed3d494938\"\u003eGoogle Testのテストケース名やテスト名にアンダースコアを使用してはいけない\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eもしJavascriptの単体テストフレームワークJestなどを使ったことがある人がこの記事を読んでいたらこう思うかもしれません。「テストケース名って一つしか書けないの？階層化できないの？」と。C++の著名な単体テストフレームワークでは今のところないような気がします。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eIUTEST_ASSERT_EQ\u003c/code\u003eは検査の本体部分です。この場合第二引数が(実際の値)が第一引数(想定した値)と等しいことを検査します。\u003c/p\u003e\n\n\u003cp\u003e比較系の検査マクロは大体どのフレームワークでも\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eEQ: ==\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eNE: !=\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eLT: \u0026lt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eLE: \u0026lt;=\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eGT: \u0026gt;\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eGE: \u0026gt;=\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eがあります。またiutestにはポインタの検査をするときに、Visual Studioのコード分析を効果的に使えるように専用のマクロがあり\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eIUTEST_ASSERT_NULL\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIUTEST_ASSERT_NOTNULL\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eを使うことで\u003ccode\u003e__analysis_assume\u003c/code\u003eを省略できます。\u003c/p\u003e\n\n\u003cp\u003e浮動小数点型を比較するとき、同値比較は行うな、という話がよくありますが、自分で誤差を考慮して比較するのは面倒なので\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eIUTEST_ASSERT_FLOAT_EQ\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eIUTEST_ASSERT_DOUBLE_EQ\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eがあります。これは\u003ca href=\"https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/\" rel=\"nofollow noopener\" target=\"_blank\"\u003e最下位桁単位を使った比較\u003c/a\u003eになります。\u003c/p\u003e\n\n\u003cp\u003e例外を投げるか検査するには\u003ccode\u003eIUTEST_ASSERT_THROW\u003c/code\u003e(与えられた型の例外を投げる)、\u003ccode\u003eIUTEST_ASSERT_ANY_THROW\u003c/code\u003e(なんか例外を投げる)、\u003ccode\u003eIUTEST_ASSERT_NO_THROW\u003c/code\u003e(例外を投げない)があります。\u003c/p\u003e\n\n\u003cp\u003eC++ではtemplate関数をよく書くと思いますが、これの検査をするときにいちいちそれぞれの型についてテストケースを作るのは面倒です。そこで型パラメータテストを利用します。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003eStringViewSplit\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eiutest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTest\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIUTEST_TYPED_TEST_CASE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStringViewSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eiutest\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eTypes\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar16_t\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003echar32_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eIUTEST_TYPED_TEST\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eStringViewSplit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003echain_front_by_singe_char\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eまず\u003ccode\u003e::iutest::Test\u003c/code\u003eを継承するクラスを作ります。これがテストケース名になります。\u003cbr\u003e\n次に\u003ccode\u003eIUTEST_TYPED_TEST_CASE(StringViewSplit, ::iutest::Types\u0026lt;char, wchar_t, char16_t, char32_t\u0026gt;);\u003c/code\u003eのようにして検査する型をすべて指定します。\u003cbr\u003e\nあとは\u003ccode\u003eIUTEST\u003c/code\u003eの代わりに\u003ccode\u003eIUTEST_TYPED_TEST\u003c/code\u003eにしてテストを書いていきます。\u003c/p\u003e\n\n\u003cp\u003eさらに詳しい情報は\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"http://iutest.osdn.jp/doc/index.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttp://iutest.osdn.jp/doc/index.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eiutestのドキュメントを見てください。またiutestはGoogle Testによく似ているので\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"http://opencv.jp/googletestdocs/primer.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e入門ガイド — Google Test ドキュメント日本語訳\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://opencv.jp/googletestdocs/advancedguide.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e上級ガイド — Google Test ドキュメント日本語訳\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなんかも参考になります。\u003c/p\u003e\n\n\u003cp\u003eこうして書いたテストをコンパイルして普通に実行するとテストが実行されます。実行するときに引数を渡すと特定のテストをskipしたりできるフレームワークもあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"どんな検査を書けばいいのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%82%93%E3%81%AA%E6%A4%9C%E6%9F%BB%E3%82%92%E6%9B%B8%E3%81%91%E3%81%B0%E3%81%84%E3%81%84%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどんな検査を書けばいいのか？\u003c/h2\u003e\n\n\u003cp\u003e単体テストフレームワークの使い方はわかっても何を検査すれば良いんだろう？というのは大きな悩みです。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eテストの書き方のコツってありますか\u003c/p\u003e— uint256_t (@uint256_t) \u003ca href=\"https://twitter.com/uint256_t/status/1020674573145010176?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2018年7月21日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e単体テストフレームワークの作り方やテスト駆動開発の方法は山のように紹介されているのにテストの書き方そのものってあまり見ない。\u003cbr\u003e俺たちは雰囲気とノリと勘と気分でテストを書いている(あかん \u003ca href=\"https://t.co/1aEmZcz9kz\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/1aEmZcz9kz\u003c/a\u003e\u003c/p\u003e— yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1020675241524146176?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2018年7月21日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e俺たちは雰囲気とノリと勘と気分でテストを書いている(あかん\u003c/p\u003e\n\n\u003cp\u003e・・・気を取り直して、どんな検査を書けば良いのか？(あるいは書かないべきか)ですが、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003cstrong\u003eすべての条件分岐を通るように検査する\u003c/strong\u003e: 特定のルートだけ検査したのでは不十分\u003c/li\u003e\n\u003cli\u003e例外が投げられる入力を与える検査をする: 意図した例外を投げているかは調べ忘れやすい\u003c/li\u003e\n\u003cli\u003e\n\u003cstrong\u003e未定義動作を起こす検査をしない\u003c/strong\u003e: 未定義動作を検知する方法はないのでそういう入力を与えない\u003c/li\u003e\n\u003cli\u003e条件分岐の境界値になるような入力を与える検査をする: 「以下」と「未満」を間違えたりド・モルガンの法則をど忘れするのはよくあるミスなので境界値を与えることで効率よくバグが見つかる\u003c/li\u003e\n\u003cli\u003e(型パラメータテストで)結果がportableにならない型は\u003ccode\u003eif constexpr\u003c/code\u003eで検査を弾く: →\u003ca href=\"https://qiita.com/yumetodo/items/c683acfa571dd5f9306a\" id=\"reference-5ddff8c1dae3bedbfbdc\"\u003eC++17のif constexprがあると嬉しかったシーンを具体的に\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e時間がかかりすぎる検査は可能ならば避ける: 時間がかかるテストは誰も実行しない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eが挙げられると個人的には思っています。多分もっとあるけど。\u003c/p\u003e\n\n\u003cp\u003e関数への入力に乱数を与えるのは一般にはテスト時間を長引かせるので本当に必要か考える必要があります。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://blog.goo.ne.jp/xmldtp/e/1d54a33d0bef7481f18907aef2ffd548\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://blog.goo.ne.jp/xmldtp/e/1d54a33d0bef7481f18907aef2ffd548\u003c/a\u003e\u003cbr\u003e\n単体テストのテストケースは（つまり、分岐・条件網羅のみを考えた場合）、\u003cbr\u003e\n分岐条件がなければ、１つの戻り値しか取れないので、１つの同値ケースとなり、\u003cbr\u003e\n１個のテストしか、しないでよい（このとき、このケースは正常系）。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e我々がプログラムを書くときに普通条件分岐がでてきますが、この条件分岐を書く動機がなんだったか振り返ると\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://blog.goo.ne.jp/xmldtp/e/1d54a33d0bef7481f18907aef2ffd548\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://blog.goo.ne.jp/xmldtp/e/1d54a33d0bef7481f18907aef2ffd548\u003c/a\u003e\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e分岐チェックする変数の値は、システムが扱うべき値であり、扱い方が異なるので、分岐が起きている\n大人と子供で料金が異なるというようなケース。\u003cbr\u003e\n同値ケースは別れ、それぞれテストする必要がある\u003c/li\u003e\n\u003cli\u003e分岐チェックする変数の値は、システムが扱うべき値の範囲外である\u003cbr\u003e\n大人が０、子供が１とコード化されているところにー１が入ってきたような場合\u003cbr\u003e\n範囲外の値をエラーとし、エラー処理を行う。\u003cbr\u003e\nその後、どうなるかは、仕様による\u003c/li\u003e\n\u003cli\u003e分岐チェックを行いたいが、そもそも、行える状態にない\u003cbr\u003e\n大人が１、子供が０というコード体系は、DBから拾ってくるが、そのDBにアクセスできない\u003cbr\u003e\nというもの。エラー、ないしは異常終了する\u003cbr\u003e\nその後、どうなるかは、仕様による\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eのように分類されます。この内1は一般に正常系と呼ばれます。2,3は異常系と呼ばれたり、2はワーニング系と呼ばれたり、3は例外系と呼ばれたりします。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"単体テストをいつ書くのか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%82%92%E3%81%84%E3%81%A4%E6%9B%B8%E3%81%8F%E3%81%AE%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単体テストをいつ書くのか\u003c/h2\u003e\n\n\u003cp\u003eテスト駆動開発という考え方があります。\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e作りたい機能を定める\u003c/li\u003e\n\u003cli\u003e機能を検証するテストを書く\u003c/li\u003e\n\u003cli\u003eテストが落ちることを確認する\u003c/li\u003e\n\u003cli\u003eテストが通るように実装する\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eというステップで開発していくわけですね。\u003c/p\u003e\n\n\u003cp\u003eこれの利点は\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e単体テストしやすく実装することが指標になるので\u003cstrong\u003eテストしづらい隠れた入力・出力がある実装が少なくなる\u003c/strong\u003e\n\u003c/li\u003e\n\u003cli\u003e行き当たりばったりな関数分けが減りコードの見通しが良くなる\u003c/li\u003e\n\u003cli\u003eなんでもやる関数が減る\u003c/li\u003e\n\u003cli\u003e仕様が明確になるのでドキュメントを書きやすくなる\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなどがあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"単体テストが機能していることを調べるにはどうしたら良いか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%8D%98%E4%BD%93%E3%83%86%E3%82%B9%E3%83%88%E3%81%8C%E6%A9%9F%E8%83%BD%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B%E3%81%AB%E3%81%AF%E3%81%A9%E3%81%86%E3%81%97%E3%81%9F%E3%82%89%E8%89%AF%E3%81%84%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e単体テストが機能していることを調べるにはどうしたら良いか\u003c/h2\u003e\n\n\u003cp\u003e単体テストを書いたとしてどのくらい単体テストが機能しているのか調べるにはどうしたら良いでしょうか？全部のテストをじっくり眺める？もうちょっと客観的で機械的な判断基準がほしいところです。さもないとテストの品質がわかりません。\u003c/p\u003e\n\n\u003cp\u003eテストの品質はテストの網羅率を測る=カバレッジ(coverage)を取ることで調べるのが一般的です。\u003c/p\u003e\n\n\u003cp\u003e網羅率の測定方法は\u003cbr\u003e\n\u003ca href=\"https://www.techmatrix.co.jp/t/quality/coverage.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://www.techmatrix.co.jp/t/quality/coverage.html\u003c/a\u003e\u003cbr\u003e\nにあるようにいろいろありますが最もよく使われるのは行カバレッジです。これは変数宣言などの処理でない部分は覗いて、処理部分のある行全体に対して実行された行が何行あるかの割合を求めるものです。\u003c/p\u003e\n\n\u003cp\u003eこの割合ですが一般に80%を超えるようにテストを書きましょうと言われています。100%にすることにこだわることはありません。\u003c/p\u003e\n\n\u003cp\u003egccでは\u003ccode\u003e-coverage\u003c/code\u003eをコンパイルオプションにつけてコンパイルし、実行することで\u003ccode\u003e.gcno\u003c/code\u003eという拡張子のファイルが生成されます。このままでは人間が読むには辛いので\u003cbr\u003e\n\u003ca href=\"https://github.com/linux-test-project/lcov\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/linux-test-project/lcov\u003c/a\u003e\u003cbr\u003e\nを用いて、変換してさらに\u003ccode\u003egenhtml\u003c/code\u003eを用いると読みやすいHTMLファイルに変換してくれます。\u003c/p\u003e\n\n\u003cp\u003eまた\u003ccode\u003egenhtml\u003c/code\u003eには掛けずに、\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://coveralls.io/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://coveralls.io/\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://codecov.io/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://codecov.io/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eのようなサービスに送信することで\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://coveralls.io/github/srz-zumix/iutest?branch=master\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://coveralls.io/github/srz-zumix/iutest?branch=master\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://codecov.io/gh/srz-zumix/iutest\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://codecov.io/gh/srz-zumix/iutest\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eカバレッジを公開することができます。このあと説明するCIを掛けるときに同時にカバレッジも測定してこうしたサービスに送信すると良いでしょう。\u003c/p\u003e\n\n\u003cp\u003eCMakeからカバレッジを取る作業をある程度自動化するには\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cmake\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"nb\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003eSTRING_SPLIT_ENABLE_COVERAGE\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"coverage enabled\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003einclude\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003eCodeCoverage\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eAPPEND_COVERAGE_COMPILER_FLAGS\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eset\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003eCOVERAGE_EXCLUDES \u003cspan class=\"s2\"\u003e\"*gcc*\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"*iutest*\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"*/usr/include/*\"\u003c/span\u003e \u003cspan class=\"s2\"\u003e\"*mingw*\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nf\"\u003eSETUP_TARGET_FOR_COVERAGE\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        NAME test_coverage       \u003cspan class=\"c1\"\u003e# New target name\u003c/span\u003e\n        EXECUTABLE basic_test          \u003cspan class=\"c1\"\u003e# Executable in PROJECT_BINARY_DIR\u003c/span\u003e\n        DEPENDENCIES basic_test        \u003cspan class=\"c1\"\u003e# Dependencies to build first\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eoption\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003eSTRING_SPLIT_ENABLE_COVERAGE_HTML \u003cspan class=\"s2\"\u003e\"enable coverage result to html\"\u003c/span\u003e TRUE\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003eSTRING_SPLIT_ENABLE_COVERAGE_HTML\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nb\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\"coverage result to html enabled\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eSETUP_TARGET_FOR_COVERAGE_TO_HTML\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n            NAME test_coverage_to_html                 \u003cspan class=\"c1\"\u003e# New target name\u003c/span\u003e\n            INFO_FILE_NAME test_coverage.info.cleaned  \u003cspan class=\"c1\"\u003e# coverage task result file name\u003c/span\u003e\n            DEPENDENCIES test_coverage                 \u003cspan class=\"c1\"\u003e# Dependencies(coverage task, etc...)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"nb\"\u003eendif\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"nb\"\u003eendif\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように書くことで(かなり省略してしまいましたが)カバレッジを取れます。(includeしているファイルは省略してます)\u003c/p\u003e\n\n\u003cp\u003e詳しくは\u003cbr\u003e\n\u003ca href=\"https://github.com/yumetodo/string_split\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/string_split\u003c/a\u003e\u003cbr\u003e\nを覗いてみてください。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e.travis.yml\u003c/code\u003eをみると分かると思いますが\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"yml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003emkdir build_release\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003emkdir build_debug\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ecd build_release\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ecmake -DCMAKE_BUILD_TYPE=Release ..\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003emake ci\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ecd ../build_debug\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003ecmake -DSTRING_SPLIT_ENABLE_COVERAGE=\"${USE_COVERALLS}\" -DCMAKE_BUILD_TYPE=Debug ..\u003c/span\u003e\n  \u003cspan class=\"pi\"\u003e-\u003c/span\u003e \u003cspan class=\"s\"\u003emake ci\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eだけでカバレッジ有効でビルドして実行して変換して後はcoveralls.ioに送信するだけになるようにcmakeを書いています。\u003c/p\u003e\n\n\u003cp\u003eこのようにカバレッジについてみてきましたが、行カバレッジは本当に品質を表しているか？という話もあって\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eコードの行数で図るのは全く意味をなさない。しかしやはり数で捉えたいものだ。テストの数ならどうだろう？\u003c/p\u003e— 173210 (@173210) \u003ca href=\"https://twitter.com/173210/status/789984039364988928?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2016年10月23日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eのような話が聞こえたりしてきます。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"cicd\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cicd\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCI/CD\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ciって何\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ci%E3%81%A3%E3%81%A6%E4%BD%95\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCIって何？\u003c/h2\u003e\n\n\u003cp\u003eまたしても日本語版Wikipediaから引っ張ってきましょう。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e継続的インテグレーション、CI（英: continuous integration）とは、主にプログラマーのアプリケーション作成時の品質改善や納期の短縮のための習慣のことである。エクストリーム・プログラミング (XP) のプラクティスの一つで、狭義にはビルドやテスト、インスペクションなどを継続的に実行していくことを意味する[1]。特に、1990年代後半以降の開発においては、継続的インテグレーションをサポートするソフトウェアを使用する傾向が強まってきた。 \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eもうすこし具体的には、gitを使った開発を前提として、commitがpushされるたびに、ビルド・テストの実行を行うことを自動化する、ということがCIと聞くとイメージされます。\u003c/p\u003e\n\n\u003cp\u003eビルドをするとかテストをするとかそういう作業は面倒極まりないので、単にcommitしてpushするだけで完結するようにしたいものです。そうすることで開発速度が上がるというメリットがあります。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"cdとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cd%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCDとは\u003c/h2\u003e\n\n\u003cp\u003eコンパクトディスクのことではありません(ｷﾘｯ\u003c/p\u003e\n\n\u003cp\u003econtinuous delivery(継続的デリバリー)の略だったりcontinuous deploy(継続的デプロイ)の略だったりしますが、実質的にはほぼ同じことを指すので厳密な違いを理解することに意味はありません。\u003c/p\u003e\n\n\u003cp\u003eつまるところ、CIの延長線で、せっかくCIでビルド自動化したのだから、ビルド・テストが成功していて、git tagが打たれていたらRelease作業も自動化してしまおうというものです。リリース作業も面倒ですからgit tag打つだけでやってくれたら楽ですよね？\u003c/p\u003e\n\n\u003cp\u003eビルド成果物をGithub Releaseに投げたり、どっかのサーバーにSSH経由で投げたりするのが一般的です。\u003c/p\u003e\n\n\u003cp\u003eCDのこともまとめてCIと呼んだりもします。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"c開発でcicdが必要な理由\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E9%96%8B%E7%99%BA%E3%81%A7cicd%E3%81%8C%E5%BF%85%E8%A6%81%E3%81%AA%E7%90%86%E7%94%B1\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++開発でCI/CDが必要な理由\u003c/h2\u003e\n\n\u003cp\u003eもちろん他の言語でもCI/CDは必要ですが、C++ではより重要です。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"cは言語処理系が複数ある\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E3%81%AF%E8%A8%80%E8%AA%9E%E5%87%A6%E7%90%86%E7%B3%BB%E3%81%8C%E8%A4%87%E6%95%B0%E3%81%82%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++は言語処理系が複数ある\u003c/h3\u003e\n\n\u003cp\u003eC++は言語処理系がgcc, clang, msvc, etc...と複数あります。\u003c/p\u003e\n\n\u003cp\u003e処理系依存の処理が書かれていたり、他の処理系でまだ実装されていない機能を使っているとそのライブラリは使いにくいものになってしまいます。特定環境に特化したライブラリというのもあるでしょうが、可能なら多くの環境で自分が作ったライブラリが動いてほしいですよね？\u003c/p\u003e\n\n\u003cp\u003eところが手元で複数の言語処理系をしかも複数のバージョンでビルドが通るか検証するのは非常に手間です。現実的にはいずれか単一の処理系だけで開発してしまうのではないでしょうか？\u003c/p\u003e\n\n\u003cp\u003eCIを組むことで複数の言語処理系での検証というのが現実的なコストになります。\u003c/p\u003e\n\n\u003cp\u003eまた、各言語処理系は完全ではないので、複数の言語処理系でクロスチェックすることでC++規格に準拠したコードが書けている可能性が高くなります。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"メンテナンスされたビルド方法のドキュメントになる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%A1%E3%83%B3%E3%83%86%E3%83%8A%E3%83%B3%E3%82%B9%E3%81%95%E3%82%8C%E3%81%9F%E3%83%93%E3%83%AB%E3%83%89%E6%96%B9%E6%B3%95%E3%81%AE%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88%E3%81%AB%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eメンテナンスされたビルド方法のドキュメントになる\u003c/h3\u003e\n\n\u003cp\u003eC++は言語公式でパッケージマネージャーを提供していませんし、もっといえば統一的なビルド方法も用意されていません。すべては開発者に委ねられています。\u003c/p\u003e\n\n\u003cp\u003eするとライブラリごとにビルド方法が異なる、という事態が現実に発生しています。もちろんビルド方法をきちんとドキュメント化すれば良いのでしょうが、ドキュメント化されたビルド方法でビルドできない、なんてことはしばしばあるのが現実です。\u003c/p\u003e\n\n\u003cp\u003eCIを組んでおけばCIを動かすビルドスクリプトはCIが通っていれば有効なビルド方法であることが保証できます。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"コード分析ツールを使いやすくなる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%82%B3%E3%83%BC%E3%83%89%E5%88%86%E6%9E%90%E3%83%84%E3%83%BC%E3%83%AB%E3%82%92%E4%BD%BF%E3%81%84%E3%82%84%E3%81%99%E3%81%8F%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eコード分析ツールを使いやすくなる\u003c/h3\u003e\n\n\u003cp\u003e例えばWindowsではgcc/clangが提供するサニタイザーの類は動きませんし、逆にmsvcのコード分析機能はWindowsじゃないと動きません。\u003c/p\u003e\n\n\u003cp\u003e鼻から悪魔が召喚されると噂の未定義動作や、メモリーリーク、不正なアドレスへのアクセスなどなどC++の開発には落とし穴がいっぱいありますから、コード分析ツールはフル活用したいものです。\u003c/p\u003e\n\n\u003cp\u003e先日もTwitterで\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003e世にも奇妙なソースコードが出てきたので紹介\u003cbr\u003e\u003cbr\u003e・乱数等は一切使っていないので出力すると毎回同じものが出力されるはずが毎回違うものが出力される。\u003cbr\u003e・3週間前は正常に動作していたが、今使ってみると全く正常に動作しない。\u003cbr\u003e・上記は外部ライブラリ等を使用していない状態でも起こる。\u003cbr\u003e\u003cbr\u003e怖い……。\u003c/p\u003e— std::gaccho( ¨̮ ); (@wanotaitei) \u003ca href=\"https://twitter.com/wanotaitei/status/1122178484753719296?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eApril 27, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/NdyDFpBgbI6uWgBn\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/NdyDFpBgbI6uWgBn\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eなんて話があったのですが、clangが提供するAddressSanitizerは一発で原因を教えてくれました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://pastebin.com/mvLwhiJE\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://pastebin.com/mvLwhiJE\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eCIでこうした分析ツールを掛けるようにしていれば一発で洗い出せましたね。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"どのようにciを組むか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%A9%E3%81%AE%E3%82%88%E3%81%86%E3%81%ABci%E3%82%92%E7%B5%84%E3%82%80%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eどのようにCIを組むか\u003c/h2\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ciツールサービスの選定\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ci%E3%83%84%E3%83%BC%E3%83%AB%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E3%81%AE%E9%81%B8%E5%AE%9A\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCIツール・サービスの選定\u003c/h3\u003e\n\n\u003cp\u003e昔は猫も杓子もJenkinsでやっていたらしいのですが(ほんとに？)、Jenkinsはメンテナンスが大変らしく(ほんとに?)、Jenkins専属おじさんが発生していたそうです。せっかく自動化したのにそれ専任の人が必要になるんだったら意味がなくね？\u003c/p\u003e\n\n\u003cp\u003e現代では主にDockerを技術的な背景としてビルド環境をDockerのコンテナとして作っておき、その上でビルドをできるようにするというサービスを複数の会社が提供しています。OSSプロジェクトは無料で使えることが多いですが、ビルドが並列化できない、遅いことが多く、速度を上げるには\u003cstrong\u003eカネの力で殴る\u003c/strong\u003eのが有効な解決策となります。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://dev.azure.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAzure Pipelines\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.bitrise.io/?referrer=a9c0b9baf7536067\" rel=\"nofollow noopener\" target=\"_blank\"\u003eBitrise\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://buddy.works/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eBuddy\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://circleci.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCircle CI\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.codacy.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodacy\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://codefresh.io/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodefresh\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://codeship.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCodeship\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://cloud.drone.io/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDrone Cloud\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://scrutinizer-ci.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eScrutinizer\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://semaphoreci.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSemaphore\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://shippable.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eShippable\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://travis-ci.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eTravis CI\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.wercker.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eWercker\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eDockerなのでOSはLinuxになることがほとんどです。ただデフォルトのdockerイメージ以外だと速度が遅くなる傾向があるように思います。\u003c/p\u003e\n\n\u003cp\u003eTravis CIは多分一番有名だと思いますし、迷ったらこれを使っとけば良い気がします。あとめっちゃ動作遅いですがTravis CIはmac OS上でも走らせてくれるサービスが合った気がします。\u003c/p\u003e\n\n\u003cp\u003eWindows上で走らせてくれるCIサービスと言えば\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.appveyor.com/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eAppVeyor\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://buildkite.com/features\" rel=\"nofollow noopener\" target=\"_blank\"\u003ebuildkite\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eがあります(カネを積めばもっとあるきがする)。AppVeyorはめっちゃ有名ですね。ただWindowsで動かせるCIサービスはめっちゃ少ないのでみんながこのサービスを使うもんだからめっちゃビルドが遅いです。branch絞って普段頻繁にいじるbranchは外すとかしたほうがいいかも・・・\u003cbr\u003e\n前はtea-ciなんてのもあったんですが\u003ca href=\"https://github.com/msys2/MINGW-packages/issues/2732\" rel=\"nofollow noopener\" target=\"_blank\"\u003emsys2のprojectでそれを無効化している\u003c/a\u003eところを見るに動かんのでしょうね・・・。\u003c/p\u003e\n\n\u003cp\u003eそういえばGitのサーバーとして有名なBitbucketはCIも持ってますね。結構高速に動くのでよい。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"cmakeできるようにする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#cmake%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCMakeできるようにする\u003c/h3\u003e\n\n\u003cp\u003eべつに必ずCMakeしないといけないわけではないのですが、CMakeを使ってビルドするのが徐々にデファクトスタンダートになりつつあるので、CMakeできるようにすると良いと思います。\u003c/p\u003e\n\n\u003cp\u003e方法は割愛しますが、\u003ccode\u003eadd_custom_target\u003c/code\u003e/\u003ccode\u003eadd_dependencies\u003c/code\u003eを駆使して\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eテスト実行までできるようにする\u003c/li\u003e\n\u003cli\u003eカバレッジを取れるようにする\u003c/li\u003e\n\u003cli\u003eサニタイザーを有効にしてビルド・実行できるようにする\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eのようにすると良いと思います。\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"ciを設定する\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ci%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCIを設定する\u003c/h3\u003e\n\n\u003cp\u003eCIサービスごとに手順が違いすぎて解説するには余白が足りません。ただ基本方針としては\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eビルドはwandboxにやらせてCIはそこへ投げるだけにする: iutest付属のiuwandbox.pyやCranberries Build Toolを使って投げる\u003c/li\u003e\n\u003cli\u003eビルドをCI上で行う\n\n\u003cul\u003e\n\u003cli\u003eaptコマンドなどを叩いてコンパイラや必要なライブラリを入れてからビルド\u003c/li\u003e\n\u003cli\u003eDockerイメージを作っておいてビルド\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eのようになると思います。\u003c/p\u003e\n\n\u003cp\u003e各CIサービスのドキュメントとにらめっこしつつ、先人たちがどうCIを使っているか設定ファイルを覗いてみると良いと思います。\u003c/p\u003e\n\n\u003cp\u003eiutestは\u003cdel\u003e頭がおかしいほど\u003c/del\u003eたくさんのCIサービスを利用しているので(上に上げたサービスのほぼ全部)いろんなサービスの設定の書き方が参考になると思います。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ciのバッジをreadmemdに貼ってアピールする\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#ci%E3%81%AE%E3%83%90%E3%83%83%E3%82%B8%E3%82%92readmemd%E3%81%AB%E8%B2%BC%E3%81%A3%E3%81%A6%E3%82%A2%E3%83%94%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eCIのバッジをREADME.mdに貼ってアピールする\u003c/h2\u003e\n\n\u003cp\u003eCIサービスはほとんどがCIの通過状況を小さな画像(バッジ)で提供してくれます。\u003cbr\u003e\n\u003ca href=\"https://ci.appveyor.com/project/srz-zumix/iutest/branch/master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fci.appveyor.com%2Fapi%2Fprojects%2Fstatus%2F2gdmgo8ce8m0iy0e%2Fbranch%2Fmaster%3Fsvg%3Dtrue?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3a07fe57f78af9219277271799d4673a\" alt=\"AppVeyor Build status\" data-canonical-src=\"https://ci.appveyor.com/api/projects/status/2gdmgo8ce8m0iy0e/branch/master?svg=true\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fci.appveyor.com%2Fapi%2Fprojects%2Fstatus%2F2gdmgo8ce8m0iy0e%2Fbranch%2Fmaster%3Fsvg%3Dtrue?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=16ef3a55fe0aa4285b22b73caf037663 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://dev.azure.com/srz-zumix/iutest/_build/latest?definitionId=4\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdev.azure.com%2Fsrz-zumix%2Fiutest%2F_apis%2Fbuild%2Fstatus%2Fsrz-zumix.iutest%3FbranchName%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=409ea3597ae8618ddcb4da458505bb21\" alt=\"Azure Pipelines Build Status\" data-canonical-src=\"https://dev.azure.com/srz-zumix/iutest/_apis/build/status/srz-zumix.iutest?branchName=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fdev.azure.com%2Fsrz-zumix%2Fiutest%2F_apis%2Fbuild%2Fstatus%2Fsrz-zumix.iutest%3FbranchName%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=c6d88ff1d919ae503e3d0a9ece60ea93 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://app.bitrise.io/app/6903498632e89465?referrer=a9c0b9baf7536067\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapp.bitrise.io%2Fapp%2F6903498632e89465%2Fstatus.svg%3Ftoken%3DsiumhVNY6p6lklSZF6xGNA%26branch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8ce2a2d5d18158abec3f5302261267cd\" alt=\"Bitrise iOS Build Status\" data-canonical-src=\"https://app.bitrise.io/app/6903498632e89465/status.svg?token=siumhVNY6p6lklSZF6xGNA\u0026amp;branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapp.bitrise.io%2Fapp%2F6903498632e89465%2Fstatus.svg%3Ftoken%3DsiumhVNY6p6lklSZF6xGNA%26branch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=d772417f261c8c2548f4e1b1eaf58876 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://app.buddy.works/zumixcpp/iutest/repository/branch/master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapp.buddy.works%2Fzumixcpp%2Fiutest%2Frepository%2Fbranch%2Fmaster%2Fbadge.svg%3Ftoken%3D5e58135ab4831252209e7b1fe75bfe9de669b0dc7e95ed4316eebad2187d59a0?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=fa1c5258bde4ffaced3093904ee5bb02\" alt=\"Buddy branch\" title=\"buddy branch\" data-canonical-src=\"https://app.buddy.works/zumixcpp/iutest/repository/branch/master/badge.svg?token=5e58135ab4831252209e7b1fe75bfe9de669b0dc7e95ed4316eebad2187d59a0\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapp.buddy.works%2Fzumixcpp%2Fiutest%2Frepository%2Fbranch%2Fmaster%2Fbadge.svg%3Ftoken%3D5e58135ab4831252209e7b1fe75bfe9de669b0dc7e95ed4316eebad2187d59a0?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=934698fb04c6e4f195852c5ff49f9ad0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://circleci.com/gh/srz-zumix/iutest/tree/master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcircleci.com%2Fgh%2Fsrz-zumix%2Fiutest%2Ftree%2Fmaster.svg%3Fstyle%3Dsvg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bd941b7438a598f993e75cf2fe448948\" alt=\"CircleCI\" data-canonical-src=\"https://circleci.com/gh/srz-zumix/iutest/tree/master.svg?style=svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcircleci.com%2Fgh%2Fsrz-zumix%2Fiutest%2Ftree%2Fmaster.svg%3Fstyle%3Dsvg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=778cf15081aff499fe763d6a9bf8c23f 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://cirrus-ci.com/github/srz-zumix/iutest/master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapi.cirrus-ci.com%2Fgithub%2Fsrz-zumix%2Fiutest.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9864a0a6d05f7bec2e0ec9e92ad6fe67\" alt=\"Cirrus Build Status\" data-canonical-src=\"https://api.cirrus-ci.com/github/srz-zumix/iutest.svg?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapi.cirrus-ci.com%2Fgithub%2Fsrz-zumix%2Fiutest.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8cf1e65738fa525360931416948d84e0 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://g.codefresh.io/pipelines/iutest_unittest/builds?repoOwner=srz-zumix\u0026amp;repoName=iutest\u0026amp;serviceName=srz-zumix%2Fiutest\u0026amp;filter=trigger:build%7EBuild;branch:master;pipeline:58a933be9d1bd40100495882%7Eiutest_unittest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fg.codefresh.io%2Fapi%2Fbadges%2Fpipeline%2Fsrz-zumix%2Fiutest%252Fiutest_unittest%3Fbranch%3Dmaster%26type%3Dcf-2?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=682f896bf0ee32fc9373187b0381a368\" alt=\"Codefresh build status\" data-canonical-src=\"https://g.codefresh.io/api/badges/pipeline/srz-zumix/iutest%2Fiutest_unittest?branch=master\u0026amp;type=cf-2\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fg.codefresh.io%2Fapi%2Fbadges%2Fpipeline%2Fsrz-zumix%2Fiutest%252Fiutest_unittest%3Fbranch%3Dmaster%26type%3Dcf-2?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=58ae039715f43a44f85e90da2e9d3ff5 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://codeship.com/projects/110695\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcodeship.com%2Fprojects%2F5bc87030-5b41-0133-6000-4242aa07dce3%2Fstatus%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=3ad600fe236534a3d232ab7577c85318\" alt=\"Codeship Status for srz-zumix/iutest\" data-canonical-src=\"https://codeship.com/projects/5bc87030-5b41-0133-6000-4242aa07dce3/status?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcodeship.com%2Fprojects%2F5bc87030-5b41-0133-6000-4242aa07dce3%2Fstatus%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=a7c354beaa139252e5b528eb02eb23e6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://cloud.drone.io/srz-zumix/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcloud.drone.io%2Fapi%2Fbadges%2Fsrz-zumix%2Fiutest%2Fstatus.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=8b2d0b6695910ea5e2fc741f288187ed\" alt=\"Drone Build Status\" data-canonical-src=\"https://cloud.drone.io/api/badges/srz-zumix/iutest/status.svg?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcloud.drone.io%2Fapi%2Fbadges%2Fsrz-zumix%2Fiutest%2Fstatus.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=5162b5b1a6f9830edba33af44eec8076 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://github.com/srz-zumix/iutest/actions?query=workflow%3A%22GitHub+Actions%22\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fsrz-zumix%2Fiutest%2Fworkflows%2FGitHub%2520Actions%2Fbadge.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=973a099a9a14cd9368721ae6661e2230\" alt=\"GitHub Actions Status\" data-canonical-src=\"https://github.com/srz-zumix/iutest/workflows/GitHub%20Actions/badge.svg?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fsrz-zumix%2Fiutest%2Fworkflows%2FGitHub%2520Actions%2Fbadge.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9f3f1e02e6a0887c8d455b08c082e6cf 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://gitlab.com/srz-zumix/iutest-test/commits/master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgitlab.com%2Fsrz-zumix%2Fiutest-test%2Fbadges%2Fmaster%2Fpipeline.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9cb3d60a9924882ee56e3dada881693a\" alt=\"GitLab CI pipeline status\" data-canonical-src=\"https://gitlab.com/srz-zumix/iutest-test/badges/master/pipeline.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgitlab.com%2Fsrz-zumix%2Fiutest-test%2Fbadges%2Fmaster%2Fpipeline.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=9dac89232309bcf385b46183bf17d271 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://www.peakflow.io/en/projects/iutest/build-groups?build_groups_q%5Bbranch_name_cont%5D=master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.peakflow.io%2Fen%2Fprojects%2Fiutest%2Fbranch-statuses%2Fmaster.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=907877e701fdb473439789528b5a0580\" alt=\"Peakflow Build Status\" data-canonical-src=\"https://www.peakflow.io/en/projects/iutest/branch-statuses/master.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fwww.peakflow.io%2Fen%2Fprojects%2Fiutest%2Fbranch-statuses%2Fmaster.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=43f2030a8d8681a5c4dc15efa09569b7 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://scrutinizer-ci.com/g/srz-zumix/iutest/build-status/master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fscrutinizer-ci.com%2Fg%2Fsrz-zumix%2Fiutest%2Fbadges%2Fbuild.png%3Fb%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=2be60772e93476df13e84342813b66d6\" alt=\"Scrutinizer Build Status\" data-canonical-src=\"https://scrutinizer-ci.com/g/srz-zumix/iutest/badges/build.png?b=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fscrutinizer-ci.com%2Fg%2Fsrz-zumix%2Fiutest%2Fbadges%2Fbuild.png%3Fb%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=28af562d4ad2548e2c6306672f27ec33 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://semaphoreci.com/srz_zumix/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fsemaphoreci.com%2Fapi%2Fv1%2Fsrz_zumix%2Fiutest%2Fbranches%2Fmaster%2Fbadge.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=358e890029393d5cfa84eb44ab07d232\" alt=\"Semaphore Build Status\" data-canonical-src=\"https://semaphoreci.com/api/v1/srz_zumix/iutest/branches/master/badge.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fsemaphoreci.com%2Fapi%2Fv1%2Fsrz_zumix%2Fiutest%2Fbranches%2Fmaster%2Fbadge.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6a3e90cb7c73d640c4e9649deebb90a1 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://iutest.semaphoreci.com/projects/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fiutest.semaphoreci.com%2Fbadges%2Fiutest%2Fbranches%2Fmaster.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26f3a838f27cf185f1b626d9c54347f8\" alt=\"Semaphore 2.0 Build Status\" data-canonical-src=\"https://iutest.semaphoreci.com/badges/iutest/branches/master.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fiutest.semaphoreci.com%2Fbadges%2Fiutest%2Fbranches%2Fmaster.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=601c92e0da670b99984224b761dbb09c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://app.shippable.com/github/srz-zumix/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapi.shippable.com%2Fprojects%2F541904d2ac22859af743f867%2Fbadge%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d1612cdec16fd16fed82c4ddb72fc5e4\" alt=\"Shippable Run Status\" data-canonical-src=\"https://api.shippable.com/projects/541904d2ac22859af743f867/badge?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapi.shippable.com%2Fprojects%2F541904d2ac22859af743f867%2Fbadge%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=65e0aff209469771fa963b93681f35af 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://travis-ci.com/srz-zumix/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ftravis-ci.com%2Fsrz-zumix%2Fiutest.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=67f53ea650489cb16bbdff84df98102e\" alt=\"Travis-CI Build Status\" data-canonical-src=\"https://travis-ci.com/srz-zumix/iutest.svg?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Ftravis-ci.com%2Fsrz-zumix%2Fiutest.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3d6f08933a9aa4ec91ae5ffc17080d77 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://app.wercker.com/project/bykey/d385156052aa4118a7f24affe4a8f851\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapp.wercker.com%2Fstatus%2Fd385156052aa4118a7f24affe4a8f851%2Fs%2Fmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=18ca2976abe6a7a14c3e39fe255ec1de\" alt=\"Wercker status\" title=\"wercker status\" data-canonical-src=\"https://app.wercker.com/status/d385156052aa4118a7f24affe4a8f851/s/master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapp.wercker.com%2Fstatus%2Fd385156052aa4118a7f24affe4a8f851%2Fs%2Fmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=99757e7a0cd1946f1e8d40e0c19a7431 1x\" loading=\"lazy\"\u003e\u003c/a\u003e      \u003ca href=\"https://www.codacy.com/app/srz-zumix/iutest?utm_source=github.com\u0026amp;amp;utm_medium=referral\u0026amp;amp;utm_content=srz-zumix/iutest\u0026amp;amp;utm_campaign=Badge_Grade\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapi.codacy.com%2Fproject%2Fbadge%2FGrade%2Fe6407b63c9c844d080ed71c7707bded9%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=7f639fec06b3965f21fa0eb36fba3c66\" alt=\"Codacy Badge\" data-canonical-src=\"https://api.codacy.com/project/badge/Grade/e6407b63c9c844d080ed71c7707bded9?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fapi.codacy.com%2Fproject%2Fbadge%2FGrade%2Fe6407b63c9c844d080ed71c7707bded9%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=eb54faa825f6d5f515c81ad3238c0538 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://codecov.io/gh/srz-zumix/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcodecov.io%2Fgh%2Fsrz-zumix%2Fiutest%2Fbranch%2Fmaster%2Fgraph%2Fbadge.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=b54c3e3eba5710563afda8998ce879c6\" alt=\"Codecov\" data-canonical-src=\"https://codecov.io/gh/srz-zumix/iutest/branch/master/graph/badge.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcodecov.io%2Fgh%2Fsrz-zumix%2Fiutest%2Fbranch%2Fmaster%2Fgraph%2Fbadge.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=8270b5fa2610c5919d82cd88da19d13d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://coveralls.io/github/srz-zumix/iutest?branch=master\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcoveralls.io%2Frepos%2Fgithub%2Fsrz-zumix%2Fiutest%2Fbadge.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=10edc5db8dfd222b46c0d69602030ccc\" alt=\"Coveralls Coverage Status\" data-canonical-src=\"https://coveralls.io/repos/github/srz-zumix/iutest/badge.svg?branch=master\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fcoveralls.io%2Frepos%2Fgithub%2Fsrz-zumix%2Fiutest%2Fbadge.svg%3Fbranch%3Dmaster?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=44f9340839460292a1a576881ef31413 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://scan.coverity.com/projects/srz-zumix-iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://scan.coverity.com/projects/1316/badge.svg\" alt=\"Coverity Scan Build Status\" data-canonical-src=\"https://scan.coverity.com/projects/1316/badge.svg\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://dashboard.guardrails.io/default/gh/srz-zumix/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbadges.guardrails.io%2Fsrz-zumix%2Fiutest.svg%3Ftoken%3Dfe1bb5ca5f743800d26e4d2b7282c5b316df83c0b228048f4192510bdd7280f0?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=9d1563fed6fa10969142d63e273312bb\" alt=\"GuardRails badge\" data-canonical-src=\"https://badges.guardrails.io/srz-zumix/iutest.svg?token=fe1bb5ca5f743800d26e4d2b7282c5b316df83c0b228048f4192510bdd7280f0\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbadges.guardrails.io%2Fsrz-zumix%2Fiutest.svg%3Ftoken%3Dfe1bb5ca5f743800d26e4d2b7282c5b316df83c0b228048f4192510bdd7280f0?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=6df47dc04bafb7c6bfc86ae5849633fb 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://github.com/srz-zumix/iutest/actions?query=workflow%3A%22GitHub+Actions+-+reviewdog%22\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fsrz-zumix%2Fiutest%2Fworkflows%2FGitHub%2520Actions%2520-%2520reviewdog%2Fbadge.svg%3Fbranch%3Ddevelop?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=bafb863b7f45c6b83c2c18343ed9f531\" alt=\"GitHub Actions reviewdog Status\" data-canonical-src=\"https://github.com/srz-zumix/iutest/workflows/GitHub%20Actions%20-%20reviewdog/badge.svg?branch=develop\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fgithub.com%2Fsrz-zumix%2Fiutest%2Fworkflows%2FGitHub%2520Actions%2520-%2520reviewdog%2Fbadge.svg%3Fbranch%3Ddevelop?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=b418df114cf9b8dea8f36ec2bbf36b3d 1x\" loading=\"lazy\"\u003e\u003c/a\u003e   \u003ca href=\"http://opensource.org/licenses/BSD-3-Clause\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fimg.shields.io%2Fbadge%2Flicense-New_BSD-blue.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=4eec74a65dcd6eea0b3058b8a072403e\" alt=\"New(3-clause) BSD License\" data-canonical-src=\"https://img.shields.io/badge/license-New_BSD-blue.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fimg.shields.io%2Fbadge%2Flicense-New_BSD-blue.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=ef97751d67de0a73fef92ada66b7c863 1x\" loading=\"lazy\"\u003e\u003c/a\u003e \u003ca href=\"https://badge.fury.io/nu/iutest\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbadge.fury.io%2Fnu%2Fiutest.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=5732251a63c392e176d7c19b33f489e8\" alt=\"NuGet version\" data-canonical-src=\"https://badge.fury.io/nu/iutest.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fbadge.fury.io%2Fnu%2Fiutest.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=08f65eb605c90f94a54d1cdd523749e6 1x\" loading=\"lazy\"\u003e\u003c/a\u003e   \u003ca href=\"http://amzn.asia/6fNxDZU\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fimg.shields.io%2Fbadge%2F%2524-support-orange.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=f0d9c0bda1fc8b73da400f0f23722603\" alt=\"support\" data-canonical-src=\"https://img.shields.io/badge/%24-support-orange.svg\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fimg.shields.io%2Fbadge%2F%2524-support-orange.svg?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=1d31acaf6cf5df3545fbf3c47f66b93c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eこういうのをREADME.mdに貼っておくとアピールになるでしょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結局ライブラリ作者はなにをするべきか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E5%B1%80%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E4%BD%9C%E8%80%85%E3%81%AF%E3%81%AA%E3%81%AB%E3%82%92%E3%81%99%E3%82%8B%E3%81%B9%E3%81%8D%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結局ライブラリ作者はなにをするべきか\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e単体テストを書く\u003c/li\u003e\n\u003cli\u003eCIを組む\n\n\u003cul\u003e\n\u003cli\u003eビルドする\u003c/li\u003e\n\u003cli\u003eテストを動かす\u003c/li\u003e\n\u003cli\u003eカバレッジを取る\u003c/li\u003e\n\u003cli\u003eコード分析ツールを動かす\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"リンク集\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AA%E3%83%B3%E3%82%AF%E9%9B%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eリンク集\u003c/h1\u003e\n\n\u003cp\u003eこの記事を読み終わったらぜひ読んでほしいQiita記事です。特に \u003ca href=\"/nonbiri15\" class=\"user-mention js-hovercard\" title=\"nonbiri15\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"nonbiri15\"\u003e@nonbiri15\u003c/a\u003e 氏の記事はここに上げた以外にも参考になる記事が多く上がっています。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"d68bdb347283ee2dbccf\"\u003eスピード感重視なのでテストは書かない。テストはなぜ開発を遅くするか\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/aimof/items/849ded1293495d3bbb50\" id=\"reference-a001fbd95d45a1a69b53\"\u003e仕様変更に弱いからテストは書かない……？(´・ω・`)＜仕様変更を想定するならテストを書いてくれ頼む\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/nonbiri15/items/d3eac4a6bfb8fc770c15\" id=\"reference-43e541ad3c120828c184\"\u003eモグラたたき開発を卒業しよう\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/nonbiri15/items/015494c7c624748a5974\" id=\"reference-6f290d336a97e0c187c3\"\u003eモグラたたき開発を卒業しよう　対策編\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/nonbiri15/items/17b37664f94d4b1784aa\" id=\"reference-015abe7381c026c47563\"\u003e継続的インテグレーション(デリバリー)サービスを利用しないという罪悪\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/nonbiri15/items/340f06bc72e84cd871a8\" id=\"reference-78709573462f60cb7976\"\u003e若手エンジニアを不幸にしないための開発の「べからず」集　テスト編\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"license\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#license\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLicense\u003c/h1\u003e\n\n\u003cp\u003eCC BY-SA 3.0\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://camo.qiitausercontent.com/c12f8f7e43ee01c8f4dedf0edd0f16d3f583be2d/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f642f64302f43432d42592d53415f69636f6e2e737667\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://camo.qiitausercontent.com/c12f8f7e43ee01c8f4dedf0edd0f16d3f583be2d/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f642f64302f43432d42592d53415f69636f6e2e737667\" alt=\"CC BY SA\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"注釈\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%B3%A8%E9%87%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e注釈\u003c/h1\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e中学校学校では数学1で文字を用いた方程式などと負の数に拡張された比例関係を学び、数学2で１次関数という流れ \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003e一松信他 中学校数学２ 学校図書 2009 ISBN: 978-4-7625-5098-1 \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"# 対象者\n\n[C++erを簡易的にレベル分けすることで初心者詐欺を減らそうという試み](https://qiita.com/yumetodo/items/a843bd542106215bbc84)\nでいうC++初心者以上であることが前提です。\n\nまた日本の義務教育ないしそれに相当するものを終了していることも条件とします。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eCl、まだチュートリアル以前で\u003cbr\u003eなんのために存在しているのか未だにわかっていません……。\u003c/p\u003e\u0026mdash; std::gaccho( ¨̮ ); (@wanotaitei) \u003ca href=\"https://twitter.com/wanotaitei/status/1122112931766816768?ref_src=twsrc%5Etfw\"\u003eApril 27, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e単体テストって１つのソースファイルのみを入れて実行するやつですかね？\u003cbr\u003e\u003cbr\u003e(名称をよくわかっていない)\u003c/p\u003e\u0026mdash; std::gaccho( ¨̮ ); (@wanotaitei) \u003ca href=\"https://twitter.com/wanotaitei/status/1122114127487365121?ref_src=twsrc%5Etfw\"\u003eApril 27, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n「砂糖ってしょっぱいですよね？」級の発言をしているあなたでも大丈夫！1から、・・・いいえ、0から始めましょう！( @Gaccho 氏へのdisがひどい)\n\n# これまであなたはどうやってプログラムを書いてきましたか？\n\n- ちょっとずつプログラムを大きくして\n- こまめにコメントアウトしながらmain関数を書き換えながら・・・\n- ノリと勢いで\n- 目についた不具合があったら都度直して\n- なんとなく検索で引っかかるコードをコピペで継ぎ接ぎして\n- 気分で関数わけ\n- よくわかんないけど、うまくいくようになった\n\nなんてかんじでしょうか？\n\nこういうのを「もぐらたたき開発」なんて言ったりすることがあります。\n\n# もぐらたたき開発の限界\n\nもぐらたたき開発でもプロジェクトがごくごく小規模であれば成立してしまったりします。また個人開発しているとなおさらその傾向が強くなります\n\nしかし規模が大きくなるにつれて\n\n- ソフトウェアの世代が変わったときに、一度は枯れたバグが復活している\n- 実装の仕様がふらふらしている\n- 発生するかもしれない要因に対して予め準備するのではなく、発生してから考える。\n- ある作業を実施できる人、対応できる人を1人のままにしている\n- バグの調査が難しくなる\n- コードが把握しきれなくなる\n- 手を出せない魔の領域ができる\n- 成果物としてメンテナンスされ続けるドキュメントが明確になっていない\n\nなどの問題ができてきて、次第に改修困難になり最終的には破棄処分せざるを得なくなります。\n\nそれでも金の力で人月を浪費して無理やり押し切る、なんてケースも有るようですが、とくに趣味開発では自分のモチベが絶対なので、こんなことが起きたらモチベが続かなくなります。\n\n# もぐらたたき開発をやめるための武器\n\nもちろんDRY原則を始めとするコーディング上のベストプラクティスの導入なんかも重要なのですが、そういったベストプラクティス導入を**動機づける**武器があります。\n\nそれが単体テストとCIです。\n\n# 単体テスト\n\nまずはみんな大好きWikipediaの日本語版を見てみましょう。\n\n\u003eコンピュータプログラミングにおいて単体テスト（たんたいテスト）あるいはユニットテスト（英語: Unit test）とは、ソースコードの個々のユニット、すなわち、1つ以上のコンピュータプログラムモジュールが使用に適しているかどうかを決定するために、関連する制御データ、使用手順、操作手順とともにテストする手法である[1]。ユニットとはアプリケーションのテスト可能な最小の部品単位である、と直観的にとらえることができる。手続き型プログラミングでは、ユニットは、モジュール全体のこともあるが、より一般的には、個々の関数や手続きである。オブジェクト指向プログラミングでは、ユニットは、クラスなどのインタフェース全体だが、個々のメソッドであることもある[2]。単体テストは開発プロセス中にプログラマー、時にはホワイトボックステスターによって作成される。\n\nいきなりこれ読んで分かるならもうこの記事読まなくて大丈夫です。よい旅路を。\n\n表面的にはユニットに対してなんらかの検査を行うのが単体テストです。\n\nユニットが何たるかというとC++においては、概ね関数ないしクラスが該当します。つまり関数単位での検査が主になると思います。でもそもそも関数ってなんでしたっけ？\n\n## 関数とは(義務教育に立ち返って)\n\n日本人が「関数」という単語を初めに習うのは中学2年の数学の時間で1次関数を習うときだと思われます[^1]。手元にあった学校図書から出ている平成17年に教科書検定を通った中学校数学2[^2]の教科書では\n\n\u003e (前略)ともなって変わる2つの変数x, yがあって、xの値を決めるとそれに対応するyがただ一つ決まるとき、**yはxの関数である**といいます。\n\nと書かれていました。懐かしいですね！\n\n様々問題はあるものの教科書検定を通り抜けてきた教科書をなめてはいけません。優秀な皆さんはまさか中学校の教科書を捨てる、などという蛮行にはでていないはずなので探せば中学校数学の教科書は見つかるはずですからぜひ自分でも調べてみてください。えっ、捨てちゃった？しょうがないなぁ～、**買え**。\n\nちなみに学校で使われる教科書は普通の書店では手に入らず教科書配給会社から買う必要があります。東京都内ならJR中央・総武各駅停車の大久保駅でてすぐ(または新宿駅から徒歩15～20分)の第一教科書で買えます(土日祝休み)。近くの小滝橋通りはラーメン激戦区なのでついでにラーメンも食べていきましょう。~~[古武士](https://tabelog.com/tokyo/A1304/A130401/13041385/)はええぞ。~~\n\nさてその教科書に興味深いことが書かれています。\n\n\u003e「関数」ということばは、英語の「function」の訳です。「function」には\"機能\"とか\"働き\"という意味があります\n\u003e\n\u003e「function」の「fun」は中国語の「\u003cruby\u003e函\u003crt\u003eファン\u003c/rt\u003e\u003c/ruby\u003e」の発音と似ているため、「function」は中国では「函数」という用語を使い、「ファンスウ」と発音しています。\n\u003e\n\u003e日本でも以前は「\u003cruby\u003e函数\u003crt\u003eかんすう\u003c/rt\u003e\u003c/ruby\u003e」と書いていましたが、使用漢字の制限により「関数」と改められました。\n\u003e\n\u003e「関」には\"かかわる\"という意味があり、「関数」は数量の関係を表していることばと考えることができます。\n\u003e\n\u003e![関数.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/ac7d2f45-9564-fcb7-0f3a-91686142290d.png)\n\n特にこの図に注目してください。**入力に対して何らかの変換をし、出力するという機能が関数である**、ということがよく分かる図です。この図を書いた人は神か!?まじで教科書検定を通り抜けてきた教科書なめたらあかんで！\n\n## 関数とは(C++において)\n\nC++における関数とはなんぞやについては\n[関数の創世から深淵まで駆け抜ける関数とはなんぞや講座](https://qiita.com/yumetodo/items/cdfb41781d32d98be1b4)\nで解説済みです。\n\nしかし、関数の本質は上で述べた**入力に対して何らかの変換をし、出力するという機能**であるということはなんら揺らぐものであありません。\n\n### 明示的な入力と明示的な出力\n\n```cpp\nint f(int n) { return n * 3 + 10; }\n```\n\nという関数を考えてみることにします。\n\nまず入力は何でしょうか？もちろん引数`n`ですよね。\n\nでは出力は何でしょうか？もちろん戻り値が出力ですね。\n\nC++では引数経由で値を返すなんてこともとくにC++11より前の時代では盛んに行われていましたし、現代でも`std::error_code`へのlvalue referenceを引数に取ってエラー返却する例もありますね。\n\n[![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/94177/7a6872dd-93db-31ef-be59-76847dfd549a.png)](https://www.slideshare.net/chihayatakatuki/boost-asio)\n( @YukiMiyatake 氏の「BoostAsioで可読性を求めるのは間違っているだろうか 」より)\n\nhttps://www.boost.org/doc/libs/1_70_0/doc/html/boost_asio/reference/basic_yield_context/operator_lb__rb_.html\n\n```cpp\nbasic_yield_context operator[](boost::system::error_code \u0026 ec) const;\n```\n\nまたそもそもC++には例外があるのでこれもまた出力ですよね。\n\n### 隠れた入力がある例\n\nC++においては関数に値を渡すのはなにも引数だけとは限りません。\n\n- static storageの変数\n- thread loacal storageの変数\n\nも入力となりえます。\n\n```cpp\nstatic int n;\nint f() { return n * 3 + 10; }\nint g()\n{\n    static int n = 0;\n    return n++;\n}\n```\n\n引数として渡すわけでもないのに関数を呼び出す前に何らかの操作が必要になるような例が隠れた入力であることが多いです。\n\n### 隠れた出力がある例\n\n隠れた入力と同様にして、隠れた出力が存在します。\n\n\u003ehttp://okapies.hateblo.jp/entry/2016/12/15/021550\n\n```csharp\npublic void processNext() {\n    Message message = InboxQueue.popMessage();\n\n    if (message != null) {\n        process(message);\n    }\n}\n```\n\n\u003eこの関数は、構文を見るかぎりは何も入力を取らず何も出力を返さないように見えるが、何かに対して明らかに依存しているし、明らかに何かをしている。実は、この関数には入力と出力の組が隠れている。その隠れた入力とは`popMessage()`を呼び出す前の`InboxQueue`の状態だ。そして、隠れた出力とは`process`が引き起こしたあらゆる結果と、それに加えて、処理が終わった後の`InboxQueue`の状態だ。\n\u003e\n\u003e間違いなく`InboxQueue`の状態はこの関数の本物の入力だ。その値を知らなければ`processNext`の挙動も分からない。そして、出力の方も本物だ。`processNext`を呼び出した結果は、`InboxQueue`の新たな状態を考慮しないと完全に理解することはできない。\n\n## 関数単位で単体テストを行うとは\n\nようやく本題。関数とは入力に対して何らかの変換をし、出力するという機能であると前に述べましたが、**関数単位で単体テストを行うとは、関数に対して何かしらの入力を与え、出力が想定通りか検査するプログラムを記述すること**です。\n\n## 追記: テストしやすい関数とは\n\nずーっとこの図を探していて見つけられなかったのですが、ふとしたきっかけで見つけたので紹介しておきます。\n\n[新人プログラマに知っておいてもらいたい人類がオブジェクト指向を手に入れるまでの軌跡](https://qiita.com/hirokidaichi/items/591ad96ab12938878fe1)\nにちょうどいい画像があるのでお借りしよう。\n![スクリーンショット 2014-05-12 21.51.26.png](https://qiita-image-store.s3.amazonaws.com/0/35671/04cb4681-c28e-5f35-5fba-6f6fb45c0b61.png \"スクリーンショット 2014-05-12 21.51.26.png\")\n\n隠れた入力や出力がない関数のほうがテストしやすいし、またそういう関数をつくるべきです。\n\n隠れた入力や出力をしたくなったときはそれを明示的な入力や出力に変換するラッパー関数を書いてそれを使うようにすると排除できるように思います。\n\n# どのように単体テストを記述するか\n\n## 単体テストフレームワークの選出\n\nRustみたいに言語そのものでテストの方法が提供されていれば素晴らしいのですが、残念ながらそのようなことはC++ではないので、誰かが作ったテストフレームワークをまず選ぶところから始めます。\n\nテストフレームワークに求められる必須要件はクロスプラットフォームな[xUnit](https://ja.wikipedia.org/wiki/XUnit)であることです。そうでないものは使い物にならないので使わないでください。\n\n有名なのは\n\n- GoogleTest\n- Boost.Test\n\nでしょうか。今回はGoogleTestによく似ていて私が愛用している @srz_zumix 氏作のiutestを利用します。\n\nhttps://github.com/srz-zumix/iutest\n\niutestはヘッダーオンリーなのでincludeするだけで使えます。\n\n## 単体テストフレームワークの使い方を覚える\n\nC++の単体テストフレームワークは概ねどれもC++言語にリフレクションがないことも相まって、マクロの塊です。\n\nしたがってちょっと癖のある書き方になります。\n\nまず通常と同じくmain関数を・・・と言いたいところですが\n\n```cpp\n#define IUTEST_USE_MAIN 1\n#include \u003ciutest.hpp\u003e\n```\n\nしておくことでiutestのヘッダーをincludeしたときにmain関数も定義してくれます。言い換えるとどこか一つの翻訳単位でのみ定義してください(さもないと翻訳単位ごとにmain関数が作られて衝突する)。\n\nではテストを書いていきます。\n\n```cpp\nint f(int n) { return n * 3 + 10; }\n```\n\nのような関数に対して\n\n```cpp\nIUTEST(MyTest, f)\n{\n    int x = 0;\n    IUTEST_ASSERT_EQ(10, f(0));\n    IUTEST_ASSERT_EQ(13, f(1));\n}\n```\n\nのように書きます。詳しく見ていきましょう。\n\nまず`IUTEST(MyTest, f)`ではテストケース名とテスト名を書きます。テスト名は迷ったら対象の関数名にしとけばいいです。テストケース名はとりあえずはテストを束ねたものと思ってもらって構いません。**ただしCamelCaseで書きましょう。より正確には`_`を使ってはいけません。**これはC++特有の事情によるものです。詳細は\n[よくある質問 — Google Test ドキュメント日本語訳](http://opencv.jp/googletestdocs/FAQ.html#faq-why-should-not-test-case-names-and-test-names-contain-underscore)\nに譲りますが、C++では`__`(アンダースコアの連続)を含む識別名(関数名とか)が予約されているため使ってはいけないことに起因します。\nref: [Google Testのテストケース名やテスト名にアンダースコアを使用してはいけない](https://qiita.com/hashitaku/items/814fa7641fdec8694d5f)\n\nもしJavascriptの単体テストフレームワークJestなどを使ったことがある人がこの記事を読んでいたらこう思うかもしれません。「テストケース名って一つしか書けないの？階層化できないの？」と。C++の著名な単体テストフレームワークでは今のところないような気がします。\n\n`IUTEST_ASSERT_EQ`は検査の本体部分です。この場合第二引数が(実際の値)が第一引数(想定した値)と等しいことを検査します。\n\n比較系の検査マクロは大体どのフレームワークでも\n\n- `EQ: ==`\n- `NE: !=`\n- `LT: \u003c`\n- `LE: \u003c=`\n- `GT: \u003e`\n- `GE: \u003e=`\n\nがあります。またiutestにはポインタの検査をするときに、Visual Studioのコード分析を効果的に使えるように専用のマクロがあり\n\n- `IUTEST_ASSERT_NULL`\n- `IUTEST_ASSERT_NOTNULL`\n\nを使うことで`__analysis_assume`を省略できます。\n\n浮動小数点型を比較するとき、同値比較は行うな、という話がよくありますが、自分で誤差を考慮して比較するのは面倒なので\n\n- `IUTEST_ASSERT_FLOAT_EQ`\n- `IUTEST_ASSERT_DOUBLE_EQ`\n\nがあります。これは[最下位桁単位を使った比較](https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/)になります。\n\n例外を投げるか検査するには`IUTEST_ASSERT_THROW`(与えられた型の例外を投げる)、`IUTEST_ASSERT_ANY_THROW`(なんか例外を投げる)、`IUTEST_ASSERT_NO_THROW`(例外を投げない)があります。\n\nC++ではtemplate関数をよく書くと思いますが、これの検査をするときにいちいちそれぞれの型についてテストケースを作るのは面倒です。そこで型パラメータテストを利用します。\n\n```cpp\ntemplate\u003ctypename T\u003e\nstruct StringViewSplit : public ::iutest::Test {};\nIUTEST_TYPED_TEST_CASE(StringViewSplit, ::iutest::Types\u003cchar, wchar_t, char16_t, char32_t\u003e);\nIUTEST_TYPED_TEST(StringViewSplit, chain_front_by_singe_char)\n{\n}\n```\n\nまず`::iutest::Test`を継承するクラスを作ります。これがテストケース名になります。\n次に`IUTEST_TYPED_TEST_CASE(StringViewSplit, ::iutest::Types\u003cchar, wchar_t, char16_t, char32_t\u003e);`のようにして検査する型をすべて指定します。\nあとは`IUTEST`の代わりに`IUTEST_TYPED_TEST`にしてテストを書いていきます。\n\nさらに詳しい情報は\n\nhttp://iutest.osdn.jp/doc/index.html\n\niutestのドキュメントを見てください。またiutestはGoogle Testによく似ているので\n\n- [入門ガイド — Google Test ドキュメント日本語訳](http://opencv.jp/googletestdocs/primer.html)\n- [上級ガイド — Google Test ドキュメント日本語訳](http://opencv.jp/googletestdocs/advancedguide.html)\n\nなんかも参考になります。\n\nこうして書いたテストをコンパイルして普通に実行するとテストが実行されます。実行するときに引数を渡すと特定のテストをskipしたりできるフレームワークもあります。\n\n## どんな検査を書けばいいのか？\n\n単体テストフレームワークの使い方はわかっても何を検査すれば良いんだろう？というのは大きな悩みです。\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eテストの書き方のコツってありますか\u003c/p\u003e\u0026mdash; uint256_t (@uint256_t) \u003ca href=\"https://twitter.com/uint256_t/status/1020674573145010176?ref_src=twsrc%5Etfw\"\u003e2018年7月21日\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e単体テストフレームワークの作り方やテスト駆動開発の方法は山のように紹介されているのにテストの書き方そのものってあまり見ない。\u003cbr\u003e俺たちは雰囲気とノリと勘と気分でテストを書いている(あかん \u003ca href=\"https://t.co/1aEmZcz9kz\"\u003ehttps://t.co/1aEmZcz9kz\u003c/a\u003e\u003c/p\u003e\u0026mdash; yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1020675241524146176?ref_src=twsrc%5Etfw\"\u003e2018年7月21日\u003c/a\u003e\u003c/blockquote\u003e\n\n俺たちは雰囲気とノリと勘と気分でテストを書いている(あかん\n\n・・・気を取り直して、どんな検査を書けば良いのか？(あるいは書かないべきか)ですが、\n\n- **すべての条件分岐を通るように検査する**: 特定のルートだけ検査したのでは不十分\n- 例外が投げられる入力を与える検査をする: 意図した例外を投げているかは調べ忘れやすい\n- **未定義動作を起こす検査をしない**: 未定義動作を検知する方法はないのでそういう入力を与えない\n- 条件分岐の境界値になるような入力を与える検査をする: 「以下」と「未満」を間違えたりド・モルガンの法則をど忘れするのはよくあるミスなので境界値を与えることで効率よくバグが見つかる\n- (型パラメータテストで)結果がportableにならない型は`if constexpr`で検査を弾く: →[C++17のif constexprがあると嬉しかったシーンを具体的に](https://qiita.com/yumetodo/items/c683acfa571dd5f9306a)\n- 時間がかかりすぎる検査は可能ならば避ける: 時間がかかるテストは誰も実行しない\n\nが挙げられると個人的には思っています。多分もっとあるけど。\n\n関数への入力に乱数を与えるのは一般にはテスト時間を長引かせるので本当に必要か考える必要があります。\n\n\u003ehttps://blog.goo.ne.jp/xmldtp/e/1d54a33d0bef7481f18907aef2ffd548\n\u003e単体テストのテストケースは（つまり、分岐・条件網羅のみを考えた場合）、\n分岐条件がなければ、１つの戻り値しか取れないので、１つの同値ケースとなり、\n１個のテストしか、しないでよい（このとき、このケースは正常系）。\n\n我々がプログラムを書くときに普通条件分岐がでてきますが、この条件分岐を書く動機がなんだったか振り返ると\n\n\u003ehttps://blog.goo.ne.jp/xmldtp/e/1d54a33d0bef7481f18907aef2ffd548\n\u003e\n1. 分岐チェックする変数の値は、システムが扱うべき値であり、扱い方が異なるので、分岐が起きている\n大人と子供で料金が異なるというようなケース。  \n同値ケースは別れ、それぞれテストする必要がある\n2. 分岐チェックする変数の値は、システムが扱うべき値の範囲外である  \n大人が０、子供が１とコード化されているところにー１が入ってきたような場合  \n範囲外の値をエラーとし、エラー処理を行う。  \nその後、どうなるかは、仕様による\n3. 分岐チェックを行いたいが、そもそも、行える状態にない  \n大人が１、子供が０というコード体系は、DBから拾ってくるが、そのDBにアクセスできない  \nというもの。エラー、ないしは異常終了する  \nその後、どうなるかは、仕様による\n\nのように分類されます。この内1は一般に正常系と呼ばれます。2,3は異常系と呼ばれたり、2はワーニング系と呼ばれたり、3は例外系と呼ばれたりします。\n\n## 単体テストをいつ書くのか\n\nテスト駆動開発という考え方があります。\n\n1. 作りたい機能を定める\n2. 機能を検証するテストを書く\n3. テストが落ちることを確認する\n4. テストが通るように実装する\n\nというステップで開発していくわけですね。\n\nこれの利点は\n\n- 単体テストしやすく実装することが指標になるので**テストしづらい隠れた入力・出力がある実装が少なくなる**\n- 行き当たりばったりな関数分けが減りコードの見通しが良くなる\n- なんでもやる関数が減る\n- 仕様が明確になるのでドキュメントを書きやすくなる\n\nなどがあります。\n\n## 単体テストが機能していることを調べるにはどうしたら良いか\n\n単体テストを書いたとしてどのくらい単体テストが機能しているのか調べるにはどうしたら良いでしょうか？全部のテストをじっくり眺める？もうちょっと客観的で機械的な判断基準がほしいところです。さもないとテストの品質がわかりません。\n\nテストの品質はテストの網羅率を測る=カバレッジ(coverage)を取ることで調べるのが一般的です。\n\n網羅率の測定方法は\nhttps://www.techmatrix.co.jp/t/quality/coverage.html\nにあるようにいろいろありますが最もよく使われるのは行カバレッジです。これは変数宣言などの処理でない部分は覗いて、処理部分のある行全体に対して実行された行が何行あるかの割合を求めるものです。\n\nこの割合ですが一般に80%を超えるようにテストを書きましょうと言われています。100%にすることにこだわることはありません。\n\ngccでは`-coverage`をコンパイルオプションにつけてコンパイルし、実行することで`.gcno`という拡張子のファイルが生成されます。このままでは人間が読むには辛いので\nhttps://github.com/linux-test-project/lcov\nを用いて、変換してさらに`genhtml`を用いると読みやすいHTMLファイルに変換してくれます。\n\nまた`genhtml`には掛けずに、\n\n- https://coveralls.io/\n- https://codecov.io/\n\nのようなサービスに送信することで\n\n- https://coveralls.io/github/srz-zumix/iutest?branch=master\n- https://codecov.io/gh/srz-zumix/iutest\n\nカバレッジを公開することができます。このあと説明するCIを掛けるときに同時にカバレッジも測定してこうしたサービスに送信すると良いでしょう。\n\nCMakeからカバレッジを取る作業をある程度自動化するには\n\n```cmake\nif(STRING_SPLIT_ENABLE_COVERAGE)\n    message(\"coverage enabled\")\n    include(CodeCoverage)\n    APPEND_COVERAGE_COMPILER_FLAGS()\n    set(COVERAGE_EXCLUDES \"*gcc*\" \"*iutest*\" \"*/usr/include/*\" \"*mingw*\")\n    SETUP_TARGET_FOR_COVERAGE(\n        NAME test_coverage       # New target name\n        EXECUTABLE basic_test          # Executable in PROJECT_BINARY_DIR\n        DEPENDENCIES basic_test        # Dependencies to build first\n    )\n    option(STRING_SPLIT_ENABLE_COVERAGE_HTML \"enable coverage result to html\" TRUE)\n    if(STRING_SPLIT_ENABLE_COVERAGE_HTML)\n        message(\"coverage result to html enabled\")\n        SETUP_TARGET_FOR_COVERAGE_TO_HTML(\n            NAME test_coverage_to_html                 # New target name\n            INFO_FILE_NAME test_coverage.info.cleaned  # coverage task result file name\n            DEPENDENCIES test_coverage                 # Dependencies(coverage task, etc...)\n        )\n    endif()\nendif()\n```\n\nのように書くことで(かなり省略してしまいましたが)カバレッジを取れます。(includeしているファイルは省略してます)\n\n詳しくは\nhttps://github.com/yumetodo/string_split\nを覗いてみてください。\n\n`.travis.yml`をみると分かると思いますが\n\n```yml\n  - mkdir build_release\n  - mkdir build_debug\n  - cd build_release\n  - cmake -DCMAKE_BUILD_TYPE=Release ..\n  - make ci\n  - cd ../build_debug\n  - cmake -DSTRING_SPLIT_ENABLE_COVERAGE=\"${USE_COVERALLS}\" -DCMAKE_BUILD_TYPE=Debug ..\n  - make ci\n```\n\nだけでカバレッジ有効でビルドして実行して変換して後はcoveralls.ioに送信するだけになるようにcmakeを書いています。\n\nこのようにカバレッジについてみてきましたが、行カバレッジは本当に品質を表しているか？という話もあって\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eコードの行数で図るのは全く意味をなさない。しかしやはり数で捉えたいものだ。テストの数ならどうだろう？\u003c/p\u003e\u0026mdash; 173210 (@173210) \u003ca href=\"https://twitter.com/173210/status/789984039364988928?ref_src=twsrc%5Etfw\"\u003e2016年10月23日\u003c/a\u003e\u003c/blockquote\u003e\n\nのような話が聞こえたりしてきます。\n\n# CI/CD\n\n## CIって何？\n\nまたしても日本語版Wikipediaから引っ張ってきましょう。\n\n\u003e継続的インテグレーション、CI（英: continuous integration）とは、主にプログラマーのアプリケーション作成時の品質改善や納期の短縮のための習慣のことである。エクストリーム・プログラミング (XP) のプラクティスの一つで、狭義にはビルドやテスト、インスペクションなどを継続的に実行していくことを意味する[1]。特に、1990年代後半以降の開発においては、継続的インテグレーションをサポートするソフトウェアを使用する傾向が強まってきた。 \n\nもうすこし具体的には、gitを使った開発を前提として、commitがpushされるたびに、ビルド・テストの実行を行うことを自動化する、ということがCIと聞くとイメージされます。\n\nビルドをするとかテストをするとかそういう作業は面倒極まりないので、単にcommitしてpushするだけで完結するようにしたいものです。そうすることで開発速度が上がるというメリットがあります。\n\n## CDとは\n\nコンパクトディスクのことではありません(ｷﾘｯ\n\ncontinuous delivery(継続的デリバリー)の略だったりcontinuous deploy(継続的デプロイ)の略だったりしますが、実質的にはほぼ同じことを指すので厳密な違いを理解することに意味はありません。\n\nつまるところ、CIの延長線で、せっかくCIでビルド自動化したのだから、ビルド・テストが成功していて、git tagが打たれていたらRelease作業も自動化してしまおうというものです。リリース作業も面倒ですからgit tag打つだけでやってくれたら楽ですよね？\n\nビルド成果物をGithub Releaseに投げたり、どっかのサーバーにSSH経由で投げたりするのが一般的です。\n\nCDのこともまとめてCIと呼んだりもします。\n\n## C++開発でCI/CDが必要な理由\n\nもちろん他の言語でもCI/CDは必要ですが、C++ではより重要です。\n\n### C++は言語処理系が複数ある\n\nC++は言語処理系がgcc, clang, msvc, etc...と複数あります。\n\n処理系依存の処理が書かれていたり、他の処理系でまだ実装されていない機能を使っているとそのライブラリは使いにくいものになってしまいます。特定環境に特化したライブラリというのもあるでしょうが、可能なら多くの環境で自分が作ったライブラリが動いてほしいですよね？\n\nところが手元で複数の言語処理系をしかも複数のバージョンでビルドが通るか検証するのは非常に手間です。現実的にはいずれか単一の処理系だけで開発してしまうのではないでしょうか？\n\nCIを組むことで複数の言語処理系での検証というのが現実的なコストになります。\n\nまた、各言語処理系は完全ではないので、複数の言語処理系でクロスチェックすることでC++規格に準拠したコードが書けている可能性が高くなります。\n\n### メンテナンスされたビルド方法のドキュメントになる\n\nC++は言語公式でパッケージマネージャーを提供していませんし、もっといえば統一的なビルド方法も用意されていません。すべては開発者に委ねられています。\n\nするとライブラリごとにビルド方法が異なる、という事態が現実に発生しています。もちろんビルド方法をきちんとドキュメント化すれば良いのでしょうが、ドキュメント化されたビルド方法でビルドできない、なんてことはしばしばあるのが現実です。\n\nCIを組んでおけばCIを動かすビルドスクリプトはCIが通っていれば有効なビルド方法であることが保証できます。\n\n### コード分析ツールを使いやすくなる\n\n例えばWindowsではgcc/clangが提供するサニタイザーの類は動きませんし、逆にmsvcのコード分析機能はWindowsじゃないと動きません。\n\n鼻から悪魔が召喚されると噂の未定義動作や、メモリーリーク、不正なアドレスへのアクセスなどなどC++の開発には落とし穴がいっぱいありますから、コード分析ツールはフル活用したいものです。\n\n先日もTwitterで\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003e世にも奇妙なソースコードが出てきたので紹介\u003cbr\u003e\u003cbr\u003e・乱数等は一切使っていないので出力すると毎回同じものが出力されるはずが毎回違うものが出力される。\u003cbr\u003e・3週間前は正常に動作していたが、今使ってみると全く正常に動作しない。\u003cbr\u003e・上記は外部ライブラリ等を使用していない状態でも起こる。\u003cbr\u003e\u003cbr\u003e怖い……。\u003c/p\u003e\u0026mdash; std::gaccho( ¨̮ ); (@wanotaitei) \u003ca href=\"https://twitter.com/wanotaitei/status/1122178484753719296?ref_src=twsrc%5Etfw\"\u003eApril 27, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\nhttps://wandbox.org/permlink/NdyDFpBgbI6uWgBn\n\nなんて話があったのですが、clangが提供するAddressSanitizerは一発で原因を教えてくれました。\n\nhttps://pastebin.com/mvLwhiJE\n\nCIでこうした分析ツールを掛けるようにしていれば一発で洗い出せましたね。\n\n## どのようにCIを組むか\n\n### CIツール・サービスの選定\n\n昔は猫も杓子もJenkinsでやっていたらしいのですが(ほんとに？)、Jenkinsはメンテナンスが大変らしく(ほんとに?)、Jenkins専属おじさんが発生していたそうです。せっかく自動化したのにそれ専任の人が必要になるんだったら意味がなくね？\n\n現代では主にDockerを技術的な背景としてビルド環境をDockerのコンテナとして作っておき、その上でビルドをできるようにするというサービスを複数の会社が提供しています。OSSプロジェクトは無料で使えることが多いですが、ビルドが並列化できない、遅いことが多く、速度を上げるには**カネの力で殴る**のが有効な解決策となります。\n\n- [Azure Pipelines](https://dev.azure.com/)\n- [Bitrise](https://www.bitrise.io/?referrer=a9c0b9baf7536067)\n- [Buddy](https://buddy.works/)\n- [Circle CI](https://circleci.com/)\n- [Codacy](https://www.codacy.com/)\n- [Codefresh](https://codefresh.io/)\n- [Codeship](https://codeship.com/)\n- [Drone Cloud](https://cloud.drone.io/)\n- [Scrutinizer](https://scrutinizer-ci.com/)\n- [Semaphore](https://semaphoreci.com/)\n- [Shippable](http://shippable.com/)\n- [Travis CI](https://travis-ci.com/)\n- [Wercker](http://www.wercker.com/)\n\nDockerなのでOSはLinuxになることがほとんどです。ただデフォルトのdockerイメージ以外だと速度が遅くなる傾向があるように思います。\n\nTravis CIは多分一番有名だと思いますし、迷ったらこれを使っとけば良い気がします。あとめっちゃ動作遅いですがTravis CIはmac OS上でも走らせてくれるサービスが合った気がします。\n\nWindows上で走らせてくれるCIサービスと言えば\n\n- [AppVeyor](https://www.appveyor.com/)\n- [buildkite](https://buildkite.com/features)\n\nがあります(カネを積めばもっとあるきがする)。AppVeyorはめっちゃ有名ですね。ただWindowsで動かせるCIサービスはめっちゃ少ないのでみんながこのサービスを使うもんだからめっちゃビルドが遅いです。branch絞って普段頻繁にいじるbranchは外すとかしたほうがいいかも・・・\n前はtea-ciなんてのもあったんですが[msys2のprojectでそれを無効化している](https://github.com/msys2/MINGW-packages/issues/2732)ところを見るに動かんのでしょうね・・・。\n\nそういえばGitのサーバーとして有名なBitbucketはCIも持ってますね。結構高速に動くのでよい。\n\n### CMakeできるようにする\n\nべつに必ずCMakeしないといけないわけではないのですが、CMakeを使ってビルドするのが徐々にデファクトスタンダートになりつつあるので、CMakeできるようにすると良いと思います。\n\n方法は割愛しますが、`add_custom_target`/`add_dependencies`を駆使して\n\n- テスト実行までできるようにする\n- カバレッジを取れるようにする\n- サニタイザーを有効にしてビルド・実行できるようにする\n\nのようにすると良いと思います。\n\n### CIを設定する\n\nCIサービスごとに手順が違いすぎて解説するには余白が足りません。ただ基本方針としては\n\n- ビルドはwandboxにやらせてCIはそこへ投げるだけにする: iutest付属のiuwandbox.pyやCranberries Build Toolを使って投げる\n- ビルドをCI上で行う\n    - aptコマンドなどを叩いてコンパイラや必要なライブラリを入れてからビルド\n    - Dockerイメージを作っておいてビルド\n\nのようになると思います。\n\n各CIサービスのドキュメントとにらめっこしつつ、先人たちがどうCIを使っているか設定ファイルを覗いてみると良いと思います。\n\niutestは~~頭がおかしいほど~~たくさんのCIサービスを利用しているので(上に上げたサービスのほぼ全部)いろんなサービスの設定の書き方が参考になると思います。\n\n## CIのバッジをREADME.mdに貼ってアピールする\n\nCIサービスはほとんどがCIの通過状況を小さな画像(バッジ)で提供してくれます。\n[![AppVeyor Build status](https://ci.appveyor.com/api/projects/status/2gdmgo8ce8m0iy0e/branch/master?svg=true)](https://ci.appveyor.com/project/srz-zumix/iutest/branch/master) [![Azure Pipelines Build Status](https://dev.azure.com/srz-zumix/iutest/_apis/build/status/srz-zumix.iutest?branchName=master)](https://dev.azure.com/srz-zumix/iutest/_build/latest?definitionId=4) [![Bitrise iOS Build Status](https://app.bitrise.io/app/6903498632e89465/status.svg?token=siumhVNY6p6lklSZF6xGNA\u0026branch=master)](https://app.bitrise.io/app/6903498632e89465?referrer=a9c0b9baf7536067) [![Buddy branch](https://app.buddy.works/zumixcpp/iutest/repository/branch/master/badge.svg?token=5e58135ab4831252209e7b1fe75bfe9de669b0dc7e95ed4316eebad2187d59a0 \"buddy branch\")](https://app.buddy.works/zumixcpp/iutest/repository/branch/master) [![CircleCI](https://circleci.com/gh/srz-zumix/iutest/tree/master.svg?style=svg)](https://circleci.com/gh/srz-zumix/iutest/tree/master) [![Cirrus Build Status](https://api.cirrus-ci.com/github/srz-zumix/iutest.svg?branch=master)](https://cirrus-ci.com/github/srz-zumix/iutest/master) [![Codefresh build status](https://g.codefresh.io/api/badges/pipeline/srz-zumix/iutest%2Fiutest_unittest?branch=master\u0026type=cf-2)](https://g.codefresh.io/pipelines/iutest_unittest/builds?repoOwner=srz-zumix\u0026repoName=iutest\u0026serviceName=srz-zumix%2Fiutest\u0026filter=trigger:build~Build;branch:master;pipeline:58a933be9d1bd40100495882~iutest_unittest) [![Codeship Status for srz-zumix/iutest](https://codeship.com/projects/5bc87030-5b41-0133-6000-4242aa07dce3/status?branch=master)](https://codeship.com/projects/110695) [![Drone Build Status](https://cloud.drone.io/api/badges/srz-zumix/iutest/status.svg?branch=master)](https://cloud.drone.io/srz-zumix/iutest) [![GitHub Actions Status](https://github.com/srz-zumix/iutest/workflows/GitHub%20Actions/badge.svg?branch=master)](https://github.com/srz-zumix/iutest/actions?query=workflow%3A%22GitHub+Actions%22) [![GitLab CI pipeline status](https://gitlab.com/srz-zumix/iutest-test/badges/master/pipeline.svg)](https://gitlab.com/srz-zumix/iutest-test/commits/master) [![Peakflow Build Status](https://www.peakflow.io/en/projects/iutest/branch-statuses/master.svg)](https://www.peakflow.io/en/projects/iutest/build-groups?build_groups_q%5Bbranch_name_cont%5D=master) [![Scrutinizer Build Status](https://scrutinizer-ci.com/g/srz-zumix/iutest/badges/build.png?b=master)](https://scrutinizer-ci.com/g/srz-zumix/iutest/build-status/master) [![Semaphore Build Status](https://semaphoreci.com/api/v1/srz_zumix/iutest/branches/master/badge.svg)](https://semaphoreci.com/srz_zumix/iutest) [![Semaphore 2.0 Build Status](https://iutest.semaphoreci.com/badges/iutest/branches/master.svg)](https://iutest.semaphoreci.com/projects/iutest) [![Shippable Run Status](https://api.shippable.com/projects/541904d2ac22859af743f867/badge?branch=master)](https://app.shippable.com/github/srz-zumix/iutest) [![Travis-CI Build Status](https://travis-ci.com/srz-zumix/iutest.svg?branch=master)](https://travis-ci.com/srz-zumix/iutest) [![Wercker status](https://app.wercker.com/status/d385156052aa4118a7f24affe4a8f851/s/master \"wercker status\")](https://app.wercker.com/project/bykey/d385156052aa4118a7f24affe4a8f851)      [![Codacy Badge](https://api.codacy.com/project/badge/Grade/e6407b63c9c844d080ed71c7707bded9?branch=master)](https://www.codacy.com/app/srz-zumix/iutest?utm_source=github.com\u0026amp;utm_medium=referral\u0026amp;utm_content=srz-zumix/iutest\u0026amp;utm_campaign=Badge_Grade) [![Codecov](https://codecov.io/gh/srz-zumix/iutest/branch/master/graph/badge.svg)](https://codecov.io/gh/srz-zumix/iutest) [![Coveralls Coverage Status](https://coveralls.io/repos/github/srz-zumix/iutest/badge.svg?branch=master)](https://coveralls.io/github/srz-zumix/iutest?branch=master) [![Coverity Scan Build Status](https://scan.coverity.com/projects/1316/badge.svg)](https://scan.coverity.com/projects/srz-zumix-iutest) [![GuardRails badge](https://badges.guardrails.io/srz-zumix/iutest.svg?token=fe1bb5ca5f743800d26e4d2b7282c5b316df83c0b228048f4192510bdd7280f0)](https://dashboard.guardrails.io/default/gh/srz-zumix/iutest) [![GitHub Actions reviewdog Status](https://github.com/srz-zumix/iutest/workflows/GitHub%20Actions%20-%20reviewdog/badge.svg?branch=develop)](https://github.com/srz-zumix/iutest/actions?query=workflow%3A%22GitHub+Actions+-+reviewdog%22)   [![New(3-clause) BSD License](https://img.shields.io/badge/license-New_BSD-blue.svg)](http://opensource.org/licenses/BSD-3-Clause) [![NuGet version](https://badge.fury.io/nu/iutest.svg)](https://badge.fury.io/nu/iutest)   [![support](https://img.shields.io/badge/%24-support-orange.svg)](http://amzn.asia/6fNxDZU)\n\nこういうのをREADME.mdに貼っておくとアピールになるでしょう。\n\n# 結局ライブラリ作者はなにをするべきか\n\n- 単体テストを書く\n- CIを組む\n    - ビルドする\n    - テストを動かす\n    - カバレッジを取る\n    - コード分析ツールを動かす\n\n# リンク集\n\nこの記事を読み終わったらぜひ読んでほしいQiita記事です。特に @nonbiri15 氏の記事はここに上げた以外にも参考になる記事が多く上がっています。\n\n- [スピード感重視なのでテストは書かない。テストはなぜ開発を遅くするか](d68bdb347283ee2dbccf)\n- [仕様変更に弱いからテストは書かない……？(´・ω・`)＜仕様変更を想定するならテストを書いてくれ頼む](https://qiita.com/aimof/items/849ded1293495d3bbb50)\n- [モグラたたき開発を卒業しよう](https://qiita.com/nonbiri15/items/d3eac4a6bfb8fc770c15)\n- [モグラたたき開発を卒業しよう　対策編](https://qiita.com/nonbiri15/items/015494c7c624748a5974)\n- [継続的インテグレーション(デリバリー)サービスを利用しないという罪悪](https://qiita.com/nonbiri15/items/17b37664f94d4b1784aa)\n- [若手エンジニアを不幸にしないための開発の「べからず」集　テスト編](https://qiita.com/nonbiri15/items/340f06bc72e84cd871a8)\n\n# License\n\nCC BY-SA 3.0\n\n![CC BY SA](https://camo.qiitausercontent.com/c12f8f7e43ee01c8f4dedf0edd0f16d3f583be2d/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f642f64302f43432d42592d53415f69636f6e2e737667)\n\n# 注釈\n\n[^1]: 中学校学校では数学1で文字を用いた方程式などと負の数に拡張された比例関係を学び、数学2で１次関数という流れ\n[^2]: 一松信他 中学校数学２ 学校図書 2009 ISBN: 978-4-7625-5098-1\n","coediting":false,"comments_count":5,"created_at":"2019-04-29T17:52:52+09:00","group":null,"id":"5886b2c0c421c24c909b","likes_count":105,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"CI","versions":[]},{"name":"単体テスト","versions":[]},{"name":"義務教育","versions":[]},{"name":"iutest","versions":[]}],"title":"C++初心者のみんな、単体テストとCIを組めるようになって君もライブラリ製作者の仲間入りしよう！","updated_at":"2020-03-05T13:15:36+09:00","url":"https://qiita.com/yumetodo/items/5886b2c0c421c24c909b","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\u003cp\u003e\u003ca href=\"https://qiita.com/SAKIchan/items/1ba150fbdf4e64ade548\"\u003efor文とif文を使わないでプログラミングしてみた\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eという記事が最近出てました。\u003ca href=\"https://github.com/bolero-MURAKAMI/Sprout\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSprout\u003c/a\u003e使えよ、とかそういう思いはありつつ、Rangeの力で書いたらどうなるかなと思いました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"元のコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%83%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e元のコード\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;ioistream\u0026gt;\n\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//基数\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//指数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//基数、指数の入力\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecin\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//答えを格納する変数\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"o\"\u003e*=\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//答えの出力\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"range-v3\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#range-v3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erange-v3\u003c/h1\u003e\n\n\u003cp\u003eRangeといえばC++20の・・・はとりあえずおいておいて、\u003ca href=\"https://github.com/ericniebler/range-v3\" rel=\"nofollow noopener\" target=\"_blank\"\u003erange-v3\u003c/a\u003eの力を借りて行きましょう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;\n#include \u0026lt;range/v3/all.hpp\u0026gt;\n\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//基数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//指数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//基数、指数の入力\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecin\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eranges\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eaccumulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eranges\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eview\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eints\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e\u003cspan class=\"p\"\u003e{},\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/Lt4N9uHSC9o0Ndm4\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/Lt4N9uHSC9o0Ndm4\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eやっぱり合計したりする系はaccumulateにやらせたいですよね。スッキリしました。\u003c/p\u003e\n\n\u003cp\u003eちなみにWandboxではrange-v3が使えますって話は\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/ef24708900b0535aa28c\" id=\"reference-dad772db42212d578d5d\"\u003e君はまだWandboxの真の実力を知らない～C++er目線で～\u003c/a\u003e\u003cbr\u003e\nでしましたね。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"range-v3を使えない状況下でもrangeの力を借りたい\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#range-v3%E3%82%92%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84%E7%8A%B6%E6%B3%81%E4%B8%8B%E3%81%A7%E3%82%82range%E3%81%AE%E5%8A%9B%E3%82%92%E5%80%9F%E3%82%8A%E3%81%9F%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003erange-v3を使えない状況下でもRangeの力を借りたい\u003c/h1\u003e\n\n\u003cp\u003eまあつまり自分でRangeを作るわけで、つまりiteratorを作ることになります。こんなときは\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/245e94a0e85db9bf5cbb\" id=\"reference-becc512d60614cbbb567\"\u003eイテレータの解説をするなんて今更佳代\u003c/a\u003e\u003cbr\u003e\nの出番ですね！\u003c/p\u003e\n\n\u003cp\u003eで結果がこちら\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;\n#include \u0026lt;numeric\u0026gt;\n#include \u0026lt;type_traits\u0026gt;\n#include \u0026lt;cstdint\u0026gt;\n#include \u0026lt;cassert\u0026gt;\n#include \u0026lt;limits\u0026gt;\n\u003c/span\u003e\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eRange\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eBinaryOperation\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"nf\"\u003eaccumulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eRange\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eBinaryOperation\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eop\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eaccumulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eforward\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eBinaryOperation\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eop\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eenable_if_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eis_integral_v\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003enullptr_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator_category\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003erandom_access_iterator_tag\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003epointer\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003ereference\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"n\"\u003enext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"n\"\u003eprev\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e// constexpr pointer operator-\u0026gt;() const noexcept;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e+=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e-=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e-=\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003evalue_type\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"p\"\u003e[](\u003c/span\u003e\u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003en_\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e!=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"kt\"\u003ebool\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;=\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT1\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003edecltype\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003el\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eptr\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"k\"\u003eoperator\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;::\u003c/span\u003e\u003cspan class=\"n\"\u003edifference_type\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003enoexcept\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003en\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003etypename\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eenable_if_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eis_integral_v\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003enullptr_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003enullptr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003einteger_range\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eusing\u003c/span\u003e \u003cspan class=\"n\"\u003eiterator\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range_iterator\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nl\"\u003eprivate:\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"nl\"\u003epublic:\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econstexpr\u003c/span\u003e \u003cspan class=\"n\"\u003einteger_range\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eT\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{};\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eiterator\u003c/span\u003e \u003cspan class=\"n\"\u003ebegin\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eiterator\u003c/span\u003e \u003cspan class=\"n\"\u003eend\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebegin_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethis\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eend_\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic_assert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eis_trivially_copyable_v\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003einteger_range\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//基数\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"c1\"\u003e//指数\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//基数、指数の入力\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecin\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eaccumulate\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einteger_range\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint16_t\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"kt\"\u003euint64_t\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e](\u003c/span\u003e\u003cspan class=\"k\"\u003eauto\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003eauto\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eradix\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e});\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//答えの出力\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eans\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/Y0bNLeDXbfvbWOvA\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/Y0bNLeDXbfvbWOvA\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e長い。C++でiterator作るの心が折れそう・・・。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結論\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E8%AB%96\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結論\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003eせっかく\u003ccode\u003eif\u003c/code\u003eと\u003ccode\u003efor\u003c/code\u003eを排除したなら、意味論的なアルゴリズム関数に投げましょう\u003c/li\u003e\n\u003cli\u003eRange-v3使おう\u003c/li\u003e\n\u003c/ul\u003e\n","body":"[for文とif文を使わないでプログラミングしてみた](https://qiita.com/SAKIchan/items/1ba150fbdf4e64ade548)\n\nという記事が最近出てました。[Sprout](https://github.com/bolero-MURAKAMI/Sprout)使えよ、とかそういう思いはありつつ、Rangeの力で書いたらどうなるかなと思いました。\n\n# 元のコード\n\n```cpp\n#include \u003cioistream\u003e\nint main()\n{\n    int radix; //基数\n    int index; //指数\n    //基数、指数の入力\n    std::cin \u003e\u003e radix \u003e\u003e index;\n    //答えを格納する変数\n    int ans = 1;\n    for (int i = 0; i \u003c index; ++i)\n    {\n        ans *= radix;\n    }\n    //答えの出力\n    std::cout \u003c\u003c ans \u003c\u003c std::endl;\n    return 0;\n}\n```\n\n# range-v3\n\nRangeといえばC++20の・・・はとりあえずおいておいて、[range-v3](https://github.com/ericniebler/range-v3)の力を借りて行きましょう。\n\n```cpp\n#include \u003ciostream\u003e\n#include \u003crange/v3/all.hpp\u003e\n\nint main()\n{\n    std::uint32_t radix; //基数\n    std::uint16_t index; //指数\n    //基数、指数の入力\n    std::cin \u003e\u003e radix \u003e\u003e index;\n    const auto re = ranges::accumulate(ranges::view::ints(std::uint16_t{},index), 1, [radix](auto re, auto) { return re * radix; });\n    std::cout \u003c\u003c re \u003c\u003c std::endl;\n}\n```\n\nhttps://wandbox.org/permlink/Lt4N9uHSC9o0Ndm4\n\nやっぱり合計したりする系はaccumulateにやらせたいですよね。スッキリしました。\n\nちなみにWandboxではrange-v3が使えますって話は\n[君はまだWandboxの真の実力を知らない～C++er目線で～](https://qiita.com/yumetodo/items/ef24708900b0535aa28c)\nでしましたね。\n\n# range-v3を使えない状況下でもRangeの力を借りたい\n\nまあつまり自分でRangeを作るわけで、つまりiteratorを作ることになります。こんなときは\n[イテレータの解説をするなんて今更佳代](https://qiita.com/yumetodo/items/245e94a0e85db9bf5cbb)\nの出番ですね！\n\nで結果がこちら\n\n```cpp\n#include \u003ciostream\u003e\n#include \u003cnumeric\u003e\n#include \u003ctype_traits\u003e\n#include \u003ccstdint\u003e\n#include \u003ccassert\u003e\n#include \u003climits\u003e\ntemplate\u003ctypename Range, typename T, typename BinaryOperation\u003e\nT accumulate(Range\u0026\u0026 r, T init, BinaryOperation\u0026\u0026 op)\n{\n    return std::accumulate(std::begin(r), std::end(r), init, std::forward\u003cBinaryOperation\u003e(op));\n}\ntemplate\u003ctypename T, std::enable_if_t\u003cstd::is_integral_v\u003cT\u003e, std::nullptr_t\u003e = nullptr\u003e\nclass integer_range_iterator {\n    T begin_;\n    T end_;\n    T n_;\npublic:\n    using iterator_category = std::random_access_iterator_tag;\n    using value_type = T;\n    using difference_type = T;\n    using pointer = T*;\n    using reference = T\u0026;\n    constexpr integer_range_iterator(T begin, T end, T n) noexcept : begin_(begin), end_(end), n_(n) {}\n    constexpr integer_range_iterator next() const noexcept\n    {\n        assert(this-\u003en_ \u003c this-\u003eend_);\n        return { this-\u003ebegin_, this-\u003eend_, this-\u003en_ + 1};\n    }\n    constexpr integer_range_iterator prev() const noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_);\n        return { this-\u003ebegin_, this-\u003eend_, this-\u003en_ - 1};\n    }\n    constexpr value_type operator*() const noexcept { return this-\u003ebegin_ + this-\u003en_; }\n    // constexpr pointer operator-\u003e() const noexcept;\n    constexpr integer_range_iterator\u0026 operator++() noexcept\n    {\n        assert(this-\u003en_ \u003c this-\u003eend_);\n        ++this-\u003en_;\n        return *this;\n    }\n    constexpr integer_range_iterator operator++(int) noexcept\n    {\n        assert(this-\u003en_ \u003c this-\u003eend_);\n        const auto re = *this;\n        ++this-\u003en_;\n        return re;\n    }\n    constexpr integer_range_iterator\u0026 operator--() noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_);\n        --this-\u003en;\n        return *this;\n    }\n    constexpr integer_range_iterator operator--(int) noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_);\n        const auto re = *this;\n        --this-\u003en;\n        return re;\n    }\n    constexpr integer_range_iterator operator+(difference_type n) const noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_ + n \u0026\u0026 this-\u003en_ + n \u003c this-\u003eend_);\n        return { this-\u003ebegin_, this-\u003eend_, this-\u003en_ + n};\n    }\n    constexpr integer_range_iterator operator-(difference_type n) const noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_ - n \u0026\u0026 this-\u003en_ - n \u003c this-\u003eend_);\n        return { this-\u003ebegin_, this-\u003eend_, this-\u003en_ - n};\n    }\n    constexpr integer_range_iterator\u0026 operator+=(difference_type n) noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_ + n \u0026\u0026 this-\u003en_ + n \u003c this-\u003eend_);\n        this-\u003en += n;\n        return *this;\n    }\n    constexpr integer_range_iterator\u0026 operator-=(difference_type n) noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_ - n \u0026\u0026 this-\u003en_ - n \u003c this-\u003eend_);\n        this-\u003en -= n;\n        return *this;\n    }\n    constexpr value_type operator[](difference_type n) const noexcept\n    {\n        assert(this-\u003ebegin_ \u003c this-\u003en_ + n \u0026\u0026 this-\u003en_ + n \u003c this-\u003eend_);\n        return this-\u003ebegin_ + this-\u003en_ + n;\n    }\n};\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr bool operator==(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept\n{\n    return *l == *r;\n}\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr bool operator!=(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept\n{\n    return !(l == r);\n}\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr bool operator\u003c(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept\n{\n    return *l \u003c *r;\n}\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr bool operator\u003e(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept\n{\n    return r \u003c l;\n}\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr bool operator\u003c=(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept\n{\n    return !(r \u003c l);\n}\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr bool operator\u003e=(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept\n{\n    return !(l \u003c r);\n}\ntemplate\u003ctypename T1, typename T2\u003e\ninline constexpr auto operator-(const integer_range_iterator\u003cT1\u003e\u0026 l, const integer_range_iterator\u003cT2\u003e\u0026 r) noexcept -\u003e decltype(l.ptr() - r.ptr())\n{\n    return l.ptr() - r.ptr();\n}\ntemplate\u003ctypename T\u003e\ninline constexpr integer_range_iterator\u003cT\u003e operator+(typename integer_range_iterator\u003cT\u003e::difference_type n, const integer_range_iterator\u003cT\u003e\u0026 it) noexcept\n{\n    return it + n;\n}\n\ntemplate\u003ctypename T, std::enable_if_t\u003cstd::is_integral_v\u003cT\u003e, std::nullptr_t\u003e = nullptr\u003e\nclass integer_range {\npublic:\n    using iterator = integer_range_iterator\u003cT\u003e;\nprivate:\n    T begin_;\n    T end_;\npublic:\n    constexpr integer_range(T begin, T end) : begin_(begin), end_(end) {};\n    iterator begin() const { return { this-\u003ebegin_, this-\u003eend_, this-\u003ebegin_}; }\n    iterator end() const { return { this-\u003ebegin_, this-\u003eend_, this-\u003eend_}; }\n};\nstatic_assert(std::is_trivially_copyable_v\u003cinteger_range\u003cint\u003e\u003e);\nint main()\n{\n    std::uint32_t radix; //基数\n    std::uint16_t index; //指数\n    //基数、指数の入力\n    std::cin \u003e\u003e radix \u003e\u003e index;\n    const auto ans = accumulate(integer_range\u003cstd::uint16_t\u003e(0, index), std::uint64_t{1}, [radix](auto re, auto) { return re * radix; });\n    //答えの出力\n    std::cout \u003c\u003c ans \u003c\u003c std::endl;\n    return 0;\n}\n```\n\nhttps://wandbox.org/permlink/Y0bNLeDXbfvbWOvA\n\n長い。C++でiterator作るの心が折れそう・・・。\n\n# 結論\n\n- せっかく`if`と`for`を排除したなら、意味論的なアルゴリズム関数に投げましょう\n- Range-v3使おう\n","coediting":false,"comments_count":0,"created_at":"2019-04-13T14:20:20+09:00","group":null,"id":"ce7092653821490f051d","likes_count":9,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"C++17","versions":[]},{"name":"range-v3","versions":[]}],"title":"for文とif文を投げ捨ててRangeの力でプログラミングしてみた","updated_at":"2019-04-13T14:20:20+09:00","url":"https://qiita.com/yumetodo/items/ce7092653821490f051d","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"そもそも-undefined-behaviorとは\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%82%82%E3%81%9D%E3%82%82-undefined-behavior%E3%81%A8%E3%81%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eそもそも Undefined Behaviorとは\u003c/h1\u003e\n\n\u003cp\u003e前に \u003ca href=\"/akinomyoga\" class=\"user-mention js-hovercard\" title=\"akinomyoga\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"akinomyoga\"\u003e@akinomyoga\u003c/a\u003e 氏がcpprefjpにまとめられていたので引っ張っておきましょう。\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://cpprefjp.github.io/implementation-compliance.html#behavior\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cpprefjp.github.io/implementation-compliance.html#behavior\u003c/a\u003e\u003cbr\u003e\n未定義の動作 (undefined behavior; 通称 UB) は、処理系が実際に行う動作について標準規格が如何なる要件もおかないことを表す。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://cpprefjp.github.io/implementation-compliance.html#nasal-demon\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cpprefjp.github.io/implementation-compliance.html#nasal-demon\u003c/a\u003e\u003cbr\u003e\nプログラムが\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e未定義の動作 (UB) を引き起こすとき、\u003c/li\u003e\n\u003cli\u003eまたは診断不要 (NDR) の規則に違反している\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eとき、標準規格は適合する処理系に対して何らの要件も課さない。 つまり、UB または NDR 違反を含むプログラムに対して処理系がいかなる動作をしても規格には抵触しないということを表す。 例えば、このことで処理系が鼻から悪魔を出しても、それはプログラムの作者の責任であり、その処理系を責めることはできない。 この冗談を鼻から悪魔 (nasal demons)\u003csup id=\"fnref1\"\u003e\u003ca href=\"#fn1\" rel=\"footnote\" title=\"nasal demons\"\u003e1\u003c/a\u003e\u003c/sup\u003e\u003csup id=\"fnref2\"\u003e\u003ca href=\"#fn2\" rel=\"footnote\" title=\"本の虫: C++0x本：鼻から悪魔\"\u003e2\u003c/a\u003e\u003c/sup\u003e と呼ぶ。鼻から悪魔を出す処理系は今のところ実在しないが、 実際の未定義の動作として最適化の過程で或る種の「タイムトラベル」を起こす処理系は実在する\u003csup id=\"fnref3\"\u003e\u003ca href=\"#fn3\" rel=\"footnote\" title=\"本の虫: Old New Thing: 未定義動作はタイムトラベルを引き起こす（他にもいろいろあるけど、タイムトラベルが一番ぶっ飛んでる）\"\u003e3\u003c/a\u003e\u003c/sup\u003e。\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"なぜundefined-behaviorなんてあるの\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AA%E3%81%9Cundefined-behavior%E3%81%AA%E3%82%93%E3%81%A6%E3%81%82%E3%82%8B%E3%81%AE\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eなぜUndefined Behaviorなんてあるの？\u003c/h1\u003e\n\n\u003cp\u003e他の言語では例外を投げることになっていたりする内容がC/C++ではUndefined Behaviorになっていることがある。\u003c/p\u003e\n\n\u003cp\u003eこれはC/C++が速度を追求する言語であり、抽象化によってプログラマが自分で挙動を制御できなくなることを避ける傾向にあること、例外などは実行時にコストがかかること、Cには例外がなかったことなどが考えられる。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"プログラマは全知全能ではないので\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%81%AF%E5%85%A8%E7%9F%A5%E5%85%A8%E8%83%BD%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84%E3%81%AE%E3%81%A7\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eプログラマは全知全能ではないので\u003c/h1\u003e\n\n\u003cp\u003eそんなC/C++を操るプログラマがもし、全知全能であれば、Undefined Behaviorをうっかり踏んでしまうことはなかっただろう。しかし現実にはプログラマもまた人間であり、過ちを犯す生き物である。\u003c/p\u003e\n\n\u003cp\u003eなにかやりたいことがあるときに、Google検索で調べながら書く、というのは日常的に行われる行為であろうが、その検索で引っかかるコードもまた人が書いたものであり、Undefined Behaviorを踏んでいる可能性がある。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"闇のc-undefined-behaviorに対する防衛術\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E9%97%87%E3%81%AEc-undefined-behavior%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E9%98%B2%E8%A1%9B%E8%A1%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e闇のC++ Undefined Behaviorに対する防衛術\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"/_EnumHack\" class=\"user-mention js-hovercard\" title=\"_EnumHack\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"_EnumHack\"\u003e@_EnumHack\u003c/a\u003e 氏が以前\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/_EnumHack/items/218018e88cf9c5667507\" id=\"reference-4fb6718ab710463a18e5\"\u003e闇のC++ Undefined Behaviorに対する防衛術\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eという記事を書いている。防衛術としては\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eコンパイラの警告レベルを上げる(\u003ccode\u003e-Wall -Wextra\u003c/code\u003eとか)\u003c/li\u003e\n\u003cli\u003e複数のコンパイラでコンパイルする\u003c/li\u003e\n\u003cli\u003eUndefined Behavior Sanitizerを使う\u003c/li\u003e\n\u003cli\u003e規格書を読む\u003c/li\u003e\n\u003cli\u003e使っている機能・標準ライブラリについて調べる\u003c/li\u003e\n\u003cli\u003eコードレビュー、複数人開発\u003c/li\u003e\n\u003cli\u003eテスト\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eなどが紹介されています。付け加えるなら\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e強い人にTwitterで聞く\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eなんてのもあるかもしれません。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結局規格書を読むハメになる\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E5%B1%80%E8%A6%8F%E6%A0%BC%E6%9B%B8%E3%82%92%E8%AA%AD%E3%82%80%E3%83%8F%E3%83%A1%E3%81%AB%E3%81%AA%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結局規格書を読むハメになる\u003c/h1\u003e\n\n\u003cp\u003eもちろんこれらの防衛術は非常に有効で、Undefined Behavior Sanitizerは結構頑張ってくれます。\u003c/p\u003e\n\n\u003cp\u003eしかし、結局規格書を読むハメになる、という事態が生じます。\u003c/p\u003e\n\n\u003cp\u003eそんなとき、規格書はこのコードはUndefined Behaviorかどうかを解説することを目的としていないので、極めて難易度が高く、挫折し、Undefined Behaviorを踏んでしまうでしょう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"undefined-behaviorを放置できない時代がすでに来ている\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#undefined-behavior%E3%82%92%E6%94%BE%E7%BD%AE%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E6%99%82%E4%BB%A3%E3%81%8C%E3%81%99%E3%81%A7%E3%81%AB%E6%9D%A5%E3%81%A6%E3%81%84%E3%82%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eUndefined Behaviorを放置できない時代がすでに来ている\u003c/h1\u003e\n\n\u003cp\u003eUndefined Behaviorを踏んでしまっても、処理系がプログラマーに忖度して、あるいは技術力不足で最適化に利用されない時代であれば、実害はなかったかもしれません(ほんとか？\u003c/p\u003e\n\n\u003cp\u003eしかし現代のコンパイラは積極的に最適化を行うので、明らかに実害が出ます。\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/AoiMoe/items/2554f78dc9c197d22109\" id=\"reference-60b3b4e7d071e1c440a9\"\u003eコンパイラのリミッタが外れつつある今、null安全は必須なのかもしれない\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/yohhoy/items/7d39b7958418f784f793\" id=\"reference-173caebb6365be555eaf\"\u003e鼻から悪魔：不定値(indeterminate value)バージョン\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://qiita.com/tkmtSo/items/de3148dd1dcb70f38d6a\" id=\"reference-5e55506fa8dfd00f04ae\"\u003eC++でうっかり無限ループを書くと鼻から悪魔が出てくる\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"c標準化委員会は踏み抜きやすいundefined-behavior-top100のようなものを公式に出すべきではないか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#c%E6%A8%99%E6%BA%96%E5%8C%96%E5%A7%94%E5%93%A1%E4%BC%9A%E3%81%AF%E8%B8%8F%E3%81%BF%E6%8A%9C%E3%81%8D%E3%82%84%E3%81%99%E3%81%84undefined-behavior-top100%E3%81%AE%E3%82%88%E3%81%86%E3%81%AA%E3%82%82%E3%81%AE%E3%82%92%E5%85%AC%E5%BC%8F%E3%81%AB%E5%87%BA%E3%81%99%E3%81%B9%E3%81%8D%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eC++標準化委員会は踏み抜きやすいUndefined Behavior TOP100のようなものを公式に出すべきではないか\u003c/h1\u003e\n\n\u003cp\u003eこうなるとそもそもC++標準化委員会が公式で解説を書くべきではないか？と思えてきます。\u003c/p\u003e\n\n\u003cp\u003e踏み抜きやすいUndefined Behavior TOP100のようなものをリストアップして、現役のC++プログラマやもしくはC++プログラマになろうとしている人に向けて解説と回避方法を書いたものを作成するべきではないでしょうか？\u003c/p\u003e\n\n\u003cp\u003eUndefined Behaviorとはもはや処理系を作る人や一部のマニアだけではなくてすべてのC++プログラマが知らなければならない知識なのですから。\u003c/p\u003e\n\n\u003cp\u003eC++標準化委員会にはC++の教育について扱うStudy Group、\u003ca href=\"https://www.cjdb.com.au/sg20-and-videos.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSG20 Education\u003c/a\u003eというのがあります。\u003c/p\u003e\n\n\u003cp\u003eまさにC++プログラマへの教育・啓蒙の範疇の話ですからここが適当なんじゃないでしょうか？(知らんけど\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/yumetodo/items/54e1a8230dbf513ea85b#%E8%BF%BD%E8%A8%982-sg20-education-draft%E4%BA%8B%E4%BB%B6\" id=\"reference-18cace0ab19cd7b2c912\"\u003eなんでchar8_tが必要か理解するためにあえて先に教えないとかのたまっている\u003c/a\u003e暇があったらそういう活動をしてほしいものです。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"この記事を執筆した経緯\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%93%E3%81%AE%E8%A8%98%E4%BA%8B%E3%82%92%E5%9F%B7%E7%AD%86%E3%81%97%E3%81%9F%E7%B5%8C%E7%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eこの記事を執筆した経緯\u003c/h1\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eところで未定義の挙動になるパターンについては重箱の隅と言われようとも積極的に覚えていこうな。コンパイラが賢くなればなるほど、今まで顕在化しなかったUBパターンが表面化しやすくなるので。\u003c/p\u003e— yoh2 (@yoh2_sdj) \u003ca href=\"https://twitter.com/yoh2_sdj/status/1116009450110836736?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年4月10日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eというかコンパイラがアグレッシブにUBを最適化に活用する現状、C++標準化委員会は公式に特に警戒するべきUBのリストみたいなのを発行するべきなんじゃないか？\u003cbr\u003eだれもあのクソ長大な規格書をいちいち引いてUBかどうか判定する(しかも大抵間違えて解釈する)なんて作業したくねーだろ \u003ca href=\"https://t.co/cGVyt1t5Ay\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/cGVyt1t5Ay\u003c/a\u003e\u003c/p\u003e— yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1116018968974610432?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年4月10日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eほんとほしいよねこれ。\u003cbr\u003e分かりづらいところに書かれていてもUBだと名言されているならまだましで、規格書内のどこにもこのパターンに関する言及はないからUBとなるものに関しては、範囲が有限とはいえある意味悪魔の証明を求められるわけで……\u003ca href=\"https://t.co/hW8nGM14dF\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/hW8nGM14dF\u003c/a\u003e\u003c/p\u003e— yoh2 (@yoh2_sdj) \u003ca href=\"https://twitter.com/yoh2_sdj/status/1116020390592040960?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年4月10日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eC++ の規格書読むよりツイッターでつぶやいたほうが早い\u003c/p\u003e— バンビちゃん@実際存在しない (@pink_bangbi) \u003ca href=\"https://twitter.com/pink_bangbi/status/1116019652256124928?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年4月10日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eそれがおかしい。\u003cbr\u003e\u003cbr\u003eというかSG20 Education はchar8_t型の重要性を説くためにあえて教えないとかそういう馬鹿げたことに労力を費やすんじゃなくて、踏み抜きやすいUBリストTOP100とかそういうのを作るべきだろ、仕事しろ。 \u003ca href=\"https://t.co/atElMGyt6u\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/atElMGyt6u\u003c/a\u003e\u003c/p\u003e— yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1116020625061978112?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2019年4月10日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cdiv class=\"footnotes\"\u003e\n\u003chr\u003e\n\u003col\u003e\n\n\u003cli id=\"fn1\"\u003e\n\u003cp\u003e\u003ca href=\"http://www.catb.org/jargon/html/N/nasal-demons.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003enasal demons\u003c/a\u003e \u003ca href=\"#fnref1\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn2\"\u003e\n\u003cp\u003e\u003ca href=\"https://cpplover.blogspot.jp/2010/01/c0x_14.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e本の虫: C++0x本：鼻から悪魔\u003c/a\u003e \u003ca href=\"#fnref2\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003cli id=\"fn3\"\u003e\n\u003cp\u003e\u003ca href=\"https://cpplover.blogspot.jp/2014/06/old-new-thing.html\" rel=\"nofollow noopener\" target=\"_blank\"\u003e本の虫: Old New Thing: 未定義動作はタイムトラベルを引き起こす（他にもいろいろあるけど、タイムトラベルが一番ぶっ飛んでる）\u003c/a\u003e \u003ca href=\"#fnref3\"\u003e↩\u003c/a\u003e\u003c/p\u003e\n\u003c/li\u003e\n\n\u003c/ol\u003e\n\u003c/div\u003e\n","body":"# そもそも Undefined Behaviorとは\n\n前に @akinomyoga 氏がcpprefjpにまとめられていたので引っ張っておきましょう。\n\n\u003ehttps://cpprefjp.github.io/implementation-compliance.html#behavior\n\u003e未定義の動作 (undefined behavior; 通称 UB) は、処理系が実際に行う動作について標準規格が如何なる要件もおかないことを表す。\n\n\u003ehttps://cpprefjp.github.io/implementation-compliance.html#nasal-demon\n\u003eプログラムが\n\u003e\n\u003e- 未定義の動作 (UB) を引き起こすとき、\n\u003e- または診断不要 (NDR) の規則に違反している\n\u003e\n\u003eとき、標準規格は適合する処理系に対して何らの要件も課さない。 つまり、UB または NDR 違反を含むプログラムに対して処理系がいかなる動作をしても規格には抵触しないということを表す。 例えば、このことで処理系が鼻から悪魔を出しても、それはプログラムの作者の責任であり、その処理系を責めることはできない。 この冗談を鼻から悪魔 (nasal demons)[^1][^2] と呼ぶ。鼻から悪魔を出す処理系は今のところ実在しないが、 実際の未定義の動作として最適化の過程で或る種の「タイムトラベル」を起こす処理系は実在する[^3]。\n\n# なぜUndefined Behaviorなんてあるの？\n\n他の言語では例外を投げることになっていたりする内容がC/C++ではUndefined Behaviorになっていることがある。\n\nこれはC/C++が速度を追求する言語であり、抽象化によってプログラマが自分で挙動を制御できなくなることを避ける傾向にあること、例外などは実行時にコストがかかること、Cには例外がなかったことなどが考えられる。\n\n# プログラマは全知全能ではないので\n\nそんなC/C++を操るプログラマがもし、全知全能であれば、Undefined Behaviorをうっかり踏んでしまうことはなかっただろう。しかし現実にはプログラマもまた人間であり、過ちを犯す生き物である。\n\nなにかやりたいことがあるときに、Google検索で調べながら書く、というのは日常的に行われる行為であろうが、その検索で引っかかるコードもまた人が書いたものであり、Undefined Behaviorを踏んでいる可能性がある。\n\n# 闇のC++ Undefined Behaviorに対する防衛術\n\n@_EnumHack 氏が以前\n\n[闇のC++ Undefined Behaviorに対する防衛術](https://qiita.com/_EnumHack/items/218018e88cf9c5667507)\n\nという記事を書いている。防衛術としては\n\n1. コンパイラの警告レベルを上げる(`-Wall -Wextra`とか)\n2. 複数のコンパイラでコンパイルする\n3. Undefined Behavior Sanitizerを使う\n4. 規格書を読む\n5. 使っている機能・標準ライブラリについて調べる\n6. コードレビュー、複数人開発\n7. テスト\n\nなどが紹介されています。付け加えるなら\n\n- 強い人にTwitterで聞く\n\nなんてのもあるかもしれません。\n\n# 結局規格書を読むハメになる\n\nもちろんこれらの防衛術は非常に有効で、Undefined Behavior Sanitizerは結構頑張ってくれます。\n\nしかし、結局規格書を読むハメになる、という事態が生じます。\n\nそんなとき、規格書はこのコードはUndefined Behaviorかどうかを解説することを目的としていないので、極めて難易度が高く、挫折し、Undefined Behaviorを踏んでしまうでしょう。\n\n# Undefined Behaviorを放置できない時代がすでに来ている\n\nUndefined Behaviorを踏んでしまっても、処理系がプログラマーに忖度して、あるいは技術力不足で最適化に利用されない時代であれば、実害はなかったかもしれません(ほんとか？\n\nしかし現代のコンパイラは積極的に最適化を行うので、明らかに実害が出ます。\n\n- [コンパイラのリミッタが外れつつある今、null安全は必須なのかもしれない](https://qiita.com/AoiMoe/items/2554f78dc9c197d22109)\n- [鼻から悪魔：不定値(indeterminate value)バージョン](https://qiita.com/yohhoy/items/7d39b7958418f784f793)\n- [C++でうっかり無限ループを書くと鼻から悪魔が出てくる](https://qiita.com/tkmtSo/items/de3148dd1dcb70f38d6a)\n\n# C++標準化委員会は踏み抜きやすいUndefined Behavior TOP100のようなものを公式に出すべきではないか\n\nこうなるとそもそもC++標準化委員会が公式で解説を書くべきではないか？と思えてきます。\n\n踏み抜きやすいUndefined Behavior TOP100のようなものをリストアップして、現役のC++プログラマやもしくはC++プログラマになろうとしている人に向けて解説と回避方法を書いたものを作成するべきではないでしょうか？\n\nUndefined Behaviorとはもはや処理系を作る人や一部のマニアだけではなくてすべてのC++プログラマが知らなければならない知識なのですから。\n\nC++標準化委員会にはC++の教育について扱うStudy Group、[SG20 Education](https://www.cjdb.com.au/sg20-and-videos.html)というのがあります。\n\nまさにC++プログラマへの教育・啓蒙の範疇の話ですからここが適当なんじゃないでしょうか？(知らんけど\n\n[なんでchar8_tが必要か理解するためにあえて先に教えないとかのたまっている](https://qiita.com/yumetodo/items/54e1a8230dbf513ea85b#%E8%BF%BD%E8%A8%982-sg20-education-draft%E4%BA%8B%E4%BB%B6)暇があったらそういう活動をしてほしいものです。\n\n# この記事を執筆した経緯\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eところで未定義の挙動になるパターンについては重箱の隅と言われようとも積極的に覚えていこうな。コンパイラが賢くなればなるほど、今まで顕在化しなかったUBパターンが表面化しやすくなるので。\u003c/p\u003e\u0026mdash; yoh2 (@yoh2_sdj) \u003ca href=\"https://twitter.com/yoh2_sdj/status/1116009450110836736?ref_src=twsrc%5Etfw\"\u003e2019年4月10日\u003c/a\u003e\u003c/blockquote\u003e\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eというかコンパイラがアグレッシブにUBを最適化に活用する現状、C++標準化委員会は公式に特に警戒するべきUBのリストみたいなのを発行するべきなんじゃないか？\u003cbr\u003eだれもあのクソ長大な規格書をいちいち引いてUBかどうか判定する(しかも大抵間違えて解釈する)なんて作業したくねーだろ \u003ca href=\"https://t.co/cGVyt1t5Ay\"\u003ehttps://t.co/cGVyt1t5Ay\u003c/a\u003e\u003c/p\u003e\u0026mdash; yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1116018968974610432?ref_src=twsrc%5Etfw\"\u003e2019年4月10日\u003c/a\u003e\u003c/blockquote\u003e\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eほんとほしいよねこれ。\u003cbr\u003e分かりづらいところに書かれていてもUBだと名言されているならまだましで、規格書内のどこにもこのパターンに関する言及はないからUBとなるものに関しては、範囲が有限とはいえある意味悪魔の証明を求められるわけで……\u003ca href=\"https://t.co/hW8nGM14dF\"\u003ehttps://t.co/hW8nGM14dF\u003c/a\u003e\u003c/p\u003e\u0026mdash; yoh2 (@yoh2_sdj) \u003ca href=\"https://twitter.com/yoh2_sdj/status/1116020390592040960?ref_src=twsrc%5Etfw\"\u003e2019年4月10日\u003c/a\u003e\u003c/blockquote\u003e\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eC++ の規格書読むよりツイッターでつぶやいたほうが早い\u003c/p\u003e\u0026mdash; バンビちゃん@実際存在しない (@pink_bangbi) \u003ca href=\"https://twitter.com/pink_bangbi/status/1116019652256124928?ref_src=twsrc%5Etfw\"\u003e2019年4月10日\u003c/a\u003e\u003c/blockquote\u003e\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eそれがおかしい。\u003cbr\u003e\u003cbr\u003eというかSG20 Education はchar8_t型の重要性を説くためにあえて教えないとかそういう馬鹿げたことに労力を費やすんじゃなくて、踏み抜きやすいUBリストTOP100とかそういうのを作るべきだろ、仕事しろ。 \u003ca href=\"https://t.co/atElMGyt6u\"\u003ehttps://t.co/atElMGyt6u\u003c/a\u003e\u003c/p\u003e\u0026mdash; yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1116020625061978112?ref_src=twsrc%5Etfw\"\u003e2019年4月10日\u003c/a\u003e\u003c/blockquote\u003e\n\n[^1]: [nasal demons](http://www.catb.org/jargon/html/N/nasal-demons.html)\n[^2]: [本の虫: C++0x本：鼻から悪魔](https://cpplover.blogspot.jp/2010/01/c0x_14.html)\n[^3]: [本の虫: Old New Thing: 未定義動作はタイムトラベルを引き起こす（他にもいろいろあるけど、タイムトラベルが一番ぶっ飛んでる）](https://cpplover.blogspot.jp/2014/06/old-new-thing.html)\n","coediting":false,"comments_count":1,"created_at":"2019-04-12T13:29:16+09:00","group":null,"id":"d41bdb5aff4b3b8a0372","likes_count":74,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]}],"title":"C++標準化委員会は踏み抜きやすいUndefined Behavior TOP100のようなものを公式に出すべきではないか","updated_at":"2019-04-16T21:05:44+09:00","url":"https://qiita.com/yumetodo/items/d41bdb5aff4b3b8a0372","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"問題\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%95%8F%E9%A1%8C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e問題\u003c/h1\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eC++ quiz time! Without checking, what does this print (assume an LP64 / LLP64 system):\u003cbr\u003e\u003cbr\u003eshort a = 1;\u003cbr\u003estd::cout \u0026lt;\u0026lt; sizeof(+a)[\"23456\"] \u0026lt;\u0026lt; std::endl;\u003c/p\u003e— Richard Smith (@zygoloid) \u003ca href=\"https://twitter.com/zygoloid/status/1107740875671498752?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMarch 18, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこんなツイートが人気を博していた。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;\n#include \"typename.h\"\n\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"23456\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e答えは四択で\u003ccode\u003e1\u003c/code\u003e,\u003ccode\u003e3\u003c/code\u003e,\u003ccode\u003e4\u003c/code\u003e,\u003ccode\u003e6\u003c/code\u003eのどれですか？というもの。\u003c/p\u003e\n\n\u003cp\u003eだれか解説書くだろと思ったが、みんなTwitter上で満足してしまったらしい(見落としてたらすまん)。解説するか。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"正解\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%AD%A3%E8%A7%A3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e正解\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003e1\u003c/code\u003eになります。\u003c/p\u003e\n\n\u003cp\u003e・・・えええっ！？\u003c/p\u003e\n\n\u003cp\u003e(私は6だと騙された)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"6と誤答した人の脳内回路\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#6%E3%81%A8%E8%AA%A4%E7%AD%94%E3%81%97%E3%81%9F%E4%BA%BA%E3%81%AE%E8%84%B3%E5%86%85%E5%9B%9E%E8%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e6\u003c/code\u003eと誤答した人の脳内回路\u003c/h1\u003e\n\n\u003cp\u003e誤答したの私だ。アンケートを見ても一番多い。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eHuh. Cute. I'm C++ guru and I knew the type of +a is int. I also knew a[b] and b[a] is equivalent. It's so obvious. Not worthy of my time and the answer is .... Whaaaaaat!? Why?\u003c/p\u003e— Ryou Ezoe (@EzoeRyou) \u003ca href=\"https://twitter.com/EzoeRyou/status/1107896189389692928?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eMarch 19, 2019\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e江添さんがノリノリで誤答を書き込んでいる。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003esizeof(+a)[\"23456\"]\u003c/code\u003eをどうパースしたかというと\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003e+a\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esizeof(+a)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esizeof(+a)[\"23456\"]\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eとパースしてしまったのだと思う。一般に\u003ccode\u003esizeof\u003c/code\u003e演算子は必ず\u003ccode\u003e()\u003c/code\u003eとつけて使いましょう、と多くの初心者本にかかれており、そして実際多くのC++erが\u003ccode\u003e()\u003c/code\u003eをつけて使うもんだから、うっかり\u003ccode\u003esizeof(+a)\u003c/code\u003eとパースしてしまいそうになるが、\u003ccode\u003eoperator[]\u003c/code\u003eの優先順位がめっちゃ高いことを忘れないでほしい(ブーメラン)\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003e暗黙変換でintになるよね～\u003c/li\u003e\n\u003cli\u003esizeof取ったら4でしょ？\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ea[b]\u003c/code\u003eは\u003ccode\u003eb[a]\u003c/code\u003eとも書けるから文字列の4番めの要素は\u003ccode\u003e6\u003c/code\u003eだ\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eと考えていく。\u003c/p\u003e\n\n\u003cp\u003e不正解だ\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"4と誤答した人の脳内回路\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#4%E3%81%A8%E8%AA%A4%E7%AD%94%E3%81%97%E3%81%9F%E4%BA%BA%E3%81%AE%E8%84%B3%E5%86%85%E5%9B%9E%E8%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e4\u003c/code\u003eと誤答した人の脳内回路\u003c/h1\u003e\n\n\u003cp\u003e\u003ccode\u003e6\u003c/code\u003eとほぼ同じだが\u003ccode\u003e+a\u003c/code\u003eが暗黙変換でintになることを見落とすと\u003ccode\u003e4\u003c/code\u003eになる\u003c/p\u003e\n\n\u003col\u003e\n\u003cli\u003eshortでしょ？\u003c/li\u003e\n\u003cli\u003esizeof取ったら2でしょ？\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003ea[b]\u003c/code\u003eは\u003ccode\u003eb[a]\u003c/code\u003eとも書けるから文字列の4番めの要素は\u003ccode\u003e4\u003c/code\u003eだ\u003c/li\u003e\n\u003c/ol\u003e\n\n\u003cp\u003eと考えていく。\u003c/p\u003e\n\n\u003cp\u003e不正解だ\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"3と誤答した人の脳内回路\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#3%E3%81%A8%E8%AA%A4%E7%AD%94%E3%81%97%E3%81%9F%E4%BA%BA%E3%81%AE%E8%84%B3%E5%86%85%E5%9B%9E%E8%B7%AF\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e3\u003c/code\u003eと誤答した人の脳内回路\u003c/h1\u003e\n\n\u003cp\u003eごめんなさい、さっぱりわからない。アンケートでももっとも票数が少ないものの、殆ど無いってわけでもないくらい投票されている。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eだからよくわからんけど文字列の1番めの要素を見に行ってしまったとか？？\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"解説\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%A7%A3%E8%AA%AC\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e解説\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"a\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#a\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e+a\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e改めて見ていこう。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eなので\u003ccode\u003ea\u003c/code\u003eの型は\u003ccode\u003eshort\u003c/code\u003e型だ。では\u003ccode\u003e+a\u003c/code\u003eの型は？\u003c/p\u003e\n\n\u003cp\u003e実は\u003ccode\u003eint\u003c/code\u003e型になる。\u003c/p\u003e\n\n\u003cp\u003e単項演算子\u003ccode\u003e+\u003c/code\u003eの演算の際にintegral promotionという暗黙変換が行われるためだ。\u003c/p\u003e\n\n\u003cp\u003eまあ\u003cstrong\u003e実はint型であるかは重要ではない\u003c/strong\u003e。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"a23456\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#a23456\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003e(+a)[\"23456\"]\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eそうだ、ここで誤って\u003ccode\u003esizeof(+a)\u003c/code\u003eを考えてしまうと誤りだ。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eoperator[]\u003c/code\u003eはポインタ演算\u003ccode\u003e*(a + b)\u003c/code\u003eのsyntax sugarであるというのは割と有名な小話だと思う。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; 2\u003c/span\u003e\n\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; 2\u003c/span\u003e\n\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003earr\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"c1\"\u003e// =\u0026gt; 2\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eつまりこの場合\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e(+a)[\"23456\"]\u003c/code\u003eと\u003ccode\u003e\"23456\"[+a]\u003c/code\u003eは等価だ。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003ea\u003c/code\u003eの値は\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eより\u003ccode\u003e1\u003c/code\u003eなので演算結果は\u003ccode\u003echar\u003c/code\u003e型の\u003ccode\u003e3\u003c/code\u003eになる。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"sizeofa23456\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#sizeofa23456\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003esizeof(+a)[\"23456\"]\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eようやく\u003ccode\u003esizeof\u003c/code\u003e演算子の出番だ。\u003ccode\u003e(+a)[\"23456\"]\u003c/code\u003eはchar型なので、\u003ccode\u003esizeof\u003c/code\u003eを取ると\u003ccode\u003e1\u003c/code\u003eになる。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003esizeof((+a)[\"23456\"])\u003c/code\u003eとなっていれば引っかかる人は少なかっただろうが・・・。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"余談\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%BD%99%E8%AB%87\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e余談\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"/Chironian\" class=\"user-mention js-hovercard\" title=\"Chironian\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"Chironian\"\u003e@Chironian\u003c/a\u003e 氏御用達の型名を表示させるマクロ\u003ccode\u003eTYPENAME\u003c/code\u003eを使いつつ、問題のコードをいじると理解度が増すかもしれない。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"cpp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;iostream\u0026gt;\n#include \"typename.h\"\n\u003c/span\u003e\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003ecout\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\"23456\"\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"23456\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"23456\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003eTYPENAME\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"23456\"\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\n        \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e+\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e)[\u003c/span\u003e\u003cspan class=\"s\"\u003e\"23456\"\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003estd\u003c/span\u003e\u003cspan class=\"o\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eendl\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/TT51W7xs3ZEfKpeq\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/TT51W7xs3ZEfKpeq\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"plain\"\u003e\n\u003cdiv class=\"code-lang\"\u003e\u003cspan class=\"bold\"\u003e実行結果\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e4\n6\n6\n3\nchar\n1\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"教訓\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%95%99%E8%A8%93\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e教訓\u003c/h1\u003e\n\n\u003cul\u003e\n\u003cli\u003e\n\u003ccode\u003esizeof\u003c/code\u003e演算子を使うときは\u003ccode\u003e()\u003c/code\u003eでくくりましょう\u003c/li\u003e\n\u003cli\u003e\n\u003ccode\u003eoperator[]\u003c/code\u003eの優先順位の高さを忘れない\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"感想\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%84%9F%E6%83%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e感想\u003c/h1\u003e\n\n\u003cp\u003eまんまとひっかかった、くやしい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"license\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#license\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLicense\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://creativecommons.org/licenses/by/4.0/deed.ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCC BY 4.0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=66aa549d659263ec972c387f23626372\" alt=\"CC-BY icon.svg\" width=\"88px\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc030b206d86c07d8785ee921a53c18e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"# 問題\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eC++ quiz time! Without checking, what does this print (assume an LP64 / LLP64 system):\u003cbr\u003e\u003cbr\u003eshort a = 1;\u003cbr\u003estd::cout \u0026lt;\u0026lt; sizeof(+a)[\u0026quot;23456\u0026quot;] \u0026lt;\u0026lt; std::endl;\u003c/p\u003e\u0026mdash; Richard Smith (@zygoloid) \u003ca href=\"https://twitter.com/zygoloid/status/1107740875671498752?ref_src=twsrc%5Etfw\"\u003eMarch 18, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\nこんなツイートが人気を博していた。\n\n```cpp\n#include \u003ciostream\u003e\n#include \"typename.h\"\nint main()\n{\n    short a = 1;\n    std::cout \u003c\u003c sizeof(+a)[\"23456\"] \u003c\u003c std::endl;\n}\n```\n\n答えは四択で`1`,`3`,`4`,`6`のどれですか？というもの。\n\nだれか解説書くだろと思ったが、みんなTwitter上で満足してしまったらしい(見落としてたらすまん)。解説するか。\n\n# 正解\n\n`1`になります。\n\n・・・えええっ！？\n\n(私は6だと騙された)\n\n# `6`と誤答した人の脳内回路\n\n誤答したの私だ。アンケートを見ても一番多い。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eHuh. Cute. I\u0026#39;m C++ guru and I knew the type of +a is int. I also knew a[b] and b[a] is equivalent. It\u0026#39;s so obvious. Not worthy of my time and the answer is .... Whaaaaaat!? Why?\u003c/p\u003e\u0026mdash; Ryou Ezoe (@EzoeRyou) \u003ca href=\"https://twitter.com/EzoeRyou/status/1107896189389692928?ref_src=twsrc%5Etfw\"\u003eMarch 19, 2019\u003c/a\u003e\u003c/blockquote\u003e\n\n江添さんがノリノリで誤答を書き込んでいる。\n\n`sizeof(+a)[\"23456\"]`をどうパースしたかというと\n\n1. `+a`\n2. `sizeof(+a)`\n3. `sizeof(+a)[\"23456\"]`\n\nとパースしてしまったのだと思う。一般に`sizeof`演算子は必ず`()`とつけて使いましょう、と多くの初心者本にかかれており、そして実際多くのC++erが`()`をつけて使うもんだから、うっかり`sizeof(+a)`とパースしてしまいそうになるが、`operator[]`の優先順位がめっちゃ高いことを忘れないでほしい(ブーメラン)\n\n1. 暗黙変換でintになるよね～\n2. sizeof取ったら4でしょ？\n3. `a[b]`は`b[a]`とも書けるから文字列の4番めの要素は`6`だ\n\nと考えていく。\n\n不正解だ\n\n# `4`と誤答した人の脳内回路\n\n`6`とほぼ同じだが`+a`が暗黙変換でintになることを見落とすと`4`になる\n\n1. shortでしょ？\n2. sizeof取ったら2でしょ？\n3. `a[b]`は`b[a]`とも書けるから文字列の4番めの要素は`4`だ\n\nと考えていく。\n\n不正解だ\n\n# `3`と誤答した人の脳内回路\n\nごめんなさい、さっぱりわからない。アンケートでももっとも票数が少ないものの、殆ど無いってわけでもないくらい投票されている。\n\n```cpp\nshort a = 1;\n```\n\nだからよくわからんけど文字列の1番めの要素を見に行ってしまったとか？？\n\n# 解説\n\n## `+a`\n\n改めて見ていこう。\n\n```cpp\nshort a = 1;\n```\n\nなので`a`の型は`short`型だ。では`+a`の型は？\n\n実は`int`型になる。\n\n単項演算子`+`の演算の際にintegral promotionという暗黙変換が行われるためだ。\n\nまあ**実はint型であるかは重要ではない**。\n\n## `(+a)[\"23456\"]`\n\nそうだ、ここで誤って`sizeof(+a)`を考えてしまうと誤りだ。\n\n`operator[]`はポインタ演算`*(a + b)`のsyntax sugarであるというのは割と有名な小話だと思う。\n\n```c\nint arr[3] = { 1, 2, 3 };\narr[1]; // =\u003e 2\n1[arr]; // =\u003e 2\n*(arr + 1); // =\u003e 2\n```\n\nつまりこの場合\n\n`(+a)[\"23456\"]`と`\"23456\"[+a]`は等価だ。\n\n`a`の値は\n\n```cpp\nshort a = 1;\n```\n\nより`1`なので演算結果は`char`型の`3`になる。\n\n## `sizeof(+a)[\"23456\"]`\n\nようやく`sizeof`演算子の出番だ。`(+a)[\"23456\"]`はchar型なので、`sizeof`を取ると`1`になる。\n\n`sizeof((+a)[\"23456\"])`となっていれば引っかかる人は少なかっただろうが・・・。\n\n# 余談\n\n@Chironian 氏御用達の型名を表示させるマクロ`TYPENAME`を使いつつ、問題のコードをいじると理解度が増すかもしれない。\n\n```cpp\n#include \u003ciostream\u003e\n#include \"typename.h\"\nint main()\n{\n    short a = 1;\n    std::cout\n        \u003c\u003c sizeof(+a) \u003c\u003c std::endl\n        \u003c\u003c \"23456\"[4] \u003c\u003c std::endl\n        \u003c\u003c 4[\"23456\"] \u003c\u003c std::endl\n        \u003c\u003c (+a)[\"23456\"] \u003c\u003c std::endl\n        \u003c\u003c TYPENAME((+a)[\"23456\"]) \u003c\u003c std::endl\n        \u003c\u003c sizeof(+a)[\"23456\"] \u003c\u003c std::endl;\n}\n```\n\nhttps://wandbox.org/permlink/TT51W7xs3ZEfKpeq\n\n```plain:実行結果\n4\n6\n6\n3\nchar\n1\n```\n\n# 教訓\n\n- `sizeof`演算子を使うときは`()`でくくりましょう\n- `operator[]`の優先順位の高さを忘れない\n\n# 感想\n\nまんまとひっかかった、くやしい。\n\n# License\n\n[CC BY 4.0](https://creativecommons.org/licenses/by/4.0/deed.ja)\n\n\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\"\u003e\u003cimg src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" alt=\"CC-BY icon.svg\" width=\"88px\"\u003e\u003c/a\u003e\n","coediting":false,"comments_count":10,"created_at":"2019-03-21T15:06:11+09:00","group":null,"id":"00e89d183e7e77e14db8","likes_count":150,"private":false,"reactions_count":0,"tags":[{"name":"C","versions":[]},{"name":"C++","versions":[]}],"title":"Twitterで話題のC++ quiz time!の解説を誰も書かないので書く","updated_at":"2019-04-02T11:07:29+09:00","url":"https://qiita.com/yumetodo/items/00e89d183e7e77e14db8","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\u003cp\u003eNode.js界隈にはnpmというパッケージマネージャがあり、様々なパッケージを配布している。\u003c/p\u003e\n\n\u003cp\u003eところでnpmの各パッケージのページにはパッケージのデカさが記述されていない。あんまでかいパッケージはちょっとなぁって思うのは私だけだろうか。\u003c/p\u003e\n\n\u003cp\u003eそこで手軽にパッケージのデカさを調べられるツールがあったのでメモしておく。\u003c/p\u003e\n\n\u003cp\u003eネタ元は\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/40642008/how-do-i-view-the-size-of-npm-packages\" rel=\"nofollow noopener\" target=\"_blank\"\u003eHow do I view the size of npm packages? - Stack Overflow\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"bundlephobia\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#bundlephobia\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003ebundlephobia\u003c/h2\u003e\n\n\u003cp\u003eかなりグラフィカルに表示してくれる。内部でcacheしてるんか動作も早い。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://bundlephobia.com/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://bundlephobia.com/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2F51d0f004-ce88-214c-8772-3dcf0db37bd9.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d3dc0c8b318e3cf38550c6f0e377fcc2\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2F51d0f004-ce88-214c-8772-3dcf0db37bd9.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=d3dc0c8b318e3cf38550c6f0e377fcc2\" alt=\"bundlephobia\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/94177/51d0f004-ce88-214c-8772-3dcf0db37bd9.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2F51d0f004-ce88-214c-8772-3dcf0db37bd9.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=3c121ae8555da43adbbb3fc5cac9ec6c 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"npm-download-size\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#npm-download-size\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003enpm-download-size\u003c/h2\u003e\n\n\u003cp\u003e極めてシンプル。わかりやすさの塊。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://arve0.github.io/npm-download-size/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://arve0.github.io/npm-download-size/\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2F3fe0493e-7d8b-8c37-0d08-a38e24e593fd.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=57eebd141a4059f6cb143e15569129a7\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2F3fe0493e-7d8b-8c37-0d08-a38e24e593fd.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=57eebd141a4059f6cb143e15569129a7\" alt=\"npm-download-size\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/94177/3fe0493e-7d8b-8c37-0d08-a38e24e593fd.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2F3fe0493e-7d8b-8c37-0d08-a38e24e593fd.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=7acf9d3adea8e90139e66c18f4e3f0dc 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"license\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#license\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLicense\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://creativecommons.org/licenses/by/4.0/deed.ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCC BY 4.0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=66aa549d659263ec972c387f23626372\" alt=\"CC-BY icon.svg\" width=\"88px\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc030b206d86c07d8785ee921a53c18e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"Node.js界隈にはnpmというパッケージマネージャがあり、様々なパッケージを配布している。\n\nところでnpmの各パッケージのページにはパッケージのデカさが記述されていない。あんまでかいパッケージはちょっとなぁって思うのは私だけだろうか。\n\nそこで手軽にパッケージのデカさを調べられるツールがあったのでメモしておく。\n\nネタ元は\n[How do I view the size of npm packages? - Stack Overflow](https://stackoverflow.com/questions/40642008/how-do-i-view-the-size-of-npm-packages)\n\n## bundlephobia\n\nかなりグラフィカルに表示してくれる。内部でcacheしてるんか動作も早い。\n\nhttps://bundlephobia.com/\n\n![bundlephobia](https://qiita-image-store.s3.amazonaws.com/0/94177/51d0f004-ce88-214c-8772-3dcf0db37bd9.png)\n\n## npm-download-size\n\n極めてシンプル。わかりやすさの塊。\n\nhttps://arve0.github.io/npm-download-size/\n\n![npm-download-size](https://qiita-image-store.s3.amazonaws.com/0/94177/3fe0493e-7d8b-8c37-0d08-a38e24e593fd.png)\n\n# License\n\n[CC BY 4.0](https://creativecommons.org/licenses/by/4.0/deed.ja)\n\n\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\"\u003e\u003cimg src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" alt=\"CC-BY icon.svg\" width=\"88px\"\u003e\u003c/a\u003e\n","coediting":false,"comments_count":0,"created_at":"2019-02-21T01:03:46+09:00","group":null,"id":"9b560a46e1980be1c0f5","likes_count":5,"private":false,"reactions_count":0,"tags":[{"name":"npm","versions":[]}],"title":"ブラウザで完結するnpm packageのデカさを調べる方法","updated_at":"2019-04-02T11:08:12+09:00","url":"https://qiita.com/yumetodo/items/9b560a46e1980be1c0f5","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\u003cp\u003e\u003ccode\u003eWindow\u003c/code\u003e要素の直後に\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"xml\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"nt\"\u003e\u0026lt;Window.CommandBindings\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"nt\"\u003e\u0026lt;CommandBinding\u003c/span\u003e \u003cspan class=\"na\"\u003eCommand=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"Copy\"\u003c/span\u003e \u003cspan class=\"na\"\u003eExecuted=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"OnCtrlC\"\u003c/span\u003e\u003cspan class=\"nt\"\u003e/\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"nt\"\u003e\u0026lt;/Window.CommandBindings\u0026gt;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eを書く。C#側は\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"csharp\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"k\"\u003epublic\u003c/span\u003e \u003cspan class=\"k\"\u003epartial\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eMainWindow\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"n\"\u003eWindow\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eprivate\u003c/span\u003e \u003cspan class=\"k\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eOnCtrlC\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eobject\u003c/span\u003e \u003cspan class=\"n\"\u003esender\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRoutedEventArgs\u003c/span\u003e \u003cspan class=\"n\"\u003ee\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"c1\"\u003e//なんか\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e以上。\u003c/p\u003e\n\n\u003cp\u003e実例\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/ImageSizeRateCalculator\" rel=\"nofollow noopener\" target=\"_blank\"\u003eyumetodo/ImageSizeRateCalculator: https://teratail.com/questions/174798 \u003c/a\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"license\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#license\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLicense\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://creativecommons.org/licenses/by/4.0/deed.ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCC BY 4.0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=66aa549d659263ec972c387f23626372\" alt=\"CC-BY icon.svg\" width=\"88px\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc030b206d86c07d8785ee921a53c18e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"`Window`要素の直後に\n\n```xml\n    \u003cWindow.CommandBindings\u003e\n        \u003cCommandBinding Command=\"Copy\" Executed=\"OnCtrlC\"/\u003e\n    \u003c/Window.CommandBindings\u003e\n```\n\nを書く。C#側は\n\n```csharp\n    public partial class MainWindow : Window\n    {\n        private void OnCtrlC(object sender, RoutedEventArgs e)\n        {\n            //なんか\n        }\n    }\n```\n\n以上。\n\n実例\n\n[yumetodo/ImageSizeRateCalculator: https://teratail.com/questions/174798 ](https://github.com/yumetodo/ImageSizeRateCalculator)\n\n# License\n\n[CC BY 4.0](https://creativecommons.org/licenses/by/4.0/deed.ja)\n\n\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\"\u003e\u003cimg src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" alt=\"CC-BY icon.svg\" width=\"88px\"\u003e\u003c/a\u003e\n","coediting":false,"comments_count":0,"created_at":"2019-02-17T18:57:56+09:00","group":null,"id":"6781a34f19993ca11421","likes_count":0,"private":false,"reactions_count":0,"tags":[{"name":"C#","versions":[]},{"name":"WPF","versions":[]}],"title":"3秒でわかるWPFでCtrl+C(Copy)のときになんか実行する方法","updated_at":"2019-04-02T11:12:10+09:00","url":"https://qiita.com/yumetodo/items/6781a34f19993ca11421","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"きっかけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8D%E3%81%A3%E3%81%8B%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eきっかけ\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/fygar256/items/0824efc9b1c197c1dcef\" id=\"reference-f69ccb207bf2a9853d87\"\u003eローマ字かな変換サンプルコード\u003c/a\u003e\u003cbr\u003e\nという記事が先日Qiitaに公開された。C言語で書かれている。\u003c/p\u003e\n\n\u003cp\u003e自分はC++erなので最初はC++で書けばもっと書きやすくなるんじゃないかと思ったが、ここはずっと入門します詐欺をして触れていなかったRustで書こうと思い立った。\u003c/p\u003e\n\n\u003cp\u003eC++20でRangeが来ることでかなりRustっぽく扱えるようになるはずだが、まだC++20は発行もされてないしまともに実装もされていない。\u003c/p\u003e\n\n\u003cp\u003eRust入門としてちょうどいい難易度なのでやってみた。ついでにRustとC++を雑に比較する。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"方針\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%96%B9%E9%87%9D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e方針\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"元記事のコードをどこまで参照するか\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%83%E8%A8%98%E4%BA%8B%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E3%81%A9%E3%81%93%E3%81%BE%E3%81%A7%E5%8F%82%E7%85%A7%E3%81%99%E3%82%8B%E3%81%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e元記事のコードをどこまで参照するか\u003c/h2\u003e\n\n\u003cp\u003e元記事はC言語なのでDictionaryなんてない世界線の書き方をしている。\u003c/p\u003e\n\n\u003cp\u003eRustにはせっかく\u003ccode\u003eHashMap\u003c/code\u003eがあるのだからこれを使って検索を速くしたい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"ローマ字\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%83%AD%E3%83%BC%E3%83%9E%E5%AD%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eローマ字\u003c/h2\u003e\n\n\u003cp\u003eまずそもそもローマ字というのが実に曖昧な定義で、どうしてくれようかという気持ちになる。\u003c/p\u003e\n\n\u003cp\u003eかつて JIS X 4063:2000という規格があったのだが、2010年1月20日に廃止されている。\u003c/p\u003e\n\n\u003cp\u003eしかしその後なにかまともな規格は出ていないので、これに従うことにする。\u003c/p\u003e\n\n\u003cp\u003eといっても規格書は高いのでそれを引っ張っているWikipedia\u003cbr\u003e\n\u003ca href=\"https://ja.wikipedia.org/wiki/%E3%83%AD%E3%83%BC%E3%83%9E%E5%AD%97%E5%85%A5%E5%8A%9B\" rel=\"nofollow noopener\" target=\"_blank\"\u003eローマ字入力 - Wikipedia\u003c/a\u003e\u003cbr\u003e\nを参照した。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"完成品\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%AE%8C%E6%88%90%E5%93%81\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e完成品\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/romaji_kana_cvt_rust\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/romaji_kana_cvt_rust\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003egit clone\u003c/code\u003e して\u003ccode\u003ecargo build\u003c/code\u003eすれば普通にコンパイルできるはずだ。\u003c/p\u003e\n\n\u003cp\u003eC++と違ってこの辺が楽で本当にいい。つーかいつになったらC++にmoduleが来るんだ・・・。\u003c/p\u003e\n\n\u003cp\u003e元記事に合わせて実行時引数になんか文字列を渡すだけでよい。入力がローマ字かひらがなかは勝手に判定してくれる。不正な入力に対しては\u003ccode\u003einvalid input\u003c/code\u003eと言いながらpanicする。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"紹介\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B4%B9%E4%BB%8B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e紹介\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"変換テーブル\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%A4%89%E6%8F%9B%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e変換テーブル\u003c/h2\u003e\n\n\u003cp\u003eまず真っ先にJIS X 4063:2000に基づく変換テーブルを作った。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/cvt/jis_x_4063_2000.rs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/cvt/jis_x_4063_2000.rs\u003c/a\u003e\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003estd\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"nn\"\u003ecollections\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eHashMap\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"c\"\u003e// We will follow the definition of JIS X 4063:2000 even though that was already obsolete.\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eTABLE1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003cspan class=\"c\"\u003e//from JIS X 4063:2000: must\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"a\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"あ\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"i\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"い\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"u\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"う\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"え\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"o\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"お\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"n\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"ん\"\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eTABLE2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"mi\"\u003e204\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003cspan class=\"c\"\u003e//from JIS X 4063:2000: must\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ka\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"か\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ki\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"き\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ku\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"く\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ke\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"け\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"ko\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"こ\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e//中略\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"xtsu\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"っ\"\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n    \u003cspan class=\"c\"\u003e//(\"^\", \"ー\"),\u003c/span\u003e\n\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんな感じでtupleのarrayだ。\u003c/p\u003e\n\n\u003cp\u003eそしてこんな感じでDictionayを作ったりする関数を定義している。他にもいくつかある。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003epub\u003c/span\u003e \u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003emake_from_romaji_table\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eHashMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003e'static\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003e'static\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e]{\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTABLE1\u003c/span\u003e\u003cspan class=\"nf\"\u003e.iter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.cloned\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTABLE2\u003c/span\u003e\u003cspan class=\"nf\"\u003e.iter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.cloned\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003epub\u003c/span\u003e \u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003emake_to_romaji_table\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eHashMap\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003e'static\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nv\"\u003e'static\u003c/span\u003e \u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"k\"\u003emut\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eVec\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTABLE2\u003c/span\u003e\u003cspan class=\"nf\"\u003e.iter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.map\u003c/span\u003e\u003cspan class=\"p\"\u003e(|(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e)|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"py\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eVec\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eTABLE1\u003c/span\u003e\u003cspan class=\"nf\"\u003e.iter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.map\u003c/span\u003e\u003cspan class=\"p\"\u003e(|(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e)|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"py\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eVec\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"mi\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"nf\"\u003e.concat\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"nf\"\u003e.sort_by\u003c/span\u003e\u003cspan class=\"p\"\u003e(|\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"err\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"nf\"\u003e.cmp\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"err\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"nf\"\u003e.dedup_by\u003c/span\u003e\u003cspan class=\"p\"\u003e(|\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"err\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"nf\"\u003e.eq\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"err\"\u003e.\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"nf\"\u003e.iter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.cloned\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003etupleの要素をswapするのをどうしたらいいのかわからなかった。というのは\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003eTABLE1\u003c/span\u003e\u003cspan class=\"nf\"\u003e.iter\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.map\u003c/span\u003e\u003cspan class=\"p\"\u003e(|(\u003c/span\u003e\u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e)|\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\u003cspan class=\"nf\"\u003e.cloned\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"py\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eVec\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e  \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eとかしようとして苦戦していた。\u003c/p\u003e\n\n\u003cp\u003e結局わからずteratailに質問を投げた。\u003cbr\u003e\n\u003ca href=\"https://teratail.com/questions/171988#reply-256175\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRust - [(\u0026amp;str, \u0026amp;str); 6]な配列の全要素のタプルについて1番目と2番目を入れ替えvectorに変換するには｜teratail\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"/yohhoy\" class=\"user-mention js-hovercard\" title=\"yohhoy\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"yohhoy\"\u003e@yohhoy\u003c/a\u003e さんの回答をそのまま採用したのだが、その後で \u003ca href=\"/tesaguri\" class=\"user-mention js-hovercard\" title=\"tesaguri\" data-hovercard-target-type=\"user\" data-hovercard-target-name=\"tesaguri\"\u003e@tesaguri\u003c/a\u003e さんから詳しい解説がついた。上のコードがなんでだめか秒殺で答えられない読者の方はぜひリンクを踏んで解説を読みに行ってほしい。\u003c/p\u003e\n\n\u003cp\u003e・・・RustってC++と違って参照がなんかめっちゃ重なっていくから感覚に反して怖い。\u003c/p\u003e\n\n\u003cp\u003e解説読んでも未だに\u003ccode\u003e.cloned()\u003c/code\u003eがいつ必要なのかよくわからない。他のところでも書いててエラーが出たらつけたり外したりという雑な対応をしていた。RustのコンパイルエラーはC++と違って読みやすくていいですね。C++20でようやくConceptが来るのでちょっとはわかりやすくなるんでしょうか。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"is_consonant\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#is_consonant\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eis_consonant\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/cvt.rs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/cvt.rs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e元記事から唯一受け継いだ関数名だ。元記事では\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\n\u003cspan class=\"n\"\u003ebool\u003c/span\u003e  \u003cspan class=\"nf\"\u003eisconsonant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e  \u003cspan class=\"kt\"\u003echar\u003c/span\u003e  \u003cspan class=\"n\"\u003ectab\u003c/span\u003e\u003cspan class=\"p\"\u003e[]\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\"kstnhmyrwzjpbcgf\"\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"k\"\u003efor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ectab\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\u003cspan class=\"o\"\u003e!=\u003c/span\u003e\u003cspan class=\"sc\"\u003e'\\0'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"o\"\u003e==\u003c/span\u003e\u003cspan class=\"n\"\u003ectab\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n      \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように定義されているが、Rustなら\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"Rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003eis_consonant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003echar\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003ebool\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"py\"\u003e.ctab\u003c/span\u003e\u003cspan class=\"nf\"\u003e.contains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのようにスッキリ書ける。ちなみに\u003ccode\u003eself.ctab\u003c/code\u003eは変換テーブルから無駄に生成させていて、\u003ccode\u003ebcdfghjkmnpqrstvwxyz\u003c/code\u003eと等価になる。元記事よりちょっと多い。\u003c/p\u003e\n\n\u003cp\u003eまあC++でも\u003ccode\u003estd::all_of\u003c/code\u003eがあるのでそこまでRustと変わらないか。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eところで\u003ccode\u003e\u0026amp;[c][..]\u003c/code\u003eという変態的な文法はどうにかならないのか・・・。\u003cbr\u003e\n\u003ca href=\"https://www.reddit.com/r/rust/comments/30608a/split_string_on_multiple_delimiters/cppsuqb/\" rel=\"nofollow noopener\" target=\"_blank\"\u003eSplit string on multiple delimiters : rust\u003c/a\u003e\u003cbr\u003e\nで紹介されていた。\u003cbr\u003e\n\u003ccode\u003e|c2| c == c2\u003c/code\u003eと多分等価だと思うが・・・。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e単に\u003ccode\u003ec\u003c/code\u003eで良かったようだ、コメントで指摘頂いた。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"to_romaji-ひらがな-ローマ字\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#to_romaji-%E3%81%B2%E3%82%89%E3%81%8C%E3%81%AA-%E3%83%AD%E3%83%BC%E3%83%9E%E5%AD%97\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eto_romaji: ひらがな-\u0026gt;ローマ字\u003c/h2\u003e\n\n\u003cp\u003eまず真っ先にやらないといけないのがUnicode NFC正規化だ。なぜか？\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eで(U+3066, U+3099)\u003c/code\u003eという2つのcodepointで表されるものを\u003ccode\u003eで(U+3067)\u003c/code\u003eに変換するためだ。さもないとせっかくの変換テーブルに引っかからなくなる。\u003c/p\u003e\n\n\u003cp\u003e漢字が絡んでくると単なるNFC正規化じゃなくてちょっと省いたやつにしないとまずかったりするがひらがなだけなので問題ない。これによってglyphまで考えなくてもcodepointで考えれば良くなった。Rustはcodepoint単位で扱うのが極めて楽な言語なので素晴らしい。\u003c/p\u003e\n\n\u003cp\u003e一方のC++はC++20でようやく\u003ca href=\"https://qiita.com/yumetodo/items/54e1a8230dbf513ea85b\" id=\"reference-53be0fd0d26beb1004aa\"\u003e\u003ccode\u003echar8_t\u003c/code\u003e型が導入される\u003c/a\u003e程度でUnicode間の変換もかつてC++11で導入されたものの脆弱性が見つかってまるごとC++17/20でdeprecatedになってしまった。\u003c/p\u003e\n\n\u003cp\u003eRustには\u003ccode\u003eunicode_normalization\u003c/code\u003eというまんまなcrateがあるのでこれを使えばいい。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/unicode-rs/unicode-normalization\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/unicode-rs/unicode-normalization\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003eローマ字に変換するときにcodepointでいうと2文字分見る必要がある。\u003ccode\u003eきゃ\u003c/code\u003eとかを変換するために。なので\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"k\"\u003emut\u003c/span\u003e \u003cspan class=\"n\"\u003eprev_c\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\0'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのような変数をループ外に持つことになった。\u003c/p\u003e\n\n\u003cp\u003eまた\u003ccode\u003eっ\u003c/code\u003e(促音)を正しく扱うのに\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"k\"\u003emut\u003c/span\u003e \u003cspan class=\"n\"\u003eprev_sokuonn_count\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのような変数をループ外に持つことになった。これは\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eprev_sokuonn_count\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003esokuonn\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eiter\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"nf\"\u003erepeat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eappend\u003c/span\u003e\u003cspan class=\"nf\"\u003e.chars\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.next\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003e.take\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprev_sokuonn_count\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"py\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n                \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003esokuonn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n                \u003cspan class=\"n\"\u003eprev_sokuonn_count\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように使っている。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eところで任意の一文字をn個連ねた\u003ccode\u003eString\u003c/code\u003eを作るもっといい方法はないんだろうか？\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003e今は\u003ccode\u003e[char; 1]\u003c/code\u003eなarrayを作って\u003ccode\u003e.iter().cycle().take(N).collect::\u0026lt;String\u0026gt;()\u003c/code\u003eとかしているが、もうちょっとまともな方法がほしい。\u003c/del\u003e\u003c/p\u003e\n\n\u003cp\u003eC++なら\u003ccode\u003estd::string(N, c)\u003c/code\u003eで済む。\u003cbr\u003e\n\u003ca href=\"https://cpprefjp.github.io/reference/string/basic_string/op_constructor.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cpprefjp.github.io/reference/string/basic_string/op_constructor.html\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003estd::iter::repeat\u003c/code\u003eで解決しました、コメントありがとうございます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"from_romaji-ローマ字-ひらがな\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#from_romaji-%E3%83%AD%E3%83%BC%E3%83%9E%E5%AD%97-%E3%81%B2%E3%82%89%E3%81%8C%E3%81%AA\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efrom_romaji: ローマ字-\u0026gt;ひらがな\u003c/h2\u003e\n\n\u003cp\u003eこれが実に面倒くさい。\u003c/p\u003e\n\n\u003cp\u003eとにかく基本方針としてまず母音を含めつつ母音の直後で分割してそれぞれについてさらに条件分岐して変換することにした。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"k\"\u003epub\u003c/span\u003e \u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003efrom_romaji\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eOption\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"k\"\u003emut\u003c/span\u003e \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"nf\"\u003ewith_capacity\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"nf\"\u003e.len\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"k\"\u003emut\u003c/span\u003e \u003cspan class=\"n\"\u003eprev_i\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003ein\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"nf\"\u003e.match_indices\u003c/span\u003e\u003cspan class=\"p\"\u003e(|\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"nn\"\u003eSelf\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eVOWEL\u003c/span\u003e\u003cspan class=\"nf\"\u003e.contains\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e][\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"nf\"\u003e.from_romaji_impl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eprev_i\u003c/span\u003e\u003cspan class=\"o\"\u003e..=\u003c/span\u003e\u003cspan class=\"n\"\u003eindex\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eprev_i\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eindex\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003eprev_i\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"nf\"\u003e.len\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"nf\"\u003e.from_romaji_impl\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003eprev_i\u003c/span\u003e\u003cspan class=\"o\"\u003e..\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"n\"\u003ere\u003c/span\u003e \u003cspan class=\"o\"\u003e+=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"nf\"\u003eSome\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ere\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ccode\u003ematch_indices\u003c/code\u003eというのがあるらしいと言うのを\u003cbr\u003e\n\u003ca href=\"https://stackoverflow.com/questions/32257273/split-a-string-keeping-the-separators\" rel=\"nofollow noopener\" target=\"_blank\"\u003erust - Split a string keeping the separators - Stack Overflow\u003c/a\u003e\u003cbr\u003e\nで知ったのでちょっといじってこんな感じに。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e\u0026amp;input[prev_i..=index]\u003c/code\u003eとかやっているがこれはcodepoint単位じゃなくてUTF-8のbyte単位らしいのであんまよくないが、Unicodeなのでまあダメ文字問題みたいなのには出くわさないはずなのでとりあえず妥協。\u003ccode\u003e\u0026amp;input.chars().skip(prev_i).take(index + 1 - prev_i).collect::\u0026lt;String\u0026gt;()\u003c/code\u003eとかしたほうがいいのかもしれないが長すぎる。つーかRustには\u003ccode\u003esubstr\u003c/code\u003e的なやつはないんだろうか。\u003cbr\u003e\n\u003ca href=\"https://cpprefjp.github.io/reference/string_view/basic_string_view/substr.html\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://cpprefjp.github.io/reference/string_view/basic_string_view/substr.html\u003c/a\u003e\u003c/p\u003e\n\n\u003ch3\u003e\n\u003cspan id=\"from_romaji_impl\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#from_romaji_impl\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003efrom_romaji_impl\u003c/h3\u003e\n\n\u003cp\u003eでこうして母音ごとに分割された切片を処理するのが\u003ccode\u003efrom_romaji_impl\u003c/code\u003eだ。\u003c/p\u003e\n\n\u003cp\u003e切片の長さで分岐をしている。長さ0は明示的に分岐していないがどうせ\u003ccode\u003echars().next()?\u003c/code\u003eあたりで勝手に\u003ccode\u003eNone\u003c/code\u003eが帰っていくはずなので気にしない。\u003c/p\u003e\n\n\u003cp\u003e長さが1か2のときは\u003ccode\u003eっ\u003c/code\u003e(促音)や\u003ccode\u003eん\u003c/code\u003e(撥音)を気にしなくていいので単純にdictonaryを見に行っている。\u003cbr\u003e\n長さが3か4のときはとりあえずdictonaryを見に行ってなければ\u003ccode\u003eっ\u003c/code\u003e(促音)や\u003ccode\u003eん\u003c/code\u003e(撥音)の処理に飛ばしている。\u003cbr\u003e\nそれ以上の長さのときはdictionaryを引く必要がないので単に\u003ccode\u003eっ\u003c/code\u003e(促音)や\u003ccode\u003eん\u003c/code\u003e(撥音)の処理に飛ばしている。\u003c/p\u003e\n\n\u003ch4\u003e\n\u003cspan id=\"convert_sokuonn_and_the_sound_of_the_kana_n\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#convert_sokuonn_and_the_sound_of_the_kana_n\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003econvert_sokuonn_and_the_sound_of_the_kana_n\u003c/h4\u003e\n\n\u003cp\u003e促音/撥音という概念が英語圏にないらしく関数名が意味不明になっている。識別名に絵文字とか使えるようにしようぜっていう提案がRustではあったはずなんだがまだ通ってないらしい。ちなみにC++にも一度そういう提案が出たがスルーされている。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e    \u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003econvert_sokuonn_and_the_sound_of_the_kana_n\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nb\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eOption\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eusize\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"k\"\u003emut\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"nf\"\u003e.chars\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003ec1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"nf\"\u003e.next\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003ecnt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eit\u003c/span\u003e\u003cspan class=\"nf\"\u003e.take_while\u003c/span\u003e\u003cspan class=\"p\"\u003e(|\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ec1\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003e.count\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"sc\"\u003e'n'\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ec1\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003ekana_cnt\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecnt\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"err\"\u003e/\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n            \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ekana_cnt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\''\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"nf\"\u003e.chars\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.nth\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nf\"\u003eSome\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"sc\"\u003e'ん'\u003c/span\u003e\u003cspan class=\"nf\"\u003e.to_string\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"nf\"\u003e.is_consonant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"nf\"\u003e.chars\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.nth\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e?\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nf\"\u003eSome\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"sc\"\u003e'ん'\u003c/span\u003e\u003cspan class=\"nf\"\u003e.to_string\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                    \u003cspan class=\"nb\"\u003eNone\u003c/span\u003e\n                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n                \u003cspan class=\"nf\"\u003eSome\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nn\"\u003eiter\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"nf\"\u003erepeat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'ん'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003e.take\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ekana_cnt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"py\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003ekana_cnt\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ecnt\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003eNone\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"k\"\u003eself\u003c/span\u003e\u003cspan class=\"nf\"\u003e.is_consonant\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nf\"\u003eSome\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"nn\"\u003eiter\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"nf\"\u003erepeat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'っ'\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"nf\"\u003e.take\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecnt\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"py\"\u003e.collect\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"n\"\u003ecnt\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n            \u003cspan class=\"nb\"\u003eNone\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e相互再帰したくなかったのでtupleのOptionを返すことになった。\u003c/p\u003e\n\n\u003cp\u003e一文字目だけ自力で取ってあとは\u003ccode\u003etake_while\u003c/code\u003eと\u003ccode\u003ecount\u003c/code\u003eの合わせ技で連続数を数えている。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003eん\u003c/code\u003e(撥音)は\u003ccode\u003en\u003c/code\u003e, \u003ccode\u003enn\u003c/code\u003e, \u003ccode\u003en'\u003c/code\u003eがあるが、\u003ccode\u003en\u003c/code\u003eはな行とかぶるので無効とする。で\u003ccode\u003en'\u003c/code\u003eのためにコードが長くなった。\u003cbr\u003e\n\u003ca href=\"https://github.com/yumetodo/romaji_kana_cvt_rust/commit/e4832541714d5a0e0ec2134b5557987d521da2c5\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/romaji_kana_cvt_rust/commit/e4832541714d5a0e0ec2134b5557987d521da2c5\u003c/a\u003e\u003cbr\u003e\n\u003ccode\u003en'\u003c/code\u003eの連続については一回ずつ再帰することにした。\u003c/p\u003e\n\n\u003cp\u003eあと\u003ccode\u003enya\u003c/code\u003eみたいに\u003ccode\u003en\u003c/code\u003e+子音字の組み合わせを当初考慮し忘れていて修正した\u003cbr\u003e\n\u003ca href=\"https://github.com/yumetodo/romaji_kana_cvt_rust/issues/1\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/romaji_kana_cvt_rust/issues/1\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003enn\u003c/code\u003eの連続については連続数を2で割って切り捨てた回数分\u003ccode\u003eん\u003c/code\u003eがあることを意味するのでそのように変換している。\u003c/p\u003e\n\n\u003cp\u003eそれ以外の子音字の連続は1引いた上で、単に\u003ccode\u003eっ\u003c/code\u003eに置き換えたのと同じように変換している。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"convert-変換\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#convert-%E5%A4%89%E6%8F%9B\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003econvert: 変換\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/main.rs\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/main.rs\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e入力がローマ字のみか否かを調べてどっちの変換を使うか分岐させている。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"rust\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003emod\u003c/span\u003e \u003cspan class=\"n\"\u003ecvt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003ecvt\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"n\"\u003eRomajiCvt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003econvert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nb\"\u003eOption\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003elet\u003c/span\u003e \u003cspan class=\"n\"\u003econverter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eRomajiCvt\u003c/span\u003e\u003cspan class=\"p\"\u003e::\u003c/span\u003e\u003cspan class=\"nf\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"nf\"\u003e.chars\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"nf\"\u003e.all\u003c/span\u003e\u003cspan class=\"p\"\u003e(|\u003c/span\u003e\u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"p\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e\u003cspan class=\"nf\"\u003e.is_ascii_alphabetic\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003ec\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\''\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econverter\u003c/span\u003e\u003cspan class=\"nf\"\u003e.from_romaji\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003econverter\u003c/span\u003e\u003cspan class=\"nf\"\u003e.to_romaji\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einput\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e当初\u003ccode\u003efilter\u003c/code\u003eして\u003ccode\u003ecount\u003c/code\u003eして\u003ccode\u003elen\u003c/code\u003eと比較とかいうだるいことをしていたが\u003ccode\u003eall\u003c/code\u003eというやつがあったらしい。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"license\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#license\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eLicense\u003c/h1\u003e\n\n\u003cp\u003e\u003ca href=\"https://creativecommons.org/licenses/by/4.0/deed.ja\" rel=\"nofollow noopener\" target=\"_blank\"\u003eCC BY 4.0\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=66aa549d659263ec972c387f23626372\" alt=\"CC-BY icon.svg\" width=\"88px\" data-canonical-src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F1%2F16%2FCC-BY_icon.svg%2F1200px-CC-BY_icon.svg.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=bc030b206d86c07d8785ee921a53c18e 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n","body":"# きっかけ\n\n[ローマ字かな変換サンプルコード](https://qiita.com/fygar256/items/0824efc9b1c197c1dcef)\nという記事が先日Qiitaに公開された。C言語で書かれている。\n\n自分はC++erなので最初はC++で書けばもっと書きやすくなるんじゃないかと思ったが、ここはずっと入門します詐欺をして触れていなかったRustで書こうと思い立った。\n\nC++20でRangeが来ることでかなりRustっぽく扱えるようになるはずだが、まだC++20は発行もされてないしまともに実装もされていない。\n\nRust入門としてちょうどいい難易度なのでやってみた。ついでにRustとC++を雑に比較する。\n\n# 方針\n\n## 元記事のコードをどこまで参照するか\n\n元記事はC言語なのでDictionaryなんてない世界線の書き方をしている。\n\nRustにはせっかく`HashMap`があるのだからこれを使って検索を速くしたい。\n\n## ローマ字\n\nまずそもそもローマ字というのが実に曖昧な定義で、どうしてくれようかという気持ちになる。\n\nかつて JIS X 4063:2000という規格があったのだが、2010年1月20日に廃止されている。\n\nしかしその後なにかまともな規格は出ていないので、これに従うことにする。\n\nといっても規格書は高いのでそれを引っ張っているWikipedia\n[ローマ字入力 - Wikipedia](https://ja.wikipedia.org/wiki/%E3%83%AD%E3%83%BC%E3%83%9E%E5%AD%97%E5%85%A5%E5%8A%9B)\nを参照した。\n\n# 完成品\n\nhttps://github.com/yumetodo/romaji_kana_cvt_rust\n\n`git clone` して`cargo build`すれば普通にコンパイルできるはずだ。\n\nC++と違ってこの辺が楽で本当にいい。つーかいつになったらC++にmoduleが来るんだ・・・。\n\n元記事に合わせて実行時引数になんか文字列を渡すだけでよい。入力がローマ字かひらがなかは勝手に判定してくれる。不正な入力に対しては`invalid input`と言いながらpanicする。\n\n# 紹介\n\n## 変換テーブル\n\nまず真っ先にJIS X 4063:2000に基づく変換テーブルを作った。\n\nhttps://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/cvt/jis_x_4063_2000.rs\n\n```rust\nuse std::collections::HashMap;\n\n// We will follow the definition of JIS X 4063:2000 even though that was already obsolete.\nconst TABLE1: [(\u0026str,  \u0026str); 6] = [\n//from JIS X 4063:2000: must\n    (\"a\", \"あ\"), (\"i\", \"い\"), (\"u\", \"う\"), (\"e\", \"え\"), (\"o\", \"お\"),\n    (\"n\", \"ん\")\n];\nconst TABLE2: [(\u0026str,  \u0026str); 204] = [\n//from JIS X 4063:2000: must\n    (\"ka\", \"か\"), (\"ki\", \"き\"), (\"ku\", \"く\"), (\"ke\", \"け\"), (\"ko\", \"こ\"),\n    //中略\n    (\"xtsu\", \"っ\"),\n    //(\"^\", \"ー\"),\n];\n```\n\nこんな感じでtupleのarrayだ。\n\nそしてこんな感じでDictionayを作ったりする関数を定義している。他にもいくつかある。\n\n```rust\npub fn make_from_romaji_table() -\u003e [HashMap\u003c\u0026'static str, \u0026'static str\u003e; 2]{\n    [\n        TABLE1.iter().cloned().collect(),\n        TABLE2.iter().cloned().collect()\n    ]\n}\n\npub fn make_to_romaji_table() -\u003e HashMap\u003c\u0026'static str, \u0026'static str\u003e {\n    let mut t: Vec\u003c_\u003e = [\n        TABLE2.iter().map(|(s1, s2)| (*s2, *s1)).collect::\u003cVec\u003c_\u003e\u003e(),\n        TABLE1.iter().map(|(s1, s2)| (*s2, *s1)).collect::\u003cVec\u003c_\u003e\u003e(),\n    ].concat();\n    t.sort_by(|a, b| a.0.cmp(b.0));\n    t.dedup_by(|a, b| a.0.eq(b.0));\n    t.iter().cloned().collect()\n}\n```\n\ntupleの要素をswapするのをどうしたらいいのかわからなかった。というのは\n\n```rust\nTABLE1.iter().map(|(s1, s2)| (s2, s1)).cloned().collect::\u003cVec\u003c(\u0026str,  \u0026str)\u003e\u003e()\n```\n\nとかしようとして苦戦していた。\n\n結局わからずteratailに質問を投げた。\n[Rust - [(\u0026str, \u0026str); 6]な配列の全要素のタプルについて1番目と2番目を入れ替えvectorに変換するには｜teratail](https://teratail.com/questions/171988#reply-256175)\n\n@yohhoy さんの回答をそのまま採用したのだが、その後で @tesaguri さんから詳しい解説がついた。上のコードがなんでだめか秒殺で答えられない読者の方はぜひリンクを踏んで解説を読みに行ってほしい。\n\n・・・RustってC++と違って参照がなんかめっちゃ重なっていくから感覚に反して怖い。\n\n解説読んでも未だに`.cloned()`がいつ必要なのかよくわからない。他のところでも書いててエラーが出たらつけたり外したりという雑な対応をしていた。RustのコンパイルエラーはC++と違って読みやすくていいですね。C++20でようやくConceptが来るのでちょっとはわかりやすくなるんでしょうか。\n\n## is_consonant\n\nhttps://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/cvt.rs\n\n元記事から唯一受け継いだ関数名だ。元記事では\n\n```c\n\nbool  isconsonant(char c)\n{\nstatic  char  ctab[]=\"kstnhmyrwzjpbcgf\";\n  int i;\n  for(i=0;ctab[i]!='\\0';i++) {\n    if (c==ctab[i])\n      return(true);\n    }\n  return(false);\n}\n```\n\nのように定義されているが、Rustなら\n\n```Rust\n    fn is_consonant(\u0026self, c: char) -\u003e bool {\n        self.ctab.contains(\u0026[c][..])\n}\n```\n\nのようにスッキリ書ける。ちなみに`self.ctab`は変換テーブルから無駄に生成させていて、`bcdfghjkmnpqrstvwxyz`と等価になる。元記事よりちょっと多い。\n\nまあC++でも`std::all_of`があるのでそこまでRustと変わらないか。\n\n~~ところで`\u0026[c][..]`という変態的な文法はどうにかならないのか・・・。\n[Split string on multiple delimiters : rust](https://www.reddit.com/r/rust/comments/30608a/split_string_on_multiple_delimiters/cppsuqb/)\nで紹介されていた。\n`|c2| c == c2`と多分等価だと思うが・・・。~~\n\n単に`c`で良かったようだ、コメントで指摘頂いた。\n\n## to_romaji: ひらがな-\u003eローマ字\n\nまず真っ先にやらないといけないのがUnicode NFC正規化だ。なぜか？\n\n`で(U+3066, U+3099)`という2つのcodepointで表されるものを`で(U+3067)`に変換するためだ。さもないとせっかくの変換テーブルに引っかからなくなる。\n\n漢字が絡んでくると単なるNFC正規化じゃなくてちょっと省いたやつにしないとまずかったりするがひらがなだけなので問題ない。これによってglyphまで考えなくてもcodepointで考えれば良くなった。Rustはcodepoint単位で扱うのが極めて楽な言語なので素晴らしい。\n\n一方のC++はC++20でようやく[`char8_t`型が導入される](https://qiita.com/yumetodo/items/54e1a8230dbf513ea85b)程度でUnicode間の変換もかつてC++11で導入されたものの脆弱性が見つかってまるごとC++17/20でdeprecatedになってしまった。\n\nRustには`unicode_normalization`というまんまなcrateがあるのでこれを使えばいい。\n\nhttps://github.com/unicode-rs/unicode-normalization\n\nローマ字に変換するときにcodepointでいうと2文字分見る必要がある。`きゃ`とかを変換するために。なので\n\n```rust\nlet mut prev_c = '\\0';\n```\n\nのような変数をループ外に持つことになった。\n\nまた`っ`(促音)を正しく扱うのに\n\n```rust\nlet mut prev_sokuonn_count = 0;\n```\n\nのような変数をループ外に持つことになった。これは\n\n```rust\n            if 0 != prev_sokuonn_count {\n                let sokuonn = iter::repeat(append.chars().next()?).take(prev_sokuonn_count).collect::\u003cString\u003e();\n                re += \u0026sokuonn;\n                prev_sokuonn_count = 0;\n            }\n```\n\nのように使っている。\n\n~~ところで任意の一文字をn個連ねた`String`を作るもっといい方法はないんだろうか？~~\n\n~~今は`[char; 1]`なarrayを作って`.iter().cycle().take(N).collect::\u003cString\u003e()`とかしているが、もうちょっとまともな方法がほしい。~~\n\nC++なら`std::string(N, c)`で済む。\nhttps://cpprefjp.github.io/reference/string/basic_string/op_constructor.html\n\n`std::iter::repeat`で解決しました、コメントありがとうございます。\n\n## from_romaji: ローマ字-\u003eひらがな\n\nこれが実に面倒くさい。\n\nとにかく基本方針としてまず母音を含めつつ母音の直後で分割してそれぞれについてさらに条件分岐して変換することにした。\n\n```rust\n    pub fn from_romaji(\u0026self, input: String) -\u003e Option\u003cString\u003e {\n        let mut re = String::with_capacity(input.len() * 2);\n        let mut prev_i = 0;\n        for (index, _) in input.match_indices(|c| Self::VOWEL.contains(\u0026[c][..])) {\n            let s = self.from_romaji_impl(\u0026input[prev_i..=index])?;\n            re += \u0026s;\n            prev_i = index + 1;\n        }\n        if prev_i != input.len() {\n            let s = self.from_romaji_impl(\u0026input[prev_i..])?;\n            re += \u0026s;\n        }\n        Some(re)\n}\n```\n\n`match_indices`というのがあるらしいと言うのを\n[rust - Split a string keeping the separators - Stack Overflow](https://stackoverflow.com/questions/32257273/split-a-string-keeping-the-separators)\nで知ったのでちょっといじってこんな感じに。\n\n`\u0026input[prev_i..=index]`とかやっているがこれはcodepoint単位じゃなくてUTF-8のbyte単位らしいのであんまよくないが、Unicodeなのでまあダメ文字問題みたいなのには出くわさないはずなのでとりあえず妥協。`\u0026input.chars().skip(prev_i).take(index + 1 - prev_i).collect::\u003cString\u003e()`とかしたほうがいいのかもしれないが長すぎる。つーかRustには`substr`的なやつはないんだろうか。\nhttps://cpprefjp.github.io/reference/string_view/basic_string_view/substr.html\n\n### from_romaji_impl\n\nでこうして母音ごとに分割された切片を処理するのが`from_romaji_impl`だ。\n\n切片の長さで分岐をしている。長さ0は明示的に分岐していないがどうせ`chars().next()?`あたりで勝手に`None`が帰っていくはずなので気にしない。\n\n長さが1か2のときは`っ`(促音)や`ん`(撥音)を気にしなくていいので単純にdictonaryを見に行っている。\n長さが3か4のときはとりあえずdictonaryを見に行ってなければ`っ`(促音)や`ん`(撥音)の処理に飛ばしている。\nそれ以上の長さのときはdictionaryを引く必要がないので単に`っ`(促音)や`ん`(撥音)の処理に飛ばしている。\n\n#### convert_sokuonn_and_the_sound_of_the_kana_n\n\n促音/撥音という概念が英語圏にないらしく関数名が意味不明になっている。識別名に絵文字とか使えるようにしようぜっていう提案がRustではあったはずなんだがまだ通ってないらしい。ちなみにC++にも一度そういう提案が出たがスルーされている。\n\n```rust\n    fn convert_sokuonn_and_the_sound_of_the_kana_n(\u0026self, s: \u0026str) -\u003e Option\u003c(String, usize)\u003e {\n        let mut it = s.chars();\n        let c1 = it.next()?;\n        let cnt = it.take_while(|c| c1 == *c).count();\n        if 'n' == c1 {\n            let kana_cnt = (cnt + 1) / 2;\n            if 0 == kana_cnt {\n                if '\\'' == s.chars().nth(1)? {\n                    Some(('ん'.to_string(), 2))\n                } else if self.is_consonant(s.chars().nth(1)?) {\n                    Some(('ん'.to_string(), 1))\n                } else {\n                    None\n                }\n            } else {\n                Some((iter::repeat('ん').take(kana_cnt).collect::\u003cString\u003e(), kana_cnt * 2))\n            }\n        } else if 0 == cnt {\n            None\n        } else if self.is_consonant(c1) {\n            Some((iter::repeat('っ').take(cnt).collect::\u003cString\u003e(), cnt))\n        } else {\n            None\n        }\n    }\n```\n\n相互再帰したくなかったのでtupleのOptionを返すことになった。\n\n一文字目だけ自力で取ってあとは`take_while`と`count`の合わせ技で連続数を数えている。\n\n`ん`(撥音)は`n`, `nn`, `n'`があるが、`n`はな行とかぶるので無効とする。で`n'`のためにコードが長くなった。\nhttps://github.com/yumetodo/romaji_kana_cvt_rust/commit/e4832541714d5a0e0ec2134b5557987d521da2c5\n`n'`の連続については一回ずつ再帰することにした。\n\nあと`nya`みたいに`n`+子音字の組み合わせを当初考慮し忘れていて修正した\nhttps://github.com/yumetodo/romaji_kana_cvt_rust/issues/1\n\n`nn`の連続については連続数を2で割って切り捨てた回数分`ん`があることを意味するのでそのように変換している。\n\nそれ以外の子音字の連続は1引いた上で、単に`っ`に置き換えたのと同じように変換している。\n\n## convert: 変換\n\nhttps://github.com/yumetodo/romaji_kana_cvt_rust/blob/v1.2.1/src/main.rs\n\n入力がローマ字のみか否かを調べてどっちの変換を使うか分岐させている。\n\n```rust\nmod cvt;\nuse cvt::RomajiCvt;\n\nfn convert(input: String) -\u003e Option\u003cString\u003e {\n    let converter = RomajiCvt::new();\n    if input.chars().all(|c| c.is_ascii_alphabetic() || c == '\\'') {\n        converter.from_romaji(input)\n    } else {\n        converter.to_romaji(input)\n    }\n}\n```\n\n当初`filter`して`count`して`len`と比較とかいうだるいことをしていたが`all`というやつがあったらしい。\n\n\n# License\n\n[CC BY 4.0](https://creativecommons.org/licenses/by/4.0/deed.ja)\n\n\u003ca href=\"https://commons.wikimedia.org/wiki/File:CC-BY_icon.svg#/media/File:CC-BY_icon.svg\"\u003e\u003cimg src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/CC-BY_icon.svg/1200px-CC-BY_icon.svg.png\" alt=\"CC-BY icon.svg\" width=\"88px\"\u003e\u003c/a\u003e\n","coediting":false,"comments_count":8,"created_at":"2019-02-01T15:49:37+09:00","group":null,"id":"376c94b618a4aeb49445","likes_count":10,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"Rust","versions":[]},{"name":"文字列","versions":[]},{"name":"ローマ字","versions":[]},{"name":"JISX4063","versions":["2000"]}],"title":"ローマ字かな変換をRustで","updated_at":"2019-04-02T11:13:59+09:00","url":"https://qiita.com/yumetodo/items/376c94b618a4aeb49445","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"はじめに\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eはじめに\u003c/h1\u003e\n\n\u003cp\u003e2016年01月22日にQiitaに\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/238751b879c09b56234b\" id=\"reference-cba755b6388a159f9188\"\u003eC言語で安全に標準入力から数値を取得\u003c/a\u003e\u003cbr\u003e\nを投稿してからもう3年が経とうとしている。\u003c/p\u003e\n\n\u003cp\u003e初投稿からいくつも不具合が見つかり、つい先日も\u003ccode\u003efgets\u003c/code\u003eのエラーハンドリング周りでバグを見つけて改定した。C言語で安全に標準入力から数値を取得するのが難しすぎる。\u003c/p\u003e\n\n\u003cp\u003eQiitaやteratailでCの標準入力から数値を取得しているものを見るたびに上の記事へ誘導し続けてきた。\u003c/p\u003e\n\n\u003cp\u003eところで先日\u003cbr\u003e\n\u003ca href=\"https://teratail.com/questions/167222\" rel=\"nofollow noopener\" target=\"_blank\"\u003eC++ - 自分の解答の穴を見つけて頂けると助かります。｜teratail\u003c/a\u003e\u003cbr\u003e\nという質問を発見した。元のコードは「苦しんで覚えるc言語」のとあるコードらしいが、改善点がいくつもある。\u003c/p\u003e\n\n\u003cp\u003eさぁ、そろそろ「苦しんで覚えるc言語」に挑むか。\u003c/p\u003e\n\n\u003cp\u003e・・・ちなみに筆者は「苦しんで覚えるc言語」立ち見勢ですが、良書だと思ってます。\u003cdel\u003e独習Cなんざ投げ捨てるべし\u003c/del\u003e\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"元のコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%85%83%E3%81%AE%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e元のコード\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include\u0026lt;stdio.h\u0026gt;\n#include\u0026lt;string.h\u0026gt;\n\u003c/span\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInputPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eShowPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInputPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eShowPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInputPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"名前：\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003escanf_s\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%s\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"mi\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"年齢：\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003escanf_s\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%d\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"性別(1-男性、2-女性):\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003escanf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%d\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eShowPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"名前：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"年齢：%d\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\n\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estrcpy_s\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"男性\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003estrcpy_s\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"女性\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"性別：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"改善できそうなところ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%94%B9%E5%96%84%E3%81%A7%E3%81%8D%E3%81%9D%E3%81%86%E3%81%AA%E3%81%A8%E3%81%93%E3%82%8D\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e改善できそうなところ\u003c/h1\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"msvcに依存したコード\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#msvc%E3%81%AB%E4%BE%9D%E5%AD%98%E3%81%97%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eMSVCに依存したコード\u003c/h2\u003e\n\n\u003cp\u003e一部\u003ccode\u003escanf_s\u003c/code\u003eじゃなくて\u003ccode\u003escanf\u003c/code\u003eが見えるから、元のコードじゃなくて質問者が書き換えた疑惑があるけどそれはさておき。\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003e_s\u003c/code\u003e付き関数は一部はC11で標準にoptionalで入ったが、常に使えるわけではないしなんかやっぱりCから取り除くみたいな話も聞く。使わないように書き換えるべきだろう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"scanf系関数で数値を読み込まない\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#scanf%E7%B3%BB%E9%96%A2%E6%95%B0%E3%81%A7%E6%95%B0%E5%80%A4%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%81%BE%E3%81%AA%E3%81%84\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003escanf系関数で数値を読み込まない\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita.com/yumetodo/items/238751b879c09b56234b\"\u003eC言語で安全に標準入力から数値を取得\u003c/a\u003e\u003cbr\u003e\nでも他所でもさんざん指摘されているとおり、scanf系関数で安全に数値に変換することはできない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"構造体コピーの排除\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E6%A7%8B%E9%80%A0%E4%BD%93%E3%82%B3%E3%83%94%E3%83%BC%E3%81%AE%E6%8E%92%E9%99%A4\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e構造体コピーの排除\u003c/h2\u003e\n\n\u003cp\u003eコード中の構造体を見てみる。\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e256要素ある\u003ccode\u003echar\u003c/code\u003e配列をメンバーに持つ。結構でかい構造体だ。しかし\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"n\"\u003eShowPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように引数でコピーが発生する。どっちが速いかはきっと大差ないけど、メモリー使用量を無駄に増やすことはないと思う。ポインタ経由で渡そう。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"無意味なstrcpy_s\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%84%A1%E6%84%8F%E5%91%B3%E3%81%AAstrcpy_s\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e無意味な\u003ccode\u003estrcpy_s\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e抜粋すると\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estrcpy_s\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"男性\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"k\"\u003eelse\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estrcpy_s\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\"女性\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"性別：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eこんなコードが見えるが、三項演算子を使うべき場面であって、strcpy_sを使うべき理由はない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"不正な入力に対するエラー処理\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E4%B8%8D%E6%AD%A3%E3%81%AA%E5%85%A5%E5%8A%9B%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E3%82%A8%E3%83%A9%E3%83%BC%E5%87%A6%E7%90%86\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e不正な入力に対するエラー処理\u003c/h2\u003e\n\n\u003cp\u003e初心者本に求めるのは間違っているが、不正な入力に対する対策がない。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"それunsignedにできるよ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%9D%E3%82%8Cunsigned%E3%81%AB%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eそれunsignedにできるよ\u003c/h2\u003e\n\n\u003cp\u003e無味に符号付き整数型を使うような愚策は\u003ca href=\"https://google.github.io/styleguide/cppguide.html#Integer_Types\" rel=\"nofollow noopener\" target=\"_blank\"\u003eGoogle C++ Style Guide\u003c/a\u003eにでも任せておけばいい。そんな愚行に付き合う必要はない。\u003c/p\u003e\n\n\u003cp\u003e符号がないことでバグを作り込む確率を大幅に下げられる。詳しくは\u003cbr\u003e\n\u003ca href=\"https://qiita.com/yumetodo/items/4ea151e15b5e540cfef5\" id=\"reference-a018f0a7649bf2742947\"\u003eC/C++はnull安全になる前に安全に差の絶対値を計算できるようになるべきではないか\u003c/a\u003e\u003cbr\u003e\nを参照して欲しい。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"分裂したprintf\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E5%88%86%E8%A3%82%E3%81%97%E3%81%9Fprintf\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e分裂した\u003ccode\u003eprintf\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003eたしかに\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"名前：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"年齢：%d\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eのように分けたほうが見やすいと主張する人がいるのは知っている。でも\u003c/p\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"名前：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n    \u003cspan class=\"s\"\u003e\"年齢：%d\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n    \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\n\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eくっつけたほうが見やすいと私は思う。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\"printfn\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#printfn\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e\u003ccode\u003eprintf(\"\\n\");\u003c/code\u003e\n\u003c/h2\u003e\n\n\u003cp\u003e\u003ccode\u003eprintf\u003c/code\u003eを使うべき理由がない。\u003ccode\u003eputchar\u003c/code\u003eで行こう。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"結果\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E7%B5%90%E6%9E%9C\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e結果\u003c/h1\u003e\n\n\u003cdiv class=\"code-frame\" data-lang=\"c\"\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre\u003e\u003cspan class=\"cp\"\u003e#include \u0026lt;stdio.h\u0026gt;\n#include \u0026lt;stdlib.h\u0026gt;\n#include \u0026lt;string.h\u0026gt;\n#include \u0026lt;limits.h\u0026gt;\n#include \u0026lt;errno.h\u0026gt;\n#include \u0026lt;stdbool.h\u0026gt;\n#include \u0026lt;ctype.h\u0026gt;\n#include \u0026lt;float.h\u0026gt;\n#include \u0026lt;assert.h\u0026gt;\n#ifndef static_assert\n#   define NO_STDC_STATIC_ASSERT\n#   define static_assert(...)\n#endif\n#if defined(_MSC_VER) || defined(__cplusplus)\n#   define restrict\n#endif\n\u003c/span\u003e\u003cspan class=\"cm\"\u003e/**\n * @brief 文字列が文字を持っているか調べます。\n * @param str 対象文字列へのポインタ\n * @return false: nullptrか空白文字のみの文字列 true:それ以外\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003estr_has_char\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\0'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003estr\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003estr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"sc\"\u003e' '\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003eret\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/**\n * @brief 文字列が文字を持っているか調べます。\n * @param io 書き換えるbool型変数へのポインタ、呼び出し後はポインタが指す変数にnew_valueが代入される\n * @param new_value 新しい値\n * @return ioが指すbool変数がもともと持っていた値\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"nf\"\u003eexchange_bool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebool\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003eio\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003enew_value\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eio\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eio\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enew_value\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"n\"\u003etmp\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"cm\"\u003e/**\n * @brief fgetsで失敗したときにストリームをクリアしてループする関数\n * @param s ストリームから読み取った文字列を格納するための領域へのポインタ\n * @param buf_size ストリームから読み取った文字列を格納するための領域の大きさ\n * @param stream FILE構造体へのポインタかstdin\n * @param message_on_error エラー時に表示してループする\n * @return 成功時は0, new line at the end of fileのときは-1\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003efgets_wrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eFILE\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebool\u003c/span\u003e \u003cspan class=\"n\"\u003efirst_flg\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003efgets\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003eexchange_bool\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003efirst_flg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003efalse\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003eputs\u003c/span\u003e\u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"再入力してください\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100u\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//無限ループ防止\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//改行文字が入力を受けた配列にない場合、入力ストリームにごみがある\u003c/span\u003e\n    \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estrlen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//短すぎる入力\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\n'\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]))\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"c1\"\u003e//長過ぎる入力\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'\\n'\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003elen\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e])\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//入力ストリームを掃除\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efgetc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estream\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * @brief 標準入力から文字列の入力を受ける\n * @param s ストリームから読み取った文字列を格納するための領域へのポインタ\n * @param buf_size ストリームから読み取った文字列を格納するための領域の大きさ\n * @param message 入力を受ける前にputsに渡す文字列。表示しない場合はnullptrか空白文字のみで構成された文字列へのポインタを渡す\n * @param message_on_error エラー時に表示してループする\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003einput_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr_has_char\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003eputs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100u\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//長過ぎる入力以降の無限ループ防止にerrnoをクリアする\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eerrno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efgets_wrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ebuf_size\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//EOF\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//短すぎる入力\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//長過ぎる入力\u003c/span\u003e\n            \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nl\"\u003edefault:\u003c/span\u003e \u003cspan class=\"k\"\u003egoto\u003c/span\u003e \u003cspan class=\"n\"\u003eafter_loop\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100u\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//無限ループ防止\u003c/span\u003e\n\u003cspan class=\"nl\"\u003eafter_loop:\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003elf\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estrchr\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003elf\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003elf\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"sc\"\u003e'\\0'\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"cm\"\u003e/**\n * @brief 標準入力から入力を受け、unsigned int型に変換する\n * @details fgetsしてstrtodしている。max, minの条件に合わないかエラー時はループ\n * @details errnoの値を書き換える\n * @param message 入力を受ける前にputsに渡す文字列。表示しない場合はnullptrか空白文字のみで構成された文字列へのポインタを渡す\n * @param message_on_error エラー時に表示してループする\n * @param max 入力値を制限する。最大値を指定\n * @param min 入力値を制限する。最小値を指定\n * @return 入力した数字、EOFのときは0\n */\u003c/span\u003e\n\u003cspan class=\"k\"\u003estatic\u003c/span\u003e \u003cspan class=\"kr\"\u003einline\u003c/span\u003e \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003einput_uint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"kr\"\u003erestrict\u003c/span\u003e \u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003emin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estr_has_char\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003eputs\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"n\"\u003estatic_assert\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"err\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003elong\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003echar\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003eendptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003eendptr\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003eerrno\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003emin\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e100u\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"c1\"\u003e//長過ぎる入力以降の無限ループ防止にerrnoをクリアする\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eerrno\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eswitch\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efgets_wrap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emessage_on_error\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//EOF\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//短すぎる入力\u003c/span\u003e\n        \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//長過ぎる入力\u003c/span\u003e\n            \u003cspan class=\"n\"\u003eendptr\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"c1\"\u003e//ループ制御フラグとして流用\u003c/span\u003e\n            \u003cspan class=\"k\"\u003econtinue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"nl\"\u003edefault:\u003c/span\u003e \u003cspan class=\"k\"\u003ebreak\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n        \u003cspan class=\"n\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estrtoul\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003es\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003eendptr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"c1\"\u003e//無限ループ防止\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e((\u003c/span\u003e\u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)(\u003c/span\u003e\u003cspan class=\"n\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#ifdef NO_STDC_STATIC_ASSERT\n#   undef static_assert\n#   undef NO_STDC_STATIC_ASSERT\n#endif\n\u003c/span\u003e\n\u003cspan class=\"cp\"\u003e#ifndef _countof\n#define _countof(arr) (sizeof(arr) / sizeof(*arr))\n#endif\n\u003c/span\u003e\n\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e256\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eInputPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003einput_str\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e_countof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e \u003cspan class=\"s\"\u003e\"名前を入力してください\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\"不正な長さの入力です、もう一度入力してください\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%sでよろしいですか？？（「合ってます」：「1」を入力、「間違いました」：「1以外」を入力）\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003einput_uint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUINT_MAX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einput_uint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"年齢を入力してください\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUINT_MAX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%dでよろしいですか？？（「合ってます」：「1」を入力、「間違いました」：「1以外」を入力）\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003einput_uint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUINT_MAX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"k\"\u003edo\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003einput_uint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"性別を入力してください（「男性」：「1」を入力、「女性」：「2」を入力）\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\"%sでよろしいですか？？（「合ってます」：「1」を入力、「間違いました」：「1以外」を入力）\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"男性\"\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"女性\"\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003ewhile\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"n\"\u003einput_uint\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nb\"\u003eNULL\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eUINT_MAX\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e));\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eputchar\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"sc\"\u003e'\\n'\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"nf\"\u003eShowPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"n\"\u003ePeople\u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003eprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"名前：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"年齢：%d\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\n        \u003cspan class=\"s\"\u003e\"性別：%s\u003c/span\u003e\u003cspan class=\"se\"\u003e\\n\\n\u003c/span\u003e\u003cspan class=\"s\"\u003e\"\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n        \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eage\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esex\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e?\u003c/span\u003e \u003cspan class=\"s\"\u003e\"男性\"\u003c/span\u003e \u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\"女性\"\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003evoid\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"n\"\u003ePeople\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estdin\u003c/span\u003e\u003cspan class=\"p\"\u003e))\u003c/span\u003e \u003cspan class=\"n\"\u003eexit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eInputPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003esize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n        \u003cspan class=\"n\"\u003eShowPeople\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"n\"\u003ei\u003c/span\u003e\u003cspan class=\"p\"\u003e]);\u003c/span\u003e\n    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003ca href=\"https://wandbox.org/permlink/s4XjyyQWnTpgmINS\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://wandbox.org/permlink/s4XjyyQWnTpgmINS\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ccode\u003erestrict\u003c/code\u003eキーワードの使い方いまいちわかってない勢なのでそこは許して下さい。\u003c/p\u003e\n","body":"# はじめに\n\n2016年01月22日にQiitaに\n[C言語で安全に標準入力から数値を取得](https://qiita.com/yumetodo/items/238751b879c09b56234b)\nを投稿してからもう3年が経とうとしている。\n\n初投稿からいくつも不具合が見つかり、つい先日も`fgets`のエラーハンドリング周りでバグを見つけて改定した。C言語で安全に標準入力から数値を取得するのが難しすぎる。\n\nQiitaやteratailでCの標準入力から数値を取得しているものを見るたびに上の記事へ誘導し続けてきた。\n\nところで先日\n[C++ - 自分の解答の穴を見つけて頂けると助かります。｜teratail](https://teratail.com/questions/167222)\nという質問を発見した。元のコードは「苦しんで覚えるc言語」のとあるコードらしいが、改善点がいくつもある。\n\nさぁ、そろそろ「苦しんで覚えるc言語」に挑むか。\n\n・・・ちなみに筆者は「苦しんで覚えるc言語」立ち見勢ですが、良書だと思ってます。~~独習Cなんざ投げ捨てるべし~~\n\n# 元のコード\n\n```c\n#include\u003cstdio.h\u003e\n#include\u003cstring.h\u003e\ntypedef struct\n{\n    char name[256];\n    int age;\n    int sex;\n}People;\n\nvoid InputPeople(People *data);\nvoid ShowPeople(People data);\n\nint main(void)\n{\n    People data[3];\n    int i;\n\n    for (i = 0; i \u003c 3; i++)\n    {\n        InputPeople(\u0026data[i]);\n    }\n    for ( i = 0; i \u003c 3; i++)\n    {\n        ShowPeople(data[i]);\n    }\n    return 0;\n}\n\n\nvoid InputPeople(People *data)\n{\n    printf(\"名前：\");\n    scanf_s(\"%s\", \u0026data-\u003ename,256);\n    printf(\"年齢：\");\n    scanf_s(\"%d\", \u0026data-\u003eage);\n    printf(\"性別(1-男性、2-女性):\");\n    scanf(\"%d\", \u0026data-\u003esex);\n    printf(\"\\n\");\n}\n\n\nvoid ShowPeople(People data)\n{\n    char sex[16];\n\n    printf(\"名前：%s\\n\",data.name);\n    printf(\"年齢：%d\\n\",data.age);\n\n\n    if (data.sex == 1)\n    {\n        strcpy_s(sex, 16,\"男性\");\n    }\n    else\n    {\n        strcpy_s(sex, 16,\"女性\");\n    }\n    printf(\"性別：%s\\n\",sex);\n    printf(\"\\n\");\n}\n```\n\n# 改善できそうなところ\n\n## MSVCに依存したコード\n\n一部`scanf_s`じゃなくて`scanf`が見えるから、元のコードじゃなくて質問者が書き換えた疑惑があるけどそれはさておき。\n\n`_s`付き関数は一部はC11で標準にoptionalで入ったが、常に使えるわけではないしなんかやっぱりCから取り除くみたいな話も聞く。使わないように書き換えるべきだろう。\n\n## scanf系関数で数値を読み込まない\n\n[C言語で安全に標準入力から数値を取得](https://qiita.com/yumetodo/items/238751b879c09b56234b)\nでも他所でもさんざん指摘されているとおり、scanf系関数で安全に数値に変換することはできない。\n\n## 構造体コピーの排除\n\nコード中の構造体を見てみる。\n\n```c\ntypedef struct\n{\n    char name[256];\n    int age;\n    int sex;\n}People;\n```\n\n256要素ある`char`配列をメンバーに持つ。結構でかい構造体だ。しかし\n\n```c\nvoid ShowPeople(People data)\n```\n\nのように引数でコピーが発生する。どっちが速いかはきっと大差ないけど、メモリー使用量を無駄に増やすことはないと思う。ポインタ経由で渡そう。\n\n## 無意味な`strcpy_s`\n\n抜粋すると\n\n```c\nchar sex[16];\nif (data.sex == 1)\n{\n    strcpy_s(sex, 16,\"男性\");\n}\nelse\n{\n    strcpy_s(sex, 16,\"女性\");\n}\nprintf(\"性別：%s\\n\",sex);\n```\n\nこんなコードが見えるが、三項演算子を使うべき場面であって、strcpy_sを使うべき理由はない。\n\n## 不正な入力に対するエラー処理\n\n初心者本に求めるのは間違っているが、不正な入力に対する対策がない。\n\n## それunsignedにできるよ\n\n無味に符号付き整数型を使うような愚策は[Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html#Integer_Types)にでも任せておけばいい。そんな愚行に付き合う必要はない。\n\n符号がないことでバグを作り込む確率を大幅に下げられる。詳しくは\n[C/C++はnull安全になる前に安全に差の絶対値を計算できるようになるべきではないか](https://qiita.com/yumetodo/items/4ea151e15b5e540cfef5)\nを参照して欲しい。\n\n## 分裂した`printf`\n\nたしかに\n\n```c\nprintf(\"名前：%s\\n\",data.name);\nprintf(\"年齢：%d\\n\",data.age);\n```\n\nのように分けたほうが見やすいと主張する人がいるのは知っている。でも\n\n```c\nprintf(\n    \"名前：%s\\n\"\n    \"年齢：%d\\n\",\n    data.name, data.age\n);\n```\n\nくっつけたほうが見やすいと私は思う。\n\n## `printf(\"\\n\");`\n\n`printf`を使うべき理由がない。`putchar`で行こう。\n\n# 結果\n\n```c\n#include \u003cstdio.h\u003e\n#include \u003cstdlib.h\u003e\n#include \u003cstring.h\u003e\n#include \u003climits.h\u003e\n#include \u003cerrno.h\u003e\n#include \u003cstdbool.h\u003e\n#include \u003cctype.h\u003e\n#include \u003cfloat.h\u003e\n#include \u003cassert.h\u003e\n#ifndef static_assert\n#   define NO_STDC_STATIC_ASSERT\n#   define static_assert(...)\n#endif\n#if defined(_MSC_VER) || defined(__cplusplus)\n#   define restrict\n#endif\n/**\n * @brief 文字列が文字を持っているか調べます。\n * @param str 対象文字列へのポインタ\n * @return false: nullptrか空白文字のみの文字列 true:それ以外\n */\nstatic inline bool str_has_char(const char *str)\n{\n    if (NULL == str) return false;\n    bool ret = false;\n    for (; !ret \u0026\u0026 *str != '\\0'; str++) ret = (*str != ' ');\n    return ret;\n}\n/**\n * @brief 文字列が文字を持っているか調べます。\n * @param io 書き換えるbool型変数へのポインタ、呼び出し後はポインタが指す変数にnew_valueが代入される\n * @param new_value 新しい値\n * @return ioが指すbool変数がもともと持っていた値\n */\nstatic inline bool exchange_bool(bool* restrict const io, const bool new_value)\n{\n    const bool tmp = *io;\n    *io = new_value;\n    return tmp;\n}\n/**\n * @brief fgetsで失敗したときにストリームをクリアしてループする関数\n * @param s ストリームから読み取った文字列を格納するための領域へのポインタ\n * @param buf_size ストリームから読み取った文字列を格納するための領域の大きさ\n * @param stream FILE構造体へのポインタかstdin\n * @param message_on_error エラー時に表示してループする\n * @return 成功時は0, new line at the end of fileのときは-1\n */\nstatic inline int fgets_wrap(char* restrict const s, size_t buf_size, FILE* restrict const stream, const char* restrict message_on_error)\n{\n    size_t i = 0;\n    for (bool first_flg = true; i \u003c 100 \u0026\u0026 NULL == fgets(s, buf_size, stream); ++i) {\n        if (feof(stdin)) return -1;\n        if (!exchange_bool(\u0026first_flg, false)) puts((message_on_error) ? message_on_error : \"再入力してください\");\n    }\n    if (100u == i) exit(1);//無限ループ防止\n    if (feof(stdin)) return 0;\n    //改行文字が入力を受けた配列にない場合、入力ストリームにごみがある\n    const size_t len = strlen(s);\n    //短すぎる入力\n    if (0 == len || (1 == len \u0026\u0026 '\\n' == s[0])) return 1;\n    //長過ぎる入力\n    if ('\\n' != s[len - 1]) {\n        //入力ストリームを掃除\n        while (fgetc(stream) != '\\n');\n        return 2;\n    }\n    return 0;\n}\n\n/**\n * @brief 標準入力から文字列の入力を受ける\n * @param s ストリームから読み取った文字列を格納するための領域へのポインタ\n * @param buf_size ストリームから読み取った文字列を格納するための領域の大きさ\n * @param message 入力を受ける前にputsに渡す文字列。表示しない場合はnullptrか空白文字のみで構成された文字列へのポインタを渡す\n * @param message_on_error エラー時に表示してループする\n */\nstatic inline void input_str(char* restrict const s, size_t buf_size, const char* message, const char* restrict message_on_error)\n{\n    if (str_has_char(message)) puts(message);\n    size_t i = 0;\n    for (; i \u003c 100u; ++i) {\n        //長過ぎる入力以降の無限ループ防止にerrnoをクリアする\n        errno = 0;\n        switch (fgets_wrap(s, buf_size, stdin, message_on_error)) {\n        case -1: return;//EOF\n        case 1://短すぎる入力\n        case 2://長過ぎる入力\n            continue;\n        default: goto after_loop;\n        }\n    }\n    if (100u == i) exit(1);//無限ループ防止\nafter_loop:\n    {\n        char* const lf = strchr(s, '\\n');\n        if(NULL != lf) lf[0] = '\\0';\n    }\n}\n\n/**\n * @brief 標準入力から入力を受け、unsigned int型に変換する\n * @details fgetsしてstrtodしている。max, minの条件に合わないかエラー時はループ\n * @details errnoの値を書き換える\n * @param message 入力を受ける前にputsに渡す文字列。表示しない場合はnullptrか空白文字のみで構成された文字列へのポインタを渡す\n * @param message_on_error エラー時に表示してループする\n * @param max 入力値を制限する。最大値を指定\n * @param min 入力値を制限する。最小値を指定\n * @return 入力した数字、EOFのときは0\n */\nstatic inline unsigned int input_uint(const char* message, const char* restrict message_on_error, const unsigned int max, const unsigned int min)\n{\n    if (str_has_char(message)) puts(message);\n    char s[30];\n    static_assert(sizeof(unsigned int) \u003c 8, \"err\");\n    unsigned long t = 0;\n    size_t i = 0;\n    for (char* endptr = s; ((0 == t \u0026\u0026 endptr == s) || 0 != errno || t \u003c min || max \u003c t) \u0026\u0026 i \u003c 100u; ++i) {\n        //長過ぎる入力以降の無限ループ防止にerrnoをクリアする\n        errno = 0;\n        switch (fgets_wrap(s, sizeof(s), stdin, message_on_error)) {\n        case -1: return 0;//EOF\n        case 1://短すぎる入力\n        case 2://長過ぎる入力\n            endptr = s;//ループ制御フラグとして流用\n            continue;\n        default: break;\n        }\n        t = strtoul(s, \u0026endptr, 10);\n    }\n    if (100 == i) exit(1);//無限ループ防止\n    return ((unsigned int)(t));\n}\n#ifdef NO_STDC_STATIC_ASSERT\n#   undef static_assert\n#   undef NO_STDC_STATIC_ASSERT\n#endif\n\n#ifndef _countof\n#define _countof(arr) (sizeof(arr) / sizeof(*arr))\n#endif\n\ntypedef struct\n{\n    char name[256];\n    unsigned int age;\n    unsigned int sex;\n}People;\n\nvoid InputPeople(People *data)\n{\n    do {\n        input_str(data-\u003ename, _countof(data-\u003ename), \"名前を入力してください\", \"不正な長さの入力です、もう一度入力してください\");\n        printf(\"%sでよろしいですか？？（「合ってます」：「1」を入力、「間違いました」：「1以外」を入力）\\n\", data-\u003ename);\n    } while (!feof(stdin) \u0026\u0026 1 != input_uint(NULL, NULL, UINT_MAX, 0) \u0026\u0026 !feof(stdin));\n    if (feof(stdin)) exit(1);\n    do {\n        data-\u003eage = input_uint(\"年齢を入力してください\", NULL, UINT_MAX, 0);\n        printf(\"%dでよろしいですか？？（「合ってます」：「1」を入力、「間違いました」：「1以外」を入力）\\n\", data-\u003eage);\n    } while (!feof(stdin) \u0026\u0026 1 != input_uint(NULL, NULL, UINT_MAX, 0) \u0026\u0026 !feof(stdin));\n    if (feof(stdin)) exit(1);\n    do {\n        data-\u003esex = input_uint(\"性別を入力してください（「男性」：「1」を入力、「女性」：「2」を入力）\", NULL, 2, 1);\n        printf(\"%sでよろしいですか？？（「合ってます」：「1」を入力、「間違いました」：「1以外」を入力）\\n\", (1 == data-\u003esex) ? \"男性\" : \"女性\");\n    } while (!feof(stdin) \u0026\u0026 1 != input_uint(NULL, NULL, UINT_MAX, 0) \u0026\u0026 !feof(stdin));\n    putchar('\\n');\n}\nvoid ShowPeople(const People* data)\n{\n    printf(\n        \"名前：%s\\n\"\n        \"年齢：%d\\n\"\n        \"性別：%s\\n\\n\",\n        data-\u003ename, data-\u003eage, (data-\u003esex == 1) ? \"男性\" : \"女性\"\n    );\n}\n\nint main(void)\n{\n    People data[3];\n    for (size_t i = 0; i \u003c 3; i++) {\n        if (feof(stdin)) exit(1);\n        InputPeople(\u0026data[i]);\n    }\n    for (size_t i = 0; i \u003c 3; i++) {\n        ShowPeople(\u0026data[i]);\n    }\n    return 0;\n}\n```\n\n[https://wandbox.org/permlink/s4XjyyQWnTpgmINS](https://wandbox.org/permlink/s4XjyyQWnTpgmINS)\n\n`restrict`キーワードの使い方いまいちわかってない勢なのでそこは許して下さい。\n","coediting":false,"comments_count":2,"created_at":"2019-01-14T14:25:53+09:00","group":null,"id":"bb2885f8c99e02e3d104","likes_count":3,"private":false,"reactions_count":0,"tags":[{"name":"C","versions":[]},{"name":"C11","versions":[]}],"title":"「苦しんで覚えるc言語」のとあるコードをもっと安全に、より良く","updated_at":"2019-01-14T20:26:14+09:00","url":"https://qiita.com/yumetodo/items/bb2885f8c99e02e3d104","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null},{"rendered_body":"\n\u003ch1\u003e\n\u003cspan id=\"きっかけ\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E3%81%8D%E3%81%A3%E3%81%8B%E3%81%91\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eきっかけ\u003c/h1\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eI wish you a merry C++hristmas!\u003c/p\u003e— Meeting C++ (@meetingcpp) \u003ca href=\"https://twitter.com/meetingcpp/status/1077526290574598144?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003e2018年12月25日\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eこんなツイートがあった。いや、C++hristmasってどう発音するのさ・・・。\u003c/p\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eまって、どう発音したらいいんだ \u003ca href=\"https://t.co/i3IkKM6CLx\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/i3IkKM6CLx\u003c/a\u003e\u003c/p\u003e— yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1077744819139563520?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 26, 2018\u003c/a\u003e\n\u003c/blockquote\u003e \n\n\u003ch1\u003e\n\u003cspan id=\"stackoverflowで聞いてみた\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#stackoverflow%E3%81%A7%E8%81%9E%E3%81%84%E3%81%A6%E3%81%BF%E3%81%9F\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003eStackOverflowで聞いてみた。\u003c/h1\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eMis-directed Christmas spirit.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e訳: 誤ったクリスマスの精神\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eAh **** no, don't sully the best time of the year with that C++ crap. \u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e訳: おいっ、C++とかいうゴミでこの一年で最高の時間を汚すんじゃねぇ！\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eCould it beeeee SATAN?\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e訳: そそそそれって悪魔より恐ろしいのっ？\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eSATAN plus plus\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e訳: 悪魔++\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eOh no! That is where SATAN resides!!!\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e訳: なんてこった、ここが悪魔のいるところだったのねっ!!!\u003c/p\u003e\n\n\u003cp\u003e皆さんノリノリである。\u003c/p\u003e\n\n\u003cp\u003e\u003cdel\u003eのりのり過ぎて\u003c/del\u003e規約違反で質問はめでたく削除されました。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2Fbc4ad711-4589-584e-1ddd-925f8b8d19ad.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26f3c617870f23c06a535d6e51506613\" target=\"_blank\" rel=\"nofollow noopener\"\u003e\u003cimg src=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2Fbc4ad711-4589-584e-1ddd-925f8b8d19ad.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;s=26f3c617870f23c06a535d6e51506613\" alt=\"c++ - How should I pronounce C++hristmas - Stack Overflow 2018-12-26.png\" data-canonical-src=\"https://qiita-image-store.s3.amazonaws.com/0/94177/bc4ad711-4589-584e-1ddd-925f8b8d19ad.png\" srcset=\"https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.amazonaws.com%2F0%2F94177%2Fbc4ad711-4589-584e-1ddd-925f8b8d19ad.png?ixlib=rb-1.2.2\u0026amp;auto=format\u0026amp;gif-q=60\u0026amp;q=75\u0026amp;w=1400\u0026amp;fit=max\u0026amp;s=dc01aa5a99c421bcf0cfee9453801d03 1x\" loading=\"lazy\"\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://stackoverflow.com/questions/53927662/how-should-i-pronounce-christmas\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://stackoverflow.com/questions/53927662/how-should-i-pronounce-christmas\u003c/a\u003e\u003cbr\u003e\n(アクセスできない)\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"肝心の発音\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#%E8%82%9D%E5%BF%83%E3%81%AE%E7%99%BA%E9%9F%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e肝心の発音\u003c/h1\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eI wish you a merry Cplusplushristmas! \u003ca href=\"https://t.co/roATvXkDHF\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/roATvXkDHF\u003c/a\u003e\u003c/p\u003e— Destiny Gaia (@destiny_gaia) \u003ca href=\"https://twitter.com/destiny_gaia/status/1077794355958575104?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 26, 2018\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eしーぷらすぷらしゅりすます（早口で3回）\u003c/p\u003e— 白山風露@kazatsuyu@qiitadon.com (@kazatsuyu) \u003ca href=\"https://twitter.com/kazatsuyu/status/1077794414875992070?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 26, 2018\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eしーぷらすぷらすしゅりすます\u003c/p\u003e— Destiny Gaia (@destiny_gaia) \u003ca href=\"https://twitter.com/destiny_gaia/status/1077794700021526528?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 26, 2018\u003c/a\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eStackOverflowでは\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://stackoverflow.com/users/61/bernard\" rel=\"nofollow noopener\" target=\"_blank\"\u003eBernard\u003c/a\u003e\u003cbr\u003e\nSee Plus Plus Wristmas\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://stackoverflow.com/users/8423261/ruks\" rel=\"nofollow noopener\" target=\"_blank\"\u003eRuks\u003c/a\u003e\u003cbr\u003e\n\u003cem\u003e/ˈsiːˌplʌsˈplʌs rɪsməs/\u003c/em\u003e (See plus plus rismas)...\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eという意見が寄せられました。\u003c/p\u003e\n\n\u003ch1\u003e\n\u003cspan id=\"15歳\" class=\"fragment\"\u003e\u003c/span\u003e\u003ca href=\"#15%E6%AD%B3\"\u003e\u003ci class=\"fa fa-link\"\u003e\u003c/i\u003e\u003c/a\u003e15歳\u003c/h1\u003e\n\n\u003cp\u003e\u003c/p\u003e\u003cblockquote class=\"twitter-tweet\"\u003e\n\u003cp\u003eI unearthed a 15year-old C++hristmas message :3\u003ca href=\"https://t.co/ee8rRtxxdq\" rel=\"nofollow noopener\" target=\"_blank\"\u003e\u003c/a\u003e\u003ca href=\"https://t.co/ee8rRtxxdq\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\"\u003ehttps://t.co/ee8rRtxxdq\u003c/a\u003e\u003c/p\u003e— 黒翼猫|ω･)｡o(や、やばた2000) (@BlackWingCat) \u003ca href=\"https://twitter.com/BlackWingCat/status/1077806615351287808?ref_src=twsrc%5Etfw\" rel=\"nofollow noopener\" target=\"_blank\"\u003eDecember 26, 2018\u003c/a\u003e\n\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\"\u003e\u003c/script\u003e \n\n\u003cp\u003e\u003ca href=\"http://ars.userfriendly.org/cartoons/read.cgi?id=20031212\u0026amp;tid=972606\" rel=\"nofollow noopener\" target=\"_blank\"\u003eUserFriendly Strip Comments\u003c/a\u003e\u003c/p\u003e\n","body":"# きっかけ\n\n\u003cblockquote class=\"twitter-tweet\" data-lang=\"ja\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eI wish you a merry C++hristmas!\u003c/p\u003e\u0026mdash; Meeting C++ (@meetingcpp) \u003ca href=\"https://twitter.com/meetingcpp/status/1077526290574598144?ref_src=twsrc%5Etfw\"\u003e2018年12月25日\u003c/a\u003e\u003c/blockquote\u003e\n\nこんなツイートがあった。いや、C++hristmasってどう発音するのさ・・・。\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eまって、どう発音したらいいんだ \u003ca href=\"https://t.co/i3IkKM6CLx\"\u003ehttps://t.co/i3IkKM6CLx\u003c/a\u003e\u003c/p\u003e\u0026mdash; yumetodo-鳥の氷河から逃げる (@yumetodo) \u003ca href=\"https://twitter.com/yumetodo/status/1077744819139563520?ref_src=twsrc%5Etfw\"\u003eDecember 26, 2018\u003c/a\u003e\u003c/blockquote\u003e \n\n# StackOverflowで聞いてみた。\n\n\u003eMis-directed Christmas spirit.\n\n訳: 誤ったクリスマスの精神\n\n\u003eAh **** no, don't sully the best time of the year with that C++ crap. \n\n訳: おいっ、C++とかいうゴミでこの一年で最高の時間を汚すんじゃねぇ！\n\n\u003eCould it beeeee SATAN?\n\n訳: そそそそれって悪魔より恐ろしいのっ？\n\n\u003eSATAN plus plus\n\n訳: 悪魔++\n\n\u003eOh no! That is where SATAN resides!!!\n\n訳: なんてこった、ここが悪魔のいるところだったのねっ!!!\n\n皆さんノリノリである。\n\n~~のりのり過ぎて~~規約違反で質問はめでたく削除されました。\n\n![c++ - How should I pronounce C++hristmas - Stack Overflow 2018-12-26.png](https://qiita-image-store.s3.amazonaws.com/0/94177/bc4ad711-4589-584e-1ddd-925f8b8d19ad.png)\n\nhttps://stackoverflow.com/questions/53927662/how-should-i-pronounce-christmas\n(アクセスできない)\n\n# 肝心の発音\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eI wish you a merry Cplusplushristmas! \u003ca href=\"https://t.co/roATvXkDHF\"\u003ehttps://t.co/roATvXkDHF\u003c/a\u003e\u003c/p\u003e\u0026mdash; Destiny Gaia (@destiny_gaia) \u003ca href=\"https://twitter.com/destiny_gaia/status/1077794355958575104?ref_src=twsrc%5Etfw\"\u003eDecember 26, 2018\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eしーぷらすぷらしゅりすます（早口で3回）\u003c/p\u003e\u0026mdash; 白山風露@kazatsuyu@qiitadon.com (@kazatsuyu) \u003ca href=\"https://twitter.com/kazatsuyu/status/1077794414875992070?ref_src=twsrc%5Etfw\"\u003eDecember 26, 2018\u003c/a\u003e\u003c/blockquote\u003e\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"ja\" dir=\"ltr\"\u003eしーぷらすぷらすしゅりすます\u003c/p\u003e\u0026mdash; Destiny Gaia (@destiny_gaia) \u003ca href=\"https://twitter.com/destiny_gaia/status/1077794700021526528?ref_src=twsrc%5Etfw\"\u003eDecember 26, 2018\u003c/a\u003e\u003c/blockquote\u003e\n\nStackOverflowでは\n\n\u003e[Bernard](https://stackoverflow.com/users/61/bernard)\n\u003eSee Plus Plus Wristmas\n\n\u003e[Ruks](https://stackoverflow.com/users/8423261/ruks)\n\u003e*/ˈsiːˌplʌsˈplʌs rɪsməs/* (See plus plus rismas)...\n\nという意見が寄せられました。\n\n# 15歳\n\n\u003cblockquote class=\"twitter-tweet\"\u003e\u003cp lang=\"en\" dir=\"ltr\"\u003eI unearthed a 15year-old C++hristmas message :3\u003ca href=\"https://t.co/ee8rRtxxdq\"\u003ehttps://t.co/ee8rRtxxdq\u003c/a\u003e\u003c/p\u003e\u0026mdash; 黒翼猫|ω･)｡o(や、やばた2000) (@BlackWingCat) \u003ca href=\"https://twitter.com/BlackWingCat/status/1077806615351287808?ref_src=twsrc%5Etfw\"\u003eDecember 26, 2018\u003c/a\u003e\u003c/blockquote\u003e \u003cscript async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"\u003e\u003c/script\u003e \n\n[UserFriendly Strip Comments](http://ars.userfriendly.org/cartoons/read.cgi?id=20031212\u0026tid=972606)\n","coediting":false,"comments_count":1,"created_at":"2018-12-26T17:38:49+09:00","group":null,"id":"70b45549fa79c85bc621","likes_count":18,"private":false,"reactions_count":0,"tags":[{"name":"C++","versions":[]},{"name":"ポエム","versions":[]},{"name":"クリスマス","versions":[]}],"title":"C++hristmasってどう発音するかStackOverflowで聞いたときの反応","updated_at":"2018-12-26T17:38:49+09:00","url":"https://qiita.com/yumetodo/items/70b45549fa79c85bc621","user":{"description":"ありきたりなC++erです。最近C++書いていません(あれっ","facebook_id":"","followees_count":32,"followers_count":236,"github_login_name":"yumetodo","id":"yumetodo","items_count":110,"linkedin_id":"","location":"Tokyo, Japan","name":"","organization":"","permanent_id":94177,"profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/94177/profile-images/1473706190","team_only":false,"twitter_screen_name":"yumetodo","website_url":"http://yumetodo.hateblo.jp/"},"page_views_count":null}]